<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-circle.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"msclock.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"github-dark"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"livere","storage":true,"lazyload":false,"nav":null,"activeClass":"livere"},"stickytabs":true,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/config.min.js" defer></script>

    <meta name="description" content="开发社区 搜集的 C++ 问答社区   Visual Studio (Microsoft)   reddit   coedingGame   bytes   medium   dev.to   相关资源 C++ 比较庞杂，开源社区资源，整理如下：    资源 组织 类型      ISO CPP isocpp  规范    C++ Core Guidelines isocpp  规范    C++">
<meta property="og:type" content="article">
<meta property="og:title" content="cpp 实践">
<meta property="og:url" content="https://msclock.github.io/posts/caeaa4a1/index.html">
<meta property="og:site_name" content="Live in the present">
<meta property="og:description" content="开发社区 搜集的 C++ 问答社区   Visual Studio (Microsoft)   reddit   coedingGame   bytes   medium   dev.to   相关资源 C++ 比较庞杂，开源社区资源，整理如下：    资源 组织 类型      ISO CPP isocpp  规范    C++ Core Guidelines isocpp  规范    C++">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20231017/230851900.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20231017/232437083.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20231017/233022638.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20231017/235259259.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20231017/231243532.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230414/094944873.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122237604.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122321446.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122423034.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122133242.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122539805.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122714872.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122943427.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123058341.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123117721.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123153107.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123351709.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123542806.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/124158424.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/124335397.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/124448163.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/125543530.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/125638512.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/125724490.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/130002008.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/130050927.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20241117/130127444.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040647867.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040138315.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040316421.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040851364.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230410/041425126.png">
<meta property="og:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20230410/041544567.png">
<meta property="article:published_time" content="2019-12-17T00:25:02.000Z">
<meta property="article:modified_time" content="2025-04-18T05:53:17.564Z">
<meta property="article:author" content="Msclock">
<meta property="article:tag" content="cpp">
<meta property="article:tag" content="cmake">
<meta property="article:tag" content="msvc">
<meta property="article:tag" content="gnu">
<meta property="article:tag" content="vs">
<meta property="article:tag" content="gdb">
<meta property="article:tag" content="xmake">
<meta property="article:tag" content="vcpkg">
<meta property="article:tag" content="doxygen">
<meta property="article:tag" content="coverage">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/msclock/images/main/images/20231017/230851900.png">


<link rel="canonical" href="https://msclock.github.io/posts/caeaa4a1/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://msclock.github.io/posts/caeaa4a1/","path":"posts/caeaa4a1/","title":"cpp 实践"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>cpp 实践 | Live in the present</title>
  








  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/utils.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/motion.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/sidebar.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/next-boot.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/pjax.min.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/third-party/search/local-search.min.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/third-party/tags/pdf.min.js" defer></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/third-party/tags/mermaid.min.js" defer></script>



  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/third-party/pace.min.js" defer></script>


  




  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous" defer></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://msclock.github.io/posts/caeaa4a1/"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/third-party/quicklink.min.js" defer></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Live in the present</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Msclock's Notes</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">32</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">50</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%A4%BE%E5%8C%BA"><span class="nav-number">1.</span> <span class="nav-text">开发社区</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90"><span class="nav-number">2.</span> <span class="nav-text">相关资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode"><span class="nav-number">3.</span> <span class="nav-text">vscode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Devcontainer"><span class="nav-number">3.1.</span> <span class="nav-text">Devcontainer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extsension"><span class="nav-number">3.2.</span> <span class="nav-text">Extsension</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debug"><span class="nav-number">3.3.</span> <span class="nav-text">Debug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CI"><span class="nav-number">4.</span> <span class="nav-text">CI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GitHub-Action"><span class="nav-number">4.1.</span> <span class="nav-text">GitHub Action</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Resource-Template"><span class="nav-number">5.</span> <span class="nav-text">Resource Template</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cpp-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF"><span class="nav-number">5.1.</span> <span class="nav-text">cpp 项目模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cmake-%E6%A8%A1%E5%9D%97%E6%A8%A1%E6%9D%BF"><span class="nav-number">5.2.</span> <span class="nav-text">cmake 模块模板</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMake"><span class="nav-number">6.</span> <span class="nav-text">CMake</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Beginner"><span class="nav-number">6.1.</span> <span class="nav-text">CMake Beginner</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Variables"><span class="nav-number">6.2.</span> <span class="nav-text">CMake Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CMAKE-MODULE-PATH"><span class="nav-number">6.2.1.</span> <span class="nav-text">CMAKE_MODULE_PATH</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMAKE-PREFIX-PATH"><span class="nav-number">6.2.2.</span> <span class="nav-text">CMAKE_PREFIX_PATH</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Platform-Specific"><span class="nav-number">6.2.3.</span> <span class="nav-text">Platform Specific</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Configuration"><span class="nav-number">6.3.</span> <span class="nav-text">CMake Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E8%AF%B4%E6%98%8E"><span class="nav-number">6.3.1.</span> <span class="nav-text">配置内置变量说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMakePresets"><span class="nav-number">6.4.</span> <span class="nav-text">CMakePresets</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CMakePresets-%E6%A8%A1%E6%9D%BF"><span class="nav-number">6.4.1.</span> <span class="nav-text">CMakePresets 模板</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Regex"><span class="nav-number">6.5.</span> <span class="nav-text">CMake Regex</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E7%BA%A6%E6%9D%9F"><span class="nav-number">6.5.1.</span> <span class="nav-text">规则约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMAKE-MATCH-n"><span class="nav-number">6.5.2.</span> <span class="nav-text">CMAKE_MATCH_&lt;n&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E5%B8%B8%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">6.5.3.</span> <span class="nav-text">正则常用场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Project"><span class="nav-number">6.6.</span> <span class="nav-text">CMake Project</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cmake-init"><span class="nav-number">6.6.1.</span> <span class="nav-text">cmake-init</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Vscode-Integration"><span class="nav-number">6.7.</span> <span class="nav-text">CMake Vscode Integration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Vscode-CMake-Tools"><span class="nav-number">6.7.1.</span> <span class="nav-text">Vscode CMake Tools</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-Tips"><span class="nav-number">6.8.</span> <span class="nav-text">CMake Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E6%88%90-C-C-threads"><span class="nav-number">6.8.1.</span> <span class="nav-text">集成 C&#x2F;C++ threads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%B0%E7%BB%9F%E4%B8%80%E8%B7%AF%E5%BE%84"><span class="nav-number">6.8.2.</span> <span class="nav-text">构建结果输出到统一路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-DEBUG-%E5%AE%8F"><span class="nav-number">6.8.3.</span> <span class="nav-text">配置 _DEBUG 宏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%BD%E5%8A%A0-CMake-%E8%84%9A%E6%9C%AC%E8%B7%AF%E5%BE%84"><span class="nav-number">6.8.4.</span> <span class="nav-text">追加 CMake 脚本路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMake-%E4%B8%AD%E6%B3%A8%E9%87%8A"><span class="nav-number">6.8.5.</span> <span class="nav-text">CMake 中注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E9%80%89%E9%A1%B9%E9%80%9A%E8%BF%87%E7%9B%AE%E6%A0%87%E9%93%BE%E6%8E%A5"><span class="nav-number">6.8.6.</span> <span class="nav-text">将选项通过目标链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E6%96%87%E4%BB%B6"><span class="nav-number">6.8.7.</span> <span class="nav-text">搜索文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E7%AC%A6%E5%8F%B7"><span class="nav-number">6.8.8.</span> <span class="nav-text">导出符号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%81%E7%94%A8-CMakeLists-txt-%E8%B7%AF%E5%BE%84%E6%9E%84%E5%BB%BA"><span class="nav-number">6.8.9.</span> <span class="nav-text">禁用 CMakeLists.txt 路径构建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="nav-number">6.8.10.</span> <span class="nav-text">符号可见性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%93%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="nav-number">6.8.11.</span> <span class="nav-text">库版本控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E5%BA%93"><span class="nav-number">6.8.12.</span> <span class="nav-text">打包库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FetchContent"><span class="nav-number">6.8.13.</span> <span class="nav-text">FetchContent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%BA%93-libConfig-cmake"><span class="nav-number">6.8.14.</span> <span class="nav-text">配置库 libConfig.cmake</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMake-Debugger"><span class="nav-number">6.8.15.</span> <span class="nav-text">CMake Debugger</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#include-gurad"><span class="nav-number">6.8.16.</span> <span class="nav-text">include_gurad</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E5%B8%B8%E7%94%A8%E7%9A%84%E9%9D%99%E6%80%81%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7"><span class="nav-number">6.8.17.</span> <span class="nav-text">集成常用的静态检测工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D-%E5%B1%95%E5%BC%80%E5%B9%B2%E6%89%B0"><span class="nav-number">6.8.18.</span> <span class="nav-text">避免 ; 展开干扰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMake%E4%B8%AD%E5%A4%84%E7%90%86rpath"><span class="nav-number">6.8.19.</span> <span class="nav-text">CMake 中处理 rpath</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMake-install-imported-lib"><span class="nav-number">6.8.20.</span> <span class="nav-text">CMake install imported lib</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Platform-check"><span class="nav-number">6.8.21.</span> <span class="nav-text">Platform check</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-ctest"><span class="nav-number">6.9.</span> <span class="nav-text">CMake ctest</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cdash"><span class="nav-number">6.9.1.</span> <span class="nav-text">cdash</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vcpkg"><span class="nav-number">7.</span> <span class="nav-text">vcpkg</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Integration"><span class="nav-number">7.1.</span> <span class="nav-text">Integration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dependencies"><span class="nav-number">7.2.</span> <span class="nav-text">dependencies</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#overrides-version"><span class="nav-number">7.2.1.</span> <span class="nav-text">overrides version</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#triplet"><span class="nav-number">7.3.</span> <span class="nav-text">triplet</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#custom-triplet"><span class="nav-number">7.3.1.</span> <span class="nav-text">custom triplet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#port"><span class="nav-number">7.4.</span> <span class="nav-text">port</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#patch-port"><span class="nav-number">7.4.1.</span> <span class="nav-text">patch port</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#empty-policy"><span class="nav-number">7.4.2.</span> <span class="nav-text">empty policy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vcpkg-cmake-wrapper-cmake"><span class="nav-number">7.4.3.</span> <span class="nav-text">vcpkg-cmake-wrapper.cmake</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#baseline"><span class="nav-number">7.4.4.</span> <span class="nav-text">baseline</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#update-port"><span class="nav-number">7.4.5.</span> <span class="nav-text">update port</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vcpkg-%E5%8A%A0%E9%80%9F"><span class="nav-number">7.5.</span> <span class="nav-text">vcpkg 加速</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E5%8A%A0%E9%80%9F"><span class="nav-number">7.5.1.</span> <span class="nav-text">使用代理加速</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E7%A7%81%E5%9F%9F%E7%BC%93%E5%AD%98"><span class="nav-number">7.5.2.</span> <span class="nav-text">搭建私域缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BD%E5%86%85%E5%85%AC%E5%BC%80%E7%BC%93%E5%AD%98"><span class="nav-number">7.5.3.</span> <span class="nav-text">国内公开缓存</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">7.6.</span> <span class="nav-text">常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#export"><span class="nav-number">7.6.1.</span> <span class="nav-text">export</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#install"><span class="nav-number">7.6.2.</span> <span class="nav-text">install</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Github-Actions"><span class="nav-number">7.7.</span> <span class="nav-text">Github Actions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vcpkg-registry"><span class="nav-number">7.8.</span> <span class="nav-text">vcpkg-registry</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#create-registry"><span class="nav-number">7.8.1.</span> <span class="nav-text">create registry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-registry"><span class="nav-number">7.8.2.</span> <span class="nav-text">using registry</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vcpkg-configuration"><span class="nav-number">7.9.</span> <span class="nav-text">vcpkg configuration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#canon"><span class="nav-number">8.</span> <span class="nav-text">canon</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88cmake"><span class="nav-number">8.1.</span> <span class="nav-text">结合 cmake</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xmake"><span class="nav-number">9.</span> <span class="nav-text">xmake</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ref-%E5%8F%82%E8%80%83"><span class="nav-number">9.1.</span> <span class="nav-text">ref 参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clang-format"><span class="nav-number">10.</span> <span class="nav-text">clang-format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WSL"><span class="nav-number">11.</span> <span class="nav-text">WSL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">11.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB"><span class="nav-number">11.2.</span> <span class="nav-text">文件共享</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows"><span class="nav-number">12.</span> <span class="nav-text">Windows</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MSVC"><span class="nav-number">12.1.</span> <span class="nav-text">MSVC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Visual-Studio"><span class="nav-number">12.2.</span> <span class="nav-text">Visual Studio</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-number">12.2.1.</span> <span class="nav-text">编译</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6"><span class="nav-number">12.2.2.</span> <span class="nav-text">插件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5"><span class="nav-number">12.3.</span> <span class="nav-text">链接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5"><span class="nav-number">12.3.1.</span> <span class="nav-text">动态链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E6%80%A7-2"><span class="nav-number">12.3.2.</span> <span class="nav-text">符号可见性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%BA%93%E6%90%9C%E7%B4%A2%E8%B7%AF%E5%BE%84"><span class="nav-number">12.3.3.</span> <span class="nav-text">链接库搜索路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BE%9D%E8%B5%96-dll"><span class="nav-number">12.3.4.</span> <span class="nav-text">查看依赖 dll</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MSVC-C-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">12.4.</span> <span class="nav-text">MSVC C++ 代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MFC"><span class="nav-number">12.5.</span> <span class="nav-text">MFC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84-MFC-%E7%A4%BA%E4%BE%8B"><span class="nav-number">12.5.1.</span> <span class="nav-text">简单的 MFC 示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LLVM-on-Windows"><span class="nav-number">12.6.</span> <span class="nav-text">LLVM on Windows</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unix"><span class="nav-number">13.</span> <span class="nav-text">Unix</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5"><span class="nav-number">13.1.</span> <span class="nav-text">编译和链接</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E6%88%96%E5%AF%B9%E8%B1%A1%E6%96%87%E4%BB%B6%E7%9A%84%E8%8A%82%E8%A1%A8%E5%92%8C%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="nav-number">13.1.1.</span> <span class="nav-text">可执行文件或对象文件的节表和内存映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E8%A1%A8"><span class="nav-number">13.1.2.</span> <span class="nav-text">节表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="nav-number">13.1.3.</span> <span class="nav-text">内存映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5"><span class="nav-number">13.1.4.</span> <span class="nav-text">静态链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Position-Independent-Code"><span class="nav-number">13.1.5.</span> <span class="nav-text">Position Independent Code</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Resolution-Time"><span class="nav-number">13.1.6.</span> <span class="nav-text">Resolution Time</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lazy-Bind"><span class="nav-number">13.1.7.</span> <span class="nav-text">Lazy Bind</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Procedure-Linkage-Table-PLT"><span class="nav-number">13.1.8.</span> <span class="nav-text">Procedure Linkage Table(PLT)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E6%80%A7-3"><span class="nav-number">13.1.9.</span> <span class="nav-text">符号可见性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5-2"><span class="nav-number">13.1.10.</span> <span class="nav-text">动态链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E5%BC%8F%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5"><span class="nav-number">13.1.11.</span> <span class="nav-text">显式动态链接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unix-%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-number">13.2.</span> <span class="nav-text">Unix 软件编译安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Python-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E7%A4%BA%E4%BE%8B"><span class="nav-number">13.2.1.</span> <span class="nav-text">Python 编译安装示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GDB"><span class="nav-number">13.3.</span> <span class="nav-text">GDB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#gdb-dashboard"><span class="nav-number">13.3.1.</span> <span class="nav-text">gdb dashboard</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gdb-%E5%BF%AB%E9%80%9F%E6%89%93%E5%8D%B0-vector-%E7%AD%89%E5%AE%B9%E5%99%A8"><span class="nav-number">13.3.2.</span> <span class="nav-text">gdb 快速打印 vector 等容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gdb-%E9%85%8D%E5%90%88-vscode-%E8%B0%83%E8%AF%95-%E9%99%84%E5%8A%A0"><span class="nav-number">13.3.3.</span> <span class="nav-text">gdb 配合 vscode 调试 &#x2F; 附加</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gdb-%E6%90%9C%E7%B4%A2%E6%BA%90%E7%A0%81%E4%BD%8D%E7%BD%AE"><span class="nav-number">13.3.4.</span> <span class="nav-text">gdb 搜索源码位置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GCC-G"><span class="nav-number">13.4.</span> <span class="nav-text">GCC&#x2F;G++</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="nav-number">13.4.1.</span> <span class="nav-text">常用编译参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E9%80%89%E9%A1%B9-Optimize-Options"><span class="nav-number">13.4.2.</span> <span class="nav-text">优化选项 Optimize-Options</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GCC%E8%B0%83%E8%AF%95%E9%80%89%E9%A1%B9"><span class="nav-number">13.4.3.</span> <span class="nav-text">GCC 调试选项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Clang-Clang"><span class="nav-number">13.5.</span> <span class="nav-text">Clang&#x2F;Clang++</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0-2"><span class="nav-number">13.5.1.</span> <span class="nav-text">常用编译参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jupyter"><span class="nav-number">14.</span> <span class="nav-text">Jupyter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docs"><span class="nav-number">15.</span> <span class="nav-text">Docs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sphinx"><span class="nav-number">15.1.</span> <span class="nav-text">sphinx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Doxygen"><span class="nav-number">15.2.</span> <span class="nav-text">Doxygen</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A%E7%89%B9%E6%AE%8A%E6%A0%87%E8%AE%B0"><span class="nav-number">15.2.1.</span> <span class="nav-text">注释特殊标记</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Coverage"><span class="nav-number">16.</span> <span class="nav-text">Coverage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#QA"><span class="nav-number">16.1.</span> <span class="nav-text">QA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">16.2.</span> <span class="nav-text">配置原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="nav-number">16.2.1.</span> <span class="nav-text">编译参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90"><span class="nav-number">16.2.2.</span> <span class="nav-text">生成</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E4%B8%89%E6%96%B9"><span class="nav-number">16.3.</span> <span class="nav-text">集成三方</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-%E7%A4%BA%E4%BE%8B"><span class="nav-number">16.4.</span> <span class="nav-text">CMake 示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Program"><span class="nav-number">17.</span> <span class="nav-text">Program</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-Program-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"><span class="nav-number">17.1.</span> <span class="nav-text">Linux Program 内存模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Assembly"><span class="nav-number">18.</span> <span class="nav-text">Assembly</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">18.1.</span> <span class="nav-text">常用工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">18.2.</span> <span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4"><span class="nav-number">18.3.</span> <span class="nav-text">指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arm-assembly"><span class="nav-number">18.4.</span> <span class="nav-text">arm assembly</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C"><span class="nav-number">19.</span> <span class="nav-text">C</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#C-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">19.1.</span> <span class="nav-text">C 内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#API"><span class="nav-number">19.1.1.</span> <span class="nav-text">API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#malloc"><span class="nav-number">19.1.2.</span> <span class="nav-text">malloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#calloc"><span class="nav-number">19.1.3.</span> <span class="nav-text">calloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#realloc"><span class="nav-number">19.1.4.</span> <span class="nav-text">realloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#alloca"><span class="nav-number">19.1.5.</span> <span class="nav-text">alloca</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#aligned-alloc"><span class="nav-number">19.1.6.</span> <span class="nav-text">aligned_alloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">19.1.7.</span> <span class="nav-text">内存分配函数的返回值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E8%B5%84%E6%BA%90%E7%9A%84%E5%88%86%E9%85%8D%E4%B8%8E%E9%87%8A%E6%94%BE"><span class="nav-number">19.1.8.</span> <span class="nav-text">内存资源的分配与释放</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E6%8C%87%E9%92%88%E8%BF%9B%E8%A1%8C%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">19.1.9.</span> <span class="nav-text">返回指针进行强制类型转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91%E4%B8%80%E5%9D%97%E5%90%88%E6%B3%95%E7%9A%84%E5%86%85%E5%AD%98"><span class="nav-number">19.1.10.</span> <span class="nav-text">指向一块合法的内存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E9%85%8D%E8%B6%B3%E5%A4%9F%E7%9A%84%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4"><span class="nav-number">19.1.11.</span> <span class="nav-text">分配足够的内存空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%81%E6%AD%A2%E6%89%A7%E8%A1%8C%E9%9B%B6%E9%95%BF%E5%BA%A6%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D"><span class="nav-number">19.1.12.</span> <span class="nav-text">禁止执行零长度的内存分配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%A4%A7%E5%9E%8B%E7%9A%84%E5%A0%86%E6%A0%88%E5%88%86%E9%85%8D"><span class="nav-number">19.1.13.</span> <span class="nav-text">避免大型的堆栈分配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E4%BD%86%E5%B9%B6%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">19.1.14.</span> <span class="nav-text">避免内存分配成功，但并未初始化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-%E5%AE%8F%EF%BC%88macro%EF%BC%89"><span class="nav-number">19.2.</span> <span class="nav-text">C 宏（macro）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%AE%8F"><span class="nav-number">19.2.1.</span> <span class="nav-text">特殊宏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VA-ARGS"><span class="nav-number">19.2.2.</span> <span class="nav-text">__VA_ARGS__</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">19.2.3.</span> <span class="nav-text">#</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#-2"><span class="nav-number">19.2.4.</span> <span class="nav-text">##</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%AE%8F%EF%BC%8C%E6%B1%82%E4%B8%A4%E4%B8%AA%E6%95%B0%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0"><span class="nav-number">19.2.5.</span> <span class="nav-text">定义一个宏，求两个数中的最大数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88"><span class="nav-number">19.3.</span> <span class="nav-text">函数指针</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91%E6%99%AE%E9%80%9A%E5%87%BD%E6%95%B0%E7%9A%84%E6%8C%87%E9%92%88"><span class="nav-number">19.3.1.</span> <span class="nav-text">指向普通函数的指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E6%95%B0%E7%BB%84"><span class="nav-number">19.3.2.</span> <span class="nav-text">函数指针数组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91%E2%80%98%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E6%95%B0%E7%BB%84%E2%80%99%E7%9A%84%E6%8C%87%E9%92%88"><span class="nav-number">19.3.3.</span> <span class="nav-text">指向‘函数指针数组’的指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E4%B8%8E%E7%B1%BB"><span class="nav-number">19.3.4.</span> <span class="nav-text">函数指针与类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91%E7%B1%BB%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%87%E9%92%88"><span class="nav-number">19.3.5.</span> <span class="nav-text">指向类成员变量的指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91%E7%B1%BB%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E6%8C%87%E9%92%88"><span class="nav-number">19.3.6.</span> <span class="nav-text">指向类成员函数的指针</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%90%91%E7%B1%BB%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E7%9A%84%E6%8C%87%E9%92%88"><span class="nav-number">19.3.7.</span> <span class="nav-text">指向类静态成员的指针</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OOP-In-C"><span class="nav-number">19.4.</span> <span class="nav-text">OOP In C</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">19.5.</span> <span class="nav-text">多线程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pthreads"><span class="nav-number">19.5.1.</span> <span class="nav-text">pthreads</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPP"><span class="nav-number">20.</span> <span class="nav-text">CPP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPP-Project"><span class="nav-number">20.1.</span> <span class="nav-text">CPP Project</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Files-in-cpp"><span class="nav-number">20.1.1.</span> <span class="nav-text">Files in cpp</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Learning-Basics"><span class="nav-number">20.2.</span> <span class="nav-text">Learning Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#assert"><span class="nav-number">20.2.1.</span> <span class="nav-text">assert</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Namespace"><span class="nav-number">20.2.2.</span> <span class="nav-text">Namespace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Template"><span class="nav-number">20.2.3.</span> <span class="nav-text">Template</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#static-assert"><span class="nav-number">20.2.4.</span> <span class="nav-text">static assert</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fold-expressions"><span class="nav-number">20.2.5.</span> <span class="nav-text">Fold expressions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#require-C-20"><span class="nav-number">20.2.6.</span> <span class="nav-text">require(C++20)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#std-variant-and-std-any"><span class="nav-number">20.2.7.</span> <span class="nav-text">std::variant and std::any</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterator-and-Tools"><span class="nav-number">20.2.8.</span> <span class="nav-text">Iterator and Tools</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8Container"><span class="nav-number">20.3.</span> <span class="nav-text">容器 Container</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91thread"><span class="nav-number">20.4.</span> <span class="nav-text">并发 thread</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sharing-data"><span class="nav-number">20.4.1.</span> <span class="nav-text">sharing data</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API-Design"><span class="nav-number">20.5.</span> <span class="nav-text">API Design</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Better-naming"><span class="nav-number">20.5.1.</span> <span class="nav-text">Better naming</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-strong-types"><span class="nav-number">20.5.2.</span> <span class="nav-text">Use strong types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Avoid-easily-swappable-params"><span class="nav-number">20.5.3.</span> <span class="nav-text">Avoid easily swappable params</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Carefully-think-about-intent"><span class="nav-number">20.5.4.</span> <span class="nav-text">Carefully think about intent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nodiscard"><span class="nav-number">20.5.5.</span> <span class="nav-text">[[nodiscard]]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#noexcept"><span class="nav-number">20.5.6.</span> <span class="nav-text">noexcept</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Never-Return-a-Raw-Pointer"><span class="nav-number">20.5.7.</span> <span class="nav-text">Never Return a Raw Pointer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Consistent-Error-Handling"><span class="nav-number">20.5.8.</span> <span class="nav-text">Consistent Error Handling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Avoid-Implicit-Conversions"><span class="nav-number">20.5.9.</span> <span class="nav-text">Avoid Implicit Conversions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete-Problematic-Overloads"><span class="nav-number">20.5.10.</span> <span class="nav-text">&#x3D;delete Problematic Overloads</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Guideline-for-Design-Classes-easy-change-and-extensions"><span class="nav-number">20.5.11.</span> <span class="nav-text">Guideline for Design Classes: easy change and extensions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Resource-Management"><span class="nav-number">20.5.12.</span> <span class="nav-text">Resource Management</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Data-Member-Initialization"><span class="nav-number">20.5.13.</span> <span class="nav-text">Data Member Initialization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prefer-Free-Function"><span class="nav-number">20.5.14.</span> <span class="nav-text">Prefer Free Function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Encapsulate-in-namespace"><span class="nav-number">20.5.15.</span> <span class="nav-text">Encapsulate in namespace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-std-string-view"><span class="nav-number">20.5.16.</span> <span class="nav-text">Use std::string_view</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Make-constants-in-configuration"><span class="nav-number">20.5.17.</span> <span class="nav-text">Make constants in configuration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Comment-the-purpose-and-usage"><span class="nav-number">20.5.18.</span> <span class="nav-text">Comment the purpose and usage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-byte-array-or-data-structure"><span class="nav-number">20.5.19.</span> <span class="nav-text">Use byte array or data structure</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Seal-coupled-parameters"><span class="nav-number">20.5.20.</span> <span class="nav-text">Seal coupled parameters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Seal-too-many-defaults"><span class="nav-number">20.5.21.</span> <span class="nav-text">Seal too many defaults</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Must-be-initialized"><span class="nav-number">20.5.22.</span> <span class="nav-text">Must be initialized</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Create-Unique-type-with-enum-for-Integer-types"><span class="nav-number">20.5.23.</span> <span class="nav-text">Create Unique type with enum for Integer types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Error-Handling-Strategies"><span class="nav-number">20.5.24.</span> <span class="nav-text">Error Handling Strategies</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Design-Pattern"><span class="nav-number">20.6.</span> <span class="nav-text">Design Pattern</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Idioms-C"><span class="nav-number">20.7.</span> <span class="nav-text">Idioms C++</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#X-Macro"><span class="nav-number">20.7.1.</span> <span class="nav-text">X Macro</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RAII-Resource-Acquisition-Is-Initialization"><span class="nav-number">20.7.2.</span> <span class="nav-text">RAII-Resource Acquisition Is Initialization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Thread-safe-singleton"><span class="nav-number">20.7.3.</span> <span class="nav-text">Thread-safe singleton</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Policy-based-class-Design"><span class="nav-number">20.7.4.</span> <span class="nav-text">Policy-based class Design</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pimpl-Pointer-to-implementation"><span class="nav-number">20.7.5.</span> <span class="nav-text">Pimpl - Pointer to implementation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CRTP-The-curiously-recurring-template-pattern"><span class="nav-number">20.7.6.</span> <span class="nav-text">CRTP -The curiously recurring template pattern</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HAP-Handler-on-Aggregation-with-Polymorphism"><span class="nav-number">20.7.7.</span> <span class="nav-text">HAP - Handler on Aggregation with Polymorphism</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NVI-Non-Virtual-Interface"><span class="nav-number">20.7.8.</span> <span class="nav-text">NVI - Non Virtual Interface</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MutextProtected"><span class="nav-number">20.7.9.</span> <span class="nav-text">MutextProtected</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TEBI-Type-erease-better-than-inheritance"><span class="nav-number">20.7.10.</span> <span class="nav-text">TEBI - Type erease better than inheritance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dependency-Injection"><span class="nav-number">20.8.</span> <span class="nav-text">Dependency Injection</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="nav-number">20.8.1.</span> <span class="nav-text">基本流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95"><span class="nav-number">20.8.2.</span> <span class="nav-text">基本方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dependency-Injection-Basic"><span class="nav-number">20.8.3.</span> <span class="nav-text">Dependency Injection Basic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Constructor-DI"><span class="nav-number">20.8.4.</span> <span class="nav-text">Constructor DI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reflection"><span class="nav-number">20.9.</span> <span class="nav-text">Reflection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lock-free"><span class="nav-number">20.10.</span> <span class="nav-text">lock-free</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ABI-C"><span class="nav-number">20.11.</span> <span class="nav-text">ABI C++</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#unwind-exception-%E5%A0%86%E6%A0%88%E5%BC%82%E5%B8%B8%E5%B1%95%E5%BC%80"><span class="nav-number">20.11.1.</span> <span class="nav-text">unwind exception 堆栈异常展开</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#stack-unwind-%E5%A0%86%E6%A0%88%E5%B1%95%E5%BC%80"><span class="nav-number">20.11.2.</span> <span class="nav-text">stack unwind 堆栈展开</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MinGW-ABI"><span class="nav-number">20.11.3.</span> <span class="nav-text">MinGW ABI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Native-API"><span class="nav-number">20.12.</span> <span class="nav-text">Native API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#jni"><span class="nav-number">20.12.1.</span> <span class="nav-text">jni</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Weekly-Practice"><span class="nav-number">20.13.</span> <span class="nav-text">Weekly Practice</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Void-Pointer-Arithmetic"><span class="nav-number">20.13.1.</span> <span class="nav-text">Void Pointer Arithmetic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#std-expected-std-optional"><span class="nav-number">20.13.2.</span> <span class="nav-text">std::expected&#x2F;std::optional</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#core-guideline"><span class="nav-number">20.14.</span> <span class="nav-text">core guideline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Development-Utilities"><span class="nav-number">20.15.</span> <span class="nav-text">Development Utilities</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optimization"><span class="nav-number">21.</span> <span class="nav-text">Optimization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#perf"><span class="nav-number">21.1.</span> <span class="nav-text">perf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Guidelines"><span class="nav-number">21.2.</span> <span class="nav-text">Guidelines</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">21.3.</span> <span class="nav-text">测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E9%9D%9E%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6"><span class="nav-number">21.3.1.</span> <span class="nav-text">依赖非代码文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GTest-Main"><span class="nav-number">21.3.2.</span> <span class="nav-text">GTest Main</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E4%B9%89%E4%BC%98%E5%8C%96%EF%BC%88%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="nav-number">21.4.</span> <span class="nav-text">语义优化（语言相关）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%8F%E5%B0%91-virtual"><span class="nav-number">21.4.1.</span> <span class="nav-text">减少 virtual</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cin-tie-%E5%92%8C-ios-sync-with-stdio"><span class="nav-number">21.4.2.</span> <span class="nav-text">cin.tie 和 ios::sync_with_stdio</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%B3%95"><span class="nav-number">21.5.</span> <span class="nav-text">算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="nav-number">21.5.1.</span> <span class="nav-text">数据结构（容器）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hash"><span class="nav-number">21.5.2.</span> <span class="nav-text">hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sort"><span class="nav-number">21.5.3.</span> <span class="nav-text">sort</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Orbit"><span class="nav-number">21.6.</span> <span class="nav-text">Orbit</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#todo"><span class="nav-number">21.6.1.</span> <span class="nav-text">todo</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Profiler"><span class="nav-number">21.7.</span> <span class="nav-text">Profiler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hardening"><span class="nav-number">21.8.</span> <span class="nav-text">Hardening</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E5%BD%A2%E5%AD%A6"><span class="nav-number">22.</span> <span class="nav-text">图形学</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5%E4%B8%89%E7%BB%B4%E5%8F%98%E6%8D%A2"><span class="nav-number">22.1.</span> <span class="nav-text">矩阵三维变换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5"><span class="nav-number">22.1.1.</span> <span class="nav-text">矩阵</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88"><span class="nav-number">22.2.</span> <span class="nav-text">曲线拟合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E6%AC%A1%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88"><span class="nav-number">22.2.1.</span> <span class="nav-text">二次曲线拟合</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%86%E7%A0%81%E5%AD%A6"><span class="nav-number">22.3.</span> <span class="nav-text">密码学</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7"><span class="nav-number">23.</span> <span class="nav-text">基础工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2"><span class="nav-number">23.1.</span> <span class="nav-text">编码转换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#wstring-and-string"><span class="nav-number">23.1.1.</span> <span class="nav-text">wstring and string</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E5%BA%93"><span class="nav-number">24.</span> <span class="nav-text">框架库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#STL"><span class="nav-number">24.1.</span> <span class="nav-text">STL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#abseil"><span class="nav-number">24.2.</span> <span class="nav-text">abseil</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">24.2.1.</span> <span class="nav-text">简介</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hotels-template-library"><span class="nav-number">24.3.</span> <span class="nav-text">hotels-template-library</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kicad"><span class="nav-number">24.4.</span> <span class="nav-text">kicad</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Boost-Geometry"><span class="nav-number">24.5.</span> <span class="nav-text">Boost.Geometry</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#single-file-libs"><span class="nav-number">24.6.</span> <span class="nav-text">single file libs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Boost"><span class="nav-number">24.7.</span> <span class="nav-text">Boost</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dynamix"><span class="nav-number">24.8.</span> <span class="nav-text">dynamix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#proxy"><span class="nav-number">24.9.</span> <span class="nav-text">proxy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gstreamer"><span class="nav-number">24.10.</span> <span class="nav-text">Gstreamer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-number">24.10.1.</span> <span class="nav-text">开发环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#demo-%E7%A4%BA%E4%BE%8B"><span class="nav-number">24.10.2.</span> <span class="nav-text">demo 示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Eigen"><span class="nav-number">24.11.</span> <span class="nav-text">Eigen</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gRPC"><span class="nav-number">24.12.</span> <span class="nav-text">gRPC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%BA%93"><span class="nav-number">24.13.</span> <span class="nav-text">网络库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wxwidget"><span class="nav-number">24.14.</span> <span class="nav-text">wxwidget</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wfrest"><span class="nav-number">24.15.</span> <span class="nav-text">wfrest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bpf"><span class="nav-number">24.16.</span> <span class="nav-text">bpf</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Msclock"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Msclock</p>
  <div class="site-description" itemprop="description">That life is reality.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/msclock" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;msclock" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:msclock@qq.com" title="E-Mail → mailto:msclock@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/msclockg" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;msclockg" rel="noopener me" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://msclock.github.io/posts/caeaa4a1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Msclock">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Live in the present">
      <meta itemprop="description" content="That life is reality.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="cpp 实践 | Live in the present">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          cpp 实践
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-17 08:25:02" itemprop="dateCreated datePublished" datetime="2019-12-17T08:25:02+08:00">2019-12-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-18 13:53:17" itemprop="dateModified" datetime="2025-04-18T13:53:17+08:00">2025-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>123k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:52</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="开发社区">开发社区</h2>
<p>搜集的 C++ 问答社区</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://developercommunity.visualstudio.com/cpp">Visual Studio (Microsoft)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.reddit.com/r/cpp/">reddit</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.codingame.com/learn">coedingGame</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://bytes.com/browse/">bytes</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://medium.com/">medium</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://dev.to/">dev.to</a></p>
</li>
</ul>
<h2 id="相关资源">相关资源</h2>
<p>C++ 比较庞杂，开源社区资源，整理如下：</p>
<table>
<thead>
<tr>
<th>资源</th>
<th>组织</th>
<th>类型 </th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://isocpp.org/">ISO CPP</a></td>
<td>isocpp</td>
<td> 规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://isocpp.org/">C++ Core Guidelines</a></td>
<td>isocpp</td>
<td> 规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://cpp-note.readthedocs.io/zh/latest/index.html">C++ Note</a></td>
<td>TOMO-CAT</td>
<td> 基本语法 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://abseil.io/tips/">C++ Tips</a></td>
<td>Abseil 及 Google</td>
<td> 规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide</a></td>
<td>Google</td>
<td> 规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.cppstories.com/p/resources/">C++ Stories</a></td>
<td>Bartłomiej Filipek</td>
<td> 博客 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://fenbf.github.io/AwesomePerfCpp/">AwesomePerfCpp</a></td>
<td>fenbf</td>
<td> 博客 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/jobbole/awesome-cpp-cn">awesome cpp cn</a></td>
<td>jobbole</td>
<td> 框架 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/fffaraz/awesome-cpp">awesome cpp</a></td>
<td>fffaraz</td>
<td> 框架 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://cppinsights.io/">C++ Insights</a></td>
<td>cppinsights</td>
<td> 工具 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://godbolt.org/">C++ Compiler Explorer</a></td>
<td>godbolt</td>
<td> 工具 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://cpulator.01xz.net/">Computer simulator</a></td>
<td>cpulator</td>
<td> 工具 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://wandbox.org/">sandbox</a></td>
<td>melpon</td>
<td> 工具 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://key.words.run/cn?aid=6370f724ea64396ce2e709e0">Reshaper 激活码</a></td>
<td> Reshaper</td>
<td> 插件 / 工具 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.wholetomato.com/">Visual Assist</a></td>
<td>Visual Assist</td>
<td> 插件 / 工具 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://johnnysswlab.com/">Performance Effect</a></td>
<td>johnnysswlab</td>
<td>blog</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.open-std.org/JTC1/SC22/WG21/">ISO/IEC C++</a></td>
<td>ISO/IEC</td>
<td> 标准规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.open-std.org/JTC1/SC22/WG14/">ISO/IEC C</a></td>
<td>ISO/IEC</td>
<td> 标准规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.open-std.org/JTC1/SC22/WG15/">ISO/IEC POSIX</a></td>
<td>ISO/IEC</td>
<td> 标准规范 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/cpp-best-practices">cpp-best-practices</a></td>
<td>cpp-best-practices</td>
<td>Jason Turner</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://cppnext">cppnext</a></td>
<td>Alex Dathskovsky blog</td>
<td> 博客 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://alandefreitas.github.io/moderncpp/">moderncpp</a></td>
<td>Alan De Freitas</td>
<td> 博客 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/sandordargo/cpp-resources">cpp-resources</a></td>
<td>sandordargo</td>
<td>github 仓库 </td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://caiorss.github.io/C-Cpp-Notes/">c-cpp-notes</a></td>
<td>caiorss</td>
<td> 博客</td>
</tr>
</tbody>
</table>
<span id="more"></span>
<h2 id="vscode">vscode</h2>
<h3 id="Devcontainer">Devcontainer</h3>
<p>推荐使用 devcontainer 配置 <a target="_blank" rel="noopener" href="https://github.com/devcontainers/images/tree/main/src/cpp">cpp</a> 开发环境，只需要在 devcontainer.json 中添加</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"C++"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"build"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"dockerfile"</span><span class="punctuation">:</span> <span class="string">"Dockerfile.dev"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"args"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="comment">// Update 'VARIANT' to pick an Ubuntu OS version: ubuntu-22.04, ubuntu-21.04, ubuntu-20.04, ubuntu-18.04</span></span><br><span class="line">        <span class="comment">// Use Ubuntu 18.04 or Ubuntu 21.04 on local arm64/Apple Silicon</span></span><br><span class="line">        <span class="attr">"VARIANT"</span><span class="punctuation">:</span> <span class="string">"ubuntu-22.04"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// User in container</span></span><br><span class="line">        <span class="attr">"USERNAME"</span><span class="punctuation">:</span> <span class="string">"vscode"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"context"</span><span class="punctuation">:</span> <span class="string">"./.."</span></span><br><span class="line"><span class="punctuation">}</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure>
<p>其中， Dockerfile.dev 中基础镜像选择 <a target="_blank" rel="noopener" href="http://mcr.microsoft.com/devcontainers/cpp">mcr.microsoft.com/devcontainers/cpp</a> 进行扩展：</p>
<figure class="highlight dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> VARIANT=ubuntu-<span class="number">22.04</span></span><br><span class="line"><span class="keyword">FROM</span> mcr.microsoft.com/vscode/devcontainers/cpp:${VARIANT}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Extsension">Extsension</h3>
<p>用于 Cpp 开发的常用 VSCode 插件：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>C/C++：官方提供的 C++ 插件，提供了代码补全、语法高亮、调试等功能。</p>
</li>
<li class="lvl-2">
<p>C++ Intellisense：提供了更强大的代码补全功能，支持头文件、宏定义等。</p>
</li>
<li class="lvl-2">
<p>C++ TestMate：提供了一个测试资源管理器，可以方便地运行和调试 C++ 测试。</p>
</li>
<li class="lvl-2">
<p>C++ Insights：提供了一个侧边栏，可以方便地查看 C++ 代码的编译器输出。</p>
</li>
<li class="lvl-2">
<p>CMake Tools：提供了一个集成的 CMake 工具，可以方便地生成和构建 C++ 项目。</p>
</li>
</ul>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"extensions"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">"ms-vscode.cpptools"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"austin.code-gnu-global"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"mitaki28.vscode-clang"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"twxs.cmake"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"vector-of-bool.cmake-tools"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"llvm-vs-code-extensions.vscode-clangd"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"mjbvz.vscode-lldb"</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Debug">Debug</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/cpp">https://code.visualstudio.com/docs/cpp</a></p>
</li>
</ul>
<h2 id="CI">CI</h2>
<h3 id="GitHub-Action">GitHub Action</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/aminya/setup-cpp">setup-cpp</a></p>
</li>
</ul>
<h2 id="Resource-Template">Resource Template</h2>
<h3 id="cpp-项目模板">cpp 项目模板</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/cpp-best-practices/cmake_template">cpp-best-practices/cmake_template</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/hugorbarbosa/cpp-project-template">hugorbarbosa/cpp-project-template</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/MangaD/cpp-project-template">MangaD/cpp-project-template</a></p>
</li>
</ul>
<h3 id="cmake-模块模板">cmake 模块模板</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/msclock/cmake-registry">cmake-registry</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://aminya.github.io/project_options/html/index.html">project_options: 较全面的项目配置</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/community/-/wikis/FAQ">cmake community faq</a></p>
</li>
</ul>
<h2 id="CMake">CMake</h2>
<!--
https://www.youtube.com/watch?v=y9kSr5enrSk
https://github.com/MangaD/cpp-project-template/tree/main
-->
<p>CMake 是 C++ 非常成熟的开发工具链。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/community">https://gitlab.kitware.com/cmake/community</a></p>
</li>
</ul>
<h3 id="CMake-Beginner">CMake Beginner</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">官方教程</a>: 包括版本、库、目标、安装、测试、打包</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gist.github.com/luncliff/6e2d4eb7ca29a0afd5b592f72b80cb5c">luncliff cmake tutorial</a></p>
</li>
</ul>
<h3 id="CMake-Variables">CMake Variables</h3>
<h4 id="CMAKE-MODULE-PATH">CMAKE_MODULE_PATH</h4>
<p><code>CMAKE_MODULE_PATH</code> 是以分号分隔的列表，供 <code>include()</code> 或 <code>find_package()</code> 使用。初始为空，由用户设定。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_MODULE_PATH.html">https://cmake.org/cmake/help/latest/variable/CMAKE_MODULE_PATH.html</a></p>
</li>
</ul>
<h4 id="CMAKE-PREFIX-PATH">CMAKE_PREFIX_PATH</h4>
<p><code>CMAKE_PREFIX_PATH</code> 是以分号分隔的列表，供 <code>find_package()</code>, <code>find_program()</code>, <code>find_library()</code>, <code>find_file()</code> 和 <code>find_path()</code> 使用，初始为空，由用户设定.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_PREFIX_PATH.html">https://cmake.org/cmake/help/latest/variable/CMAKE_PREFIX_PATH.html</a></p>
</li>
</ul>
<h4 id="Platform-Specific">Platform Specific</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>osx: MACOS, APPLE</p>
</li>
<li class="lvl-2">
<p>windows: WIN32</p>
</li>
<li class="lvl-2">
<p>linux: LINUX, UNIX AND NOT APPLE</p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/393316878">https://zhuanlan.zhihu.com/p/393316878</a></p>
</li>
</ul>
<h3 id="CMake-Configuration">CMake Configuration</h3>
<p>CMake 配置区分可分为单配置类型生成器和多配置类型生成器</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>单配置类型： <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html#makefile-generators"><code>Makefile Generators</code></a>和 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/generator/Ninja.html#generator:Ninja"><code>Ninja</code></a></p>
</li>
<li class="lvl-2">
<p>多配置类型：<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html#visual-studio-generators"><code>Visual Studio</code></a>, <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/generator/Xcode.html#generator:Xcode"><code>Xcode</code></a>, or <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/generator/Ninja%20Multi-Config.html#generator:Ninja%20Multi-Config"><code>Ninja Multi-Config</code></a></p>
</li>
</ul>
<h4 id="配置内置变量说明">配置内置变量说明</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html#variable:CMAKE_BUILD_TYPE">CMAKE_BUILD_TYPE</a>，指定配置生成器的构建类型。</p>
</li>
</ul>
<p>这静态指定将在此构建树中构建的构建类型（配置）。可能的值为空、 <code>Debug</code> 、 <code>Release</code> 、 <code>RelWithDebInfo</code> 、 <code>MinSizeRel</code> ，<code>...</code> 这个变量只对单配置生成器（例如 <code>Makefile Generators</code> 和 <code>Ninja</code> ）有意义，即那些在 CMake 运行以生成构建树时选择单个配置的生成器与在生成的构建环境中提供构建配置选择的多配置生成器相反。有许多 <code>per-config</code> 属性和变量（通常遵循干净的 <code>SOME_VAR_&lt;CONFIG&gt;</code> 命令约定），例如 <code>CMAKE_C_FLAGS_&lt;CONFIG&gt;</code> ，指定为大写： <code>CMAKE_C_FLAGS_[DEBUG|Release|RELWITHDEBINFO|MINSIZEREL|...]</code> 。例如，在配置为构建类型 <code>Debug</code> 的构建树中，CMake 将看到将 <code>CMAKE_C_FLAGS_DEBUG</code> 设置添加到 <code>CMAKE_C_FLAGS</code> 设置中。另见 <code>CMAKE_CONFIGURATION_TYPES</code> 。</p>
<p>请注意，配置名称不区分大小写。此变量的值将与调用 CMake 时指定的值相同。例如，如果 <code>-DCMAKE_BUILD_TYPE=Release</code> 被指定，则该值 <code>CMAKE_BUILD_TYPE</code> 将 <code>Release</code> 。该变量配置类型总是存在。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_CONFIGURATION_TYPES.html#variable:CMAKE_CONFIGURATION_TYPES">CMAKE_CONFIGURATION_TYPES</a>，指定多配置生成的构建类型。</p>
</li>
</ul>
<p>该类型在单配置类型是总是为空。否则，按照生成器默认的类型生成 <code>Debug</code> 、 <code>Release</code> 、 <code>RelWithDebInfo</code> 、 <code>MinSizeRel</code> 等类型。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/prop_gbl/GENERATOR_IS_MULTI_CONFIG.html">GENERATOR_IS_MULTI_CONFIG</a>，获取当前是否是多配置类型。使用示例:</p>
</li>
</ul>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># multi config setting</span></span><br><span class="line"><span class="keyword">get_property</span>(GENERATOR_IS_MULTI_CONFIG GLOBAL</span><br><span class="line">            PROPERTY GENERATOR_IS_MULTI_CONFIG)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"GENERATOR_IS_MULTI_CONFIG ${GENERATOR_IS_MULTI_CONFIG}"</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"CMAKE_CONFIGURATION_TYPES ${CMAKE_CONFIGURATION_TYPES}"</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"CMAKE_BUILD_TYPE ${CMAKE_BUILD_TYPE}"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">${GENERATOR_IS_MULTI_CONFIG}</span>)</span><br><span class="line">  <span class="keyword">set</span>(multi_config_path</span><br><span class="line">      <span class="string">"${CMAKE_BUILD_TYPE}"</span></span><br><span class="line">      CACHE <span class="keyword">STRING</span> <span class="string">"Multi Config Path"</span> FORCE)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="comment"># write a json file indicating the multi config mode</span></span><br><span class="line"><span class="keyword">file</span>(</span><br><span class="line">WRITE <span class="variable">${CMAKE_BINARY_DIR}</span>/multi_config.json</span><br><span class="line"><span class="string">"</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">    \"multi_config\": ${GENERATOR_IS_MULTI_CONFIG}</span></span><br><span class="line"><span class="string">}"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="CMakePresets">CMakePresets</h3>
<p>用于 CMake 通用的 configure、build、test 等配置步骤。</p>
<h4 id="CMakePresets-模板">CMakePresets 模板</h4>
<p>确保环境</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>cmake &gt;=3.20</p>
</li>
<li class="lvl-2">
<p>Visual Studio 环境</p>
<ul class="lvl-2">
<li class="lvl-4"><code>C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Auxiliary\Build\</code></li>
<li class="lvl-4"><code>C:\Program Files (x86)\Windows Kits\10\bin\10.0.22000.0\x64</code></li>
<li class="lvl-4"><code>C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Tools\Llvm\bin</code></li>
</ul>
</li>
<li class="lvl-2">
<p>Linux 环境</p>
<ul class="lvl-2">
<li class="lvl-4">g++</li>
<li class="lvl-4">clang++</li>
</ul>
</li>
</ul>
<h5 id="模板一">模板一</h5>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"configurePresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"common-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"binaryDir"</span><span class="punctuation">:</span> <span class="string">"${sourceDir}/out/build/${presetName}"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"installDir"</span><span class="punctuation">:</span> <span class="string">"${sourceDir}/out/install/${presetName}"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"common-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"generator"</span><span class="punctuation">:</span> <span class="string">"Ninja"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"condition"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"equals"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"lhs"</span><span class="punctuation">:</span> <span class="string">"${hostSystemName}"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"rhs"</span><span class="punctuation">:</span> <span class="string">"Linux"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"architecture"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_C_COMPILER"</span><span class="punctuation">:</span> <span class="string">"gcc"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"CMAKE_CXX_COMPILER"</span><span class="punctuation">:</span> <span class="string">"g++"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"vendor"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"microsoft.com/VisualStudioSettings/CMake/1.0"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"hostOS"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">"Linux"</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"microsoft.com/VisualStudioRemoteSettings/CMake/1.0"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"sourceDir"</span><span class="punctuation">:</span> <span class="string">"$env{HOME}/.vs/$ms{projectDirName}"</span></span><br><span class="line">                <span class="punctuation">}</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Release"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-asan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=address"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Address"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-tsan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=thread"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Thread"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-lsan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=leak"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Leak"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-ubsan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=undefined"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Undefined"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"common-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"generator"</span><span class="punctuation">:</span> <span class="string">"Ninja"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_C_COMPILER"</span><span class="punctuation">:</span> <span class="string">"cl"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"CMAKE_CXX_COMPILER"</span><span class="punctuation">:</span> <span class="string">"cl"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"architecture"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"toolset"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"host=x64"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"condition"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"equals"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"lhs"</span><span class="punctuation">:</span> <span class="string">"${hostSystemName}"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"rhs"</span><span class="punctuation">:</span> <span class="string">"Windows"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-x64-debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-x64-Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Release"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-x64-asan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=address"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Address"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"testPresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"common-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Basic shared test settings"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"execution"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"noTestsAction"</span><span class="punctuation">:</span> <span class="string">"error"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"stopOnFailure"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"output"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"outputOnFailure"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"common-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"common-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"linux-x64-debug"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"linux-x64-Release"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-asan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=address"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"linux-x64-asan"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-tsan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=thread"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"linux-x64-tsan"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-lsan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=leak"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"linux-x64-lsan"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"linux-x64-ubsan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"linux-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=undefined"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"linux-x64-ubsan"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-x64-debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"windows-x64-debug"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-x64-Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 Release"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"windows-x64-Release"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"windows-x64-asan"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"windows-base"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"x64 sanitize=address"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"windows-x64-asan"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="模板二">模板二</h5>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"version"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"configurePresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"Basic Config"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Basic build using Ninja generator"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// The generator is always ninja because of cross-platform performance</span></span><br><span class="line">      <span class="attr">"generator"</span><span class="punctuation">:</span> <span class="string">"Ninja"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// It enables hidden when presets present</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"binaryDir"</span><span class="punctuation">:</span> <span class="string">"${sourceDir}/out/build/${presetName}"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"installDir"</span><span class="punctuation">:</span> <span class="string">"${sourceDir}/out/install/${presetName}"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="comment">// x64 architecture conf</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"architecture"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x86"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"architecture"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"x86"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="comment">// Debug conf</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// Custom definition variable</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"Release"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"RelWithDebInfo"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"MSVC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// MSVC compiler</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"CMAKE_C_COMPILER"</span><span class="punctuation">:</span> <span class="string">"cl"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"CMAKE_CXX_COMPILER"</span><span class="punctuation">:</span> <span class="string">"cl"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// MSVC toolset conf</span></span><br><span class="line">      <span class="attr">"toolset"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"host=x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"condition"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"equals"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"lhs"</span><span class="punctuation">:</span> <span class="string">"${hostSystemName}"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"rhs"</span><span class="punctuation">:</span> <span class="string">"Windows"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"Clang"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"CMAKE_C_COMPILER"</span><span class="punctuation">:</span> <span class="string">"clang"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"CMAKE_CXX_COMPILER"</span><span class="punctuation">:</span> <span class="string">"clang++"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"condition"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"equals"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"lhs"</span><span class="punctuation">:</span> <span class="string">"${hostSystemName}"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"rhs"</span><span class="punctuation">:</span> <span class="string">"Linux"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"toolset"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"host=x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"hidden"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"CMAKE_C_COMPILER"</span><span class="punctuation">:</span> <span class="string">"gcc"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"CMAKE_CXX_COMPILER"</span><span class="punctuation">:</span> <span class="string">"g++"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"condition"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"equals"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"lhs"</span><span class="punctuation">:</span> <span class="string">"${hostSystemName}"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"rhs"</span><span class="punctuation">:</span> <span class="string">"Linux"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"toolset"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"host=x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"strategy"</span><span class="punctuation">:</span> <span class="string">"external"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"MSVC for x64 (Debug)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"MSVC"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Release-MSVC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"MSVC for x64 (Release)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Release"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"MSVC"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-Clang"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Clang/LLVM for x64 (Debug)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Clang"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Release-Clang"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Clang/LLVM for x64 (Release)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Release"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Clang"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"GNUC for x64 (Debug)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"GNUC"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Release-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"GNUC for x64 (Release)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"base"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"x64"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"Release"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"GNUC"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC-asan"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC with /fsanitize=address"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Address"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC-asan"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Address"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC-tsan"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Thread"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC-lsan"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Leak"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC-ubsan"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"inherits"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"USE_SANITIZER"</span><span class="punctuation">:</span> <span class="string">"Undefined"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"testPresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Release-MSVC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Release-MSVC"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-Clang"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-Clang"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Release-Clang"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Release-Clang"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-GNUC"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Release-GNUC"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Release-GNUC"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC-asan"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"x64-Debug-MSVC-asan"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="模板三">模板三</h5>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"cmakeMinimumRequired"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"major"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"minor"</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"patch"</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"configurePresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"default"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"displayName"</span><span class="punctuation">:</span> <span class="string">"Default Config"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"binaryDir"</span><span class="punctuation">:</span> <span class="string">"${sourceDir}/build"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"toolchainFile"</span><span class="punctuation">:</span> <span class="string">"$env{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cacheVariables"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"CMAKE_BUILD_TYPE"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"VCPKG_OVERLAY_PORTS"</span><span class="punctuation">:</span> <span class="string">"${sourceDir}/deps"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"CMAKE_INSTALL_PREFIX"</span><span class="punctuation">:</span> <span class="string">"out"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"ASIO_GRPC_BUILD_TESTS"</span><span class="punctuation">:</span> <span class="string">"TRUE"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"ASIO_GRPC_DISCOVER_TESTS"</span><span class="punctuation">:</span> <span class="string">"TRUE"</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"buildPresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"default"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"default"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configuration"</span><span class="punctuation">:</span> <span class="string">"Debug"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"testPresets"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"default"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configurePreset"</span><span class="punctuation">:</span> <span class="string">"default"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"configuration"</span><span class="punctuation">:</span> <span class="string">"Debug"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"output"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"outputOnFailure"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"execution"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"noTestsAction"</span><span class="punctuation">:</span> <span class="string">"error"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"timeout"</span><span class="punctuation">:</span> <span class="number">180</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"jobs"</span><span class="punctuation">:</span> <span class="number">8</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="CMake-Regex">CMake Regex</h3>
<h4 id="规则约束">规则约束</h4>
<p>在 CMake 中，可以在几个上下文中使用正则表达式，例如 <code>string(REGEX MATCH)</code> 命令和 <code>ctest</code> 命令的 <code>-R</code> 选项。与 Ruby 或 Perl 等相比，该正则表达式具有低功能，例如，字母数字和下划线 <code>_</code> 中所述修改相应参数的值。此外，也不能使用表示重复的 <code>{n}</code> 等。<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/string.html">可以使用的元字符如下</a>：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>开头 <code>^</code></p>
</li>
<li class="lvl-2">
<p>末尾 <code>$</code></p>
</li>
<li class="lvl-2">
<p>任意字符 <code>.</code></p>
</li>
<li class="lvl-2">
<p>匹配中列出的字符 <code>[]</code> 及其范围 <code>-</code></p>
</li>
<li class="lvl-2">
<p>非匹配列出的字符 <code>[^]</code></p>
</li>
<li class="lvl-2">
<p>重复 0 次以上 <code>*</code></p>
</li>
<li class="lvl-2">
<p>一次或多次重复 <code>+</code></p>
</li>
<li class="lvl-2">
<p>0 次，或者 1 次 <code>?</code></p>
</li>
<li class="lvl-2">
<p>指定的模式之一 <code>|</code></p>
</li>
<li class="lvl-2">
<p>分组 <code>()</code></p>
</li>
</ul>
<h4 id="CMAKE-MATCH-n"><code>CMAKE_MATCH_&lt;n&gt;</code></h4>
<p>为组 0 到 9 捕获由最后一个正则表达式匹配的组 <code>&lt;n&gt;</code> 。组 0 是整个匹配项。组 1 到 9 是 <code>()</code> 语法捕获的子表达式。</p>
<p>当使用正则表达式匹配时，CMake 将匹配内容填充到 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_MATCH_n.html"><code>CMAKE_MATCH_&lt;n&gt;</code></a> 变量中。匹配时， <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_MATCH_COUNT.html#variable:CMAKE_MATCH_COUNT"><code>CMAKE_MATCH_COUNT</code></a> 变量保存匹配表达式的数量。</p>
<h4 id="正则常用场景">正则常用场景</h4>
<p>可以在以下位置使用正则表达式</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/string.html">https://cmake.org/cmake/help/latest/command/string.html</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://qiita.com/mrk_21/items/4bb58f64a82e73c42cb3">CMake: 正規表現</a></p>
</li>
</ul>
<h5 id="命令">命令</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/string.html">string(REGEX MATCH)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/string.html">string(REGEX MATCHALL)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/string.html">string(REGEX REPLACE)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/file.html">file(STRINGS)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/if.html">if(MATCHES)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/install.html">install(DIRECTORY)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/source_group.html">source_group()</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/include_regular_expression.html">include_regular_expression()</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/ctest_test.html">ctest_test()</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/ctest_memcheck.html">ctest_memcheck()</a></p>
</li>
</ul>
<p>显示读取 pyproject.toml 版本号</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># unless specified version, read the file pyproject.toml version information</span></span><br><span class="line"><span class="keyword">if</span>(PROJECT_VERSION)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">"explicit the version ${PROJECT_VERSION}"</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">file</span>(</span><br><span class="line">    STRINGS <span class="string">"${CMAKE_SOURCE_DIR}/pyproject.toml"</span> ver_read</span><br><span class="line">    ENCODING <span class="string">"UTF-8"</span></span><br><span class="line">    REGEX [[^version = <span class="string">"(.+)"</span>]])</span><br><span class="line">  <span class="keyword">string</span>(REGEX MATCH [[^version = <span class="string">"([^-]+)-?(.+)?"</span>]] matches_out <span class="string">"${ver_read}"</span>)</span><br><span class="line">  <span class="keyword">message</span>(</span><br><span class="line">    STATUS</span><br><span class="line">      <span class="string">"Read the project version ${CMAKE_MATCH_0} from the file pyproject.toml ${ver_read}"</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">if</span>(<span class="string">"${CMAKE_MATCH_1}"</span> <span class="keyword">STREQUAL</span> <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR <span class="string">"we need a version specified."</span>)</span><br><span class="line">  <span class="keyword">endif</span>()</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_PROJECT_VERSION <span class="variable">${CMAKE_MATCH_1}</span>)</span><br><span class="line">  <span class="keyword">if</span>(CMAKE_MATCH_2)</span><br><span class="line">    <span class="keyword">set</span>(VERSION_SUFFIX <span class="variable">${CMAKE_MATCH_2}</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">"VERSION_SUFFIX:${VERSION_SUFFIX}"</span>)</span><br><span class="line">  <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></tbody></table></figure>
<h5 id="变量">变量</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_LIBRARY_ARCHITECTURE_REGEX.html">CMAKE_LIBRARY_ARCHITECTURE_REGEX</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/prop_dir/INCLUDE_REGULAR_EXPRESSION.html">INCLUDE_REGULAR_EXPRESSION</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/prop_test/FAIL_REGULAR_EXPRESSION.html">FAIL_REGULAR_EXPRESSION</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/prop_test/PASS_REGULAR_EXPRESSION.html">PASS_REGULAR_EXPRESSION</a></p>
</li>
</ul>
<h5 id="模块">模块</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/ExternalData.html">ExtenalData</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CMakeGraphVizOptions.html">CMakeGraphVizOptions</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CPack.html">CPack</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CheckCSourceCompiles.html">CheckCSourceCompiles</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CheckCXXSourceCompiles.html">CheckCxxSourceCompiles</a></p>
</li>
</ul>
<h5 id="命令行">命令行</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p>ctest -L/-R/-E/-LE</p>
</li>
</ul>
<h3 id="CMake-Project">CMake Project</h3>
<h4 id="cmake-init">cmake-init</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/friendlyanon/cmake-init">cmake-init</a> 专用于初始化基于 CMake 构建的项目。只需要简单的运行命令 <code>cmake-init &lt;project-name&gt;</code>, 即可根据提示初始化不同的构建方案.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install cmake-init</span><br></pre></td></tr></tbody></table></figure>
<h3 id="CMake-Vscode-Integration">CMake Vscode Integration</h3>
<h4 id="Vscode-CMake-Tools">Vscode CMake Tools</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/vscode-cmake-tools/blob/main/docs/debug-launch.md">https://github.com/microsoft/vscode-cmake-tools/blob/main/docs/debug-launch.md</a></p>
</li>
</ul>
<h3 id="CMake-Tips">CMake Tips</h3>
<p>这里总结了一下 CMake 实际项目中应用的技巧。</p>
<h4 id="集成-C-C-threads">集成 C/C++ threads</h4>
<p>CMAKE 中提供了单独的 threads 模块集成方式，这里是示例 <a target="_blank" rel="noopener" href="https://godbolt.org/z/46nrYGhsc">threads</a> 利用了 C API pthread 实现 RAII 锁。</p>
<blockquote>
<p>[!CAUTION]<br>
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/128519905">using std::thread in a library loaded with dlopen leads to a sigsev</a></p>
</blockquote>
<h4 id="构建结果输出到统一路径">构建结果输出到统一路径</h4>
<p>配置将在构建生成的 Runtime，Libraries，archives 都生成到对应的 binary 目录，而不是对应源码位置的子目录下。</p>
<blockquote>
<p>[!TIP]<br>
将构建生产构件都输出当对应的目录，有利于测试如 Gtest，否则对应得测试会生成到相应得同名目录下，造成.exe 或 elf 找不到依赖库等 crash 。</p>
</blockquote>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GNU install standard dirs</span></span><br><span class="line"><span class="keyword">include</span>(GNUInstallDirs)</span><br><span class="line"><span class="comment"># Configure uniform output directory for Runtime,Libraries,archives</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY <span class="variable">${CMAKE_BINARY_DIR}</span>/<span class="variable">${CMAKE_INSTALL_LIBDIR}</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class="variable">${CMAKE_BINARY_DIR}</span>/<span class="variable">${CMAKE_INSTALL_LIBDIR}</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">${CMAKE_BINARY_DIR}</span>/<span class="variable">${CMAKE_INSTALL_BINDIR}</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="配置-DEBUG-宏">配置 _DEBUG 宏</h4>
<p>通常 Windows 下调试时会配置 _DEBUG 宏，但在 Linux 下需要手动增加配置。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Debug configuration</span></span><br><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> Debug)</span><br><span class="line">  <span class="keyword">add_definitions</span>(-D_DEBUG)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></tbody></table></figure>
<h4 id="追加-CMake-脚本路径">追加 CMake 脚本路径</h4>
<p>通常会将工程的 cmake 脚本放到一个 cmake 的目录，然后统一在 CMAKE_MODULE_PATH 中导入，方便后续调用相应模块。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMake module tools import custom cmake modules</span></span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_MODULE_PATH <span class="string">"${CMAKE_CURRENT_SOURCE_DIR}/cmake"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="CMake-中注释">CMake 中注释</h4>
<p><code>#[[</code>注释可以跨越多行，并且不会被编译器解释为代码。</p>
<blockquote>
<p>[!CAUTION]<br>
多行注释不会被 cmake-format 格式化。</p>
</blockquote>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[[ This is</span></span><br><span class="line"><span class="comment">  a multi-line</span></span><br><span class="line"><span class="comment">  comment ]]</span></span><br><span class="line"><span class="comment"># This is a single-line comment</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[=======================================================================[.rst:</span></span><br><span class="line">Title</span><br><span class="line">-----</span><br><span class="line"></span><br><span class="line">The first line takes up <span class="number">80</span> spaces with rst style syntax declaration.The last line takes up <span class="number">75</span> spaces.</span><br><span class="line"></span><br><span class="line">Variables</span><br><span class="line">^^^^^^^^^</span><br><span class="line"></span><br><span class="line"><span class="comment">#]=======================================================================]</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="将选项通过目标链接">将选项通过目标链接</h4>
<p>其它目标依赖通过将编译或链接选项生成一个 INTERFACE 目标，进而传递该目标包含的各种配置选项。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add a common compile setting interface</span></span><br><span class="line"><span class="keyword">add_library</span>(common-compile-settings INTERFACE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_compile_features</span>(common-compile-settings INTERFACE cxx_std_11)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_compile_options</span>(common-compile-settings INTERFACE</span><br><span class="line">  <span class="comment"># clang-like or GNU flags</span></span><br><span class="line">  $&lt;$&lt;<span class="keyword">OR</span>:$&lt;CXX_COMPILER_ID:Clang&gt;,$&lt;CXX_COMPILER_ID:AppleClang&gt;,$&lt;CXX_COMPILER_ID:GNU&gt;&gt;:</span><br><span class="line">    -Wall -Wextra -Wno-unused-parameter -Wno-type-limits -Werror&gt;</span><br><span class="line">  <span class="comment"># msvc flags</span></span><br><span class="line">  $&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:/W0 /D_WIN32_WINNT=<span class="number">0</span>x0A00 /EHsc&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the interface with PRIVATE link mode so that the settings would</span></span><br><span class="line"><span class="comment"># not be propergated to a target depending on the target other_tgt</span></span><br><span class="line"><span class="keyword">add_library</span>(other_tgt</span><br><span class="line">    src/some.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(</span><br><span class="line">    other_tgt</span><br><span class="line">    PRIVATE</span><br><span class="line">        common-compile-settings</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="搜索文件">搜索文件</h4>
<p>方式一: <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/file.html"><code>file(GLOB_RECURSE ...)</code></a> 搜索文件的方式可以方便地获取指定目录下的所有文件，包括子目录中的文件。然而，这种方式并不推荐在大型项目中使用，因为它会导致以下问题：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>性能问题：由于搜索整个目录树，因此会导致性能问题，特别是在大型项目中。</p>
</li>
<li class="lvl-2">
<p>不稳定性：由于该命令依赖于文件系统，因此可能会受到文件系统的限制，例如文件名长度限制。</p>
</li>
<li class="lvl-2">
<p>可读性问题：使用该命令可能会使 CMakeLists.txt 文件变得难以阅读和维护。</p>
</li>
</ul>
<p>因此，对于大型项目，建议手动列出所有源文件，以便更好地控制构建过程。如果仍然想使用该命令，请确保的项目规模较小，并且已经测试了该命令的性能和稳定性。</p>
<p>方式二：<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/aux_source_directory.html"><code>aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</code></a> 是一个旧的 CMake 命令，用于将指定目录中的所有源文件添加到一个变量中。然而，这个命令已经被弃用了，因为它不能正确地处理源文件的依赖关系。相反，应该使用 <code>file(GLOB_RECURSE ...)</code> 命令来获取源文件列表，然后将它们添加到目标中。</p>
<h4 id="导出符号">导出符号</h4>
<p>控制 cpp 符号导出在动态或插件链接库是非常必要的步骤，在 windows 中符号默认都不导出，linux 中默认都导出。</p>
<p>通常为了跨平台实现编译链接，需要使用针对性处理。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  only export all symbols on windows but no static symbols</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(Tgt PROPERTIES</span><br><span class="line">    WINDOWS_EXPORT_ALL_SYMBOLS <span class="keyword">ON</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/community/-/wikis/doc/tutorials/BuildingWinDLL">https://gitlab.kitware.com/cmake/community/-/wikis/doc/tutorials/BuildingWinDLL</a></p>
</li>
</ul>
<h4 id="禁用-CMakeLists-txt-路径构建">禁用 CMakeLists.txt 路径构建</h4>
<p>对构建目录存在 CMakeLists.txt 脚本目录的情况报错，其目的是强制将构建缓存和构建脚本分离。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error if building out of a build directory</span></span><br><span class="line"><span class="keyword">file</span>(TO_CMAKE_PATH <span class="string">"${PROJECT_BINARY_DIR}/CMakeLists.txt"</span> LOC_PATH)</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">EXISTS</span> <span class="string">"${LOC_PATH}"</span>)</span><br><span class="line">  <span class="keyword">message</span>(</span><br><span class="line">    FATAL_ERROR</span><br><span class="line">      <span class="string">"You cannot build in a source directory (or any directory with "</span></span><br><span class="line">      <span class="string">"CMakeLists.txt file). Please make a build subdirectory. Feel free to "</span></span><br><span class="line">      <span class="string">"remove CMakeCache.txt and CMakeFiles."</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></tbody></table></figure>
<h4 id="符号可见性">符号可见性</h4>
<p>CMake 中 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=m0DwB4OvDXk">Visibility Control</a> 标准的库符号导出，需要严格控制。windows 下默认不导出，linux 默认全导出。这里通过 CMake 控制符号导出能减小这部分工作量。</p>
<p>通常尽可能预设将所有符号隐藏，然后使用 generate_export_header 生成符号导出修饰前缀。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_VISIBILITY_PRESET hidden)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_VISIBILITY_INLINES_HIDDEN YES)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(MyTgt ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成合适的 mytgt_export.h</span></span><br><span class="line"><span class="comment"># 确保 MyTgt_EXPORT 定义</span></span><br><span class="line"><span class="comment"># 添加符号导出宏 MyTgt_EXPORT 添加到目标 MyTgt</span></span><br><span class="line"><span class="keyword">include</span>(GenerateExportHeader)</span><br><span class="line">generate_export_header(MyTgt)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="库版本控制">库版本控制</h4>
<p>对于动态库，需要做 Library Version 时，CMake 也提供了工具。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Example ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># libExample.so -&gt; libExample.so.2.4.7 NAME LINK</span></span><br><span class="line"><span class="comment"># libExample.so.2 -&gt; libExample.so.2.4.7 SONAME</span></span><br><span class="line"><span class="comment"># libExample.so.2.4.7 REAL LIBRARY</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(</span><br><span class="line">    Example PROPERTIES</span><br><span class="line">        SOVERSION <span class="number">2</span></span><br><span class="line">        VERSION <span class="number">2.4</span>.<span class="number">7</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>[!WARNING]<br>
如果缺失 SOVERSION，如果 Example 只做了一个简单的内部修改，然后增加了 patch 为 2.4.8，对于依赖于 Example 的 2.4.7 版本的项目来说，简单更新 Example 库就不再合适，而是需要重新编译链接指向 2.4.8，但这实际上是不必要的。所以都建议加上 <strong>SOVERSION</strong>。</p>
</blockquote>
<p>包版本控制，需要导出版本 cmake 脚本。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># require AConfig.cmake AConfigVersion.cmake</span></span><br><span class="line"><span class="keyword">find_package</span>(A <span class="number">2.3</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>使用工具自动生成</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CMakePackageConfigHelpers)</span><br><span class="line">write_basic_package_version_file(</span><br><span class="line">    AConfigVersion.cmake</span><br><span class="line">    VERSION <span class="number">2.4</span>.<span class="number">7</span></span><br><span class="line">    COMPATIBILITY SameMajorVersion</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq295109601/article/details/118063009">windows 及 linux 下库版本控制</a></p>
</li>
</ul>
<h4 id="打包库">打包库</h4>
<p>配置安装规则 (Installing Rules)。安装规则包括安装运行库、头文件、文档等等，以下是不断对安装规则不断改进的过程。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html">https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html</a></p>
</li>
</ul>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Version 1: 只是安装对应工件</span></span><br><span class="line"><span class="keyword">include</span>(GNUInstallDis) <span class="comment"># GNU dir-installed layout</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS Example</span><br><span class="line">    RUNTIME DESTINATION <span class="variable">${CMAKE_INSTALL_BINDIR}</span></span><br><span class="line">    LIBRARY DESTINATION <span class="variable">${CMAKE_INSTALL_LIBDIR}</span></span><br><span class="line">    ARCHIVE DESTINATION <span class="variable">${CMAKE_INSTALL_LIBDIR}</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># CMake &gt;=3.14 same as [[install(TARGETS Example)]] as the above</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Version 2:通常安装包会区分运行库（Runtime）和开发库（Development）</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS Example</span><br><span class="line">    RUNTIME DESTINATION <span class="variable">${CMAKE_INSTALL_BINDIR}</span></span><br><span class="line">        COMPONENT Runtime</span><br><span class="line">    LIBRARY DESTINATION <span class="variable">${CMAKE_INSTALL_LIBDIR}</span></span><br><span class="line">        COMPONENT Runtime</span><br><span class="line">        NAMELINK_COMPONENT Development <span class="comment"># CMake &gt;= 3.12</span></span><br><span class="line">    ARCHIVE DESTINATION <span class="variable">${CMAKE_INSTALL_LIBDIR}</span></span><br><span class="line">        COMPONENT Development</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Version 3: 通常加上 SomeProj_ 前缀避免安装规则被其它项目通过 add_subdirctory 的集成的安装规则干扰</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS Example</span><br><span class="line">    RUNTIME DESTINATION <span class="variable">${CMAKE_INSTALL_BINDIR}</span></span><br><span class="line">        COMPONENT SomeProj_Runtime</span><br><span class="line">    LIBRARY DESTINATION <span class="variable">${CMAKE_INSTALL_LIBDIR}</span></span><br><span class="line">        COMPONENT SomeProj_Runtime</span><br><span class="line">        NAMELINK_COMPONENT SomeProj_Development</span><br><span class="line">    ARCHIVE DESTINATION <span class="variable">${CMAKE_INSTALL_LIBDIR}</span></span><br><span class="line">        COMPONENT SomeProj_Development</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p>构建库及依赖的 RPATH，通常需要小心设置。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Build and Test, CMake 会将 RPATH 给到库及相关执行程序。</p>
</li>
<li class="lvl-2">
<p>Package and Install, CMake 将 <strong>RPATH</strong> 替换为<strong>空</strong>。</p>
</li>
<li class="lvl-2">
<p>Run and Failed, 缺少 RPATH，通常由 DT_RPATH 及 DT_RUNPATH 确定，如果两者都存在，则前者被丢弃。LD_LIBRARY_PATH 在 DT_RPATH 之后评估，DT_RUNPATH 在 LD_LIBRARY_PATH 之后评估。优先级顺序为 <strong>DT_RPATH -&gt; LD_LIBRARY_PATH -&gt; DT_RUNPATH</strong>。</p>
</li>
</ul>
<blockquote>
<p>[!CAUTION]<br>
配置 SO 动态库搜索规则，当使用 <code>-Wl,-rpath,path/to/so/location,--disable-new-dtags</code> 时为 DT_RPATH 配置，当使用 <code>-Wl,-rpath,path/to/so/location,--enable-new-dtags</code> 时为 DT_RUNPATH 配置（gcc-7 已设置默认打开配置）。DT_RPATH 搜索到后，就不会再考虑 LD_LIBRARY_PATH，所以也推荐配置 DT_RUNPATH。</p>
</blockquote>
<p>综上，动态库的搜索路径优先级是：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>DT_RPATH</p>
</li>
<li class="lvl-2">
<p>LD_LIBRARY_PATH</p>
</li>
<li class="lvl-2">
<p>DT_RUNPATH</p>
</li>
</ul>
<p>从历史的角度来说，一开始是只有 DT_RPATH 的，问题是 DT_RPATH 在编译时一旦设了就不能靠 LD_LIBRARY_PATH 来自定义加载的路径了，每次要测不同的库的时候（放的位置可能不同）就得重新 build 可执行文件，这样很烦。因此才引入了 DT_RUNPATH ，编译后在运行时还可以用 LD_LIBRARY_PATH 来覆盖掉，这样就不用每次重新编译了，只需要 NEEDED 里的 Value 一致即可。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Simple rpath configuration</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># on Apple are there different keyword @loader_path</span></span><br><span class="line"><span class="comment">#     check env variables first</span></span><br><span class="line"><span class="comment">#   recursive searching like DT_RPATH</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> APPLE)</span><br><span class="line"> <span class="comment"># $ORIGIN means the location of the binary requiring the dependency</span></span><br><span class="line"> <span class="keyword">set</span>(CMAKE_INSTALL_RPATH $ORIGIN)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">add_library</span>(Example ...)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>[!NOTE]<br>
当使用动态链接器（<a target="_blank" rel="noopener" href="http://ld.so">ld.so</a>）加载共享库时，<strong>$ORIGIN</strong> 可以用于指定相对于可执行文件的路径的搜索目录。这使得共享库可以相对于可执行文件的位置进行定位，而不是使用绝对路径或者在系统范围内搜索共享库。</p>
<p><strong>@loaderpath(macOS)</strong> 和 <strong>$ORIGIN(Unix)</strong> 都是用于在可执行文件和共享库中指定动态链接器搜索依赖项的路径的特殊字符串，指向包含当前可执行文件或共享库的目录。它们的主要区别在于它们的作用范围和解析方式。</p>
<p>@loaderpath 不能在环境变量中使用。</p>
<p>$ORIGIN 的解析是在运行时进行的，而不是在链接时进行的。这意味着 $ORIGIN 可以用于在不同的环境中运行相同的可执行文件或共享库，而不需要修改它们的路径。例如，如果可执行文件或共享库位于 /path/to/myapp/bin/myapp 中，则 $ORIGIN 将被解析为 /path/to/myapp/bin/，即可执行文件所在的相对路径，无论在哪个目录中运行它。</p>
<p>另见 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6329888/difference-between-origin-and-loader-path-environment-variable">stackoverflow</a> 及 <a target="_blank" rel="noopener" href="https://www.man7.org/linux/man-pages/man8/ld.so.8.html">ld</a>.</p>
</blockquote>
<p>以下是一个示例，其中使用了 $ORIGIN 变量来加载共享库：</p>
<p>假设有一个可执行文件 /home/user/myapp，<a target="_blank" rel="noopener" href="http://xn--libfoo-9m7igl43b30qfrd8t2bm1i310nv0sa9o1a.so">它需要加载一个共享库 libfoo.so</a>，该共享库位于可执行文件所在目录的 lib 子目录中。可以使用以下命令来加载共享库：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/user</span><br><span class="line"><span class="built_in">mkdir</span> lib</span><br><span class="line"><span class="built_in">cp</span> /path/to/libfoo.so lib/</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORIGIN</span>/lib</span><br><span class="line">./myapp</span><br></pre></td></tr></tbody></table></figure>
<p>在这个例子中，将共享库复制到可执行文件所在目录的 lib 子目录中，并使用 <strong>$ORIGIN/lib</strong> 来指定共享库的搜索目录。这使得动态链接器可以相对于可执行文件的位置找到共享库。</p>
<p>根据之前的讨论，为 bin executable 配置 rpath 为<strong>当前路径</strong>及 <strong>lib 所在路径</strong>如下：</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[=======================================================================[.rst:</span></span><br><span class="line">Runpath Configuration</span><br><span class="line">------------------</span><br><span class="line"></span><br><span class="line">This scripts setup a runpath properly when use <span class="keyword">add_library</span> to generate</span><br><span class="line">a shared library. The path of shared libraries will be pointed to lib</span><br><span class="line">directory by variable CMAKE_INSTALL_BIN.</span><br><span class="line"></span><br><span class="line"><span class="comment">#]=======================================================================]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use, i.e. don't skip the full RPATH for the build tree</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_SKIP_BUILD_RPATH <span class="keyword">FALSE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># when building, don't use the install RPATH already (but later on when</span></span><br><span class="line"><span class="comment"># installing)</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_WITH_INSTALL_RPATH <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prepare RPATH</span></span><br><span class="line"><span class="keyword">file</span>(RELATIVE_PATH _rel <span class="variable">${CMAKE_INSTALL_FULL_BINDIR}</span></span><br><span class="line">     <span class="variable">${CMAKE_INSTALL_FULL_LIBDIR}</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"_rel:${_rel}"</span>)</span><br><span class="line"><span class="keyword">if</span>(APPLE)</span><br><span class="line">  <span class="keyword">set</span>(_rpath <span class="string">"@loader_path/${_rel}"</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">set</span>(_rpath <span class="string">"$ORIGIN/${_rel}"</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"_rpath:${_rpath}"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add auto dly-load path such as</span></span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_INSTALL_RPATH <span class="variable">${_rpath}</span>;$ORIGIN)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"CMAKE_INSTALL_RPATH:${CMAKE_INSTALL_RPATH}"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the automatically determined parts of the RPATH which point to directories</span></span><br><span class="line"><span class="comment"># outside the build tree to the install RPATH</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INSTALL_RPATH_USE_LINK_PATH <span class="keyword">TRUE</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>完整的安装规则配置 demo，参考仓库如下：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/common">triton/common</a></p>
</li>
</ul>
<h4 id="FetchContent">FetchContent</h4>
<p>FetchContent 参考应用示例：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/python_backend">triton/python_backend</a></p>
</li>
</ul>
<h4 id="配置库-libConfig-cmake">配置库 libConfig.cmake</h4>
<p>为了为静态库 lib 编写 CMake 配置文件，需要创建一个名为 libConfig.cmake 的文件。在该文件中，可以设置库的导入路径、链接库和其他相关设置。</p>
<p>以下是一个示例 libConfig.cmake 文件的模板，集成使用 include 该模块即可</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置lib的导入路径</span></span><br><span class="line"><span class="keyword">set</span>(lib_INCLUDE_DIRS <span class="string">"&lt;path_to_lib_include_directory&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置lib的链接库</span></span><br><span class="line"><span class="keyword">set</span>(lib_LIBRARIES <span class="string">"&lt;path_to_lib_library_file&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出lib的配置</span></span><br><span class="line"><span class="keyword">set</span>(lib_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">set</span>(lib_VERSION_MAJOR &lt;major_version&gt;)</span><br><span class="line"><span class="keyword">set</span>(lib_VERSION_MINOR &lt;minor_version&gt;)</span><br><span class="line"><span class="keyword">set</span>(lib_VERSION_PATCH &lt;patch_version&gt;)</span><br><span class="line"><span class="keyword">set</span>(lib_VERSION <span class="string">"&lt;version_string&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将lib相关的配置信息添加到全局变量中</span></span><br><span class="line"><span class="keyword">set</span>(_IMPORT_PREFIX <span class="string">"&lt;path_to_lib_directory&gt;"</span>)</span><br><span class="line"><span class="keyword">set</span>(_IMPORT_PREFIX_Release <span class="string">"&lt;path_to_lib_directory&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加lib的目标</span></span><br><span class="line"><span class="keyword">add_library</span>(lib INTERFACE IMPORTED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置lib的包含路径和链接库</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(lib PROPERTIES</span><br><span class="line">  INTERFACE_INCLUDE_DIRECTORIES <span class="string">"${lib_INCLUDE_DIRS}"</span></span><br><span class="line">  INTERFACE_LINK_LIBRARIES <span class="string">"${lib_LIBRARIES}"</span></span><br><span class="line">  INTERFACE_COMPILE_DEFINITIONS <span class="string">"LIB_VERSION_MAJOR=${lib_VERSION_MAJOR};LIB_VERSION_MINOR=${lib_VERSION_MINOR};LIB_VERSION_PATCH=${lib_VERSION_PATCH};LIB_VERSION=${lib_VERSION}"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入其他依赖</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">${_IMPORT_PREFIX}</span>/lib1/lib1Targets.cmake)</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">${_IMPORT_PREFIX}</span>/lib2/lib2Targets.cmake)</span><br></pre></td></tr></tbody></table></figure>
<p>需要根据您的库的实际情况修改上述模板中的路径和其他相关设置。确保将 <code>&lt;path_to_lib_include_directory&gt;</code> 替换为 lib 的包含目录的路径，将 <code>&lt;path_to_lib_library_file&gt;</code> 替换为 lib 的库文件的路径，并根据需要添加或修改其他设置。</p>
<h4 id="CMake-Debugger">CMake Debugger</h4>
<p>从 3.27 开始，CMake 支持调试器，可通过 vscode 调试 CMake 脚本。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/">https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/</a></p>
</li>
</ul>
<h4 id="include-gurad">include_gurad</h4>
<p>提供一个 include_guard 避免重复引入</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include_gurad(GLOBAL)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="集成常用的静态检测工具">集成常用的静态检测工具</h4>
<p>在 cmake 中集成静态检查工具.</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>iwyu: CMAKE_CXX_INCLUDE_WHAT_YOU_USE</p>
</li>
<li class="lvl-2">
<p>lwyu: CMAKE_LINK_WHAT_YOU_USE</p>
</li>
<li class="lvl-2">
<p>cpplint: CMAKE_CXX_CPPCHECK</p>
</li>
<li class="lvl-2">
<p>cppcheck: CMAKE_CXX_CPPCHECK</p>
</li>
<li class="lvl-2">
<p>clang tidy: CMAKE_CXX_CLANG_TIDY</p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.kitware.com/static-checks-with-cmake-cdash-iwyu-clang-tidy-lwyu-cpplint-and-cppcheck/">https://www.kitware.com/static-checks-with-cmake-cdash-iwyu-clang-tidy-lwyu-cpplint-and-cppcheck/</a></p>
</li>
</ul>
<h4 id="避免-展开干扰">避免 <code>;</code> 展开干扰</h4>
<p>通常 CMake 中 list 以字符串以 <code>;</code> 分隔的方式展开。这样会导致 CMake 引用变量时候出现问题，需要做特殊处理。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取以.specific_suffix为后缀的文件</span></span><br><span class="line"><span class="keyword">file</span>(GLOB_RECURSE list_depends</span><br><span class="line">    RELATIVE <span class="string">"${CMAKE_CURRENT_SOURCE_DIR}/suffix_specific_folder"</span></span><br><span class="line">    <span class="string">"${CMAKE_CURRENT_SOURCE_DIR}/suffix_specific_folder/*.specific_suffix"</span>)</span><br><span class="line"><span class="comment"># 将list以字符串以`;`分隔替换为\$&lt;SEMICOLON&gt;</span></span><br><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">";"</span> <span class="string">"\\$&lt;SEMICOLON&gt;"</span> list_depends <span class="string">"${list_depends}"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于以;分隔的字符串宏展开</span></span><br><span class="line"><span class="keyword">target_compile_options</span>(</span><br><span class="line">  <span class="variable">${target_name}</span></span><br><span class="line">  PRIVATE -DLIST_DEPENDS=<span class="string">"${list_depends}"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="CMake中处理rpath">CMake 中处理 rpath</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/community/-/wikis/doc/cmake/RPATH-handling">https://gitlab.kitware.com/cmake/community/-/wikis/doc/cmake/RPATH-handling</a></p>
</li>
</ul>
<h4 id="CMake-install-imported-lib">CMake install imported lib</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/41175354/can-i-install-shared-imported-library">https://stackoverflow.com/questions/41175354/can-i-install-shared-imported-library</a></p>
</li>
</ul>
<h4 id="Platform-check">Platform check</h4>
<p>cmake 提供对平台功能的模块。</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CheckIncludeFile)</span><br><span class="line"><span class="keyword">include</span>(CheckSymbolExists)</span><br><span class="line"><span class="keyword">include</span>(CheckTypeSize)</span><br><span class="line"><span class="keyword">include</span>(CheckFunctionExists)</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/community/-/wikis/doc/tutorials/How-To-Write-Platform-Checks">https://gitlab.kitware.com/cmake/community/-/wikis/doc/tutorials/How-To-Write-Platform-Checks</a></p>
</li>
</ul>
<h3 id="CMake-ctest">CMake ctest</h3>
<p>ctest 可执行文件是 CMake 测试驱动程序。CMake 生成的构建树是为使用 enable_testing () 和 add_test () 命令的项目创建的，它具有测试支持。该程序将运行测试并报告结果。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html">https://cmake.org/cmake/help/latest/manual/ctest.1.html</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CTest.html">https://cmake.org/cmake/help/latest/module/CTest.html</a></p>
</li>
</ul>
<h4 id="cdash">cdash</h4>
<p>cdash 用于发布 CMake 运行 ctest 的测试结果。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#id23">https://cmake.org/cmake/help/latest/manual/ctest.1.html#id23</a></p>
</li>
</ul>
<h2 id="vcpkg">vcpkg</h2>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/vcpkg/">vcpkg</a> 是 C++ 比较成熟的包管理器，覆盖大部分平台。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/category/vcpkg/">https://devblogs.microsoft.com/cppblog/category/vcpkg/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/maintainers/variables">Portfile Variable Reference</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/users/versioning">Versioning reference</a></p>
</li>
</ul>
<h3 id="Integration">Integration</h3>
<p>vcpkg 集成模式包含 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/vcpkg/examples/installing-and-using-packages"><code>Classic mode</code></a> 和 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/vcpkg/examples/manifest-mode-cmake"><code>Manifest mode</code></a>。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration">CMake Integration</a></p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration#cmake_toolchain_file">CMAKE_TOOLCHAIN_FILE</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration#using-multiple-toolchain-files">Multiple Toolchain</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/users/buildsystems/cmake-integration#settings-reference">Settings Reference</a></li>
</ul>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/reference/vcpkg-json">vcpkg.json reference</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/reference/vcpkg-configuration-json">vcpkg-configuration reference</a></p>
</li>
</ul>
<h3 id="dependencies">dependencies</h3>
<h4 id="overrides-version">overrides version</h4>
<p>使用 overrides 固化版本。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/vcpkg/discussions/25622">https://github.com/microsoft/vcpkg/discussions/25622</a></p>
</li>
</ul>
<h3 id="triplet">triplet</h3>
<h4 id="custom-triplet">custom triplet</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/users/examples/overlay-triplets-linux-dynamic">使用自定义 triplets</a></p>
</li>
</ul>
<h3 id="port">port</h3>
<p>创建 port 提交示例</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/northwindtraders/vcpkg-registry/commit/dd751ef4c5d0a7c2872e16354b1607f102855f63">https://github.com/northwindtraders/vcpkg-registry/commit/dd751ef4c5d0a7c2872e16354b1607f102855f63</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/vcpkg/pull/30005/files">https://github.com/microsoft/vcpkg/pull/30005/files</a></p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/northwindtraders/vcpkg-registry">https://github.com/northwindtraders/vcpkg-registry</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/maintainers/functions/vcpkg_from_github#sha512">determine sha512 for in vcpkg_from_github</a></p>
</li>
</ul>
<h4 id="patch-port">patch port</h4>
<p>当需要改动源码来通过编译时，可以使用 git diff 生成 patch 文件和 port 一起提交到 registry</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/examples/patching">https://learn.microsoft.com/en-us/vcpkg/examples/patching</a></p>
</li>
</ul>
<h4 id="empty-policy">empty policy</h4>
<p>空包策略是 VCPKG 中的一种特性，它允许用户安装一个空的库包，以便在项目中占位，但实际上不包含任何库文件 (包含函数、类、变量等代码的二进制文件)。这在某些情况下可能很有用，例如当用户需要占位符来满足其他依赖关系时。</p>
<p>代码步骤：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>设置一个名为 VCPKG_POLICY_EMPTY_PACKAGE 的变量。</p>
</li>
<li class="lvl-2">
<p>将该变量的值设置为 enabled，表示启用空包策略。</p>
</li>
</ul>
<h4 id="vcpkg-cmake-wrapper-cmake">vcpkg-cmake-wrapper.cmake</h4>
<p>自定义在 vcpkg 的 find_package 执行 include 的模块.</p>
<h4 id="baseline">baseline</h4>
<p>生成或更新 baseline</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcpkg x-update-baseline --add-initial-baseline</span><br></pre></td></tr></tbody></table></figure>
<h4 id="update-port">update port</h4>
<p>在私有 vcpkg 存储库上，可以使用 vcpkg 可执行文件生成所有 rev 解析哈希并提交 ports.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vcpkg format-manifest ports/mypackage/vcpkg.json</span><br><span class="line">git add ports</span><br><span class="line">git commit -m <span class="string">"update ports"</span></span><br><span class="line">vcpkg x-add-version mypackage --overlay-ports=./ports --x-builtin-registry-versions-dir=./versions/ --x-builtin-ports-root=./ports</span><br><span class="line">git add versions</span><br><span class="line">git commit --amend --no-edit</span><br></pre></td></tr></tbody></table></figure>
<h3 id="vcpkg-加速">vcpkg 加速</h3>
<h4 id="使用代理加速">使用代理加速</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>clash 或其它代理方式加速访问 github</p>
</li>
<li class="lvl-2">
<p>国内私域加速（企业加速等）</p>
</li>
</ul>
<h4 id="搭建私域缓存">搭建私域缓存</h4>
<p>参考 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/vcpkg/users/assetcaching">vcpkg 构建缓存</a>。</p>
<h4 id="国内公开缓存">国内公开缓存</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/383683670">JackBoosY 缓存</a></p>
</li>
</ul>
<h3 id="常用命令">常用命令</h3>
<h4 id="export">export</h4>
<p>将包导出作为缓存开发环境，但是不推荐</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用原始格式导出，可以搭建 vcpkg 离线构建环境，只需要在 CMakeLists 中设置 CMAKE_TOOLCHAIN_FILE 为导出的离线 vcpkg.cmake 即可。</span></span><br><span class="line">vcpkg <span class="built_in">export</span> abseil:x64-windows --raw --output=<span class="variable">$PWD</span>/path/to/project/3rdparty</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/vcpkg-2023-10-19-release-export-for-manifests-documentation-improvements-and-more/">vcpkg export now supports manifest mode</a></p>
</li>
</ul>
<h4 id="install">install</h4>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># libredwg 包名，tools 功能feature，x64 架构，windows 平台</span></span><br><span class="line">vcpkg install libredwg[tools]:x64-windows</span><br><span class="line"></span><br><span class="line"><span class="comment"># download and unpack sources for debugging, see https://github.com/microsoft/vcpkg/discussions/33259</span></span><br><span class="line">vcpkg install --only-downloads</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Github-Actions">Github Actions</h3>
<!-- todo -->
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/vcpkg/github-integration">https://learn.microsoft.com/zh-cn/vcpkg/github-integration</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/vcpkg-integration-with-the-github-dependency-graph/">https://devblogs.microsoft.com/cppblog/vcpkg-integration-with-the-github-dependency-graph/</a></p>
</li>
</ul>
<h3 id="vcpkg-registry">vcpkg-registry</h3>
<h4 id="create-registry">create registry</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/vcpkg/maintainers/registries">https://learn.microsoft.com/zh-cn/vcpkg/maintainers/registries</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/maintainers/registries">https://learn.microsoft.com/en-us/vcpkg/maintainers/registries</a></p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/maintainers/registries#git-registries">git registry</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/vcpkg/maintainers/registries#filesystem-registries">filesystem registry</a></li>
</ul>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/registries-bring-your-own-libraries-to-vcpkg/">https://devblogs.microsoft.com/cppblog/registries-bring-your-own-libraries-to-vcpkg/</a></p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://github.com/northwindtraders/vcpkg-registry">registry 示例</a></li>
</ul>
</li>
</ul>
<h4 id="using-registry">using registry</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/northwindtraders/beison-ptr">https://github.com/northwindtraders/beison-ptr</a></p>
</li>
</ul>
<h3 id="vcpkg-configuration">vcpkg configuration</h3>
<p>使用 vcpkg 引导开发环境，通过配置 <code>vcpkg-configuration.json</code> 即可配置项目需要的各种工具.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/vcpkg-artifacts/">https://devblogs.microsoft.com/cppblog/vcpkg-artifacts/</a></p>
</li>
</ul>
<h2 id="canon">canon</h2>
<!--
https://www.youtube.com/watch?v=mrSwJBJ-0z8
-->
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/conan-io">https://github.com/conan-io</a></p>
</li>
</ul>
<h3 id="结合cmake">结合 cmake</h3>
<p>conan 提供在 cmake 中运行 conan install 的 cmake 模块，该模块已集成在 cmake-registry 中，可通过 vcpkg 配置.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/conan-io/cmake-conan">https://github.com/conan-io/cmake-conan</a></p>
</li>
</ul>
<h2 id="xmake">xmake</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/xmake-io/xmake">xmake</a> 由国人开发的比较全面的构建系统。<a target="_blank" rel="noopener" href="https://xmake.io/#/zh-cn/about/course">中文版</a>，是一个基于 Lua 的轻量级现代化 c/c++ 的项目构建工具，主要特点是：语法简单易上手，提供更加可读的项目维护，实现跨平台行为一致的构建体验。</p>
<h3 id="ref-参考">ref 参考</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://xmake.io/#/">https://xmake.io/#/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://tboox.org/cn/2019/11/09/quickstart-1-installation/">https://tboox.org/cn/2019/11/09/quickstart-1-installation/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://xmake.io/#/zh-cn/about/course">https://xmake.io/#/zh-cn/about/course</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/91176441">https://zhuanlan.zhihu.com/p/91176441</a></p>
</li>
</ul>
<h2 id="clang-format">clang-format</h2>
<p>安装 <code>pip/choco/mamba/apt/yum install clang-format</code></p>
<p><a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/ClangFormatStyleOptions.html">Format Style Options</a> 格式配置说明</p>
<p>配置样例一</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .clang-format</span></span><br><span class="line"><span class="comment"># https://clang.llvm.org/docs/ClangFormatStyleOptions.html</span></span><br><span class="line">---</span><br><span class="line">Language: Cpp</span><br><span class="line"><span class="comment"># 访问说明符(public、protected、private)不偏移</span></span><br><span class="line">AccessModifierOffset: -4</span><br><span class="line"><span class="comment"># 开括号(开圆括号、开尖括号、开方括号)后的参数换行需要对齐</span></span><br><span class="line">AlignAfterOpenBracket: Align</span><br><span class="line"><span class="comment"># 连续赋值时，不对齐所有等号</span></span><br><span class="line">AlignConsecutiveAssignments: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 连续声明时，不对齐所有声明的变量名</span></span><br><span class="line">AlignConsecutiveDeclarations: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 对齐连续宏定义的样式</span></span><br><span class="line">AlignConsecutiveMacros: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 将转义的换行符(\)尽可能向左对齐</span></span><br><span class="line">AlignEscapedNewlines: Left</span><br><span class="line"><span class="comment"># 水平对齐二元和三元表达式的操作数</span></span><br><span class="line">AlignOperands: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 对齐连续的尾部注释</span></span><br><span class="line">AlignTrailingComments: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许函数的所有参数放到下一行</span></span><br><span class="line">AllowAllArgumentsOnNextLine: <span class="literal">false</span></span><br><span class="line">AllowAllConstructorInitializersOnNextLine: <span class="literal">false</span></span><br><span class="line">AllowAllParametersOfDeclarationOnNextLine: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不允许短的代码块放在同一行，如 while 代码块</span></span><br><span class="line">AllowShortBlocksOnASingleLine: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不允许短的 case 标签代码块放在同一行</span></span><br><span class="line">AllowShortCaseLabelsOnASingleLine: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不允许在类外定义的非空函数放在同一行</span></span><br><span class="line">AllowShortFunctionsOnASingleLine: Inline</span><br><span class="line"><span class="comment"># 不允许短的 if 语句放在同一行</span></span><br><span class="line">AllowShortIfStatementsOnASingleLine: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不允许短的循环代码块放在同一行</span></span><br><span class="line">AllowShortLoopsOnASingleLine: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不要主动在函数定义返回类型处换行，除非超过行字符数限制必须换行</span></span><br><span class="line">AlwaysBreakAfterDefinitionReturnType: None</span><br><span class="line">AlwaysBreakAfterReturnType: None</span><br><span class="line"><span class="comment"># 不允许在多行 string 前换行</span></span><br><span class="line">AlwaysBreakBeforeMultilineStrings: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 总是在 template 声明后换行</span></span><br><span class="line">AlwaysBreakTemplateDeclarations: Yes</span><br><span class="line"><span class="comment"># 不要求函数实参换行时必须每个参数各自一行</span></span><br><span class="line">BinPackArguments: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不要求函数形参换行时必须每个参数各自一行</span></span><br><span class="line">BinPackParameters: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 配置大括号是否换行</span></span><br><span class="line">BraceWrapping:</span><br><span class="line">  <span class="comment"># case 标签后面大括号不换行</span></span><br><span class="line">  AfterCaseLabel: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># class 定义后面大括号不换行</span></span><br><span class="line">  AfterClass: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 控制语句后面大括号不换行</span></span><br><span class="line">  AfterControlStatement: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># enum 定义后面大括号不换行</span></span><br><span class="line">  AfterEnum: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 函数定义后面大括号不换行</span></span><br><span class="line">  AfterFunction: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 命名空间定义后面大括号不换行</span></span><br><span class="line">  AfterNamespace: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># struct 定义后面大括号不换行</span></span><br><span class="line">  AfterStruct: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># union 定义后面大括号不换行</span></span><br><span class="line">  AfterUnion: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># extern 块后面大括号不换行</span></span><br><span class="line">  AfterExternBlock: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># catch 之前需要换行</span></span><br><span class="line">  BeforeCatch: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># else 之前需要换行</span></span><br><span class="line">  BeforeElse: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># lambda 大括号不换行</span></span><br><span class="line">  BeforeLambdaBody: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># while 之前需要换行</span></span><br><span class="line">  BeforeWhile: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 不要缩进大括号</span></span><br><span class="line">  IndentBraces: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 空函数体可以在同一行</span></span><br><span class="line">  SplitEmptyFunction: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 空语句可以在同一行</span></span><br><span class="line">  SplitEmptyRecord: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 空命名空间可以在同一行</span></span><br><span class="line">  SplitEmptyNamespace: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 需要换行时在二元操作符前换行，除了赋值操作符</span></span><br><span class="line">BreakBeforeBinaryOperators: NonAssignment</span><br><span class="line"><span class="comment"># 在 BraceWrapping 中自定义</span></span><br><span class="line">BreakBeforeBraces: Custom</span><br><span class="line"><span class="comment"># 继承列表换行时逗号不换行</span></span><br><span class="line">BreakBeforeInheritanceComma: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 继承列表换行时冒号换行，逗号不换行</span></span><br><span class="line">BreakInheritanceList: BeforeColon</span><br><span class="line"><span class="comment"># 在三元运算操作符之前换行</span></span><br><span class="line">BreakBeforeTernaryOperators: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 构造函数初始化列表换行时逗号不换行</span></span><br><span class="line">BreakConstructorInitializersBeforeComma: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 构造函数初始化列表换行时冒号换行，逗号不换行</span></span><br><span class="line">BreakConstructorInitializers: BeforeColon</span><br><span class="line"><span class="comment"># 允许断开字符串文字</span></span><br><span class="line">BreakStringLiterals: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 每行字符数限制</span></span><br><span class="line">ColumnLimit: 120</span><br><span class="line">CommentPragmas: <span class="string">"^ IWYU pragma:"</span></span><br><span class="line"><span class="comment"># 不允许不同的命名空间定义在同一行</span></span><br><span class="line">CompactNamespaces: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 构造函数初始化列表要么都在一行，要么每个变量一行</span></span><br><span class="line">ConstructorInitializerAllOnOneLineOrOnePerLine: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 构造函数初始化列表需要 4 个缩进</span></span><br><span class="line">ConstructorInitializerIndentWidth: 4</span><br><span class="line"><span class="comment"># 换行后下一行需要 4 个 缩进</span></span><br><span class="line">ContinuationIndentWidth: 4</span><br><span class="line"><span class="comment"># 变量初始化列表前后不需要空格</span></span><br><span class="line">Cpp11BracedListStyle: <span class="literal">true</span></span><br><span class="line">DerivePointerAlignment: <span class="literal">true</span></span><br><span class="line">DisableFormat: <span class="literal">false</span></span><br><span class="line">ExperimentalAutoDetectBinPacking: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 自动为命名空间结尾处添加注释</span></span><br><span class="line">FixNamespaceComments: <span class="literal">true</span></span><br><span class="line">ForEachMacros:</span><br><span class="line">  - foreach</span><br><span class="line">  - Q_FOREACH</span><br><span class="line">  - BOOST_FOREACH</span><br><span class="line">IncludeBlocks: Preserve</span><br><span class="line">IncludeCategories:</span><br><span class="line">  - Regex: <span class="string">'^&lt;ext/.*\.h&gt;'</span></span><br><span class="line">    Priority: 2</span><br><span class="line">  - Regex: <span class="string">"StdAfx.h"</span></span><br><span class="line">    Priority: -1</span><br><span class="line">  - Regex: <span class="string">'^&lt;.*\.h&gt;'</span></span><br><span class="line">    Priority: 1</span><br><span class="line">  - Regex: <span class="string">"^&lt;.*"</span></span><br><span class="line">    Priority: 2</span><br><span class="line">  - Regex: <span class="string">".*"</span></span><br><span class="line">    Priority: 3</span><br><span class="line">IncludeIsMainRegex: <span class="string">"([-_](test|unittest))?$"</span></span><br><span class="line"><span class="comment"># switch 里的 case 需要缩进</span></span><br><span class="line">IndentCaseLabels: <span class="literal">true</span></span><br><span class="line"><span class="comment"># extern 里的代码块需要缩进</span></span><br><span class="line">IndentExternBlock: Indent</span><br><span class="line"><span class="comment"># 预处理指令不能有缩进</span></span><br><span class="line">IndentPPDirectives: None</span><br><span class="line"><span class="comment"># 使用 4 个缩进</span></span><br><span class="line">IndentWidth: 4</span><br><span class="line"><span class="comment"># 函数声明、定义时在返回类型处换行时，下一行不要缩进</span></span><br><span class="line">IndentWrappedFunctionNames: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 代码块开始处不要有空行</span></span><br><span class="line">KeepEmptyLinesAtTheStartOfBlocks: <span class="literal">false</span></span><br><span class="line">MacroBlockBegin: <span class="string">""</span></span><br><span class="line">MacroBlockEnd: <span class="string">""</span></span><br><span class="line"><span class="comment"># 不能有连续2个及以上的空行</span></span><br><span class="line">MaxEmptyLinesToKeep: 1</span><br><span class="line"><span class="comment"># 命名空间内的内容不要缩进</span></span><br><span class="line">NamespaceIndentation: None</span><br><span class="line">PenaltyBreakAssignment: 2</span><br><span class="line">PenaltyBreakBeforeFirstCallParameter: 1</span><br><span class="line">PenaltyBreakComment: 300</span><br><span class="line">PenaltyBreakFirstLessLess: 120</span><br><span class="line">PenaltyBreakString: 1000</span><br><span class="line">PenaltyBreakTemplateDeclaration: 10</span><br><span class="line">PenaltyExcessCharacter: 1000000</span><br><span class="line">PenaltyReturnTypeOnItsOwnLine: 200</span><br><span class="line"><span class="comment"># * &amp; 紧挨类型名</span></span><br><span class="line">PointerAlignment: Left</span><br><span class="line">RawStringFormats:</span><br><span class="line">  - Language: Cpp</span><br><span class="line">    Delimiters:</span><br><span class="line">      - cc</span><br><span class="line">      - CC</span><br><span class="line">      - cpp</span><br><span class="line">      - Cpp</span><br><span class="line">      - CPP</span><br><span class="line">      - <span class="string">"c++"</span></span><br><span class="line">      - <span class="string">"C++"</span></span><br><span class="line">    CanonicalDelimiter: <span class="string">""</span></span><br><span class="line">    BasedOnStyle: google</span><br><span class="line">  - Language: TextProto</span><br><span class="line">    Delimiters:</span><br><span class="line">      - pb</span><br><span class="line">      - PB</span><br><span class="line">      - proto</span><br><span class="line">      - PROTO</span><br><span class="line">    EnclosingFunctions:</span><br><span class="line">      - EqualsProto</span><br><span class="line">      - EquivToProto</span><br><span class="line">      - PARSE_PARTIAL_TEXT_PROTO</span><br><span class="line">      - PARSE_TEST_PROTO</span><br><span class="line">      - PARSE_TEXT_PROTO</span><br><span class="line">      - ParseTextOrDie</span><br><span class="line">      - ParseTextProtoOrDie</span><br><span class="line">    CanonicalDelimiter: <span class="string">""</span></span><br><span class="line">    BasedOnStyle: google</span><br><span class="line"><span class="comment"># 允许对注释重新排版</span></span><br><span class="line">ReflowComments: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许对 #include 排序</span></span><br><span class="line">SortIncludes: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许对 using 声明排序</span></span><br><span class="line">SortUsingDeclarations: <span class="literal">true</span></span><br><span class="line"><span class="comment"># c 风格类型转换括号后不要有空格</span></span><br><span class="line">SpaceAfterCStyleCast: <span class="literal">false</span></span><br><span class="line"><span class="comment"># template 关键字后面需要一个空格</span></span><br><span class="line">SpaceAfterTemplateKeyword: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 赋值运算符两边需要空格</span></span><br><span class="line">SpaceBeforeAssignmentOperators: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 变量初始化列表大括号前不要有空格</span></span><br><span class="line">SpaceBeforeCpp11BracedList: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 构造函数初始化冒号前需要空格</span></span><br><span class="line">SpaceBeforeCtorInitializerColon: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 继承语句冒号前需要一个空格</span></span><br><span class="line">SpaceBeforeInheritanceColon: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 控制语句后面需要一个空格(if/for/while...)</span></span><br><span class="line">SpaceBeforeParens: ControlStatements</span><br><span class="line"><span class="comment"># 基于范围循环的冒号前需要一个空格</span></span><br><span class="line">SpaceBeforeRangeBasedForLoopColon: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 不要在空的圆括号内添加空格</span></span><br><span class="line">SpaceInEmptyParentheses: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 同行尾随注释 // 前面需要一个空格</span></span><br><span class="line">SpacesBeforeTrailingComments: 1</span><br><span class="line"><span class="comment"># 尖括号前后没有空格</span></span><br><span class="line">SpacesInAngles: <span class="literal">false</span></span><br><span class="line"><span class="comment"># c 风格类型转换的括号中前后没有空格</span></span><br><span class="line">SpacesInCStyleCastParentheses: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 圆括号前后没有空格</span></span><br><span class="line">SpacesInParentheses: <span class="literal">false</span></span><br><span class="line"><span class="comment"># 方括号前后没有空格</span></span><br><span class="line">SpacesInSquareBrackets: <span class="literal">false</span></span><br><span class="line">Standard: Auto</span><br><span class="line">StatementMacros:</span><br><span class="line">  - Q_UNUSED</span><br><span class="line">  - QT_REQUIRE_VERSION</span><br><span class="line">TabWidth: 4</span><br><span class="line">UseTab: Never</span><br></pre></td></tr></tbody></table></figure>
<h2 id="WSL">WSL</h2>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/windows/wsl/">WSL</a> 是 Windows 上的 Linux 子系统。</p>
<h3 id="安装">安装</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>在 Store 中安装 Windows subsystem for Linux。</p>
</li>
<li class="lvl-2">
<p>配置非 root 用户登录密码提示。</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$USER</span> ALL=\(root\) NOPASSWD:ALL | <span class="built_in">tee</span> /etc/sudoers.d/<span class="variable">$USER</span> \</span><br><span class="line">    &amp;&amp; <span class="built_in">chmod</span> 0440 /etc/sudoers.d/<span class="variable">$USER</span></span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>打开 systemd</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \[boot\]\nsystemd=<span class="literal">true</span>  &gt;&gt; /etc/wsl.conf</span><br></pre></td></tr></tbody></table></figure>
<p>重启 wsl，<code>wsl --shutdown &lt;your linux distro&gt;</code>。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证 systemd</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>=service</span><br></pre></td></tr></tbody></table></figure>
<h3 id="文件共享">文件共享</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>通过路径 <code>/mnt/c/path/to/windows</code></p>
</li>
<li class="lvl-2">
<p>通过命令打开浏览器 <code>explorer .</code></p>
</li>
</ul>
<h2 id="Windows">Windows</h2>
<h3 id="MSVC">MSVC</h3>
<h3 id="Visual-Studio">Visual Studio</h3>
<h4 id="编译">编译</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>/PROFILE: 打开 VS 测试覆盖率</p>
</li>
</ul>
<h4 id="插件">插件</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/0xc5/p/17081194.html">VA(Visual Assist)</a></p>
</li>
</ul>
<h3 id="链接">链接</h3>
<p>在 windows 上完整的动态链接参考<a target="_blank" rel="noopener" href="https://learn.microsoft.com/windows/win32/dlls/dynamic-link-libraries">官方文档</a>，DLL 搜索路径参考 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/windows/win32/dlls/dynamic-link-library-search-order">动态库链接顺序</a>。</p>
<h4 id="动态链接">动态链接</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6TrJc06IekE">https://www.youtube.com/watch?v=6TrJc06IekE</a></p>
</li>
</ul>
<p><strong>windows 下动态链接信息保存在 .idata 节中</strong> , .idata 是指导入数据表（Import Data Table）。idata 是 PE 文件格式中的一个部分，用于描述程序在运行时所需的外部函数和符号。 其中的 Directory Table 包含了每个 dll 的链接信息，包含有以下信息：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>ImportLookupTable（导入查找表） offset</strong>:</p>
<ul class="lvl-2">
<li class="lvl-4">Ordinal/Name flags</li>
<li class="lvl-4">Ordinal (序号)</li>
<li class="lvl-4"><strong>Hint/Name offset</strong>: 函数名称相对于 Hint/Name Table 的偏移量
<ul class="lvl-4">
<li class="lvl-6">Hint idx to export table</li>
<li class="lvl-6"><strong>Function name</strong></li>
</ul>
</li>
</ul>
</li>
<li class="lvl-2">
<p>DLL timestamp(filled at bind time)</p>
</li>
<li class="lvl-2">
<p>Forwarder Chain</p>
</li>
<li class="lvl-2">
<p><strong>DLL Name(offset in image)</strong></p>
</li>
<li class="lvl-2">
<p><strong>ImportAddressTable offset</strong></p>
<ul class="lvl-2">
<li class="lvl-4">Imported function address</li>
</ul>
</li>
</ul>
<p>在当前程序引用库时，对应入函数调用处使用 jmp 指令时，会通过 .idata 查询链接进当前程序被编译进的引用库 dll1.lib 的对应函数跳转地址，并转到库 dll1.dll 中的 .edata 找到最终的调用实现。如下图:</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20231017/230851900.png" alt="image"></p>
<h4 id="符号可见性-2">符号可见性</h4>
<p>默认符号不到处，除非使用以下声明</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>__declspec (export): 添加符号到 .edata</p>
</li>
<li class="lvl-2">
<p>__declspec (import): 基本不做太多工作，主要用于优化加速符号调用跳转</p>
</li>
</ul>
<h4 id="链接库搜索路径">链接库搜索路径</h4>
<p>Windows 会按照以下顺序搜索目录：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>程序所在的目录</p>
</li>
<li class="lvl-2">
<p>当前目录</p>
</li>
<li class="lvl-2">
<p>Windows 系统目录（例如，C:\Windows\System32）</p>
</li>
<li class="lvl-2">
<p>Windows 目录（例如，C:\Windows）</p>
</li>
<li class="lvl-2">
<p>PATH 环境变量中列出的目录</p>
</li>
</ul>
<blockquote>
<p>[!TIP]<br>
可以使用 <code>setx path "%path%;C:\my\directory"</code>，将其它的链接路径设置到环境变量中。请注意，<code>%path%</code> 是一个特殊的变量，它包含了当前 <code>path</code> 环境变量的值，环境变量是永久的。</p>
</blockquote>
<h4 id="查看依赖-dll">查看依赖 dll</h4>
<figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&amp; <span class="string">"C:/Program Files/Microsoft Visual Studio/2022/Enterprise/VC/Tools/MSVC/14.34.31933/bin/Hostx64/x64/dumpbin.exe"</span> /dependents xxx.dll</span><br><span class="line">Microsoft (<span class="built_in">R</span>) COFF/PE Dumper Version <span class="number">14.34</span>.<span class="number">31942.0</span></span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dump of file abseil_dll.dll</span><br><span class="line"></span><br><span class="line">File <span class="built_in">Type</span>: DLL</span><br><span class="line"></span><br><span class="line">  Image has the following dependencies:</span><br><span class="line"></span><br><span class="line">    KERNEL32.dll</span><br><span class="line">    ADVAPI32.dll</span><br><span class="line">    clang_rt.asan_dbg_dynamic<span class="literal">-x86_64</span>.dll</span><br><span class="line">    MSVCP140D.dll</span><br><span class="line">    dbghelp.dll</span><br><span class="line">    bcrypt.dll</span><br><span class="line">    VCRUNTIME140D.dll</span><br><span class="line">    VCRUNTIME140_1D.dll</span><br><span class="line">    ucrtbased.dll</span><br><span class="line"></span><br><span class="line">  Summary</span><br><span class="line"></span><br><span class="line">      <span class="number">161000</span> .data</span><br><span class="line">       <span class="number">14000</span> .pdata</span><br><span class="line">      <span class="number">557000</span> .rdata</span><br><span class="line">       <span class="number">38000</span> .reloc</span><br><span class="line">        <span class="number">1000</span> .rsrc</span><br><span class="line">      <span class="number">293000</span> .text</span><br></pre></td></tr></tbody></table></figure>
<h3 id="MSVC-C-代码分析">MSVC C++ 代码分析</h3>
<p>Visual Studio 提供了多种用于分析和提升 C++ 代码质量的工具。例如 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/cpp/code-quality/?view=msvc-170">Visual Studio (MSVC-170) C++ 代码分析</a></p>
<h3 id="MFC">MFC</h3>
<h4 id="简单的-MFC-示例">简单的 MFC 示例</h4>
<p>示例使用 n 次拟合曲线，并实现功能点选 3 个点，自动画出拟合曲线。实现使用 CMake + vcpkg 工具链，对于 MFC 编译，需要增加配置编译选项，否则，会报错：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>AFXDLL: 配置 AFXDLL 宏</p>
</li>
<li class="lvl-2">
<p>CMAKE_MFC_FLAG: 默认改为动态连接 mfc 库</p>
</li>
<li class="lvl-2">
<p>WIN32: 设置正确的 /SUBSYSTEM 表示一个窗口程序，而不是一个终端程序。</p>
</li>
</ul>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.18</span> FATAL_ERROR)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Vcpkg build environment</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">"VCPKG_ROOT:$ENV{VCPKG_ROOT}"</span>)</span><br><span class="line"><span class="keyword">set</span>(VCPKG_ROOT <span class="string">"$ENV{VCPKG_ROOT}"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set cmake tool chain</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_TOOLCHAIN_FILE <span class="variable">${VCPKG_ROOT}</span>/scripts/buildsystems/vcpkg.cmake)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(VCPKG_VERBOSE</span><br><span class="line">    <span class="keyword">ON</span></span><br><span class="line">    CACHE BOOL <span class="string">"Vcpkg VCPKG_VERBOSE"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(fitting)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(Eigen3 CONFIG REQUIRED)</span><br><span class="line"><span class="keyword">if</span>(CMAKE_HOST_WIN32)</span><br><span class="line">  <span class="keyword">add_definitions</span>(-D_AFXDLL)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_MFC_FLAG <span class="number">2</span>) <span class="comment"># shared link</span></span><br><span class="line">  <span class="comment"># WIN32 correctly set Visual Studio linker flag /SUBSYSTEM in CMAKE</span></span><br><span class="line">  <span class="keyword">add_executable</span>(<span class="variable">${PROJECT_NAME}</span> WIN32 main.cpp)</span><br><span class="line">  <span class="keyword">target_include_directories</span>(<span class="variable">${PROJECT_NAME}</span> PUBLIC <span class="variable">${CMAKE_CURRENT_LIST_DIR}</span>/)</span><br><span class="line">  <span class="keyword">target_link_libraries</span>(<span class="variable">${PROJECT_NAME}</span> PRIVATE Eigen3::Eigen)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></tbody></table></figure>
<p>在 vcpkg 中配置使用依赖 Eigen3</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"$schema"</span><span class="punctuation">:</span> <span class="string">"https://raw.githubusercontent.com/microsoft/vcpkg-tool/main/docs/vcpkg.schema.json"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"fitting"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"1.0.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"dependencies"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"eigen3"</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"Eigen/Dense"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WindowWidth 640</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WindowHeight 480</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WindowLeft 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WindowTop 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WindowRight (WindowLeft + WindowWidth)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WindowBottom (WindowTop + WindowHeight)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ViewLeft 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ViewBottom 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PixelUnit 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ViewZoomLevel 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所给点的矩阵，返回结果的点拟合矩阵</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">size_t</span> row, <span class="type">size_t</span> col&gt;</span><br><span class="line"><span class="function">Eigen::Matrix&lt;<span class="type">double</span>, row, 1&gt; <span class="title">GetFitting</span><span class="params">(Eigen::Matrix&lt;<span class="type">double</span>, row, col&gt; m,</span></span></span><br><span class="line"><span class="params"><span class="function">                                         Eigen::Matrix&lt;<span class="type">double</span>, row, <span class="number">1</span>&gt; y)</span> </span>{</span><br><span class="line">  <span class="keyword">return</span> m.<span class="built_in">inverse</span>() * y;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取拟合结果</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">size_t</span> row&gt;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">FittingReuslt</span><span class="params">(Eigen::Matrix&lt;<span class="type">double</span>, row, <span class="number">1</span>&gt; fa, <span class="type">double</span> x)</span> </span>{</span><br><span class="line">  <span class="comment">// product</span></span><br><span class="line">  <span class="keyword">return</span> Eigen::Matrix&lt;<span class="type">double</span>, <span class="number">1</span>, <span class="number">3</span>&gt;{x * x, x, <span class="number">1</span>} * fa;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CMyWnd</span> : <span class="keyword">public</span> CFrameWnd {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">CMyWnd</span>() {</span><br><span class="line">    <span class="built_in">Create</span>(<span class="literal">NULL</span>, _T(<span class="string">"My Window"</span>), WS_OVERLAPPEDWINDOW,</span><br><span class="line">           <span class="built_in">CRect</span>(WindowLeft, WindowTop, WindowWidth, WindowHeight));</span><br><span class="line">    <span class="built_in">SetTimer</span>(<span class="number">1</span>, <span class="number">40</span>, <span class="literal">NULL</span>); <span class="comment">// 设置定时</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="comment">// 绘制回调</span></span><br><span class="line">  <span class="function">afx_msg <span class="type">void</span> <span class="title">OnPaint</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function">CPaintDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    dc.<span class="built_in">SetMapMode</span>(MM_ANISOTROPIC);</span><br><span class="line">    dc.<span class="built_in">SetWindowExt</span>(WindowWidth + <span class="number">50</span>, WindowHeight + <span class="number">50</span>);</span><br><span class="line">    dc.<span class="built_in">SetViewportExt</span>(WindowWidth, WindowHeight);</span><br><span class="line">    dc.<span class="built_in">SetViewportOrg</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> HPEN pen = <span class="built_in">CreatePen</span>(PS_SOLID, <span class="number">0</span>, <span class="built_in">RGB</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="type">const</span> HPEN oldpen = <span class="built_in">static_cast</span>&lt;HPEN&gt;(<span class="built_in">SelectObject</span>(dc, pen));</span><br><span class="line">    dc.<span class="built_in">MoveTo</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    dc.<span class="built_in">LineTo</span>(WindowWidth, WindowHeight);</span><br><span class="line">    dc.<span class="built_in">MoveTo</span>(<span class="number">0</span>, WindowHeight);</span><br><span class="line">    dc.<span class="built_in">LineTo</span>(WindowWidth, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (m_points.<span class="built_in">size</span>() &gt;= <span class="number">3</span>) {</span><br><span class="line">      <span class="comment">// 计算拟合参数</span></span><br><span class="line">      CPoint p1 = m_points[<span class="number">0</span>];</span><br><span class="line">      CPoint p2 = m_points[<span class="number">1</span>];</span><br><span class="line">      CPoint p3 = m_points[<span class="number">2</span>];</span><br><span class="line">      Eigen::Matrix&lt;<span class="type">double</span>, <span class="number">3</span>, <span class="number">3</span>&gt; m;</span><br><span class="line">      Eigen::Matrix&lt;<span class="type">double</span>, <span class="number">3</span>, <span class="number">1</span>&gt; y;</span><br><span class="line">      m &lt;&lt; p<span class="number">1.</span>x * p<span class="number">1.</span>x, p<span class="number">1.</span>x, <span class="number">1</span>, p<span class="number">2.</span>x * p<span class="number">2.</span>x, p<span class="number">2.</span>x, <span class="number">1</span>, p<span class="number">3.</span>x * p<span class="number">3.</span>x, p<span class="number">3.</span>x, <span class="number">1</span>;</span><br><span class="line">      y &lt;&lt; p<span class="number">1.</span>y, p<span class="number">2.</span>y, p<span class="number">3.</span>y;</span><br><span class="line">      <span class="keyword">auto</span> fa = <span class="built_in">GetFitting</span>&lt;<span class="number">3</span>, <span class="number">3</span>&gt;(m, y);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 绘制拟合结果</span></span><br><span class="line">      dc.<span class="built_in">MoveTo</span>(p1);</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> x = p<span class="number">1.</span>x; x &lt;= p<span class="number">3.</span>x; x++) {</span><br><span class="line">        dc.<span class="built_in">LineTo</span>((<span class="type">int</span>)x, (<span class="type">int</span>)<span class="built_in">FittingReuslt</span>&lt;<span class="number">3</span>&gt;(fa, x));</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">SelectObject</span>(dc, oldpen);</span><br><span class="line">    <span class="built_in">DeleteObject</span>(pen);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 鼠标左击事件回调</span></span><br><span class="line">  <span class="function">afx_msg <span class="type">void</span> <span class="title">OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (m_points.<span class="built_in">size</span>() &lt; <span class="number">3</span>) {</span><br><span class="line">      m_points.<span class="built_in">push_back</span>(point);</span><br><span class="line">      <span class="built_in">Invalidate</span>();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定时回调，重绘</span></span><br><span class="line">  <span class="function">afx_msg <span class="type">void</span> <span class="title">OnTimer</span><span class="params">(UINT_PTR nIDEvent)</span> </span>{ <span class="built_in">Invalidate</span>(); }</span><br><span class="line"></span><br><span class="line">  <span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::vector&lt;CPoint&gt; m_points{};</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册消息回调映射</span></span><br><span class="line"><span class="built_in">BEGIN_MESSAGE_MAP</span>(CMyWnd, CFrameWnd)</span><br><span class="line"><span class="built_in">ON_WM_PAINT</span>()</span><br><span class="line"><span class="built_in">ON_WM_LBUTTONDOWN</span>()</span><br><span class="line"><span class="built_in">ON_WM_TIMER</span>()</span><br><span class="line"><span class="built_in">END_MESSAGE_MAP</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CMyApp</span> : <span class="keyword">public</span> CWinApp {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> BOOL <span class="title">InitInstance</span><span class="params">()</span> </span>{</span><br><span class="line">    CMyWnd *pWnd = <span class="keyword">new</span> <span class="built_in">CMyWnd</span>();</span><br><span class="line">    m_pMainWnd = pWnd;</span><br><span class="line">    pWnd-&gt;<span class="built_in">ShowWindow</span>(SW_SHOW);</span><br><span class="line">    pWnd-&gt;<span class="built_in">UpdateWindow</span>();</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">CMyApp theApp;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="LLVM-on-Windows">LLVM on Windows</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wetmelon.github.io/clang-on-windows.html">https://wetmelon.github.io/clang-on-windows.html</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.conan.io/2022/10/13/Different-flavors-Clang-compiler-Windows.html">https://blog.conan.io/2022/10/13/Different-flavors-Clang-compiler-Windows.html</a></p>
</li>
</ul>
<h2 id="Unix">Unix</h2>
<h3 id="编译和链接">编译和链接</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=cpkDQaYttR4">Compiling and Linking</a></p>
</li>
</ul>
<p>通常比较成熟的 IDE 会将这个过程封装，对用户无感。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>编译</p>
</li>
</ul>
<p>简单来说，将用户代码，编译成机器可执行的指令，一般指对单个文件进行编译。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 ellf 的头部信息</span></span><br><span class="line">readelf -h main.o</span><br><span class="line"><span class="comment"># 获取 elf 区块</span></span><br><span class="line">readelf -S m</span><br><span class="line"><span class="comment"># .text 编译好的代码</span></span><br><span class="line"><span class="comment"># .data 数据区</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果代码中有调用其它的库或对象，在代码编译成单个对象文件时，调用符号时会将对应位置的反汇编先设置为 0，然后在链接这一步组装（生成调用地址）。</p>
<p>在代码块中，可以找到需要为调用函数生成地址的重定位表（.reloc）。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取重定位表，在 .text 可以找到需要生成调用地址的函数</span></span><br><span class="line">objdump -r main.o</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>链接</p>
</li>
</ul>
<p>将编译之后的所有目标文件，库（动态库、静态库）组合拼装成一个独立的可执行文件。</p>
<p>这里，链接器，会根据目标文件、静态库中的重定位表找到需要修正地址的函数及全局变量。</p>
<p>如果，在链接时没有提供需要的库，链接时会警告 <code>undefined reference</code>。</p>
<hr>
<p>以上编译及链接过程通常使用 IDE 或脚本自动完成。比如 makefile 管理依赖的脚本：</p>
<figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个目标 main 依赖树</span></span><br><span class="line"><span class="section">all: main</span></span><br><span class="line"><span class="comment"># main 依赖 main.o math.o，以及生成指令</span></span><br><span class="line"><span class="section">main: main.o math.o</span></span><br><span class="line">    gcc main.o math.o -o main</span><br><span class="line"></span><br><span class="line"><span class="section">main.o: main.c</span></span><br><span class="line">    gcc -c main.c</span><br><span class="line"></span><br><span class="line"><span class="section">math.o: math.c</span></span><br><span class="line">    gcc -c math.c</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm main main.o math.o</span><br></pre></td></tr></tbody></table></figure>
<h4 id="可执行文件或对象文件的节表和内存映射">可执行文件或对象文件的节表和内存映射</h4>
<p>对象文件或可执行文件的节表和内存布局是两个不同的概念，它们描述了程序在不同层次上的组织和存储方式。</p>
<p>节表（Section Table）是对象文件或可执行文件中的一种数据结构，用于记录文件中各个节的信息。它包含了每个节的名称、大小、偏移量等属性。节表是静态的，它在编译或链接过程中生成，并嵌入到最终的二进制文件中。节表描述了程序在文件中的组织形式，但并不直接映射到内存中的布局。</p>
<p>内存布局（Memory Layout）是程序在运行时分配和使用内存的方式。当程序被加载到内存中运行时，操作系统会为程序分配一块内存空间，并将程序的各个部分（例如代码、数据、堆栈）放置在不同的内存区域中。内存布局是动态的，它由操作系统和运行时环境决定，并且可以因为程序的运行状态而发生变化。</p>
<p>节表描述了程序在文件中的组织形式，而内存布局描述了程序在运行时的内存分配和布局情况。节表用于链接器和调试器在加载文件时定位和解析各个节的数据，而内存布局则决定了程序在运行时如何访问和使用内存中的数据和代码。</p>
<h4 id="节表">节表</h4>
<p>对象文件或可执行文件的节表是一个数据结构，用于记录文件中各个节的信息。具体的节表结构和命名约定可能因不同的对象文件格式而有所不同，但以下是一些常见的节表条目及其相对位置的示例：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>代码节（Text Section）：存储程序的可执行代码。它通常位于节表的开始位置。</p>
</li>
<li class="lvl-2">
<p>数据节（Data Section）：存储程序的已初始化的全局变量和静态变量。它通常紧随代码节之后。</p>
</li>
<li class="lvl-2">
<p>BSS 节（BSS Section）：存储程序的未初始化的全局变量和静态变量。它通常位于数据节之后。</p>
</li>
<li class="lvl-2">
<p>符号表节（Symbol Table Section）：存储符号表的相关信息，包括函数、变量、常量等的名称、类型和地址等。它通常位于 BSS 节之后。</p>
</li>
<li class="lvl-2">
<p>字符串表节（String Table Section）：存储字符串常量的表，用于存储符号表中的名称和其他字符串。它通常紧随符号表节之后。</p>
</li>
<li class="lvl-2">
<p>重定位表节（Relocation Table Section）：存储需要进行重定位的代码和数据的相关信息。它通常位于字符串表节之后。</p>
</li>
<li class="lvl-2">
<p>动态链接节（Dynamic Linking Section）：存储动态链接相关的信息，如动态链接库的名称和依赖关系等。它通常位于重定位表节之后。</p>
</li>
<li class="lvl-2">
<p>调试信息节（Debug Information Section）：存储调试器使用的调试信息，如源代码映射、变量名称和行号等。它通常位于动态链接节之后。</p>
</li>
<li class="lvl-2">
<p>其他自定义节：根据具体的对象文件格式和编译器的实现，还可能存在其他自定义的节，用于存储特定的数据或代码。</p>
</li>
</ul>
<h4 id="内存映射">内存映射</h4>
<p>内存映射 (Memory Map) 通常用于描述编译及链接将程序的实体放到不同的段地址上:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>代码 (text or code), 用于存放代码</p>
</li>
<li class="lvl-2">
<p>字面量 (literal), 用于存放已初始化只读数据</p>
</li>
<li class="lvl-2">
<p>数据 (data), 用于存放已初始化读写数据</p>
</li>
<li class="lvl-2">
<p>符号 (bss,Block Started by Symbol), 用于存放未初始化读写数据</p>
</li>
<li class="lvl-2">
<p>栈 (stack), 用于存储函数的<code>局部变量、函数参数、函数调用的上下文信息和返回地址</code>等。栈以<code>后进先出（LIFO）</code>的方式分配和释放内存。每当调用函数时，栈都会分配一块新的内存空间，当函数返回时，栈会释放该内存空间。栈通常位于高地址的部分，靠近内存的顶部。栈的地址增长方向可以是向下（从高地址向低地址增长）或向上（从低地址向高地址增长），具体取决于操作系统和编译器的实现。大多数常见的操作系统（如 Windows、Linux 等）使用向下增长的栈，也就是栈底位于高地址，栈顶位于低地址。</p>
</li>
<li class="lvl-2">
<p>堆 (heap), 用于存储程序<code>运行时动态创建的对象、变量或数据结构</code>。堆的大小在程序运行期间可以动态增长或缩小，需要手动管理内存的分配和释放。地址生长方向和栈相反，并靠近内存的底部.</p>
</li>
<li class="lvl-2">
<p>命令行参数及环境变量，用于存储程序运行时传递给程序的命令行参数和环境变量的值的一部分。通常以字符串数组的形式存储在内存中，数组中的每个元素对应一个命令行参数。这些参数在内存中是连续存储的，通常在堆栈之后的位置。命令行参数和环境变量的具体存储方式和访问方式取决于操作系统和编程语言的实现。在 C 语言中，可以使用 argc 和 argv 参数来获取命令行参数，使用 environ 变量来获取环境变量。</p>
</li>
<li class="lvl-2">
<p>共享库 (shared library), 用于存储程序所需的外部共享库的代码和数据。动态链接库通常在程序加载时被动态加载到内存中，以供程序在运行时使用。</p>
</li>
</ul>
<h4 id="静态链接">静态链接</h4>
<p>将程序所需库在编译时<strong>根据重定位表</strong>链接到 elf 中。</p>
<p>这样不需要依赖库，提高运行性能，减少运行时库加载时间。</p>
<p><code>-static</code> 选项告诉编译器使用静态链接，<code>-o main</code> 指定输出文件名为 <code>main</code>，main.c 是源代码文件名，<code>-lm</code> 选项告诉编译器链接 <code>math</code> 库。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -static -o main main.c -lm</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Position-Independent-Code">Position Independent Code</h4>
<p>非 PIC, 调用符号跳转地址保存的是相对代码位置的绝对地址.</p>
<p>在 PIC 中，** 隐藏符号（Hidden Symbol）** 跳转是通过相对偏移量来实现的，通过将代码段的基址与相对偏移量相加来计算函数或变量的实际地址。这使得代码可以在内存中的不同位置加载，而不需要重新定位符号。</p>
<p><strong>可见符号，使用过 got 进行跳转的</strong>: got 表存储了全局符号的实际地址。全局符号是在程序或共享库中定义的全局变量和函数。由于动态链接的特性，这些全局符号的地址在程序加载时是未知的。</p>
<p>当程序或共享库被加载到内存中时，动态链接器（<a target="_blank" rel="noopener" href="http://ld.so">ld.so</a>）会负责填充.got 表中的地址。它将解析和定位全局符号的实际地址，并将这些地址写入.got 表中。</p>
<p>在程序执行期间，当需要访问全局符号时，程序会通过.got 表来获取实际地址。它会使用.got 表中的偏移量来计算全局符号的地址，然后进行访问。</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20231017/232437083.png" alt="image"></p>
<p>通常建议所有动态库都使用 PIC, 但 - fPIC 并没有作为隐式传递和 - shared 一起传递使用.</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20231017/233022638.png" alt="image"></p>
<h4 id="Resolution-Time">Resolution Time</h4>
<p>默认链接时，链接使用:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>--allow-shlib-undefined</code>: 允许未定义的动态符号，通常可以使用参数强制检查，如 <code>--no-allow-shlib-undefined</code>(ld 上时递归生效，在 gold/ldd 中不递归) 或者 <code>-z defs</code> / <code>--no-undefined</code></p>
</li>
</ul>
<h4 id="Lazy-Bind">Lazy Bind</h4>
<p>在 Linux 中，动态链接的 Lazy bind（延迟绑定）是一种优化技术，用于在程序运行时推迟对外部函数的解析和绑定。</p>
<p>当程序需要调用一个外部函数时，Lazy bind 的工作如下：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>首先，程序会通过 PLT（Procedure Linkage Table，过程链接表）来查找外部函数的地址。</p>
</li>
<li class="lvl-2">
<p>如果外部函数的地址在 PLT 的 GOT（Global Offset Table，全局偏移表）中已经被填充，那么程序会直接跳转到该地址执行函数。</p>
</li>
<li class="lvl-2">
<p>如果外部函数的地址在 GOT 中还未被填充，那么程序会跳转到 PLT 中的一个特殊条目，该条目负责进行解析和绑定。</p>
</li>
<li class="lvl-2">
<p>解析和绑定的过程由动态链接器（<a target="_blank" rel="noopener" href="http://ld.so">ld.so</a>）完成。它会在首次调用时，根据外部函数的名称在共享库中进行符号查找，并将实际地址填充到 GOT 中。</p>
</li>
<li class="lvl-2">
<p>一旦地址被填充到 GOT 中，程序会跳转到该地址执行函数。此后，对该外部函数的调用将直接使用已绑定的地址，而不需要再执行解析和绑定过程。</p>
</li>
</ul>
<p>Lazy bind 的优势在于，它推迟了对外部函数的解析和绑定，只在真正需要调用时才进行。这可以减少启动时间和内存开销，特别是对于大型程序和具有大量外部函数调用的程序来说。然而，这也可能导致在首次调用时的一定延迟，因为需要进行解析和绑定操作。</p>
<p>Linux: 默认打开，通过环境变量 LD_BIND_NOW 控制<br>
Windows: 默认关闭，通过链接器 / DELAYLOAD:<code>&lt;xxx.dll&gt;</code></p>
<blockquote>
<p>[!CAUTION]<br>
Windows 下延迟绑定下动态库函数地址不相等，可能导致程序崩溃。</p>
</blockquote>
<h4 id="Procedure-Linkage-Table-PLT">Procedure Linkage Table(PLT)</h4>
<p>在 Linux 中，PLT（Procedure Linkage Table，过程链接表）是用于实现动态链接的重要数据结构之一。</p>
<p>PLT 是一个函数调用的中间层，用于处理动态链接的函数调用。当程序中的代码需要调用一个外部函数时，它会通过 PLT 来实现。</p>
<p>PLT 中的每个条目都包含了两个部分：GOT（Global Offset Table，全局偏移表）和跳转指令。GOT 用于存储外部函数的实际地址，而跳转指令用于跳转到正确的地址。</p>
<p>当程序第一次调用一个外部函数时，PLT 会执行以下步骤：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>在 GOT 中查找外部函数的实际地址。由于初始时 GOT 中的地址是未知的，所以会跳转到 PLT 的下一个条目。</p>
</li>
<li class="lvl-2">
<p>PLT 中的跳转指令将控制权转移到动态链接器（<a target="_blank" rel="noopener" href="http://ld.so">ld.so</a>）中的相应解析函数。解析函数负责定位并填充 GOT 中的地址。</p>
</li>
<li class="lvl-2">
<p>解析函数会将外部函数的实际地址写入 GOT 中，并跳转回 PLT 中的下一个条目。</p>
</li>
<li class="lvl-2">
<p>现在，GOT 中已经存储了外部函数的实际地址。PLT 中的跳转指令将控制权转移到该地址，实现对外部函数的调用。</p>
</li>
</ul>
<p>在后续的函数调用中，PLT 会直接使用 GOT 中存储的实际地址，而不需要再执行解析函数。这样可以提高函数调用的效率。</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20231017/235259259.png" alt="image"></p>
<h4 id="符号可见性-3">符号可见性</h4>
<p>默认符号都可见，需要手动隐藏不需要的符号，这可以一定程度优化链接和加载动态库可维护性。</p>
<p>隐藏符号:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>-fvisibility=hidden</code></p>
</li>
<li class="lvl-2">
<p><code>-fvisibility-inlines-hidden</code></p>
</li>
<li class="lvl-2">
<p><code>-fvisibility-ms-compat</code></p>
</li>
<li class="lvl-2">
<p><code>__attribute__((visibility("hidden")))</code></p>
</li>
</ul>
<p><strong>静态符号（static symbols）</strong>: 指在编译时由编译器创建的符号，它们只在当前编译单元（如一个源文件或一个库）中可见。静态符号在编译时进行识别和分配内存，并在链接时被解析和链接到最终的可执行文件中。</p>
<p><strong>动态符号（dynamic symbols）</strong>: 指在编译时不可见的符号，它们在运行时由动态链接器（dynamic linker）解析和绑定到正确的地址。动态符号可以在多个编译单元之间共享，并且可以在运行时被其他程序使用。</p>
<blockquote>
<p>[!TIP]<br>
nm -D, --dynamic (Display dynamic symbols instead of normal symbols): 仅显示动态符号。</p>
</blockquote>
<p>简而言之，静态符号是在编译时创建的，只在当前编译单元中可见，而动态符号是在运行时由动态链接器解析和绑定的，可以在多个编译单元之间共享。</p>
<h4 id="动态链接-2">动态链接</h4>
<p>动态链接是在程序运行时将所需的库加载到内存中的过程，将符号查询、地址重定位推迟到程序加载或符号调用的时候。</p>
<p>这样可以减小可执行文件的大小，并且可以使多个程序共享同一个库，从而节省内存，实现二进制代码级别复用。</p>
<p><strong>.dynamic/.dynsym 节保存动态链接信息</strong>. 如下</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20231017/231243532.png" alt="image"></p>
<p>不同于 windows, linux 下动态链接信息是分开保存的，链接的 lib 保存在 .dynamic 节中，链接的符号保存在 .dynsym 节中.</p>
<p>动态链接在数据段 .data 预留一个叫全局偏移表 got（Global Offset Table）区域保存专用于保存全局变量和函数跳转地址。在 .code 中调用动态库时搜先查找 GOT，GOT 中的地址会在动态库加载时替换为真正的动态库中的地址。这里利用了 GOT 和代码段相对位置是固定的，可以利用 CPU 相对寻址实现。这样 GOT 在每个进程中都保留一部分很小的副本，但可以实现代码被所有进程共享，这种方式称为 PIC (地址无关代码)。一般为减小函数符号重定位开销，操作系统会用程序链接表 PLT (Procedure Linkage Table) 进行延迟到函数第一次调用的时候，因为绝大多数函数不会被调用。一般这个过程会在代码段用一段桩代码，在第一次调用时去查询真正的跳转地址并更新 GOT，具体会更新复杂。</p>
<p>在 Linux 下，动态库是通过内存映射的方式加载到进程的地址空间中的。当多个进程加载同一个动态库时，它们会共享同一个物理内存页，这样可以节省内存空间并提高系统性能。具体来说，当一个进程加载一个动态库时，动态链接器会将动态库的代码段、数据段等内容映射到进程的地址空间中。如果另一个进程也需要加载同一个动态库，动态链接器会检查该动态库是否已经在其他进程中加载过。如果已经加载过，动态链接器会将该动态库的内存映射到新进程的地址空间中，并且新进程和原进程会共享同一个物理内存页。这样，多个进程就可以共享同一个动态库的代码和数据，从而节省内存空间并提高系统性能。需要注意的是，如果多个进程需要修改同一个动态库的数据，就需要使用线程同步机制来保证数据的一致性。否则，不同进程之间对同一个动态库的数据修改可能会相互影响，导致程序出现错误。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (-shared)指令生成位置无关(-fPIC)的动态库，</span></span><br><span class="line"><span class="comment"># (-Wl,-soname,libexample.so.1)指定生成库文件名为(libexample.so.1)，并在当前路径生成符号链接(libexample.so)指向(libexample.so.1)</span></span><br><span class="line"><span class="comment"># (-Wl,-rpath=/path/to/rpath)指定运行时查找库(example_dep)的路径</span></span><br><span class="line">gcc -shared -fPIC example.c -o libexample.so.1 -L. -lexample_dep -Wl,-soname,libexample.so -Wl,-rpath=/path/to/rpath</span><br><span class="line"><span class="comment"># 在当前路径（-L.）链接（-lexample）动态库 libexample.so，可以加入 -Wl,-rpath=/path/to/rpath 指定运行时查找依赖动态库 example 路径</span></span><br><span class="line">gcc -o main main.c -L. -lexample -Wl,-rpath=$(<span class="built_in">pwd</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>查看依赖的动态库</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 main 依赖的动态库</span></span><br><span class="line">readelf -d main | grep NEEDED</span><br><span class="line">objdump -x main | grep NEEDED</span><br></pre></td></tr></tbody></table></figure>
<p>查看库提供的实现符号</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 libc 的提供的动态符号</span></span><br><span class="line">nm -D /lib/x86_64-llinux-gnu/libc.so.6</span><br><span class="line"><span class="comment"># 查看 libc 的提供的符号，包括静态和动态</span></span><br><span class="line">nm /lib/x86_64-llinux-gnu/libc.so.6</span><br></pre></td></tr></tbody></table></figure>
<p>查看系统能搜索到的库</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldconfig -p | grep libc</span><br></pre></td></tr></tbody></table></figure>
<p>生成动态库常用指令</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>-soname 选项用于在动态库文件中指定一个名为 soname 的标记，该标记指定了动态库的名称，通常用于版本区分。</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译器将生成名为libexample.so.1的动态库文件，并在其中指定一个名为soname的标记，该标记的值为libexample.so。此外，编译器还将在当前目录中创建一个名为libexample.so的符号链接，该符号链接指向libexample.so.1。这样，当其他程序链接到该动态库时，它们将使用libexample.so作为动态库的名称。</span></span><br><span class="line">gcc -shared -fPIC example.c -o libexample.so.1 -Wl,-soname,libexample.so</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>-rpath 选项用于指定动态库文件的搜索路径。</p>
</li>
<li class="lvl-2">
<p>-Wl 将逗号分隔的选项列表传递给链接器。</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译器将使用-rpath=/path/to/rpath选项将rpath加入链接选项，</span></span><br><span class="line"><span class="comment"># 使用-Bstatic选项将后续的静态库链接到程序中，使用-lstatic_dep选项指定静态库的名称，</span></span><br><span class="line"><span class="comment"># 使用-Bdynamic选项将后续的动态库链接到程序中，使用-ldynamic_dep选项指定动态库的名称。</span></span><br><span class="line">gcc -o main main.c -L. -lexample_dep -Wl,-rpath=/path/to/rpath,-Bstatic,-lstatic_dep,-Bdynamic,-ldynamic_dep</span><br></pre></td></tr></tbody></table></figure>
<p>查看及控制动态库加载</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>LD_DEBUG 查看程序在运行时搜索动态库的过程，例如 <code>LD_DEBUG=all ./program</code></p>
</li>
<li class="lvl-2">
<p>LD_LIBRARY_PATH 指定动态库的搜索路径，指定先搜索动态库路径，例如 <code>LD_LIBRARY_PATH=$(pwd) ./program</code></p>
</li>
<li class="lvl-2">
<p>LD_PRELOAD 指定要预加载的动态库。当程序在运行时需要加载动态库时，动态链接器会首先加载 LD_PRELOAD 环境变量指定的动态库，然后再搜索其他动态库。例如 <code>LD_PRELOAD=/path/to/libmylib.so</code></p>
</li>
</ul>
<blockquote>
<p>[!TIP]<br>
动态库链接及运行行为，可以直接使用工具 patchelf 强行更改。patchelf 一个用于动态链接器和可执行文件的工具，可用于在没有重新编译的情况下更改程序的运行时属性。使用 patchelf，可以修改二进制文件的动态链接器路径，设置程序的默认库路径，设置二进制文件的运行权限，甚至可以通过修改二进制文件的段来添加或删除符号。</p>
</blockquote>
<p>以下是使用 patchelf 的示例命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将二进制文件的动态链接库路径设置为当前目录</span></span><br><span class="line">patchelf --set-rpath . /path/to/binary</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将二进制文件的运行权限设置为仅限用户</span></span><br><span class="line">patchelf --set-interpreter /lib/ld-linux.so.2 --set-rpath . --set-soname new_name.so /path/to/binary</span><br><span class="line"><span class="built_in">chmod</span> 700 /path/to/binary</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出二进制文件的所有动态链接库依赖项</span></span><br><span class="line">patchelf --print-interpreter /path/to/binary</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出二进制文件依赖的所有动态链接库及其版本</span></span><br><span class="line">patchelf --print-needed /path/to/binary</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>[!CAUTION]<br>
注意，使用 patchelf 需要小心谨慎，因为不当的更改可能会导致程序无法正常工作。在对二进制文件进行更改之前，请务必确保知道自己在做什么，并备份原始文件以防发生问题。</p>
</blockquote>
<h4 id="显式动态链接">显式动态链接</h4>
<p>显示动态链接通常用于实现基于库级别的插件热更新.</p>
<h3 id="Unix-软件编译安装">Unix 软件编译安装</h3>
<p>本节描述了，针对编译安装软件的 <code>--enable-shared and run path</code> 参数注意要点。</p>
<p>在 linux 上安装非标准的编译安装，附带 --enable-shared 时，需要注意运行库是否和标准位置的运行库是否冲突，是否涉及覆盖等问题。</p>
<blockquote>
<p>[!CAUTION]<br>
The problem is, that on most Unix systems (with the notable exception of Mac OS X), the path to shared libraries is not an absolute path. So, if you install Python in a non-standard location, which is the right thing to do so as not to interfere with a system Python of the same version, you will need to configure in the path to the shared library or supply it via an environment variable at run time, like LD_LIBRARY_PATH. You may be better off avoiding --enable-shared; it’s easy to run into problems like this with it.</p>
<p>From Python Issue27685, <a target="_blank" rel="noopener" href="https://bugs.python.org/issue27685">Issue 27685: altinstall with --enable-shared showing incorrect behaviour</a></p>
</blockquote>
<h4 id="Python-编译安装示例">Python 编译安装示例</h4>
<p>python 编译成动态库安装能增加更多功能，但当附带 --enable-shared 时，需要附带安装位置的运行库的 run path 保证运行库位置能被正确找到。</p>
<h5 id="绝对共享库路径">绝对共享库路径</h5>
<p>如下，指定了 python 的安装路径，并指定了对应的运行库的绝对路径所在 run path。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --enable-shared --prefix=/opt/python LDFLAGS=-Wl,-rpath=/opt/python/lib</span><br></pre></td></tr></tbody></table></figure>
<p>这里 /opt/python/lib 没有在系统共享库搜索路径中，需要手动将动态库的安装目录添加到 ld 的搜索路径。</p>
<p>找到运行库路径，链接器默认的动态库搜索范围包括 /lib 、/usr/lib 以及 /etc/ld.so.conf 配置文件中包含的目录。</p>
<p>这里参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/50838802">python 安装非标准位置问题</a></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用链接器查看可搜索范围</span></span><br><span class="line">ldconfig -v | grep python3</span><br><span class="line">ldd $(<span class="built_in">which</span> python3)</span><br></pre></td></tr></tbody></table></figure>
<p>配置非标准位置动态库加载路径</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到运行库所在路径</span></span><br><span class="line">find /usr -name <span class="string">'libpython3.7m.so*'</span></span><br><span class="line"><span class="comment"># 新增运行库路径，并刷新运行库搜索环境</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/opt/python/lib"</span> &gt; /etc/ld.so.conf.d/opt_python.conf &amp;&amp; ldconfig</span><br></pre></td></tr></tbody></table></figure>
<h5 id="相对共享库路径">相对共享库路径</h5>
<p>如下，指定了 python 的运行库安装路径，并指定了对应的运行库的相对路径所在 run path。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --enable-shared \</span><br><span class="line">--prefix=/opt/python \</span><br><span class="line">LDFLAGS=-Wl,-rpath=@ORIGIN/../lib <span class="comment"># 指定 path/bin/python3 的共享库搜索路径为 lib 路径</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="GDB">GDB</h3>
<p>主要描述了针对 GDB 工具的相关使用及工具。</p>
<p>一般来说，GDB 主要帮助完成下面五个方面的功能：<br>
1、启动程序，可以按照自定义的要求随心所欲的运行程序。<br>
2、可让被调试的程序在所指定的调置的断点处停住。（断点可以是条件表达式）<br>
3、当程序被停住时，可以检查此时程序中所发生的事 即挂载调试。<br>
4、可以改变程序，将一个 BUG 产生的影响修正从而测试其他 BUG。<br>
5、当程序产生核心段错误时，可以进行 CORE 文件调试，查找错误。</p>
<h4 id="gdb-dashboard">gdb dashboard</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/cyrus-and/gdb-dashboard">GDB dashboard</a> 是一个独立的.gdbinit 文件，使用 Python API 编写，支持模块化界面，显示有关正在调试的程序的相关信息。其主要目标是减少检查当前程序状态所需的 GDB 命令数量，从而允许开发人员主要关注控制流。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/gdb-step-by-step-introduction/">GDB (Step by Step Introduction)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/LUCAS004/article/details/108174437?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-108174437-blog-121535829.pc_relevant_multi_platform_whitelistv4eslandingrelevant2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-108174437-blog-121535829.pc_relevant_multi_platform_whitelistv4eslandingrelevant2&amp;utm_relevant_index=1">https://blog.csdn.net/LUCAS004/article/details/108174437?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-108174437-blog-121535829.pc_relevant_multi_platform_whitelistv4eslandingrelevant2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-108174437-blog-121535829.pc_relevant_multi_platform_whitelistv4eslandingrelevant2&amp;utm_relevant_index=1</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitee.com/mirrors_cyrus-and/gdb-dashboard">gitee gdb dashboard</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://jasonblog.github.io/note/gdb/183.html">http://jasonblog.github.io/note/gdb/183.html</a></p>
</li>
</ul>
<h4 id="gdb-快速打印-vector-等容器">gdb 快速打印 vector 等容器</h4>
<p>GDB 默认是不会打印 C++ 标准库的常用容器，需要通过访问容器属性（非规范命名），才能看到容器中所包含的值。这里介绍了一种 gdb 自动加载脚本，辅助打印容器内容。</p>
<p>下载<a target="_blank" rel="noopener" href="https://files.cnblogs.com/linyx/dbinit_stl_views-1.03.zip">文件</a>，将之保存为～/.gdbinit 就可以使用打印命令了。</p>
<p>打印 list 用 plist 命令，打印 vector 用 pvector，依此类推。</p>
<p>相关命令如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   STL GDB evaluators/views/utilities - 1.03</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   The new GDB commands:</span></span><br><span class="line"><span class="comment">#         are entirely non instrumental</span></span><br><span class="line"><span class="comment">#         do not depend on any "inline"(s) - e.g. size(), [], etc</span></span><br><span class="line"><span class="comment">#       are extremely tolerant to debugger settings</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   This file should be "included" in .gdbinit as following:</span></span><br><span class="line"><span class="comment">#   source stl-views.gdb or just paste it into your .gdbinit file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   The following STL containers are currently supported:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       std::vector&lt;T&gt; -- via pvector command</span></span><br><span class="line"><span class="comment">#       std::list&lt;T&gt; -- via plist or plist_member command</span></span><br><span class="line"><span class="comment">#       std::map&lt;T,T&gt; -- via pmap or pmap_member command</span></span><br><span class="line"><span class="comment">#       std::multimap&lt;T,T&gt; -- via pmap or pmap_member command</span></span><br><span class="line"><span class="comment">#       std::set&lt;T&gt; -- via pset command</span></span><br><span class="line"><span class="comment">#       std::multiset&lt;T&gt; -- via pset command</span></span><br><span class="line"><span class="comment">#       std::deque&lt;T&gt; -- via pdequeue command</span></span><br><span class="line"><span class="comment">#       std::stack&lt;T&gt; -- via pstack command</span></span><br><span class="line"><span class="comment">#       std::queue&lt;T&gt; -- via pqueue command</span></span><br><span class="line"><span class="comment">#       std::priority_queue&lt;T&gt; -- via ppqueue command</span></span><br><span class="line"><span class="comment">#       std::bitset&lt;n&gt; -- via pbitset command</span></span><br><span class="line"><span class="comment">#       std::string -- via pstring command</span></span><br><span class="line"><span class="comment">#       std::widestring -- via pwstring command</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   The end of this file contains (optional) C++ beautifiers</span></span><br><span class="line"><span class="comment">#   Make sure your debugger supports $argc</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Simple GDB Macros written by Dan Marinescu (H-PhD) - License GPL</span></span><br><span class="line"><span class="comment">#   Inspired by initial work of Tom Malnar,</span></span><br><span class="line"><span class="comment">#     Tony Novac (PhD) / Cornell / Stanford,</span></span><br><span class="line"><span class="comment">#     Gilad Mishne (PhD) and Many Many Others.</span></span><br><span class="line"><span class="comment">#   Contact: dan_c_marinescu@yahoo.com (Subject: STL)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Modified to work with g++ 4.3 by Anders Elton</span></span><br><span class="line"><span class="comment">#   Also added _member functions, that instead of printing the entire class in map, prints a member.</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) pvector cur</span><br><span class="line">elem[0]: <span class="variable">$5</span> = 3</span><br><span class="line">elem[1]: <span class="variable">$6</span> = 9</span><br><span class="line">Vector size = 2</span><br><span class="line">Vector capacity = 2</span><br><span class="line">Element <span class="built_in">type</span> = std::allocator&lt;int&gt;::pointer</span><br></pre></td></tr></tbody></table></figure>
<h4 id="gdb-配合-vscode-调试-附加">gdb 配合 vscode 调试 / 附加</h4>
<p>linux 下 gdb 针对 core 复现及错误现场跟踪是一个非常强大的工具。配合 vscode 能够可视化的调试错误问题。</p>
<p>前置条件：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>C/C++ MS plugin</p>
</li>
<li class="lvl-2">
<p>GDB</p>
</li>
</ul>
<p>在 launch.json 文件中配置如下：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"0.2.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"configurations"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"(gdb) Attach"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"cppdbg"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"request"</span><span class="punctuation">:</span> <span class="string">"attach"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// attach program</span></span><br><span class="line">            <span class="attr">"program"</span><span class="punctuation">:</span> <span class="string">"/usr/local/bin/python"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// select gdb tool</span></span><br><span class="line">            <span class="attr">"MIMode"</span><span class="punctuation">:</span> <span class="string">"gdb"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"setupCommands"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Enable pretty-printing for gdb"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"text"</span><span class="punctuation">:</span> <span class="string">"-enable-pretty-printing"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"ignoreFailures"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Set Disassembly Flavor to Intel"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"text"</span><span class="punctuation">:</span> <span class="string">"-gdb-set disassembly-flavor intel"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"ignoreFailures"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">}</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// for selecting process to attach in a moment</span></span><br><span class="line">            <span class="attr">"processId"</span><span class="punctuation">:</span> <span class="string">"${command:pickProcess}"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"(gdb) Launch"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"cppdbg"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"request"</span><span class="punctuation">:</span> <span class="string">"launch"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"program"</span><span class="punctuation">:</span> <span class="string">"/usr/local/bin/python"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"args"</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"stopAtEntry"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// project folder</span></span><br><span class="line">            <span class="attr">"cwd"</span><span class="punctuation">:</span> <span class="string">"${workspaceFolder}"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"environment"</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"externalConsole"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"MIMode"</span><span class="punctuation">:</span> <span class="string">"gdb"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"setupCommands"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Enable pretty-printing for gdb"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"text"</span><span class="punctuation">:</span> <span class="string">"-enable-pretty-printing"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"ignoreFailures"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"Set Disassembly Flavor to Intel"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"text"</span><span class="punctuation">:</span> <span class="string">"-gdb-set disassembly-flavor intel"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"ignoreFailures"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">}</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// core dump path</span></span><br><span class="line">            <span class="attr">"coreDumpPath"</span><span class="punctuation">:</span> <span class="string">"/workspace/xxxx/core.29991"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模板中 core 文件调试方式，即相当于：</span></span><br><span class="line">gdb /usr/local/bin/python core.29991</span><br><span class="line"><span class="comment"># 模板中 attach 方式，即相当于：</span></span><br><span class="line"><span class="built_in">cd</span> /project</span><br><span class="line">gdb -p xxxx 或 gdb xxxx 3598</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/gdb/">http://c.biancheng.net/gdb/</a></p>
</li>
</ul>
<h4 id="gdb-搜索源码位置">gdb 搜索源码位置</h4>
<p>由于源码可能会变动，所以可能需要手动指定源码位置，方便调试时显示源码。</p>
<p>相关命令:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看编译源码x信息位置</span></span><br><span class="line">info <span class="built_in">source</span></span><br><span class="line"><span class="comment"># 查看源码搜索目录</span></span><br><span class="line">show <span class="built_in">dir</span></span><br><span class="line"><span class="comment"># gdb 指定源码移动到相应位置</span></span><br><span class="line"><span class="built_in">set</span> substitute-path from-path to-path</span><br><span class="line"><span class="comment"># 将目录加入到搜索源码路径</span></span><br><span class="line"><span class="built_in">dir</span> path-to-set</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/nicholas_duan/article/details/117515155">https://blog.csdn.net/nicholas_duan/article/details/117515155</a></p>
</li>
</ul>
<h3 id="GCC-G">GCC/G++</h3>
<p>本节主要描述有关 gcc 各个方面应用及问题。</p>
<!-- more -->
<h4 id="常用编译参数">常用编译参数</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>-std=c++20</code>: 用于指定应该使用哪个 C++ 标准来编译程序</p>
</li>
<li class="lvl-2">
<p><code>-Wpedantic</code>: 告诉在遇到不符合 ISO C++ 标准的代码时发出警告。这包括一些编译器特定的扩展和一些可能导致移植性问题的代码。使用可以帮助编写更符合标准、更具有移植性的代码。</p>
</li>
<li class="lvl-2">
<p><code>-Wall</code>: 告诉启用所有的警告信息，这可以帮助发现代码中的潜在问题。然而，-Wall 并不真的启用所有的警告，只是启用了一部分被认为最有用的警告。</p>
</li>
<li class="lvl-2">
<p><code>-Wextra</code>: 告诉启用一些额外的警告信息，这些警告信息在 -Wall 中没有被启用。这些额外的警告可以帮助发现代码中的一些不常见的问题。</p>
</li>
</ul>
<h4 id="优化选项-Optimize-Options">优化选项 Optimize-Options</h4>
<h5 id="GCC优化选项">GCC 优化选项</h5>
<p>在开启编译优化的开关时，GCC 编译器的目的是：优化程序的性能和减少代码的大小，尽管会以牺牲编译时间和程序的可调试能力为代价。对于不同的优化级别开启的对应优化开关可以通过 <code>gcc -Q -O1 --help=optimizers</code> 来查看对应的开启优化列表。</p>
<h5 id="常用的优化选项">常用的优化选项</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p>-O0</p>
<p>默认的优化选项，减少编译时间和生成完整的调试信息。</p>
</li>
<li class="lvl-2">
<p>-O/-O1</p>
<p>这两个都是开启 level 1 的编译优化。开启编译优化会导致更长的编译时间，对于大函数还会消耗更多的内存空间。level1 的编译优化下，编译器会尝试减少代码段大小和优化程序的执行时间，但不执行需要消耗大量编译时间的优化。</p>
</li>
<li class="lvl-2">
<p>-O2</p>
<p>相比于 - O1，-O2 打开了更多的编译优化开关</p>
</li>
<li class="lvl-2">
<p>-O3</p>
<p>在 - O2 的基础上，level 3 的级别优化</p>
</li>
<li class="lvl-2">
<p>-Os</p>
<p>优化生成的目标文件的大小</p>
</li>
<li class="lvl-2">
<p>-Ofast</p>
<p>为了提高程序的执行速度，GCC 可以无视严格的语言标准。-Ofast 会开启所有 - O3 的编译开关，且会对不符合标准的程序进行优化。</p>
</li>
<li class="lvl-2">
<p>-Og</p>
<p>优化调试信息。相对于 - O0 生成的调试信息，-Og 是为了能够生成更好的调试信息。和 - O0 一样，-Og 选项关闭了很多优化开关。</p>
</li>
</ul>
<blockquote>
<p>[!NOTE]<br>
如果同时使用多个不同 level -O 优化选项来进行编译，编译器会根据最后一个 - O 的 level 来决定采用那种优化级别。</p>
</blockquote>
<ul class="lvl-0">
<li class="lvl-2">
<p>-Q -v</p>
<p>输出编译器 - O 打开的优化编译选项</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iosfwd&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomSigHandler</span><span class="params">(<span class="type">int</span> signum)</span> </span>{</span><br><span class="line">    std::ostringstream os;</span><br><span class="line">    os &lt;&lt; <span class="string">"Abnormal signal is triggered:"</span> &lt;&lt; signum &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    std::cout &lt;&lt; os.<span class="built_in">str</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getX</span><span class="params">()</span> </span>{ <span class="keyword">return</span> x; }</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">};</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> {</span><br><span class="line">    Point s;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>{</span><br><span class="line">    <span class="built_in">signal</span>(SIGSEGV, &amp;CustomSigHandler); <span class="comment">// handle SIGSEGV</span></span><br><span class="line">    <span class="built_in">signal</span>(SIGABRT, &amp;CustomSigHandler); <span class="comment">// handle SIGABRT</span></span><br><span class="line">    <span class="comment">// access read illegally</span></span><br><span class="line">    std::shared_ptr&lt;Line&gt; l;</span><br><span class="line">    l-&gt;s.<span class="built_in">getX</span>(); <span class="comment">// without signal emitted when set -fipa-pure-const</span></span><br><span class="line">    <span class="comment">// access read illegally</span></span><br><span class="line">    <span class="comment">// int *p=NULL;</span></span><br><span class="line">    <span class="comment">// *p=0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -O -Q -v test.cpp -o <span class="built_in">test</span> &amp;&gt; ops.out</span><br></pre></td></tr></tbody></table></figure>
</li>
<li class="lvl-2">
<p>-fno-<strong>flag</strong></p>
<p>关闭编译指定 <strong>flag</strong> 的编译选项。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -O -fno-ipa-pure-const test.cpp -o <span class="built_in">test</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li class="lvl-2">
<p>-fomit-frame-pointer</p>
<p>对于不需要帧指针的函数，不要将帧指针保存在寄存器中。这避免了保存、设置和恢复帧指针的指令；它还为许多函数提供了一个额外的寄存器。这也使得在某些机器上无法进行调试。<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14666665/trying-to-understand-gcc-option-fomit-frame-pointer">参考</a></p>
</li>
</ul>
<h5 id="参考">参考</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/">GCC online documentation</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc-10.4.0/gcc/Optimize-Options.html#Optimize-Options">GCC 10.4 Optimze-Options</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/27090458/answer/35226469">GCC 优化选项</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jinchengzhou/article/details/120703911?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120703911-blog-47343201.pc_relevant_multi_platform_whitelistv3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120703911-blog-47343201.pc_relevant_multi_platform_whitelistv3&amp;utm_relevant_index=2">编译选项 csdn 参考</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.stubbornhuang.com/2096/">个人博客参考 1</a></p>
</li>
</ul>
<h4 id="GCC调试选项">GCC 调试选项</h4>
<p>GCC 允许将 - g 与 - O 配合使用。GCC 开启优化编译选项的结果有时可能会令人惊讶：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>声明的某些变量可能被删除；</p>
</li>
<li class="lvl-2">
<p>控制流走到意想不到的位置；</p>
</li>
<li class="lvl-2">
<p>有些语句可能不会执行，因为它们计算的是常量结果或它们的值已经在手边；</p>
</li>
<li class="lvl-2">
<p>有些语句可能会在不同的位置执行，因为它们已经移出了循环。</p>
</li>
<li class="lvl-2">
<p>GCC 允许编译时添加额外的调试信息，以便程序进行调试，大部分情况下，需要编译选项 - g 就可以满足调试需求。</p>
</li>
</ul>
<p>如果<strong>没有使用其他优化选项，请考虑将 - Og 与 - g 一起使用</strong>。在完全没有 - O 选项的情况下，一些编译器收集对调试有用的信息根本不会运行，因此 - Og 可能会带来更好的调试体验。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>g0：不生成调试信息，相当于没有使用 - g；</p>
</li>
<li class="lvl-2">
<p>g1：生成最小的调试信息，足够在不打算调试的程序中进行堆栈查看。最小调试信息包括函数描述，外部变量，行数表，但不包括局部变量信息。</p>
</li>
<li class="lvl-2">
<p>g2：默认 - g 的调试级别；</p>
</li>
<li class="lvl-2">
<p>g3：相对 - g，生成额外的信息，例如所有的宏定义；</p>
</li>
</ul>
<blockquote>
<p>[!NOTE]<br>
和 - O 一样，如果多个级别的 - g 选项同时存在，最后的选项会被生效</p>
</blockquote>
<blockquote>
<p>[!TIP]<br>
综上，很多项目的线上版本都是使用”-O2 -g” 的编译选项进行编译，以便发生问题的时候容易定位。但这有一个很大的弊端就是目标文件会比不开启调试信息的情况下大很多，所以一般对外发布的软件都是不含有调试信息的 Release 版本，同时也会发布含有调试信息的 debug 版本，两者的性能是一样的只是 debug 多了调试信息而已。</p>
</blockquote>
<h3 id="Clang-Clang">Clang/Clang++</h3>
<h4 id="常用编译参数-2">常用编译参数</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>-std=c++20</code>: 同 gcc</p>
</li>
<li class="lvl-2">
<p><code>-Wpedantic</code>: 同 gcc</p>
</li>
<li class="lvl-2">
<p><code>-Wall</code>: 同 gcc</p>
</li>
<li class="lvl-2">
<p><code>-Wextra</code>: 同 gcc</p>
</li>
</ul>
<h2 id="Jupyter">Jupyter</h2>
<p>使用 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=MtKdza3RJNM">Jupyter</a> 编写丰富的可执行的富文档。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Local setup</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mamba create -n cling</span><br><span class="line">mamba install xeus-cling -c conda-forge</span><br><span class="line">mamba install xeus -c conda-forge</span><br><span class="line">mamba activate cling</span><br><span class="line"></span><br><span class="line">jupter notebook</span><br><span class="line">jupter lab</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Docs">Docs</h2>
<h3 id="sphinx">sphinx</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/clear-functional-c-documentation-with-sphinx-breathe-doxygen-cmake/">sphinx 配置过程 blog</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/k0ekk0ek/cmake-sphinx/blob/master/CMakeLists.txt">sphinx cmake 模块</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.sphinx-doc.org/en/master/usage/quickstart.html">https://www.sphinx-doc.org/en/master/usage/quickstart.html</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.sphinx-doc.org/en/master/usage/configuration.html">https://www.sphinx-doc.org/en/master/usage/configuration.html</a></p>
</li>
</ul>
<h3 id="Doxygen">Doxygen</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.doxygen.nl/manual/commands.html">https://www.doxygen.nl/manual/commands.html</a></p>
</li>
</ul>
<h4 id="注释特殊标记">注释特殊标记</h4>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标记代码</span></span><br><span class="line">\code{.unparsed}</span><br><span class="line">Show <span class="keyword">this</span> as-is please</span><br><span class="line">\endcode</span><br><span class="line"></span><br><span class="line">\code{.sh}</span><br><span class="line">echo <span class="string">"This is a shell script"</span></span><br><span class="line">\endcode</span><br><span class="line"></span><br><span class="line">\code{.py}</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Python</span>:</span><br><span class="line">    pass</span><br><span class="line">\endcode</span><br><span class="line"></span><br><span class="line">\code{.cpp}</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cpp</span> {};</span><br><span class="line">\endcode</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Coverage">Coverage</h2>
<p>对 C/C++ 项目进行代码覆盖率的度量</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>gcov</p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/402463278">https://zhuanlan.zhihu.com/p/402463278</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://wiki.documentfoundation.org/Development/Lcov">https://wiki.documentfoundation.org/Development/Lcov</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://medium.com/@naveen.maltesh/generating-code-coverage-report-using-gnu-gcov-lcov-ee54a4de3f11">https://medium.com/@naveen.maltesh/generating-code-coverage-report-using-gnu-gcov-lcov-ee54a4de3f11</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Invoking-Gcov.html">https://gcc.gnu.org/onlinedocs/gcc/Invoking-Gcov.html</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://blog.csdn.net/yanxiangyfg/article/details/80989680">https://blog.csdn.net/yanxiangyfg/article/details/80989680</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://manpages.ubuntu.com/manpages/bionic/man1/gcov-8.1.html">https://manpages.ubuntu.com/manpages/bionic/man1/gcov-8.1.html</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html#Instrumentation-Options">https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html#Instrumentation-Options</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/672040?spm=a2c6h.12873639.article-detail.48.7baa5576DTZmVN&amp;scm=20140722.ID_community@@article@@672040._.ID_community@@article@@672040-OR_rec-V_1">C++ 语言的单元测试与代码覆盖率 - 阿里云开发者社区 (aliyun.com)</a></li>
</ul>
</li>
<li class="lvl-2">
<p>llvm</p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://llvm.org/docs/CommandGuide/llvm-cov.html#llvm-cov-gcov">https://llvm.org/docs/CommandGuide/llvm-cov.html#llvm-cov-gcov</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/clion/code-coverage-clion.html#compiler-flags">https://www.jetbrains.com/help/clion/code-coverage-clion.html#compiler-flags</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/SourceBasedCodeCoverage.html#id1">https://clang.llvm.org/docs/SourceBasedCodeCoverage.html#id1</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/58400297/trying-to-view-code-coverage-with-llvm-cov">https://stackoverflow.com/questions/58400297/trying-to-view-code-coverage-with-llvm-cov</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://marco-c.github.io/2018/01/09/code-coverage-with-clang-on-windows.html">https://marco-c.github.io/2018/01/09/code-coverage-with-clang-on-windows.html</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="http://www.stablecoder.ca/2018/01/15/code-coverage.html">http://www.stablecoder.ca/2018/01/15/code-coverage.html</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="http://logan.tw/posts/2015/04/28/check-code-coverage-with-clang-and-lcov/">http://logan.tw/posts/2015/04/28/check-code-coverage-with-clang-and-lcov/</a></li>
</ul>
</li>
</ul>
<h3 id="QA">QA</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/72985855/libgcov-profiling-error-overwriting-an-existing-profile-data-with-a-different">libgcov-profiling-error-overwriting-an-existing-profile-data-with-a-different</a></p>
</li>
</ul>
<h3 id="配置原理">配置原理</h3>
<h4 id="编译参数">编译参数</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>GNU：</p>
<ul class="lvl-2">
<li class="lvl-4">compile options: -fprofile-arcs -ftest-coverage</li>
<li class="lvl-4">link options: -fprofile-arcs</li>
<li class="lvl-4">link lib: gcov</li>
</ul>
</li>
<li class="lvl-2">
<p>Clang:</p>
<ul class="lvl-2">
<li class="lvl-4">compile options: -fprofile-instr-generate -fcoverage-mapping --coverage (或 - fprofile-arcs -ftest-coverage)</li>
<li class="lvl-4">link options: -fprofile-instr-generate -fcoverage-mapping</li>
</ul>
</li>
<li class="lvl-2">
<p>Windows:</p>
<ul class="lvl-2">
<li class="lvl-4">opencppcoverage/vstest.console.exe</li>
</ul>
</li>
</ul>
<blockquote>
<p>[!TIP]<br>
-fprofile-arcs -ftest-coverage: gcov required</p>
</blockquote>
<blockquote>
<p>[!TIP]<br>
-fprofile-instr-generate -fcoverage-mapping: llvm-cov</p>
</blockquote>
<h4 id="生成">生成</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>GNU 方式一，使用 gcov 作为媒介</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install lcov(genhtml in inclusion)</span></span><br><span class="line">apt/yum install lcov</span><br><span class="line"><span class="comment"># Run gcov and generate coverage file *.gcov</span></span><br><span class="line">gcov &lt;sources&gt; -s &lt;some exclusion <span class="built_in">dir</span>&gt;</span><br><span class="line"><span class="comment"># 根据 *.gcov 生成 coverage.info 数据文件</span></span><br><span class="line"><span class="comment"># -rc genhtml_branch_coverage=1 打开默认禁用的分支覆盖率计算</span></span><br><span class="line">lcov --rc lcov_branch_coverage=1 --capture --directory &lt;*.gcov file <span class="built_in">dir</span>&gt; --output-file coverage.info.tmp</span><br><span class="line">lcov --rc lcov_branch_coverage=1  -e coverage.info.tmp <span class="string">"*src*"</span> -o coverage.info</span><br><span class="line"><span class="comment"># 根据 coverage.info 这个数据文件生成 html 报告</span></span><br><span class="line">genhtml -rc genhtml_branch_coverage=1 coverage.info --output-directory out</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>GNU 方式二，单独依赖 lcov（间接使用 gcov ）</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install lcov(genhtml in inclusion)</span></span><br><span class="line">apt/yum install lcov</span><br><span class="line"><span class="comment"># Lcov initial/baseline lcov</span></span><br><span class="line">lcov --no-external --rc lcov_branch_coverage=1 --capture --initial --directory &lt;<span class="built_in">source</span> <span class="built_in">dir</span>&gt; --output-file coverage_base.info</span><br><span class="line"><span class="comment"># Run test and lcov again after tests/checks complete</span></span><br><span class="line">lcov --no-external --rc lcov_branch_coverage=1 --capture --directory &lt;<span class="built_in">source</span> <span class="built_in">dir</span>&gt; --output-file coverage_test.info</span><br><span class="line"><span class="comment"># Combine lcov tracefiles</span></span><br><span class="line">lcov --add-tracefile coverage_base.info --add-tracefile coverage_test.info --output-file coverage.info</span><br><span class="line"><span class="comment"># Remove / filter out remaining unwanted stuff from tracefile</span></span><br><span class="line">lcov --remove coverage.info <span class="string">'/usr/include/*'</span> <span class="string">'/usr/lib/*'</span> ...&lt;some other <span class="built_in">dirs</span>&gt; -o coverage_final.info</span><br><span class="line">genhtml -rc genhtml_branch_coverage=1 coverage_final.info --output-directory out</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>Clang</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run test and generate *.profraw</span></span><br><span class="line">./executable_test</span><br><span class="line"><span class="comment"># Merge *.profraw to on merged.profraw</span></span><br><span class="line">llvm-profdata merge -sparse *.profraw -o merged.profdata</span><br><span class="line"><span class="comment"># Generate coverage</span></span><br><span class="line">llvm-cov show --instr-profile=merged.profdata -object=./executable_test -show-line-counts-or-regions -output-dir=./all-merged -format=<span class="string">"html"</span>-ignore-filename-regex=<span class="string">'/usr/include/*'</span></span><br><span class="line"><span class="comment"># report to console</span></span><br><span class="line">llvm-cov report --instr-profile=merged.profdata -object=./executable_test -show-line-counts-or-regions -output-dir=./all-merged -format=<span class="string">"html"</span>-ignore-filename-regex=<span class="string">'/usr/include/*'</span></span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>Windows</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vstest.console.exe *.dll /EnableCodeCoverage /Collect:<span class="string">"Code Coverage;Format=Xml"</span> /ResultsDirectory:<span class="string">"&lt;coverage result dir&gt;"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="集成三方">集成三方</h3>
<p>测试集成三方</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.sonarqube.org/latest/analyzing-source-code/test-coverage/c-family-test-coverage/">Sonar</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://my.cdash.org">CDash</a></p>
<ul class="lvl-2">
<li class="lvl-4">ctest <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#ctest-coverage-step">https://cmake.org/cmake/help/latest/manual/ctest.1.html#ctest-coverage-step</a></li>
<li class="lvl-4">ctest scripts <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CTestCoverageCollectGCOV.html">https://cmake.org/cmake/help/latest/module/CTestCoverageCollectGCOV.html</a></li>
<li class="lvl-4">cmake scripts <a target="_blank" rel="noopener" href="https://github.com/StableCoder/cmake-scripts">https://github.com/StableCoder/cmake-scripts</a></li>
</ul>
</li>
<li class="lvl-2">
<p>GitLab</p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-de/use-cases/coverage-reports/gitlab-test-coverage-googletest-cmake-gcov">gitlab-test-coverage-googletest-cmake-gcov · GitLab</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/ci/testing/test_coverage_visualization.html#cc-example">GitLab cc example</a></li>
</ul>
</li>
</ul>
<h3 id="CMake-示例">CMake 示例</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/bilke/cmake-modules/blob/master/CodeCoverage.cmake">https://github.com/bilke/cmake-modules/blob/master/CodeCoverage.cmake</a></p>
</li>
</ul>
<h2 id="Program">Program</h2>
<p>这张图片展示了 ELF 加载到内存的一个数据结构关系。<br>
<img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230414/094944873.jpg" alt="elf loaded to the memory"></p>
<h3 id="Linux-Program-内存模型">Linux Program 内存模型</h3>
<p>Linux 的 ELF 内存模型。ELF（Executable and Linkable Format）是一种可执行文件格式，常用于 Linux 系统中的可执行文件、共享库等。ELF 文件在内存中的布局由 ELF 头、程序头表、节区头表和节区数据组成。其中，程序头表描述了 ELF 文件在内存中的布局，包括代码段、数据段、BSS 段等。节区头表描述了 ELF 文件中各个节区的信息，如名称、大小、偏移量等。节区数据则包含了 ELF 文件中各个节区的实际数据。</p>
<p>在 Linux 中，每个进程都有自己的虚拟地址空间，其中包括代码段、数据段、堆、栈等。当一个 ELF 文件被加载到内存中时，它的各个节区数据会被映射到进程的虚拟地址空间中相应的位置。例如，代码段会被映射到进程的代码段区域，数据段会被映射到进程的数据段区域。由于每个进程都有自己的虚拟地址空间，因此不同进程中同一 ELF 文件的虚拟地址空间布局可能会不同。</p>
<!--
https://tinylab-1.gitbook.io/cbook/02-chapter4
https://zhuanlan.zhihu.com/p/607142856?utm_campaign=shareopn&utm_medium=social&utm_oi=929703030027243520&utm_psn=1628092769049853952&utm_source=wechat_session
-->
<h2 id="Assembly">Assembly</h2>
<p>Assembly language is a low-level programming language that is specific to a particular computer architecture. It is often used for system-level programming, such as operating systems, device drivers, and embedded systems.</p>
<h3 id="常用工具">常用工具</h3>
<p>学习 Assembly 的 C/C++ 超级工具 <a target="_blank" rel="noopener" href="https://godbolt.org"><strong>Godbolt</strong></a></p>
<blockquote>
<p>[!TIP]<br>
Godbolt is a web-based tool that allows you to see the assembly code generated by different compilers for a given piece of code. It can be useful for understanding how your code is translated into machine code and for optimizing your code for a specific architecture.</p>
</blockquote>
<h3 id="寄存器">寄存器</h3>
<p><strong>RSP</strong>: The rsp register in x86-64 assembly language is the stack pointer register and is used to keep track of the top of the stack. The stack is a region of memory that is used to store temporary data, such as function parameters and local variables.</p>
<blockquote>
<p>[!TIP1] When a function is called, the <code>rsp</code> register is decremented to allocate space on the stack for the function’s parameters and local variables. When the function returns, the rsp register is incremented to deallocate the stack space that was used by the function.</p>
</blockquote>
<blockquote>
<p>[!TIP2] To allocate 4 bytes in assembly, you can use the <code>sub</code> instruction to decrement the stack pointer register (<code>rsp</code>) by 4 bytes. This will allocate 4 bytes of space on the stack for temporary data, such as function parameters or local variables.</p>
</blockquote>
<p>Here is an example of how to allocate 4 bytes in x86-64 assembly language:</p>
<figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sub</span> rsp, <span class="number">4</span> <span class="comment">; allocate 4 bytes on the stack</span></span><br></pre></td></tr></tbody></table></figure>
<p>This instruction decrements the value of rsp by 4, effectively allocating 4 bytes of space on the stack. To deallocate the space when it is no longer needed, you can use the add instruction to increment the value of rsp by the same amount:</p>
<figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add</span> rsp, <span class="number">4</span> <span class="comment">; deallocate 4 bytes from the stack</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>RBP</strong>: The rbp register in x86-64 assembly language is the base pointer register and is used to access function parameters and local variables relative to the current stack frame.</p>
<blockquote>
<p>[!TIP]<br>
At the beginning of a function, the instructions <code>push rbp</code> and <code>mov rbp, rsp</code> are commonly used to set up the function’s stack frame. <code>push rbp</code> pushes the value of the previous stack frame’s base pointer onto the stack, and <code>mov rbp, rsp</code> moves the value of the stack pointer register into the base pointer register, effectively <strong>creating a new stack frame for the current function</strong>.</p>
</blockquote>
<blockquote>
<p>[!TIP2]<br>
By using the rbp register to access function parameters and local variables, the function can allocate space on the stack for its own variables and use the base pointer register to access them.</p>
</blockquote>
<p><strong>RDI</strong>: The rdi register is one of the general-purpose registers in the x86-64 architecture, and it is typically used to pass the first argument to a function.</p>
<p><strong>RSI</strong>: The rsi register is another general-purpose register in the x86-64 architecture, and it is typically used to pass the second argument to a function.</p>
<blockquote>
<p>[!TIP]<br>
The instruction <code>mov QWORD PTR [rbp-8], rdi</code> is a move instruction in assembly language. It moves the value in the rdi register, which is the first argument to the function, into the memory location at [rbp-8], which is a local variable on the stack.</p>
</blockquote>
<p><strong>RAX</strong>: The rax register is one of the general-purpose registers in the x86-64 architecture, and it is typically used to hold the return value of a function.</p>
<blockquote>
<p>[!TIP]<br>
The instruction <code>mov rax, QWORD PTR [rbp-8]</code> is a move instruction in assembly language. It moves the value in the memory location at [rbp-8], which is a local variable on the stack, into the rax register for later use in the function.</p>
</blockquote>
<p><strong>EDX/EAX</strong>: The edx/eax register is one of the general-purpose registers in the x86-64 architecture, and it is typically used to hold a 32-bit value.</p>
<p><strong>RBX</strong>: The rbx register in x86-64 assembly language is one of the general-purpose registers that can be used to hold data or memory addresses. It is a 64-bit register, so it can hold values between 0 and 2^64-1.</p>
<h3 id="指令">指令</h3>
<p>As for common assembly instructions, there are many different instructions that can be used depending on the architecture and the specific task at hand. However, some common instructions include:</p>
<p><strong>MOV</strong>: This instruction moves data from one location to another. For example, <code>MOV EAX, 5</code> moves the value 5 into the EAX register.</p>
<p><strong>ADD/SUB</strong>: These instructions perform addition and subtraction operations. For example, <code>ADD EAX, EBX</code> adds the value in the EBX register to the value in the EAX register.</p>
<p><strong>CMP</strong>: This instruction compares two values and sets flags based on the result. For example, <code>CMP EAX, EBX</code> compares the values in the EAX and EBX registers and sets flags based on whether EAX is greater than, less than, or equal to EBX.</p>
<p><strong>JMP</strong>: This instruction jumps to a different location in the code. For example, <code>JMP label</code> jumps to the location labeled “label”.</p>
<p><strong>CALL/RET</strong>: These instructions are used for function calls and returns. CALL function calls the function at the specified location, and RET returns from a function.</p>
<p>DD in the .data section of an assembly program stands for “define doubleword”. A doubleword is a 32-bit value, which is equivalent to 4 bytes. The dd directive is used to reserve space in memory for a variable and initialize it to a specific value.</p>
<p>下面是一些完整示例：</p>
<figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; Here is an example program that uses the MOV instruction to move the value 5 into the EAX register, adds the value in the EBX register to the value in the EAX register using the ADD instruction, and then returns the result:</span></span><br><span class="line"><span class="symbol">global</span> _start</span><br><span class="line"></span><br><span class="line"><span class="symbol">section</span> <span class="meta">.text</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="comment">; Move 5 into EAX</span></span><br><span class="line">    <span class="keyword">MOV</span> EAX, <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">; Add EBX to EAX</span></span><br><span class="line">    <span class="keyword">ADD</span> EAX, EBX</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Exit program with EAX as return value</span></span><br><span class="line">    <span class="comment">; The reason we use the following code to exit a program in assembly language is because it is a convention that has been established for Linux systems. The INT instruction with the value 0x80 is used to make a system call to the kernel. The kernel then interprets the value in the EAX register as the system call number and performs the appropriate action. In this case, the system call number is 1, which corresponds to the exit system call. The value in the EBX register is used as the exit status of the program. By convention, a value of 0 indicates success, while any other value indicates an error. Therefore, the MOV EBX, 0 instruction is used to set the EBX register to 0 before exiting the program with a return value of 0 in the EAX register.</span></span><br><span class="line">    <span class="keyword">MOV</span> EBX, <span class="number">0</span></span><br><span class="line">    <span class="comment">; For notifying the kernel to end the system call</span></span><br><span class="line">    <span class="keyword">MOV</span> EAX, <span class="number">1</span></span><br><span class="line">    INT <span class="number">0x80</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; Here is another example program that uses the CMP instruction to compare the values in the EAX and EBX registers and then jumps to a different location in the code based on the result:</span></span><br><span class="line"><span class="symbol">global</span> _start</span><br><span class="line"></span><br><span class="line"><span class="symbol">section</span> <span class="meta">.text</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="comment">; Compare EAX and EBX</span></span><br><span class="line">    <span class="keyword">CMP</span> EAX, EBX</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Jump to label1 if EAX is greater than EBX</span></span><br><span class="line">    JG label1</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Jump to label2 if EAX is less than EBX</span></span><br><span class="line">    JL label2</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Jump to label3 if EAX is equal to EBX</span></span><br><span class="line">    JE label3</span><br><span class="line"></span><br><span class="line"><span class="symbol">label1:</span></span><br><span class="line">    <span class="comment">; Code to execute if EAX is greater than EBX</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Jump to end of program</span></span><br><span class="line">    JMP <span class="meta">end</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">label2:</span></span><br><span class="line">    <span class="comment">; Code to execute if EAX is less than EBX</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Jump to end of program</span></span><br><span class="line">    JMP <span class="meta">end</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">label3:</span></span><br><span class="line">    <span class="comment">; Code to execute if EAX is equal to EBX</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Jump to end of program</span></span><br><span class="line">    JMP <span class="meta">end</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">end:</span></span><br><span class="line">    <span class="comment">; Exit program with EAX as return value</span></span><br><span class="line">    <span class="keyword">MOV</span> EBX, <span class="number">0</span></span><br><span class="line">    <span class="keyword">MOV</span> EAX, <span class="number">1</span></span><br><span class="line">    INT <span class="number">0x80</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">; To write an assembly program that adds two numbers, you can use the ADD instruction.</span></span><br><span class="line"><span class="symbol">section</span> <span class="meta">.data</span></span><br><span class="line">    <span class="comment">; define three variables in the .data section: num1, num2, and result. The dd directive is used to reserve space for each variable and initialize it to a specific value. num1 is initialized to 10, num2 is initialized to 20, and result is initialized to 0.</span></span><br><span class="line">    num1 dd <span class="number">10</span></span><br><span class="line">    num2 dd <span class="number">20</span></span><br><span class="line">    result dd <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">section</span> <span class="meta">.text</span></span><br><span class="line">    <span class="meta">global</span> _start</span><br><span class="line"></span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="comment">; Move num1 into EAX</span></span><br><span class="line">    <span class="keyword">mov</span> eax, [num1]</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Add num2 to EAX</span></span><br><span class="line">    <span class="keyword">add</span> eax, [num2]</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Move the result into result variable</span></span><br><span class="line">    <span class="keyword">mov</span> [result], eax</span><br><span class="line"></span><br><span class="line">    <span class="comment">; Exit the program with a return value of 0</span></span><br><span class="line">    <span class="keyword">mov</span> ebx, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> eax, <span class="number">1</span></span><br><span class="line">    int <span class="number">0x80</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="arm-assembly">arm assembly</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kKtWsuuJEDs&amp;list=PLn_It163He32Ujm-l_czgEBhbJjOUgFhg">https://www.youtube.com/watch?v=kKtWsuuJEDs&amp;list=PLn_It163He32Ujm-l_czgEBhbJjOUgFhg</a></p>
</li>
</ul>
<h2 id="C">C</h2>
<h3 id="C-内存管理">C 内存管理</h3>
<h4 id="API">API</h4>
<p>C 语言主要提供 <code>malloc</code>、<code>realloc</code>、<code>calloc</code>、<code>alloca</code> 与 <code>aligned_alloc</code> 等内存分配函数来实现对内存的分配功能。</p>
<h4 id="malloc">malloc</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * <span class="title function_">malloc</span> <span class="params">(<span class="type">size_t</span> size)</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>该函数用于从堆中分配内存空间，内存分配大小为 size。如果内存分配成功，则返回首地址；如果内存分配失败，则返回 NULL。</p>
<h4 id="calloc">calloc</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * <span class="title function_">calloc</span> <span class="params">(<span class="type">size_t</span> num, <span class="type">size_t</span> size )</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>该函数用于从堆中分配 <code>num</code> 个相邻的内存单元，每个内存单元的大小为 <code>size</code>。如果内存分配成功则返回第一个内存单元的首地址；否则内存分配失败，则返回 <code>NULL</code>。从功能上看，<code>calloc</code> 函数与语句 <code>malloc（num*size)</code> 的效果极其相似。但不同的是，在使用 <code>calloc</code> 函数分配内存时，会将内存内容初始化为 0。</p>
<h4 id="realloc">realloc</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * <span class="title function_">realloc</span> <span class="params">(<span class="type">void</span> * ptr, <span class="type">size_t</span> size )</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>该函数用于更改已经配置的内存空间，它同样是从堆中分配内存的。当程序需要扩大一块内存空间时，<code>realloc</code> 函数<strong>试图直接从堆上当前内存段后面的字节中获得更多的内存空</strong><br>
<strong>间</strong>，即它将首先判断当前的指针是否有足够的连续存储空间，如果有，则扩大 <code>ptr</code> 指向的地址，并且将 <code>ptr</code> 返回（返回原指针）；如果当前内存段后面的空闲字节不够，那么将先按照 <code>size</code> 指定的大小分配空间（使用堆上第一个能够满足这一要求的内存块），并将原有数据从头到尾拷贝到新分配的内存区域，然后释放原来 <code>ptr</code> 所指内存区域，同时返回新分配的内存区域的首地址，即重新分配存储器块的地址。</p>
<p>需要注意的是，参数 <code>ptr</code> 为指向先前由 <code>malloc</code>、<code>calloc</code> 与 <code>realloc</code> 函数所返回的内存指针，而参数 <code>size</code> 为新分配的内存大小，其值可比原内存大或小。其中：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>如果 <code>size</code> 值比原分配的内存空间小，内存内容不会改变（即新内存保持原内存的内容），且返回的指针为原来内存的首地址（即 <code>ptr</code>）。</p>
</li>
<li class="lvl-2">
<p>如果 <code>size</code> 值比原分配的内存空间大，则 <code>realloc</code> 不一定会返回原来的指针，原内存的内容保持不变，但新多出的内存则设为初始值。</p>
</li>
<li class="lvl-2">
<p>最后，如果内存分配成功，则返回首地址；如果内存分配失败，则返回 <code>NULL</code>。</p>
</li>
</ul>
<h4 id="alloca">alloca</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * <span class="title function_">alloca</span> <span class="params">(<span class="type">size_t</span> size)</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>相对与 <code>malloc</code>、<code>calloc</code> 与 <code>realloc</code> 函数，函数 <code>alloca</code> 是<strong>从栈中分配内存空间</strong>，内存分配大小为 <code>size</code>。如果内存分配成功，则返回首地址；如果内存分配失败，则返回 <code>NULL</code>。也正因为函数 <code>alloca</code> 是从栈中分配内存空间，因此它会自动释放内存空间，而无需手动释放。</p>
<h4 id="aligned-alloc">aligned_alloc</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * <span class="title function_">aligned_alloc</span> <span class="params">(<span class="type">size_t</span> alignment,<span class="type">size_t</span> size)</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>该函数属于 <strong>C11 标准</strong>提供的新函数，用于<strong>边界对齐的动态内存分配</strong>。该函数按照参数 <code>alignment</code> 规定的对齐方式为对象进行动态存储分配 <code>size</code> 个 <code>size_t</code> 类型的存储单元。如果内存分配成功，则返回首地址；否则内存分配失败，则返回 <code>NULL</code>。</p>
<p>相对于 <code>malloc</code> 函数，<code>aligned_alloc</code> 函数保证了返回的地址是能对齐的，同时也要求 size 参数是 <code>alignment</code> 参数的整数倍。从表面上看，函数 <code>calloc</code> 相对 <code>malloc</code> 更接近 <code>aligned_alloc</code>，但 <code>calloc</code> 函数比 <code>aligned_alloc</code> 函数多了一个动作，那就是会将内存内容初始化为 <code>0</code>。</p>
<h4 id="内存分配函数的返回值">内存分配函数的返回值</h4>
<table>
<thead>
<tr>
<th style="text-align:center">函数名</th>
<th style="text-align:center">成功返回</th>
<th style="text-align:center">失败返回</th>
<th style="text-align:center"> errno</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">malloc</td>
<td style="text-align:center"> 指向被分配内存的指针</td>
<td style="text-align:center"> NULL</td>
<td style="text-align:center">ENOMEM</td>
</tr>
<tr>
<td style="text-align:center">aligned_alloc</td>
<td style="text-align:center"> 指向被分配内存的指针</td>
<td style="text-align:center"> NULL</td>
<td style="text-align:center">ENOMEM</td>
</tr>
<tr>
<td style="text-align:center">calloc</td>
<td style="text-align:center"> 指向被分配内存的指针</td>
<td style="text-align:center"> NULL</td>
<td style="text-align:center">ENOMEM</td>
</tr>
<tr>
<td style="text-align:center">realloc</td>
<td style="text-align:center"> 指向重新分配内存的指针</td>
<td style="text-align:center"> NULL</td>
<td style="text-align:center">ENOMEM</td>
</tr>
</tbody>
</table>
<p>在调用表 1 中的这些内存分配函数时，必须进行返回值检查，以便能够及时得到内存分配是否成功与失败（如果分配失败则返回 <code>NULL</code> 指针），这样也可以避免因为内存分配错误而导致的不可预知和意外程序行为发生，如下面的示例代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *p = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">if</span> (!p)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">/*处理内存分配错误，并返回错误状态*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>除通过使用 <code>“if（p==NULL）”</code> 或者 <code>“if（p！=NULL）”</code> 语句进行简单防错处理之外，如果指针 <code>p</code> 是函数的参数，那么还可以在函数的入口处用 <code>assert(p !=NULL)</code> 进行检查，从而避免发生内存分配未成功却使用了它的情况。</p>
<h4 id="内存资源的分配与释放">内存资源的分配与释放</h4>
<p>内存资源的分配与释放应该限定在同一模块或者同一抽象层内进行，在 C 语言中，如果内存的分配和释放在不同的模块或抽象层内，不仅会加大程序员追踪内存块生命周期的负担，而且可能会导致内存泄漏、内存双重释放（<code>double-free</code>）、非法访问已经释放的内存、写入已释放或未分配的内存区域等问题。看下面一段示例代码：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MIN_MEM_SIZE 10</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">CompareMemorySize</span><span class="params">(<span class="type">char</span> *p, <span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (size &lt; MIN_MEM_SIZE)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">        p = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">AllocMemory</span><span class="params">(<span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> *p = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (CompareMemorySize(p, size) == <span class="number">-1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">        p = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在上面的示例代码中，p 的内存是在 <code>AllocMemory</code> 函数中进行分配的，然后再将它通过语句 “<code>CompareMemorySize(p,size)</code>” 传给 <code>CompareMemorySize</code> 函数。在 <code>CompareMemorySize</code> 函数中，首先通过语句 “<code>if(size&lt;MIN_MEM_SIZE)</code>” 检查 <code>p</code> 所分配的内存长度，如果内存长度小于最小值 <code>(MIN_MEM_SIZE)</code>，则释放 <code>p</code>。</p>
<p>然后，再将 <code>CompareMemorySize</code> 函数的返回值 “<code>-1</code>” 返回给调用者 <code>AllocMemory</code> 函数。在 <code>AllocMemory</code> 函数中执行语句 “<code>if(CompareMemorySize(p,size)==-1)</code>” 条件成立，<strong>再次释放 p</strong>。</p>
<p>很显然，这样不仅违背了 “内存资源的分配与释放应该限定在同一模块或者同一抽象层内进行” 的原则，同时导致了内存的双重释放。因此，需要对代码做如下修改：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MIN_MEM_SIZE 10</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">CompareMemorySize</span><span class="params">(<span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (size &lt; MIN_MEM_SIZE)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">AllocMemory</span><span class="params">(<span class="type">size_t</span> size)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> *p = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (CompareMemorySize(size) == <span class="number">-1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">        p = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>现在，函数 <code>CompareMemorySize</code> 与 <code>AllocMemory</code> 的职责很清楚了。其中，<code>CompareMemorySize</code> 函数只负责检查内存分配的长度，而内存的分配与释放都放在 <code>AllocMemory</code> 函数内进行。这样不仅不会导致内存的双重释放，而且完全遵从 “<strong>内存资源的分配与释放应该限定在同一模块或者同一抽象层内进行</strong>” 原则。</p>
<h4 id="返回指针进行强制类型转换">返回指针进行强制类型转换</h4>
<p>在 C 语言中，“<code>void</code>” 被称为 “无类型”，而 “<code>void*</code>” 则被称为 “无类型指针”。之所以称 “<code>void*</code>” 为 “无类型指针”，是因为它<code>可以指向任何数据类型</code>。因此，对于任何类型 “<code>T</code>” 都可以转换为 “<code>void</code><em>”，而 “`void</em> 也可以转换为任何类型 “T*”。</p>
<p>也正是因为 “<code>void</code>” 的这个特征，它常被用在如下两个方面：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>对函数返回的限定，即如果函数没有返回值，那么应将其声明为 <code>void</code> 类型。</p>
</li>
<li class="lvl-2">
<p>对函数参数的限定，即如果函数无参数，那么声明函数参数为 <code>void</code>。</p>
</li>
</ul>
<p>当然，内存管理函数也不例外，如 <code>malloc</code>、<code>realloc</code>、<code>calloc</code>、<code>alloca</code> 与 <code>aligned_alloc</code> 函数的返回都是 <code>void*</code> 类型。但需要特别注意的是，在使用这些内存管理函数进行内存分配时，必须将返回类型 <code>void*</code> 强制转换为指向被分配类型的指针。如下面的代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *p = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">10</span> * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br></pre></td></tr></tbody></table></figure>
<p>当然，为了能够简单调用，也可以将 malloc 函数使用 define 定义成如下形式：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC(type) ((type *)malloc(sizeof(type)))</span></span><br><span class="line"><span class="comment">/*或者*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC(number,type) ((type *)malloc((number) * sizeof(type)))</span></span><br></pre></td></tr></tbody></table></figure>
<p>现在，调用就简单多了，如下面的代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *p = MALLOC(<span class="type">char</span>);</span><br><span class="line"><span class="comment">/*或者*/</span></span><br><span class="line"><span class="type">char</span> *p = MALLOC(<span class="number">10</span>, <span class="type">char</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>下面的宏为大家提供了更多方便：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*malloc*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC_ARRAY(number, type) \((type *)malloc((number)* sizeof(type)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC_FLEX(stype, number, etype) \((stype *)malloc(sizeof(stype) \</span></span><br><span class="line"><span class="meta">+ (number)* sizeof(etype)))</span></span><br><span class="line"><span class="comment">/*calloc*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CALLOC(number, type) \((type *)calloc(number, sizeof(type)))</span></span><br><span class="line"><span class="comment">/*realloc*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REALLOC_ARRAY(pointer, number, type) \((type *)realloc(pointer, (number)* sizeof(type)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REALLOC_FLEX(pointer, stype, number, etype) \((stype *)realloc(pointer, sizeof(stype) \</span></span><br><span class="line"><span class="meta">+ (number)* sizeof(etype)))</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="指向一块合法的内存">指向一块合法的内存</h4>
<p>在 C 语言中，只要是指针变量，那么在使用它之前必须确保该指针变量的值是一个有效的值，它能够指向一块合法的内存，并从根本上避免未分配内存或者内存分配不足的情况发生。</p>
<p>看下面一段示例代码：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">phonelist</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">int</span> number;</span><br><span class="line">    <span class="type">char</span> *name;</span><br><span class="line">    <span class="type">char</span> *tel;</span><br><span class="line">}<span class="built_in">list</span>,*plist;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="built_in">list</span>.number = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(<span class="built_in">list</span>.name, <span class="string">"Abby"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(<span class="built_in">list</span>.tel, <span class="string">"13511111111"</span>);</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>对于上面的代码片段，在定义结构体变量 <code>list</code> 时，<strong>并未给结构体 phonelist 内部的指针变量成员 “<code>char*name</code>” 与 “<code>char*tel</code>” 分配内存</strong>。这时候的指针变量成员 “<code>char*name</code>” 与 “<code>char*tel</code>” 并没有指向一个合法的地址，从而导致其内部存储的将是一些未知的乱码。</p>
<p>因此，在调用 <code>strcpy</code> 函数时，如 “<code>strcpy(list.name,"Abby")</code>” 语句会将字符串 "<code>Abby</code>" 向未知的乱码所指的内存上拷贝，而这块内存 <code>name</code> 指针根本就无权访问，从而导致程序出错。</p>
<p>既然没有给指针变量成员 “<code>char*name</code>” 与 “<code>char*tel</code>” 分配内存，那么解决的办法就是为指针变量成员分配内存，使其指向一个合法的地址，如下面的示例代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>.name = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">20</span>*<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line"><span class="built_in">strcpy</span>(<span class="built_in">list</span>.name, <span class="string">"Abby"</span>);</span><br><span class="line"><span class="built_in">list</span>.tel = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">20</span>*<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line"><span class="built_in">strcpy</span>(<span class="built_in">list</span>.tel, <span class="string">"13511111111"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>除此之外，下面的错误也是大家经常容易忽视的：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">phonelist</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">int</span> number;</span><br><span class="line">    <span class="type">char</span> *name;</span><br><span class="line">    <span class="type">char</span> *tel;</span><br><span class="line">}<span class="built_in">list</span>, *plist;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    plist = (<span class="keyword">struct</span> phonelist*)<span class="built_in">malloc</span>(\</span><br><span class="line">        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> phonelist));</span><br><span class="line">    <span class="keyword">if</span> (plist)</span><br><span class="line">    {</span><br><span class="line">        plist-&gt;number = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">strcpy</span>(plist-&gt;name, <span class="string">"Abby"</span>);</span><br><span class="line">        <span class="built_in">strcpy</span>(plist-&gt;tel, <span class="string">"13511111111"</span>);</span><br><span class="line">            <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="built_in">free</span>(plist);</span><br><span class="line">    plist = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>不难发现，上面的代码片段虽然为结构体指针变量 <code>plist</code> 分配了内存，但是仍旧没有给结构体指针变量成员 “<code>char*name</code>” 与 “<code>char*tel</code>” 分配内存，从而导致结构体指针变量成员 “<code>char*name</code>” 与 “<code>char*tel</code>” 并没有指向一个合法的地址。因此，应该做如下修改：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plist-&gt;name = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">20</span>*<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line"><span class="built_in">strcpy</span>(plist-&gt;name, <span class="string">"Abby"</span>);</span><br><span class="line">plist-&gt;tel = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">20</span>*<span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line"><span class="built_in">strcpy</span>(plist-&gt;tel, <span class="string">"13511111111"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>由此可见，对结构体来说，仅仅是为结构体指针变量分配内存还是不够的，还必须为结构体成员中的所有指针变量分配足够的内存。</p>
<h4 id="分配足够的内存空间">分配足够的内存空间</h4>
<p>对于上面的结构体指针变量 plist 的内存分配语句：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plist = (<span class="keyword">struct</span> phonelist*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> phonelist));</span><br></pre></td></tr></tbody></table></figure>
<p>如果不小心误写成如下形式会怎么样呢？</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plist = (<span class="keyword">struct</span> phonelist*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> phonelist*));</span><br></pre></td></tr></tbody></table></figure>
<p>虽然这里只是简单地将 “<code>sizeof(struct phonelist)</code>” 误写成了 “<code>sizeof(struct phonelist*)</code>”，但将会因为结构体指针变量 <code>plist</code> 内存分配不足而导致程序的内存错误发生。类似的示例还有许多，如下面的代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">f</span><span class="params">(<span class="type">size_t</span> len)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">long</span> *p;</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">0</span> || len &gt; SIZE_MAX / <span class="keyword">sizeof</span>(<span class="type">long</span>))</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/*溢出处理*/</span></span><br><span class="line">    }</span><br><span class="line">    p = (<span class="type">long</span> *)<span class="built_in">malloc</span>(len * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在上面的示例代码中，内存分配语句 “<code>p=(long*)malloc(len*sizeof(int))</code>” 使用了 “<code>sizeof(int)</code>” 来计算内存的大小，而不是 <code>sizeof(long)</code>，这显然是不对的，应该修改成 <code>sizeof(long)</code>，当然，也可以用 “<code>sizeof(*p)</code>”。</p>
<p>除此之外，对于数组对象尤其要注意内存分配的问题，如下面的代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ARRAY_SIZE 10</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">datalist</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">size_t</span> number;</span><br><span class="line">    <span class="type">int</span> data[];</span><br><span class="line">};</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">datalist</span> <span class="title">list</span>;</span></span><br><span class="line">    <span class="built_in">list</span>.number = ARRAY_SIZE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; ++i)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">list</span>.data[i] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>对于上面的示例，当一个结构体中包含数组成员时，其数组成员的大小必须添加到结构体的大小中。因此，上面示例的正确内存分配方法应该按照如下方式进行：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ARRAY_SIZE 10</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">datalist</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">size_t</span> number;</span><br><span class="line">    <span class="type">int</span> data[];</span><br><span class="line">}；</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">datalist</span> *<span class="title">plist</span>;</span></span><br><span class="line">    plist = (<span class="keyword">struct</span> datalist *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> datalist)+<span class="keyword">sizeof</span>(<span class="type">int</span>) * ARRAY_SIZE);</span><br><span class="line">    <span class="keyword">if</span> (plist == <span class="literal">NULL</span>){</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    plist-&gt;number = ARRAY_SIZE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; ARRAY_SIZE; ++i)</span><br><span class="line">    {</span><br><span class="line">            plist-&gt;data[i] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>由上面的几个示例代码片段可见，对于 <code>malloc</code>、<code>calloc</code>、<code>realloc</code> 与 <code>aligned_alloc</code> 内存分配函数中长度参数的大小，必须保证有足够的范围来表示对象要存储的大小。如果长度参数不正确或者可能被攻击者所操纵，将可能会出现缓冲区溢出。与此同时，不正确的长度参数、不充分的范围检查、整数溢出或截断都会导致分配长度不足的缓冲区。因此，一定要确保内存分配函数的长度参数能够合法地分配足够数量的内存。</p>
<h4 id="禁止执行零长度的内存分配">禁止执行零长度的内存分配</h4>
<p>根据 C99 规定，如果在程序中试图调用 <code>malloc</code>、<code>calloc</code> 与 realloc 等系列内存分配函数分配长度为 0 的内存，那么其行为将是由具体编译器所定义的（如可能返回一个 <code>null</code> 指针，又或者是长度为非零的值等），从而导致产生不可预料的结果。</p>
<p>因此，为了保证不会将 0 作为长度参数值传给 malloc、calloc 与 realloc 等系列内存分配函数，应该对这些内存分配函数的<strong>长度参数进行合法性检查</strong>，以保证它的合法取值范围。</p>
<p>如下面的代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> len;</span><br><span class="line"><span class="comment">/*初始化len变量*/</span></span><br><span class="line"><span class="keyword">if</span> (len == <span class="number">0</span>)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">/* 处理长度为0的错误 */</span></span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> *p = (<span class="type">int</span> *)<span class="built_in">malloc</span>(len);</span><br><span class="line"><span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">/*...*/</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="避免大型的堆栈分配">避免大型的堆栈分配</h4>
<p>C99 标准引入了对变长数组的支持，如果变长数组的长度传入未进行任何检查和处理，那么将很容易被攻击者用来实施攻击，如常见的 DOS 攻击。看下面的示例代码：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">CopyFile</span><span class="params">(FILE *src, FILE *dst, <span class="type">size_t</span> bufsize)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> buf[bufsize];</span><br><span class="line">    <span class="keyword">while</span> (fgets(buf, bufsize, src))</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fputs</span>(buf, dst) == EOF)</span><br><span class="line">        {</span><br><span class="line">                <span class="comment">/*...*/</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在上面的示例代码中，数组 “<code>char buf[bufsize]</code>” 的长度将根据 <code>CopyFile</code> 函数的 <code>bufsize</code> 参数来决定，这显然不符合要求的。对于这种情况，可以通过一个 <code>malloc</code> 调用来替换掉这个变长数组。与此同时，如果 <code>malloc</code> 函数内存分配失败，还可以对返回值进行检查，从而防止程序异常终止等情况发生。如下面的示例代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">CopyFile</span><span class="params">(FILE *src, FILE *dst, <span class="type">size_t</span> bufsize)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (bufsize == <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="type">char</span> *buf = (<span class="type">char</span> *)<span class="built_in">malloc</span>(bufsize);</span><br><span class="line">    <span class="keyword">if</span> (buf == <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span> (fgets(buf, bufsize, src))</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fputs</span>(buf, dst) == EOF)</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">/*...*/</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="built_in">free</span>(buf);</span><br><span class="line">    buf = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="避免内存分配成功，但并未初始化">避免内存分配成功，但并未初始化</h4>
<p>在通常情况下，导致这种错误的主要原因有两个：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>没有初始化的观念。</p>
</li>
<li class="lvl-2">
<p>误以为内存的默认初值全部为零，从而导致引用初值错误（如数组）。</p>
</li>
</ul>
<p>其实，内存的默认初值究竟是什么并没有统一的标准。如 <code>malloc</code> 函数分配得到的内存空间就是未初始化的，而它所分配的内存空间里可能包含出乎意料的值。因此，一般在使用该内存空间时，就需要调用函数 <code>memset</code> 来将其初始化为全 <code>0</code>。如下面的示例代码所示：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> * p = <span class="literal">NULL</span>;</span><br><span class="line">p = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"><span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">/*初始化为0*/</span></span><br><span class="line"><span class="built_in">memset</span>(p, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br></pre></td></tr></tbody></table></figure>
<p>对于 <code>realloc</code> 函数，同样需要使用 <code>memset</code> 函数对其内存进行初始化。而对于数组，也别忘了赋初值，即便是赋零值也不可省略，千万不要嫌麻烦。</p>
<h3 id="C-宏（macro）">C 宏（macro）</h3>
<h4 id="特殊宏">特殊宏</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__DATE__     : 在原文件中插入当前的编写日期</span><br><span class="line">__TIME__     : 在源文件中插入当前的编辑时间</span><br><span class="line">__cplusplus__: 在源文件中编写c++程序时该标识被定义</span><br><span class="line">__FILE__     :文件名</span><br><span class="line">__LINE__     :行数</span><br><span class="line">__func__     :所在函数</span><br><span class="line">__FUNCTION__ :</span><br></pre></td></tr></tbody></table></figure>
<h4 id="VA-ARGS"><code>__VA_ARGS__</code></h4>
<p>用于实现变参函数，将函数宏的形参列表最后的参数用省略号（…）表示即实现了变参函数。<code>__VA_ARGS__</code>用于在宏替换部分中，表明省略号代表什么。</p>
<p>例如：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PR(...) printf(__VA__ARGS__);    <span class="comment">//Note：需编译器支持__VA__ARGS__</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> age = <span class="number">26</span>;</span><br><span class="line">    <span class="type">int</span> weight = <span class="number">75</span>;</span><br><span class="line">    <span class="type">float</span> BMI = <span class="number">26.4</span>;</span><br><span class="line">    PR(<span class="string">"oh mashuai"</span>);</span><br><span class="line">    PR(<span class="string">"Age:%d, weight:%d,BMI:%d"</span>,age,weight,BMI);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><strong><code>##__VA_ARGS__</code> 宏前面加上<code>##</code>的作用在于，当可变参数的个数为 0 时，这里的<code>##</code>起到把前面多余的 "<code>,</code>" 去掉的作用，否则会编译出错。</strong></p>
<p>一般这个用在调试信息上多一点.</p>
<h4 id=""><code>#</code></h4>
<p>表示将参数转换为字符串输出：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> P(A) printf(<span class="string">"%s:%d.\r\n"</span>,#A,A);</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> b=<span class="number">2</span>;</span><br><span class="line">    P(a);</span><br><span class="line">    P(b);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>运行结果为：</p>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a:1</span><br><span class="line">b:2</span><br></pre></td></tr></tbody></table></figure>
<h4 id="-2"><code>##</code></h4>
<p>用于类函数宏的替换部分，也可以用于对象宏的替换部分。主要用于将两个语言符号组成单个语言符号，为宏扩展提供一种连接实际变元的手段；</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> XNAME(n) X##n        <span class="comment">//将定元X和变元n组合，列出X1, X2, X3 ...</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT_XN(n) printf(<span class="string">"X"</span>#n<span class="string">"=%d\n"</span>,X##n);</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> <span class="title function_">XNAME</span><span class="params">(<span class="number">1</span>)</span>=<span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">XNAME</span><span class="params">(<span class="number">2</span>)</span>=<span class="number">20</span>;</span><br><span class="line">    <span class="type">int</span> X3=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    PRINT_XN(<span class="number">1</span>);</span><br><span class="line">    PRINT_XN(<span class="number">2</span>);</span><br><span class="line">    PRINT_XN(<span class="number">3</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="定义一个宏，求两个数中的最大数">定义一个宏，求两个数中的最大数</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>合格</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span>  MAX(x,y)  x &gt; y ? x : y</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li class="lvl-2">
<p>中等</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(x,y) (x) &gt; (y) ? (x) : (y)</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li class="lvl-2">
<p>良好</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(x,y)({ \</span></span><br><span class="line"><span class="meta">    int _x = x; \</span></span><br><span class="line"><span class="meta">    int _y = y; \</span></span><br><span class="line"><span class="meta">    _x &gt; _y ? _x : _y; \</span></span><br><span class="line"><span class="meta">})</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> i = <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">6</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"max=%d"</span>,MAX(i++,j++));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li class="lvl-2">
<p>优秀</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(type,x,y)({ \</span></span><br><span class="line"><span class="meta">    type _x = x; \</span></span><br><span class="line"><span class="meta">    type _y = y; \</span></span><br><span class="line"><span class="meta">    _x &gt; _y ? _x : _y; \</span></span><br><span class="line"><span class="meta">})</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> i = <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">6</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"max=%d\n"</span>,MAX(<span class="type">int</span>,i++,j++));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"max=%f\n"</span>,MAX(<span class="type">float</span>,<span class="number">3.14</span>,<span class="number">3.15</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li class="lvl-2">
<p>流弊</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> max(x, y) ({    \</span></span><br><span class="line"><span class="meta">    typeof(x) _x = (x); \</span></span><br><span class="line"><span class="meta">    typeof(y) _y = (y); \</span></span><br><span class="line"><span class="meta">    (void) (&amp;_x == &amp;_y);\</span></span><br><span class="line"><span class="meta">    _x &gt; _y ? _x : _y; })</span></span><br></pre></td></tr></tbody></table></figure>
<p>在这个宏定义中，使用了 <code>typeof</code>(GCC 的扩展) 关键字<code>用来获取宏的两个参数类型</code>。干货在 <code>(void) (&amp;x == &amp;y);</code> 这句话，简直是天才般的设计！</p>
<ul class="lvl-2">
<li class="lvl-4">
<p>用来给用户提示一个警告，对于不同类型的指针比较，编译器会给一个警告，提示两种数据类型不同；</p>
</li>
<li class="lvl-4">
<p>当两个值比较，比较的结果没有用到，有些编译器可能会给出一个 warning，加个 (void) 后，就可以消除这个警告！</p>
</li>
</ul>
</li>
<li class="lvl-2">
<p>完美</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">max(x, _x)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> max(x, y) ({                \</span></span><br><span class="line"><span class="meta">    typeof(x) _max1 = (x);            \</span></span><br><span class="line"><span class="meta">    typeof(y) _max2 = (y);            \</span></span><br><span class="line"><span class="meta">    (void) (&amp;_max1 == &amp;_max2);        \</span></span><br><span class="line"><span class="meta">    _max1 &gt; _max2 ? _max1 : _max2; })</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __max(t1, t2, max1, max2, x, y) ({              \</span></span><br><span class="line"><span class="meta">    t1 max1 = (x);                                  \</span></span><br><span class="line"><span class="meta">    t2 max2 = (y);                                  \</span></span><br><span class="line"><span class="meta">    (void) (&amp;max1 == &amp;max2);                        \</span></span><br><span class="line"><span class="meta">    max1 &lt; max2 ? max1 : max2; })</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ___PASTE(a,b) a##b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PASTE(a,b) ___PASTE(a,b)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __UNIQUE_ID(prefix) __PASTE(__PASTE(__UNIQUE_ID_, prefix), __COUNTER__)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> max(x, y)                                       \</span></span><br><span class="line"><span class="meta">    __max(typeof(x), typeof(y),                     \</span></span><br><span class="line"><span class="meta">          __UNIQUE_ID(max1_), __UNIQUE_ID(max2_),   \</span></span><br><span class="line"><span class="meta">          x, y)</span></span><br></pre></td></tr></tbody></table></figure>
<p>在新版的宏中，内部的临时变量不再由程序员自己定义，而是让编译器生成一个独一无二的变量，这样就避免了同名冲突的风险。宏 **__UNIQUE_ID** 的作用就是生成了一个独一无二的变量，确保了临时变量的唯一性。关于它的使用，可以参考<a href="https://link.zhihu.com/?target=https%3A//gaomf.cn/2017/10/08/Kernel_min_max_macro/">文章</a>，写的很好。</p>
</li>
<li class="lvl-2">
<p>参考</p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/22465774">Linux 三剑客知乎</a></li>
</ul>
</li>
</ul>
<h3 id="函数指针">函数指针</h3>
<h4 id="指向普通函数的指针">指向普通函数的指针</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">int_add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> (a+b);</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> <span class="title function_">int_sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> (a-b);</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> (*int_operator)(<span class="type">int</span>, <span class="type">int</span>) = int_add;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">{</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;int_operator(<span class="number">4</span>, <span class="number">5</span>)&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// output 9</span></span><br><span class="line">    int_operator = int_sub;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;int_operator(<span class="number">4</span>, <span class="number">5</span>)&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// output -1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>上例中，<code>int_operator</code> 会被编译器解释成类型 <code>int(*)(int, int)</code> 的一个指针。</p>
<p>调用方式还可以写作：<code>(*int_operator)(4, 5)</code>，这样的好处是让人一眼就能看到 <code>int_operator</code> 是一个函数指针。<strong>注意：函数指针和指向函数的返回值的类型和参数都必须严格一致；</strong></p>
<h4 id="函数指针数组">函数指针数组</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> (*pFuncArray[<span class="number">10</span>])();</span><br></pre></td></tr></tbody></table></figure>
<p><code>[]</code> 的优先级高于 <code>*</code>，该语句将 <code>pFuncArray</code> 声明为拥有 10 个元素的数组，每一个元素都是指向一个函数的函数指针，该函数没有参数，返回值类型为 <code>int</code>；</p>
<p>注意不能写作：<code>int ((*pFuncArray)[10])()</code>，这样会产生编译错误；<code>(*pFuncArray)[10]</code> 表明了 <code>pFuncArray</code> 是一个指针，该指针指向一个<code>含有 10个元素的数组</code>；其类型为 <code>int()()</code>，显然，编译不能通过。</p>
<p>将上面的声明转换为 <code>typedef</code> 格式，会使程序可读性增加：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span><span class="params">(*pFunc)</span><span class="params">()</span>;</span><br><span class="line">pFunc pFuncArray[<span class="number">10</span>];</span><br></pre></td></tr></tbody></table></figure>
<p>如果需要调用其中的第三个函数，那么调用方式为：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pFuncArray[<span class="number">2</span>]();</span><br></pre></td></tr></tbody></table></figure>
<h4 id="指向‘函数指针数组’的指针">指向‘函数指针数组’的指针</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">cmp_len</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str1, <span class="type">const</span> <span class="type">char</span> *str2)</span></span><br><span class="line">{<span class="keyword">return</span> ((<span class="type">int</span>)<span class="built_in">strlen</span>(str1) - (<span class="type">int</span>)<span class="built_in">strlen</span>(str2));}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">cmp_str</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str1, <span class="type">const</span> <span class="type">char</span> *str2)</span></span><br><span class="line">{<span class="keyword">return</span> <span class="built_in">strcmp</span>(str1, str2);}</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span><span class="params">(*PCMP_FUNC)</span><span class="params">(<span class="type">const</span> <span class="type">char</span>*, <span class="type">const</span> <span class="type">char</span>*)</span>;</span><br><span class="line"></span><br><span class="line">PCMP_FUNC pCmpFuncs[<span class="number">2</span>] =</span><br><span class="line">{</span><br><span class="line">    cmp_len,</span><br><span class="line">    cmp_str,</span><br><span class="line">};</span><br><span class="line"><span class="comment">// 声明指向pCmpFuncs的指针</span></span><br><span class="line">PCMP_FUNC (*ppCmps)[<span class="number">2</span>] = &amp;pCmpFuncs;</span><br></pre></td></tr></tbody></table></figure>
<p>声明分解说明如下：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>(*ppCmps)</code>：表明 <code>ppCmps</code> 是一个指针；</p>
</li>
<li class="lvl-2">
<p><code>(*ppCmps)[2]</code>：后面紧跟 <code>[2]</code>，表明 <code>ppCmps</code> 是一个指向‘两个元素数组’的指针</p>
</li>
<li class="lvl-2">
<p><code>PCMP_FUNC</code> 表明了该数组元素的类型，它是指向函数的指针，返回值为 <code>int</code>，有两个 <code>const char*</code> 类型的参数；</p>
</li>
<li class="lvl-2">
<p>实际上语句 <code>PCMP_FUNC (*ppCmps)[2] = &amp;pCmpFuncs;</code> 将会被编译器解释为：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> (*(*ppCmps)[<span class="number">2</span>])(<span class="type">const</span> <span class="type">char</span>*, <span class="type">const</span> <span class="type">char</span>*) = &amp;pCmpFuncs;</span><br></pre></td></tr></tbody></table></figure>
<p><code>int (*)(const char*, const char *)</code>：表明了该数组元素的类型，它是指向函数的指针，返回值为 <code>int</code>，有两个 <code>const char*</code> 类型的参数；</p>
</li>
</ul>
<h4 id="函数指针与类">函数指针与类</h4>
<p>在 <code>C++</code> 语言中，使用函数指针可以指向类的一个成员函数或变量，虽然这种用法很少能用到，不过了解一下还是有点必要的。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>为了支持这类指针，<code>C++</code> 有三个特殊的运算法符：<code>::*，.-&gt;，.*</code></p>
</li>
<li class="lvl-2">
<p><strong>指向成员函数的指针</strong>必须与向其赋值的函数类型匹配，这包括：</p>
<ul class="lvl-2">
<li class="lvl-4">参数的类型和个数；</li>
<li class="lvl-4">返回值类型；</li>
<li class="lvl-4">它所属的类型；</li>
</ul>
</li>
<li class="lvl-2">
<p><strong>指向成员变量的指针</strong>必须与向其赋值的变量类型匹配，这包括</p>
<ul class="lvl-2">
<li class="lvl-4">变量类型；</li>
<li class="lvl-4">它所属的类型；</li>
</ul>
</li>
<li class="lvl-2">
<p>成员函数和变量必须被绑定到一个对象或者指针上，然后才能得到调用对象的 <code>this</code> 指针，然后才能指向成员变量或函数；</p>
</li>
<li class="lvl-2">
<p>类 <code>AClass</code> 的成员变量 <code>int m_iValue</code>，其完整类型是：<code>int AClass::m_iValue</code>；</p>
</li>
<li class="lvl-2">
<p>类 <code>AClass</code> 的成员函数 <code>int Add(int)</code>，其完整类型是：<code>int AClass::Add(int)</code>;</p>
</li>
</ul>
<p><strong>注意：指向类的静态变量或静态成员函数的指针和普通成员不同；</strong></p>
<h4 id="指向类成员变量的指针">指向类成员变量的指针</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AClass</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">void</span> <span class="title function_">Add</span><span class="params">(<span class="type">int</span> a)</span>{m_iValue += a;}</span><br><span class="line">    <span class="type">int</span>  m_iValue;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">{</span><br><span class="line">    AClass a;</span><br><span class="line">   <span class="comment">// 声明并指向AClass的一个成员变量的指针</span></span><br><span class="line">    <span class="type">int</span> AClass::*pValue = &amp;AClass::m_iValue;</span><br><span class="line">    <span class="comment">// 或者如下方式：</span></span><br><span class="line">    <span class="comment">// int AClass::*pValue;// 指针变量声明</span></span><br><span class="line">    <span class="comment">// pValue = &amp;AClass::m_iValue;// 指向A的m_iValue成员</span></span><br><span class="line">    a.*pValue = <span class="number">4</span>; <span class="comment">// 使用方式，赋值</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;a.m_iValue&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// 输出4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="指向类成员函数的指针">指向类成员函数的指针</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AClass</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">void</span> <span class="title function_">Add</span><span class="params">(<span class="type">int</span> a)</span>{m_iValue += a;}</span><br><span class="line">    <span class="type">int</span>  m_iValue;</span><br><span class="line">};</span><br><span class="line"><span class="comment">// 指向类 AClass 成员函数的指针的声明方式</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(AClass::*pAFunc)</span><span class="params">(<span class="type">int</span>)</span>;</span><br><span class="line"><span class="comment">// 声明一个指向 AClass::Add 的函数指针</span></span><br><span class="line">pAFunc pAAdd = &amp;(AClass::Add);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">{</span><br><span class="line">    AClass a;</span><br><span class="line">    <span class="comment">// 声明并指向AClass的一个成员变量的指针</span></span><br><span class="line">    <span class="type">int</span> AClass::*pValue = &amp;AClass::m_iValue;</span><br><span class="line">    <span class="comment">// 或者如下方式：</span></span><br><span class="line">    <span class="comment">// int AClass::*pValue;// 指针变量声明</span></span><br><span class="line">    <span class="comment">// pValue = &amp;AClass::m_iValue;// 指向A的m_iValue成员</span></span><br><span class="line">    a.*pValue = <span class="number">4</span>; <span class="comment">// 使用方式，赋值</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;a.m_iValue&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// 输出</span></span><br><span class="line">    (a.*pAAdd)(<span class="number">5</span>); <span class="comment">// 指向成员函数指针的调用方式</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;a.m_iValue&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// 输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="指向类静态成员的指针">指向类静态成员的指针</h4>
<p>类的静态成员属于该类的全局对象和函数，并不需要 <em>this</em> 指针；因此指向类静态成员的指针声明方式和普通指针相同。</p>
<p>类指针和普通指针的声明和调用方式完全相同；唯一的不同就是设置指向的对象时，仍然需要类信息，这一点和指向普通成员的指针相同。</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AClass</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> <span class="title function_">Add</span><span class="params">(<span class="type">int</span> a)</span>{m_iValue += a;}</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span>  m_iValue;</span><br><span class="line">};</span><br><span class="line"><span class="type">int</span> AClass::m_iValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span><span class="params">(*pAAdd)</span><span class="params">(<span class="type">int</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 声明并指向AClass的一个静态成员变量的指针</span></span><br><span class="line">    <span class="type">int</span> *pValue = &amp;AClass::m_iValue;</span><br><span class="line">    <span class="comment">// 或者如下方式：</span></span><br><span class="line">    <span class="comment">// int *pValue;// 指针变量声明</span></span><br><span class="line">    <span class="comment">// pValue = &amp;AClass::m_iValue;// 指向A的m_iValue成员</span></span><br><span class="line">    *pValue = <span class="number">4</span>; <span class="comment">// 使用方式同普通指针，赋值</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;*pValue&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// 输出</span></span><br><span class="line">    pAAdd p = &amp;AClass::Add;</span><br><span class="line">    p(<span class="number">5</span>); <span class="comment">// 调用方式同普通函数指针</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;*pValue&lt;&lt;<span class="built_in">endl</span>; <span class="comment">// 输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="OOP-In-C">OOP In C</h3>
<!--
https://stackoverflow.com/questions/351733/how-would-one-write-object-oriented-code-in-c/351745#351745
https://stackoverflow.com/questions/4103704/experiment-object-oriented-c/4103725#4103725
https://stackoverflow.com/questions/6304794/oop-and-interfaces-in-c
https://stackoverflow.com/questions/351733/how-would-one-write-object-oriented-code-in-c?noredirect=1&lq=1
https://stackoverflow.com/questions/660083/derived-classes-in-c-what-is-your-favorite-method?noredirect=1&lq=1
 -->
<h3 id="多线程">多线程</h3>
<p>todo</p>
<h4 id="pthreads">pthreads</h4>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pthreads">Unix/Linux thread standard</a> 基于 <a target="_blank" rel="noopener" href="https://godbolt.org/z/T79TxWK9q">wiki</a> 示例。</p>
<h2 id="CPP">CPP</h2>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/cpp-best-practices">cpp-best-practices</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://riptutorial.com/cplusplus">startup</a></p>
</li>
</ul>
<h3 id="CPP-Project">CPP Project</h3>
<p>项目布局遵循规范：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1204r0.html">P1204R0</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://api.csswg.org/bikeshed/?force=1&amp;url=https://raw.githubusercontent.com/vector-of-bool/pitchfork/develop/data/spec.bs">The Pitchfork Layout</a></p>
</li>
</ul>
<p>现代 C++ 工程布局通常使用成熟的工具生成，比如 <a target="_blank" rel="noopener" href="https://github.com/friendlyanon/cmake-init">cmake-init</a> 及<a target="_blank" rel="noopener" href="https://github.com/friendlyanon/cmake-init/wiki/Examples">示例</a>。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip3 install cmake-init</span><br><span class="line"><span class="comment"># 使用 cmake-init 创建模板，根据提示输出选项即可</span></span><br><span class="line">cmake-init libhello</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Files-in-cpp">Files in cpp</h4>
<p>cpp 作为编译型静态语言，考虑了各方面原因，通常不同的文件后缀，习惯于放置不同的代码段以作为区分，不完全包含后缀有 <code>.h/.cpp/.def/.inc/.imp/impl/.tpp</code>。</p>
<h5 id="hpp-and-cpp">.hpp and .cpp</h5>
<p>通常普通的类及函数都声明于 <code>.h</code> 和 <code>.cpp</code> 中。</p>
<h5 id="inc-imp-impl-tpp">.inc/.imp/.impl/.tpp</h5>
<p>.inc/.inl/.def</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>宏定义或预编译</p>
</li>
<li class="lvl-2">
<p>模板和 <code>constexpr</code> 操作</p>
</li>
<li class="lvl-2">
<p>也可作为类似 <code>.hpp</code> 作用或作为 <code>.hpp</code> 的实现部分，如 <a href="#x-macro">X Macro</a></p>
</li>
</ul>
<p>.imp/.impl/.tpp</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>模板定义</p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/38402525/difference-between-h-files-and-inc-files-in-c">stackoverflow</a></p>
</li>
</ul>
<h3 id="Learning-Basics">Learning Basics</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/beginners_guide.html">hacking cpp</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/?view=msvc-170">cpp microsoft</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/cpp/cpp/cpp-language-reference?view=msvc-170">modern cpp microsoft</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.learncpp.com/">learncpp</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/509466763?utm_campaign=shareopn&amp;utm_medium=social&amp;utm_oi=929703030027243520&amp;utm_psn=1628093059283038208&amp;utm_source=wechat_session">大 C 小 C 整理的基础语法</a></p>
</li>
</ul>
<h4 id="assert">assert</h4>
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/vj1eh4f8M">assert</a> 可以结合说明，给出运行时更多信息。</p>
<h4 id="Namespace">Namespace</h4>
<p>命名空间除了避免命名冲突外，还有以下特殊使用方法 <a target="_blank" rel="noopener" href="https://www.learncpp.com/cpp-tutorial/unnamed-and-inline-namespaces/"><sup>1</sup></a></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/W155zz87P">unnamed namespace</a>：用于分类只属于当前给定文件的实现。</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/c8MaGfWe6">inline namespacce</a>：用于设定上一级命名空间的默认版本。</p>
</li>
</ul>
<h4 id="Template">Template</h4>
<h4 id="static-assert">static assert</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>static assert for equality type</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 std::is_same, std::is_same_v, decltype, declval, std::decy, std::decy_t</span></span><br><span class="line"><span class="comment">// \tparam R 一个模板类型</span></span><br><span class="line"><span class="comment">// \tparam Policy 另一个模板类型</span></span><br><span class="line"><span class="comment">// \tparam Args a parameter pack 参数包</span></span><br><span class="line"><span class="built_in">static_assert</span>(</span><br><span class="line">    std::is_same_v&lt; <span class="comment">// 比较类型是否相等 trait</span></span><br><span class="line">        std::<span class="type">decay_t</span>&lt;R&gt;, <span class="comment">// 获取对应无限定符修饰的类型</span></span><br><span class="line">        std::<span class="type">decay_t</span>&lt; <span class="comment">// 获取表达式无限定符修饰类型</span></span><br><span class="line">            <span class="keyword">decltype</span>(</span><br><span class="line">                <span class="built_in">static_cast</span>&lt;Policy*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">PolicyImpl</span>(</span><br><span class="line">                    std::forward&lt;Args&gt;(args)...</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">        &gt;</span><br><span class="line">    &gt;,</span><br><span class="line">    <span class="string">"R must be same as  the return type of PolicyImpl"</span>);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Fold-expressions">Fold expressions</h4>
<p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/fold">Fold expressions</a> 折叠表达式在 c++17 引入，用于避免需要为模板写多个版本以使用可变模板参数及编译效率。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">SumCpp11Version</span><span class="params">()</span></span>{ <span class="comment">// no parameter version</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span>... T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">SumCpp11Version</span><span class="params">(T1 s, T... ts)</span></span>{ <span class="comment">// recursive version for every param</span></span><br><span class="line">    <span class="keyword">return</span> s + <span class="built_in">SumCpp11Version</span>(ts...);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>使用折叠表达式，书写更简便，且有利于编译器模板实例化：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ...Args&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum</span><span class="params">(Args ...args)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> (args + ... + <span class="number">0</span>); <span class="comment">// with initial value 0</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// or even:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ...Args&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum2</span><span class="params">(Args ...args)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> (args + ...);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>使用参考<a target="_blank" rel="noopener" href="https://cppinsights.io/s/7f9603b6">示例</a></p>
<p>折叠表达式展开到参数包如下：</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>展开</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(... op pack)</code></td>
<td><code>((pack1 op pack2) op ...) op packN</code></td>
</tr>
<tr>
<td><code>(init op ... op pack)</code></td>
<td><code>(((init op pack1) op pack2) op ...) op packN</code></td>
</tr>
<tr>
<td><code>(pack op ...)</code></td>
<td><code>pack1 op (... op (packN-1 op packN))</code></td>
</tr>
<tr>
<td><code>(pack op ... op init)</code></td>
<td><code>pack1 op (... op (packN-1 op (packN op init)))</code></td>
</tr>
</tbody>
</table>
<p>当 op 为如下操作时，空的参数包值自动推导为默认值:</p>
<table>
<thead>
<tr>
<th>Op</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;&amp;</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>||</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>,</code></td>
<td><code>void()</code></td>
</tr>
</tbody>
</table>
<p>这里是一个<a target="_blank" rel="noopener" href="https://godbolt.org/z/bcseTeWK7">实际代码示例</a>:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">foo_first</span><span class="params">(<span class="type">bool</span> apply_all = <span class="literal">false</span>, Args&amp;&amp;... args)</span> </span>{</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; ret;</span><br><span class="line">    ret.<span class="built_in">reserve</span>(<span class="keyword">sizeof</span>...(args)); <span class="comment">// performance with reservation capacity</span></span><br><span class="line">    (... || [&amp;ret, &amp;apply_all](<span class="keyword">auto</span>&amp;&amp; v) {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">foo_is_even</span>(v) ? ret.<span class="built_in">push_back</span>(v), apply_all ? <span class="literal">false</span> : <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    }(std::forward&lt;Args&gt;(args))); <span class="comment">// expanding with a lambda and perfect-forwarding way</span></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>相关参考</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4295.html">n4295</a> 和 <a target="_blank" rel="noopener" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2015/p0036r0.pdf">P0036R0</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.codingame.com/playgrounds/2205/7-features-of-c17-that-will-simplify-your-code/fold-expressions">CodinGame</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.tartanllama.xyz/exploding-tuples-fold-expressions/">tuple with fold expression</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://www.modernescpp.com/index.php/fold-expressions">morderncpp</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://iamsorush.com/posts/cpp-variadic-template/">iamsorush blog</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://toutiao.io/posts/hr3lc2m/preview">toutiao</a></p>
</li>
</ul>
<h4 id="require-C-20">require(C++20)</h4>
<!--
https://en.cppreference.com/w/cpp/language/constraints
 -->
<p>C++20 新增 <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/requires">require</a>，简化了模板复杂性，以更符合语义方式实现约束。</p>
<h5 id="可调对象">可调对象</h5>
<p>对<a target="_blank" rel="noopener" href="https://godbolt.org/z/c48G1YxE6">可调用对象</a>进行约束，需要分别对参数及返回值进行设置。</p>
<h4 id="std-variant-and-std-any">std::variant and std::any</h4>
<p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/variant">std::variant</a> 类型安全的 union。<br>
<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/any">std::any</a> 类型安全的实现 copy 语义的单值容器。</p>
<blockquote>
<p>[!TIP]<br>
使用这两个容器可以实现<a target="_blank" rel="noopener" href="https://godbolt.org/z/WoxnzjnvK">简单动态属性</a>。</p>
</blockquote>
<h4 id="Iterator-and-Tools">Iterator and Tools</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>std::next</p>
</li>
<li class="lvl-2">
<p>std::partition</p>
</li>
<li class="lvl-2">
<p>std::distance</p>
</li>
</ul>
<p>在 STL 中使用迭代器操作数据结构，进而实现算法是非常普遍的做法。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// quick sort</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> RandomIt&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quicksort</span><span class="params">(RandomIt first, RandomIt last)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (first == last) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">auto</span> pivot = *std::<span class="built_in">next</span>(first, std::<span class="built_in">distance</span>(first,last)/<span class="number">2</span>);</span><br><span class="line">    RandomIt middle1 = std::<span class="built_in">partition</span>(first, last, [pivot](<span class="type">const</span> <span class="keyword">auto</span>&amp; em){ <span class="keyword">return</span> em &lt; pivot; });</span><br><span class="line">    RandomIt middle2 = std::<span class="built_in">partition</span>(middle1, last, [pivot](<span class="type">const</span> <span class="keyword">auto</span>&amp; em){ <span class="keyword">return</span> !(pivot &lt; em); });</span><br><span class="line">    <span class="built_in">quicksort</span>(first, middle1);</span><br><span class="line">    <span class="built_in">quicksort</span>(middle2, last);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> RandomIt&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sort</span><span class="params">(RandomIt first, RandomIt last)</span> </span>{</span><br><span class="line">    <span class="built_in">quicksort</span>(first, last);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="容器Container">容器 Container</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/container">https://zh.cppreference.com/w/cpp/container</a></p>
</li>
</ul>
<h3 id="并发thread">并发 thread</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/thread">https://zh.cppreference.com/w/cpp/thread</a></p>
</li>
</ul>
<h4 id="sharing-data">sharing data</h4>
<p><strong>the Risk of mutexes</strong>: <a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/the-risk-of-mutexes/">https://www.modernescpp.com/index.php/the-risk-of-mutexes/</a></p>
<p><strong>Prefer to mutex</strong>: <a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/prefer-locks-to-mutexes/">https://www.modernescpp.com/index.php/prefer-locks-to-mutexes/</a></p>
<h3 id="API-Design">API Design</h3>
<p>“Make interfaces easy to use correctly and hard to use incorrectly.—Scott Meyers”。这很容易达成一致，但很难遵循。这里提供一些技巧来如何改进的 API，避免接口增长带来的陷阱。</p>
<h4 id="Better-naming">Better naming</h4>
<p>使用更表意的命名方式，命名非常困难，但能让事情变简单。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_data</span><span class="params">(<span class="type">unsigned</span> value)</span> </span>{</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">"Distance is {} meters\n"</span>, value);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">auto</span> distance_mk=<span class="number">3</span>;</span><br><span class="line"><span class="built_in">print_data</span>(distance_km); <span class="comment">// 歧义调用，这里原意只让打印 meters</span></span><br><span class="line"><span class="built_in">print_data</span>(distance_km*<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_distance</span><span class="params">(<span class="type">unsigned</span> distance_in_meters)</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Use-strong-types">Use strong types</h4>
<p>使用健壮的类型，尽量保证在编译或运行给出更多信息，健壮的类型不完全检测包括：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/foonathan/type_safe">检测类型</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/joboccara/NamedType">值校验</a></p>
</li>
<li class="lvl-2">
<p>…</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;NamedType/named_type.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> Meter= fluent::NamedType&lt;unsgined, <span class="keyword">struct</span> MeterTag&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_distance</span><span class="params">(Meter distance)</span> </span>{</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">"Distance is {} meters\n"</span>, distance.<span class="built_in">get</span>());</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">auto</span> distance_meters=<span class="number">3000</span>;</span><br><span class="line"><span class="built_in">print_distance</span>(<span class="built_in">Meter</span>(distance_meters)); <span class="comment">//  ok</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print_distance</span>(<span class="number">3000</span>); <span class="comment">// won't compile</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Avoid-easily-swappable-params">Avoid easily swappable params</h4>
<p>避免两个类型相等的参数很容易错用，注释不如实际类型使用安全。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good 每个参数都能清楚表达应有的含义</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">visitor</span> {<span class="comment">/**/</span>}</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Direction</span> {Forward,Backward };</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Config</span>{</span><br><span class="line">    <span class="type">bool</span> ignore_x {<span class="literal">false</span>};</span><br><span class="line">    <span class="type">bool</span> ignore_y {<span class="literal">false</span>};</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span>{</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">walk</span><span class="params">(visitor v, Direction direction,Config config)</span></span>{}</span><br><span class="line">}</span><br><span class="line">visitor my_visitor;</span><br><span class="line">Config config;</span><br><span class="line">config.ignore_y = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Graph</span>().<span class="built_in">walk</span>(my_visitor, Direction::Backward, config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// bad 存在 3 个 bool 参数，可能造成调用错误且造成 api 不容易使用</span></span><br><span class="line"><span class="comment">// void walk(visitora v,bool is_backward, bool ignore_x, bool ignore_y){}</span></span><br><span class="line"><span class="comment">// Graph().walk(my_visitor, false, true, false);</span></span><br></pre></td></tr></tbody></table></figure>
<p>避免相同类型设置为函数签名的参数，除了惯用表达外。更健全的类型能在让编译器更易报错</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Enum class to the rescue</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">truncate</span> {off,on};</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">pad</span> {off,on};</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">fill</span> {off,on};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(std::string_view str, truncate truncate_, pad pad_, fill fill_)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">main</span>(){</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"hello"</span>, truncate::on, pad::on, fill::on);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/rb7TvhGc9">fopen API 合理重写</a></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> FilePtr = std:unique_ptr&lt;FILE,<span class="keyword">decltype</span>([](FILE *f){<span class="built_in">fclose</span>(f);})&gt;</span><br><span class="line"></span><br><span class="line">[[nodiscard]] FilePtr <span class="built_in">fopen</span>(<span class="type">const</span> std:filesystem:path &amp;path,</span><br><span class="line">                            std:string view mode);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Carefully-think-about-intent">Carefully think about intent</h4>
<p>接口设计要紧贴真实用户意图，关注调用 api 方的可能的行为。</p>
<h4 id="nodiscard"><code>[[nodiscard]]</code></h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/xvrjhjGdK">Functions</a></p>
</li>
</ul>
<p>Instructs the compiler to generate a warning if a return value is dropped.  Can be applied to types or function declarations.</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/ad444nqqW">Lambda</a></p>
</li>
</ul>
<p>C++23 fixes a minor loophole in the standard and now allows <code>[[nodiscard]]</code> with lambdas.</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/Gdv8YsMcG">Types</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/x5e87r7Ka">Constructors in C++20</a></p>
</li>
</ul>
<p>Summary</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Can have a message to explain the error <code>[[nodiscard("Lock objects should never be discarded")]]</code></p>
</li>
<li class="lvl-2">
<p>Should be used extensively.Any non-mutating (getter/accessor/const)</p>
</li>
<li class="lvl-2">
<p>function should be <code>[[nodiscard]]</code></p>
</li>
<li class="lvl-2">
<p>Can be checked enforced with static analysis</p>
</li>
</ul>
<h4 id="noexcept"><code>noexcept</code></h4>
<p><code>noexcept</code> notifies the user (and compiler)that a function may not throw an exception.If an exception is thrown from that function, <a target="_blank" rel="noopener" href="https://godbolt.org/z/P1EjKbMsc"><code>terminate</code> MUST be called</a>.</p>
<h4 id="Never-Return-a-Raw-Pointer">Never Return a Raw Pointer</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>It simply raises too many questions.Who owns it?Who deletes it?Is it a singleton global?</p>
</li>
<li class="lvl-2">
<p>Consider owning_ptr, non_owning_ptror some kind of wrapper to document intent,if you must.</p>
</li>
</ul>
<h4 id="Consistent-Error-Handling">Consistent Error Handling</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>Use one consistent method of reporting errors in your library</p>
</li>
<li class="lvl-2">
<p>Strongly avoid out-of-band error reporting <code>(get_last_error() or errno ）</code></p>
</li>
<li class="lvl-2">
<p>Make errors impossible to ignore(no returning an error code!)</p>
</li>
<li class="lvl-2">
<p>Never use std:optional&lt;&gt;to indicate an error condition.(it does not convey a reason, and the reason becomes out of bound).</p>
</li>
<li class="lvl-2">
<p>Consider std::expected&lt;&gt;(C++23) or similar.</p>
</li>
</ul>
<h4 id="Avoid-Implicit-Conversions">Avoid Implicit Conversions</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>std::filesystem::path and std::string-view appear to be strongly typed but are not</p>
</li>
<li class="lvl-2">
<p>Implicit conversions between const char*,string,string_view,and path break type safety</p>
</li>
<li class="lvl-2">
<p>Conversion operators and single parameter constructors (including variadic and ones with default parameters)should beexplicit</p>
</li>
</ul>
<h4 id="delete-Problematic-Overloads">=delete Problematic Overloads</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>Any function can be =deleted</p>
</li>
<li class="lvl-2">
<p>If you =delete a template, it will become the match for any non-exact parameter, and prevent implicit conversions.</p>
</li>
</ul>
<h4 id="Guideline-for-Design-Classes-easy-change-and-extensions">Guideline for Design Classes: easy change and extensions</h4>
<p>Design class fundamental principles</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Single-Responsibility Principle(SRP) - simplify changes</p>
</li>
<li class="lvl-2">
<p>Open-Closed Principle(OCP) - simplify the extensions</p>
</li>
<li class="lvl-2">
<p>Don’t Repeat Yourself(DRY) - simplify change</p>
</li>
</ul>
<p>A strategy-based solution(Separate the structure from the single behavior, and then broker the single behavior with a policy)</p>
<blockquote>
<p>Resist the urge to put everything into one class. Separate concerns!<br>
If you use OO programming, use it properly.</p>
</blockquote>
<p>The Single behavior can be implemented with:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>a class family with inheritance.(90s+ or 00s+)</p>
</li>
<li class="lvl-2">
<p>a template class.(c++11+)</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DrawStrategy&gt; <span class="comment">// &lt;--- SRP</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Circle</span>(<span class="type">double</span> rad)</span><br><span class="line">      : radius{rad}</span><br><span class="line">        , <span class="comment">//..Remaining data members</span></span><br><span class="line">        {}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getRadius</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line">    <span class="comment">// ... getCenter(),getRotation(),...</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="comment">/*...*/</span>)</span> <span class="type">const</span> <span class="keyword">override</span> </span>{</span><br><span class="line">        DrawStrategy{}(<span class="keyword">this</span>, <span class="comment">/*...*/</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(<span class="comment">/*...*/</span>)</span><span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius;</span><br><span class="line">    <span class="comment">// ... Remaining data members</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>a callback function(eg. std::function)(c++11+)</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>;</span><br><span class="line"><span class="keyword">using</span> DrawCircleStrategy = std::function&lt;<span class="built_in">void</span>(Circle <span class="type">const</span> &amp;)&gt;; <span class="comment">// &lt;--- SRP</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Circle</span>(<span class="type">double</span> rad, DrawCircleStrategy strategy) <span class="comment">// &lt;--- Dependency Injection</span></span><br><span class="line">      : radius{rad}, <span class="comment">//..Remaining data members</span></span><br><span class="line">        drawing{std::<span class="built_in">move</span>(strategy)} {}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getRadius</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line">    <span class="comment">// ... getCenter(),getRotation(),...</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="comment">/*...*/</span>)</span> <span class="type">const</span> <span class="keyword">override</span> </span>{</span><br><span class="line">        <span class="built_in">drawing</span>(<span class="keyword">this</span>, <span class="comment">/*...*/</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(<span class="comment">/*...*/</span>)</span><span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius;</span><br><span class="line">    <span class="comment">// ... Remaining data members</span></span><br><span class="line">    DrawCircleStrategy drawing;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>The template method-based solution(Non-Virtual Interface Idoim(NVI))</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>separated concerns and simplified changed(SRP).</p>
</li>
<li class="lvl-2">
<p>enabled internal changes with no impact on callers.</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PersistenceInterface</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="built_in">PersistenceInterface</span>();</span><br><span class="line">     <span class="keyword">virtual</span> ~<span class="built_in">PersistenceInterface</span>();</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="type">bool</span> <span class="title">write</span><span class="params">( <span class="type">const</span> Blob&amp; blob )</span> </span>{ <span class="comment">// &lt;--- NVI</span></span><br><span class="line">         <span class="built_in">LOG_INFO</span>( <span class="string">"PersistenceInterface::write( Blob ), name = "</span> &lt;&lt;</span><br><span class="line">             blob.<span class="built_in">name</span>() &lt;&lt; <span class="string">": starting..."</span> );</span><br><span class="line">         <span class="keyword">if</span> ( blob.<span class="built_in">name</span>().<span class="built_in">empty</span>() ) {</span><br><span class="line">             <span class="built_in">LOG_ERROR</span>( <span class="string">"PersistenceInterface::write( Blob ): Attempt to"</span></span><br><span class="line">                 <span class="string">" write unnamed blob failed"</span> );</span><br><span class="line">             <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">         }</span><br><span class="line">         <span class="type">const</span> <span class="keyword">auto</span> start = std::chrono::<span class="built_in">high_resolution_clock</span>()::<span class="built_in">now</span>();</span><br><span class="line">         <span class="type">const</span> <span class="type">bool</span> success = <span class="built_in">doWrite</span>( blob ); <span class="comment">// call the actual implementation</span></span><br><span class="line">         <span class="type">const</span> <span class="type">uint32_t</span> time = std::chrono::high_resolution_clock::<span class="built_in">now</span>() - start;</span><br><span class="line">         <span class="built_in">LOG_INFO</span>( <span class="string">"PersistenceInterface::write( Blob ), name = "</span> &lt;&lt;</span><br><span class="line">             blob.<span class="built_in">name</span>() &lt;&lt; <span class="string">": Writing blob of size "</span> &lt;&lt; blob.<span class="built_in">size</span>() &lt;&lt;</span><br><span class="line">             <span class="string">" bytes "</span> &lt;&lt; ( success ? <span class="string">"succeeded"</span> : <span class="string">"failed"</span> ) &lt;&lt; <span class="string">" in"</span></span><br><span class="line">             <span class="string">"duration = "</span> &lt;&lt; time.<span class="built_in">count</span>() &lt;&lt; <span class="string">"ms"</span> );</span><br><span class="line">         <span class="keyword">return</span> success;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span>: <span class="comment">// protected?</span></span><br><span class="line">     <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">doWrite</span><span class="params">( <span class="type">const</span> Blob&amp; blob )</span> </span>= <span class="number">0</span>;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Design for testability. How to test a private member?</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>#define private public. No</p>
</li>
<li class="lvl-2">
<p>Make the test a friend. Maybe</p>
</li>
<li class="lvl-2">
<p>Make the member public. No</p>
</li>
<li class="lvl-2">
<p>Derive the test class from the tested class. Maybe</p>
</li>
<li class="lvl-2">
<p>Separate concerns. Recommended</p>
<ul class="lvl-2">
<li class="lvl-4">Move the member into a private namespace …</li>
<li class="lvl-4">… or into another class (as a separate service).</li>
</ul>
</li>
<li class="lvl-2">
<p>Using gmock to define some <code>MOCK_METHOD</code> to access to private members.</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;</span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">T</span>,</span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">Allocator</span> = std::allocator&lt;T&gt;</span><br><span class="line">&gt; <span class="keyword">class</span> vector;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt; <span class="keyword">class</span> ForwardIt &gt;</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">destroy</span><span class="params">( ForwardIt first, ForwardIt last )</span></span>; <span class="comment">// isolated scopes</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Resource-Management">Resource Management</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>If you can avoid defining default operations, do <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/rule_of_three">The Rule of 0</a>.</p>
</li>
<li class="lvl-2">
<p>Core Guideline C.32: If a class has a raw pointer (T*) or reference (T&amp;), consider whether it might be owning.</p>
</li>
<li class="lvl-2">
<p>Core Guideline C.33: If a class has an owning pointer member, define a destructor.</p>
</li>
<li class="lvl-2">
<p>Core Guideline R.3: A raw pointer (a T*) is non-owning</p>
</li>
<li class="lvl-2">
<p><a href="#idioms-c">RAII</a> is the most important idioms.</p>
</li>
<li class="lvl-2">
<p>Core Guideline C.21: If you define or =delete any default operation,<br>
define or =delete them all. Manager resources can be possessed by samrt pointers.</p>
<ul class="lvl-2">
<li class="lvl-4">std::unique_ptr(<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/rule_of_three">The Rule of 5</a>)</li>
<li class="lvl-4">std::shared_ptr(<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/rule_of_three">The Rule of 5/0</a>)</li>
</ul>
</li>
</ul>
<h4 id="Data-Member-Initialization">Data Member Initialization</h4>
<p>Obeying to <a target="_blank" rel="noopener" href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rc-ctor">Cpp Core Guideline</a></p>
<h4 id="Prefer-Free-Function">Prefer Free Function</h4>
<p>设计功能接口在大多数时候应该使用非成员函数（<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=WLDT1lDOsb4">free function</a>）</p>
<p>接口设计基本规则遵循：</p>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if(f needs to be virtual)</span><br><span class="line">    make f a member function of C;</span><br><span class="line">else if (f is operator &gt;&gt; or operator&lt;&lt; or</span><br><span class="line">        f needs type conversion on its left-most argument)</span><br><span class="line">{</span><br><span class="line">    make f a non-member function;</span><br><span class="line">    if(f needs access to non-public members of C)</span><br><span class="line">        make f a friend of C;</span><br><span class="line">}</span><br><span class="line">else if(f can be-implemented via C's public interface)</span><br><span class="line">    make f a non-member function;</span><br><span class="line">else</span><br><span class="line">    make f a member function of C;</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=zL-vn_pGGgY">jason api design</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=motLOioLJfg&amp;t=64s">klaus lglberger</a></p>
</li>
</ul>
<h4 id="Encapsulate-in-namespace">Encapsulate in namespace</h4>
<p>使用 Namespace 封装隔离，避免命名冲突</p>
<h4 id="Use-std-string-view">Use std::string_view</h4>
<p>使用 std::string_view 提供了一种更安全、更灵活的方式来处理字符串文字，它允许编译时评估，避免潜在的缓冲区溢出，并提供方便的接口来处理字符串</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> std::string_view cnt = <span class="string">"abc"</span>; <span class="comment">// instead of inline const std::string or inline const char*</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Make-constants-in-configuration">Make constants in configuration</h4>
<p>将常量配置配置为读取配置解析获取，避免重复编译.</p>
<h4 id="Comment-the-purpose-and-usage">Comment the purpose and usage</h4>
<p>对代码补充目的性的注释和用法示例，增加可读性.</p>
<h4 id="Use-byte-array-or-data-structure">Use byte array or data structure</h4>
<p>使用字节数组或数据结构表达十六进制流.</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::array&lt;<span class="type">uint8_t</span>,4&gt; bytes{<span class="number">0x1</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x4</span>};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Seal-coupled-parameters">Seal coupled parameters</h4>
<p>但传递的参数时描述一个东西时，考虑将其封装为一个结构。常见的用法是将 buffer 和长度作为参数，此时可考虑将其封装为一个结构或<a target="_blank" rel="noopener" href="https://www.sandordargo.com/blog/2024/11/06/std-span">使用 std::span</a>.</p>
<h4 id="Seal-too-many-defaults">Seal too many defaults</h4>
<p>将过多的参数封装为结构体，增加可读性.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=gV7jhTMYkKc">https://www.youtube.com/watch?v=gV7jhTMYkKc</a></p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">server</span>{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">config</span>{</span><br><span class="line">        <span class="type">uint16_t</span> port;</span><br><span class="line">        <span class="type">bool</span> tcp = <span class="literal">true</span>;</span><br><span class="line">        std::string_view address = <span class="string">"0.0.0.0"</span>;</span><br><span class="line">        std::optional&lt;std::string_view&gt; multicast = std::<span class="literal">nullopt</span>;</span><br><span class="line">        <span class="type">bool</span> nonblocking = <span class="literal">true</span></span><br><span class="line">    };</span><br><span class="line">    <span class="built_in">server</span>(config);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="built_in">main</span>(){</span><br><span class="line">    <span class="comment">// require c++20</span></span><br><span class="line">    <span class="function">server <span class="title">s</span><span class="params">({.port = <span class="number">1666</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            .tcp = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            .address = <span class="string">"127.0.0.1"</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            .nonblocking = <span class="literal">false</span>})</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Must-be-initialized">Must be initialized</h4>
<p>C++20 提供了结构体命名委托初始化器，若没有传参数，gcc -Wextra 给出警告，clang/msvc 不做检查，所以有必要对类型设置必须初始化约束.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=gV7jhTMYkKc">https://www.youtube.com/watch?v=gV7jhTMYkKc</a></p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">must_init</span>{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// no default constructor</span></span><br><span class="line">    <span class="built_in">must_init</span>(T t): <span class="built_in">value</span>(std::<span class="built_in">move</span>(t)) {}</span><br><span class="line">    <span class="keyword">operator</span> T&amp;() { <span class="keyword">return</span> value; }</span><br><span class="line">    <span class="keyword">operator</span> <span class="type">const</span> T&amp;() <span class="type">const</span> { <span class="keyword">return</span> value; }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T value;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">server</span>{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">config</span>{</span><br><span class="line">        must_init&lt;<span class="type">uint16_t</span>&gt; port; <span class="comment">// failure to init is now a compiler error</span></span><br><span class="line">        <span class="type">bool</span> tcp = <span class="literal">true</span>;</span><br><span class="line">        std::string_view address = <span class="string">"0.0.0.0"</span>;</span><br><span class="line">        std::optional&lt;std::string_view&gt; multicast = std::<span class="literal">nullopt</span>;</span><br><span class="line">        <span class="type">bool</span> nonblocking = <span class="literal">true</span></span><br><span class="line">    };</span><br><span class="line">    <span class="built_in">server</span>(config);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Create-Unique-type-with-enum-for-Integer-types">Create Unique type with enum for Integer types</h4>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">server_id</span>: <span class="type">int</span> {};</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">client_id</span>: <span class="type">int</span> {};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Error-Handling-Strategies">Error Handling Strategies</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://johnfarrier.com/c-error-handling-strategies-benchmarks-and-performance/">https://johnfarrier.com/c-error-handling-strategies-benchmarks-and-performance/</a></p>
</li>
</ul>
<h3 id="Design-Pattern">Design Pattern</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLalVdRk2RC6otl3oBU2cn-P6DWi1y1PS3">https://www.youtube.com/playlist?list=PLalVdRk2RC6otl3oBU2cn-P6DWi1y1PS3</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/431714886">https://zhuanlan.zhihu.com/p/431714886</a></p>
</li>
</ul>
<!-- todo -->
<h3 id="Idioms-C">Idioms C++</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/table-of-content/#top">mordernescpp.com</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%9F%BA%E6%96%BC%E5%8E%9F%E5%89%87%E8%A8%AD%E8%A8%88">基於原則設計</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://en.wikibooks.org/wiki/Category:Book:More_C%2B%2B_Idioms">More C++ Idioms</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://en.wikibooks.org/w/index.php?title=More_C%2B%2B_Idioms/Print_Version&amp;oldid=2452097&amp;diff=cur&amp;diffonly=0">https://en.wikibooks.org/w/index.php?title=More_C%2B%2B_Idioms/Print_Version&amp;oldid=2452097&amp;diff=cur&amp;diffonly=0</a></p>
</li>
</ul>
<h4 id="X-Macro">X Macro</h4>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X_Macro">X macro</a> 是一种可靠地维护并行代码和 / 或数据列表的技术，其对应的项必须以相同的顺序声明或执行，例如，列表元素的定义在 <code>.inl</code> 文件中 <a target="_blank" rel="noopener" href="https://godbolt.org/z/G19vMWTPe">示例</a>。</p>
<h4 id="RAII-Resource-Acquisition-Is-Initialization">RAII-Resource Acquisition Is Initialization</h4>
<p>资源获取即初始化 （简称 <a target="_blank" rel="noopener" href="https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Resource_Acquisition_Is_Initialization">RAII</a> ）是 C++ 防止内存泄露一个很好解决方案，它结合构造函数和析构函数，把资源生命周期和对象生命周期绑定起来，在构造函数中获取资源（这些错误会引发异常），然后将其释放到析构函数中（永不抛出），并且不需要显式清理，从而防止忘记释放资源；<a target="_blank" rel="noopener" href="https://godbolt.org/z/46nrYGhsc">参考示例</a>。</p>
<h4 id="Thread-safe-singleton">Thread-safe singleton</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/thread-safe-initialization-of-a-singleton/">https://www.modernescpp.com/index.php/thread-safe-initialization-of-a-singleton/</a></p>
</li>
</ul>
<h4 id="Policy-based-class-Design">Policy-based class Design</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://www.modernescpp.com/index.php/policy-and-traits">mordernescpp policy-and-traits</a>。</p>
</li>
</ul>
<p>基于策略设计又名 policy-based class design 是一种基于 C<ins> 计算机程序设计模式，以策略（Policy）为基础，并结合 C</ins> 的模板元编程。就是将原本复杂的系统，拆解成多个独立运作的 “策略类别”，每一组 policy class 都只负责单纯如行为或结构的某一方面。多重继承由于继承自多组 Base Class，故缺乏型别消息，而 Templetes 基于型别，拥有丰富的型别消息。多重继承容易扩张，而 Templetes 的特化不容易扩张。Policy-Based Class Design 同时使用了 Template 以及 Multiple Inheritance 两项技术，结合两者的优点，看下面例子：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Policy1</span>, <span class="keyword">class</span> <span class="title class_">Policy2</span>, <span class="keyword">class</span> <span class="title class_">Policy3</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PolicyBasedClass</span> : <span class="keyword">public</span> Policy1, <span class="keyword">public</span> Policy2, <span class="keyword">public</span> Policy3 {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PolicyBasedClass</span>(){};</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>PolicyBasedClass 则称为宿主类别（host class），只需要切换不同 Policy Class，就可以得到不同的需求。Policy 不一定要被宿主（host）继承，只需要用委托（delegation）完成这一工作。但 policies 必须遵守一个隐含的 constraint，接口（interface）必须一样，故参数不能有巨大改变。</p>
<p>Policy class 有点类似回调函数（callbacks），但不同的是，callback 只是一个函数，至于 policy class 则尽可能包含许多的 functions (methods), 有时还会结合状态变量（state variables）与其他各式各样的类型，如嵌套类型（nested types）。</p>
<p>policy 的一个重要的特征是，宿主类别（host class）经常（并不一定要）使用多重继承的机制去使用多个 policy classes. 因此在进行 policy 拆解时，必须要尽可能达成正交分解（Orthogonal Decomposition），policy 彼此独立运作，不相互影响。</p>
<h5 id="Template-Template-Parameter">Template Template Parameter</h5>
<p>在 C++ 的 Policy-Based Design 中，用来建构 Template 的类别参数（也就是 policy class），本身亦可以是一个 Template 化的类别，形成所谓的 Template Template Parameter。</p>
<p>如果 Read ()、Write () 有各种不同类型的参数时，可以利用 template 的不完全具现化 (Incomplement Instantiation) 特征检实现各个参数不同的成员函数（member function）。在 host class 中，可以撰写不同参数版本的 Read (…) 函数，这有赖于 c++ compiler 的协助。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span></span><br><span class="line">&lt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">T</span>,</span><br><span class="line">    <span class="keyword">template</span>&lt; <span class="keyword">class</span> &gt; <span class="keyword">class</span> <span class="title class_">ReadPolicy</span>,</span><br><span class="line">    <span class="keyword">template</span>&lt; <span class="keyword">class</span> &gt; <span class="keyword">class</span> <span class="title class_">WritePolicy</span></span><br><span class="line">&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResourceManager</span></span><br><span class="line">    :</span><br><span class="line">    <span class="keyword">public</span> ReadPolicy&lt; T &gt;,</span><br><span class="line">    <span class="keyword">public</span> WritePolicy&lt; T &gt;</span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">Read</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">Write</span><span class="params">(XmlElement*)</span></span>;</span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">Write</span><span class="params">(DataSource*)</span></span>;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  ResourceManager&lt; AnimationEntity, BinaryReader, BinaryWriter &gt; ResMgr1;</span><br><span class="line">  ResourceManager&lt; ScriptEntity, TextReader, TextWriter &gt; ResMgr2;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>上述的 class T 即是一个 Template Template Parameter，这使得 Policy Class 更具扩展性与弹性，能够处理各种类型的实体（instance）。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Hello World 简单示例</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;</span><br><span class="line">    <span class="keyword">typename</span> output_policy,</span><br><span class="line">    <span class="keyword">typename</span> language_policy</span><br><span class="line">&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorld</span></span><br><span class="line">  : <span class="keyword">public</span> output_policy,</span><br><span class="line">    <span class="keyword">public</span> language_policy</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">using</span> output_policy::Print;</span><br><span class="line">    <span class="keyword">using</span> language_policy::Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">//behaviour method</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="comment">//two policy methods</span></span><br><span class="line">        <span class="built_in">Print</span>( <span class="built_in">Message</span>() );</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorld_OutputPolicy_WriteToCout</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt; <span class="keyword">typename</span> message_type &gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">Print</span><span class="params">( message_type message )</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorld_LanguagePolicy_English</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">Message</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello, World!"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorld_LanguagePolicy_German</span>{</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">Message</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hallo Welt!"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line"><span class="comment">/* example 1 */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span></span><br><span class="line">        HelloWorld&lt;</span><br><span class="line">            HelloWorld_OutputPolicy_WriteToCout,</span><br><span class="line">            HelloWorld_LanguagePolicy_English</span><br><span class="line">        &gt;</span><br><span class="line">            my_hello_world_type;</span><br><span class="line"></span><br><span class="line">    my_hello_world_type hello_world;</span><br><span class="line">    hello_world.<span class="built_in">Run</span>(); <span class="comment">//returns Hello World!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* example 2</span></span><br><span class="line"><span class="comment"> * does the same but uses another policy, the language has changed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span></span><br><span class="line">        HelloWorld&lt;</span><br><span class="line">            HelloWorld_OutputPolicy_WriteToCout,</span><br><span class="line">            HelloWorld_LanguagePolicy_German</span><br><span class="line">        &gt;</span><br><span class="line">            my_other_hello_world_type;</span><br><span class="line"></span><br><span class="line">    my_other_hello_world_type hello_world2;</span><br><span class="line">    hello_world<span class="number">2.</span><span class="built_in">Run</span>(); <span class="comment">//returns Hallo Welt!</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>后续可以更容易的撰写其他的 Output policy, 单靠创造更新的 Policy class 并实现 print 于其中。</p>
<h4 id="Pimpl-Pointer-to-implementation">Pimpl - Pointer to implementation</h4>
<p><a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/language/pimpl">Pimpl</a> 是一种广泛使用的削减编译依赖项的技术，具体讨论<a target="_blank" rel="noopener" href="https://herbsutter.com/gotw/_100/">参考</a>，看下面例子可能就明白了：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cppreference 官方示例</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;experimental/propagate_const&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------</span></span><br><span class="line"><span class="comment">// 接口（widget.h）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">widget</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">impl</span>; <span class="comment">// 实现类的前置声明</span></span><br><span class="line">    std::experimental::propagate_const&lt; <span class="comment">// 转发 const 的指针包装器</span></span><br><span class="line">        std::unique_ptr&lt; <span class="comment">// 唯一所有权的不透明指针</span></span><br><span class="line">            impl&gt;&gt; pImpl; <span class="comment">// 指向前置声明的实现类</span></span><br><span class="line"><span class="keyword">public</span>: <span class="comment">// 公开成员</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span></span>; <span class="comment">// 公开 API，将被转发给实现</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">shown</span><span class="params">()</span> <span class="type">const</span> </span>{ <span class="keyword">return</span> <span class="literal">true</span>; } <span class="comment">// 公开 API，实现必须调用它</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">widget</span>(<span class="type">int</span>);</span><br><span class="line">    ~<span class="built_in">widget</span>(); <span class="comment">// 在实现文件中定义，其中 impl 是完整类型</span></span><br><span class="line">    <span class="built_in">widget</span>(widget&amp;&amp;); <span class="comment">// 在实现文件中定义</span></span><br><span class="line">                      <span class="comment">// 注意：在被移动的对象上调用 draw() 是未定义行为</span></span><br><span class="line">    <span class="built_in">widget</span>(<span class="type">const</span> widget&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    widget&amp; <span class="keyword">operator</span>=(widget&amp;&amp;); <span class="comment">// 在实现文件中定义</span></span><br><span class="line">    widget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> widget&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------</span></span><br><span class="line"><span class="comment">// 实现（widget.cpp）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">widget</span>::impl</span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> n; <span class="comment">// 私有数据</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">const</span> widget&amp; w)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span>(w.<span class="built_in">shown</span>()) <span class="comment">// 对公开成员函数的此调用要求回溯引用</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">"正在绘制 const 组件 "</span> &lt;&lt; n &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">const</span> widget&amp; w)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span>(w.<span class="built_in">shown</span>())</span><br><span class="line">            std::cout &lt;&lt; <span class="string">"正在绘制非 const 组件 "</span> &lt;&lt; n &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">impl</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n) {}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">widget::draw</span><span class="params">()</span> <span class="type">const</span> </span>{ pImpl-&gt;<span class="built_in">draw</span>(*<span class="keyword">this</span>); }</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">widget::draw</span><span class="params">()</span> </span>{ pImpl-&gt;<span class="built_in">draw</span>(*<span class="keyword">this</span>); }</span><br><span class="line">widget::<span class="built_in">widget</span>(<span class="type">int</span> n) : pImpl{std::<span class="built_in">make_unique</span>&lt;impl&gt;(n)} {}</span><br><span class="line">widget::<span class="built_in">widget</span>(widget&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">widget::~<span class="built_in">widget</span>() = <span class="keyword">default</span>;</span><br><span class="line">widget&amp; widget::<span class="keyword">operator</span>=(widget&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------</span></span><br><span class="line"><span class="comment">// 用户（main.cpp）</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="function">widget <span class="title">w</span><span class="params">(<span class="number">7</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> widget <span class="title">w2</span><span class="params">(<span class="number">8</span>)</span></span>;</span><br><span class="line">    w.<span class="built_in">draw</span>();</span><br><span class="line">    w<span class="number">2.</span><span class="built_in">draw</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>此技巧用于构造拥有稳定 ABI 的 C++ 库接口，及减少编译时依赖。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://www.modernescpp.com/index.php/the-bridge-pattern">morderncpp</a>。</p>
</li>
</ul>
<h4 id="CRTP-The-curiously-recurring-template-pattern">CRTP -The curiously recurring template pattern</h4>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A5%87%E5%BC%82%E9%80%92%E5%BD%92%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F">CRTP</a> (奇异递归模板模式）是一种在编译期实现多态方法，是对运行时多态一种优化，多态是个很好的特性，但是动态绑定比较慢，因为要查虚函数表。而使用 CRTP，完全消除了动态绑定，降低了继承带来的虚函数表查询开销。</p>
<p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/crtp">CRTP cpp reference 示例</a> 包含：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>从模板类继承，</p>
</li>
<li class="lvl-2">
<p>使用派生类本身作为基类的模板参数。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __cpp_explicit_this_parameter <span class="comment">// Traditional syntax</span></span></span><br><span class="line"><span class="comment">// see https://cppinsights.io/s/82b200f2 from C++ insight result</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Derived</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> { <span class="function"><span class="type">void</span> <span class="title">name</span><span class="params">()</span> </span>{ (<span class="built_in">static_cast</span>&lt;Derived*&gt;(<span class="keyword">this</span>))-&gt;<span class="built_in">impl</span>(); } };</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D1</span> : <span class="keyword">public</span> Base&lt;D1&gt; { <span class="function"><span class="type">void</span> <span class="title">impl</span><span class="params">()</span> </span>{ std::<span class="built_in">puts</span>(<span class="string">"D1::impl()"</span>); } };</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D2</span> : <span class="keyword">public</span> Base&lt;D2&gt; { <span class="function"><span class="type">void</span> <span class="title">impl</span><span class="params">()</span> </span>{ std::<span class="built_in">puts</span>(<span class="string">"D2::impl()"</span>); } };</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">    Base&lt;D1&gt; b1; b<span class="number">1.</span><span class="built_in">name</span>();</span><br><span class="line">    Base&lt;D2&gt; b2; b<span class="number">2.</span><span class="built_in">name</span>();</span><br><span class="line">    D1 d1; d<span class="number">1.</span><span class="built_in">name</span>();</span><br><span class="line">    D2 d2; d<span class="number">2.</span><span class="built_in">name</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span> <span class="comment">// C++23 alternative syntax from https://godbolt.org/z/s1o6qTMnP</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> { <span class="function"><span class="type">void</span> <span class="title">name</span><span class="params">(<span class="keyword">this</span> <span class="keyword">auto</span>&amp;&amp; self)</span> </span>{ self.<span class="built_in">impl</span>(); } };</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D1</span> : <span class="keyword">public</span> Base { <span class="function"><span class="type">void</span> <span class="title">impl</span><span class="params">()</span> </span>{ std::<span class="built_in">puts</span>(<span class="string">"D1::impl()"</span>); } };</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D2</span> : <span class="keyword">public</span> Base { <span class="function"><span class="type">void</span> <span class="title">impl</span><span class="params">()</span> </span>{ std::<span class="built_in">puts</span>(<span class="string">"D2::impl()"</span>); } };</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">    D1 d1; d<span class="number">1.</span><span class="built_in">name</span>();</span><br><span class="line">    D2 d2; d<span class="number">2.</span><span class="built_in">name</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>这样做的目的是在基类中使用派生类。从基础对象的角度来看，派生对象本身就是对象，但是是向下转换的对象。因此，基类可以通过将 static_cast 自身放入派生类来访问派生类.</p>
<p>实现简单策略调用示例</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义引线识别模板</span></span><br><span class="line"><span class="comment"> * @note 子类需要定义 PolicyImpl</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @tparam Policy 策略子类实现</span></span><br><span class="line"><span class="comment"> * @tparam R 返回类型约束</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Policy, <span class="keyword">typename</span> R&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LeadBasePolicy</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LeadBasePolicy</span>(<span class="type">const</span> DataPtr&amp; data, <span class="type">const</span> AiTextPtr&amp; ref_text)</span><br><span class="line">        : <span class="built_in">ref_text</span>(ref_text), <span class="built_in">data</span>(data) {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line">    <span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="comment">// 保留返回修饰限定</span></span><br><span class="line">    <span class="built_in">DoPolicy</span>(Args&amp;&amp;... args) {</span><br><span class="line">        <span class="built_in">static_assert</span>(</span><br><span class="line">            std::is_same_v&lt;</span><br><span class="line">                std::<span class="type">decay_t</span>&lt;R&gt;,</span><br><span class="line">                std::<span class="type">decay_t</span>&lt;</span><br><span class="line">                    <span class="keyword">decltype</span>(</span><br><span class="line">                        <span class="built_in">static_cast</span>&lt;Policy*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">PolicyImpl</span>(</span><br><span class="line">                            std::forward&lt;Args&gt;(args)...</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                &gt;</span><br><span class="line">            &gt;,</span><br><span class="line">            <span class="string">"R must be same as  the return type of PolicyImpl"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;Policy*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">PolicyImpl</span>(std::forward&lt;Args&gt;(args)...);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">const</span> AiTextPtr&amp; ref_text{};</span><br><span class="line">    <span class="type">const</span> DataPtr&amp; data{};</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述文本查找相对引线策略</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @code {.cpp}</span></span><br><span class="line"><span class="comment"> * auto line_ptr = TextLinePolicy(data,text).DoPolicy();</span></span><br><span class="line"><span class="comment"> * assert(line_ptr);</span></span><br><span class="line"><span class="comment"> * @endcode</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextLinePolicy</span> : <span class="keyword">public</span> LeadBasePolicy&lt;TextLinePolicy, AiLinePtr&gt; {</span><br><span class="line">    <span class="keyword">friend</span> LeadBasePolicy;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> LeadBasePolicy::LeadBasePolicy;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief 策略实际实现的文本关联线段搜索</span></span><br><span class="line"><span class="comment">     * PolicyImpl 可被子类重写，进行调用分发</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">AiLinePtr <span class="title">PolicyImpl</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">auto</span> line_ptr = <span class="built_in">RangeSearch</span>();</span><br><span class="line">        <span class="keyword">return</span> line_ptr ? line_ptr : <span class="built_in">NearSearch</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief 策略1，文本范围附近引线线段搜索</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">AiLinePtr <span class="title">RangeSearch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief 策略2，距离文本附近最近的三个条线搜索</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">AiLinePtr <span class="title">NearSearch</span><span class="params">()</span></span>;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="HAP-Handler-on-Aggregation-with-Polymorphism">HAP - Handler on Aggregation with Polymorphism</h4>
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/8hM8v93GM">HAP</a> 提供了一种方法如何在使用多态和虚方法时保持通用性和良好的性能，以及如何使用聚合。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>虚方法对集合整体分发一次。</p>
</li>
<li class="lvl-2">
<p>使用基于类策略模式简化策略 Handler 的调用。</p>
</li>
<li class="lvl-2">
<p>处理器 Handler 仅在运行时可知。</p>
</li>
</ul>
<h4 id="NVI-Non-Virtual-Interface">NVI - Non Virtual Interface</h4>
<p>仅暴露非虚方法接口，避免调用歧义.</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">HandlerBase</span> {</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(std::span&lt;Element&gt; elements)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span>(Element e : elements) {<span class="built_in">handle</span>(std::<span class="built_in">move</span>(e)); }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle</span><span class="params">(Element element)</span> </span>= <span class="number">0</span>;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Handler</span> : <span class="keyword">public</span> HandlerBase {</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Element element)</span> <span class="keyword">override</span></span>{}</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="MutextProtected">MutextProtected</h4>
<p>这里提供了一种 C++ 方式的并行访问数据加锁模式，通常通过 RAII 实现。</p>
<p>另见，<a target="_blank" rel="noopener" href="https://awesomekling.github.io/MutexProtected-A-C++-Pattern-for-Easier-Concurrency/">Andreas Kling - MutextProtected</a>、<a target="_blank" rel="noopener" href="https://github.com/facebook/folly/blob/main/folly/docs/Synchronized.md">Synchronized - folly</a>、<a target="_blank" rel="noopener" href="https://www.reddit.com/r/cpp/comments/12def1f/mutexprotected_a_c_pattern_for_easier_concurrency/">MutextProtected - reddit</a>。</p>
<h4 id="TEBI-Type-erease-better-than-inheritance">TEBI - Type erease better than inheritance</h4>
<p>在解耦，类型擦除更优于继承，避免了多重继承，导致依赖过多。</p>
<p>参考示例:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/ze8frr9oK">https://godbolt.org/z/ze8frr9oK</a></p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/37391884/answer/2740375441">https://www.zhihu.com/question/37391884/answer/2740375441</a></p>
</li>
</ul>
<h3 id="Dependency-Injection">Dependency Injection</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>抽离实际系统的简单的系统或部分功能。</p>
</li>
<li class="lvl-2">
<p>不适用于小项目</p>
</li>
<li class="lvl-2">
<p>暂时不关注，用于之后追加</p>
</li>
<li class="lvl-2">
<p>用于测试</p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=_UTgOC6jW8o">https://www.youtube.com/watch?v=_UTgOC6jW8o</a></p>
</li>
</ul>
<h4 id="基本流程">基本流程</h4>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Data in(Usage) -&gt; |Interface -&gt; Capture(Implementation) -&gt; Synthesize(Implementation) -&gt; |Interface -&gt; Results out(Usage)</span><br></pre></td></tr></tbody></table></figure>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122237604.png" alt="image"></p>
<h4 id="基本方法">基本方法</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>使用方法参数注入 Link-time（不建议使用）</p>
</li>
<li class="lvl-2">
<p>使用虚方法和继承</p>
</li>
<li class="lvl-2">
<p>使用模板</p>
</li>
<li class="lvl-2">
<p>使用类型擦除</p>
</li>
</ul>
<h5 id="方法参数">方法参数</h5>
<p>需要实现两次，一侧用于实际生产的代码，另一侧实现用于测试</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122321446.png" alt="image"></p>
<p>pros:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>对实际代码不改变</p>
</li>
<li class="lvl-2">
<p>允许一定范围的测试<br>
cons:</p>
</li>
<li class="lvl-2">
<p>难以管理，需要对测试的组件部分都写一遍</p>
</li>
<li class="lvl-2">
<p>违反 ODR/UB</p>
</li>
<li class="lvl-2">
<p>更像集成测试</p>
</li>
</ul>
<h5 id="使用虚方法和继承">使用虚方法和继承</h5>
<p>创建一个接口基类，或从存在的类继承</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>能处理很多接口</p>
</li>
<li class="lvl-2">
<p>易于理解的重写机制</p>
</li>
<li class="lvl-2">
<p>易于增加到原有的代码</p>
</li>
</ul>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122423034.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122133242.png" alt="image"></p>
<p>google mock 示例：<br>
<img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122539805.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122714872.png" alt="image"></p>
<h5 id="使用模板">使用模板</h5>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/122943427.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123058341.png" alt="image"></p>
<p>gmock 示例：<br>
<img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123117721.png" alt="image"></p>
<p>c++20 concept：<br>
<img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123153107.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123351709.png" alt="image"></p>
<h5 id="使用类型擦除">使用类型擦除</h5>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/123542806.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/124158424.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/124335397.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/124448163.png" alt="image"></p>
<h4 id="Dependency-Injection-Basic">Dependency Injection Basic</h4>
<h5 id="Setter-DI">Setter DI</h5>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/125543530.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/125638512.png" alt="image"></p>
<h5 id="Method-DI">Method DI</h5>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/125724490.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/130002008.png" alt="image"></p>
<h4 id="Constructor-DI">Constructor DI</h4>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/130050927.png" alt="image"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20241117/130127444.png" alt="image"></p>
<h3 id="Reflection">Reflection</h3>
<!--
todo
https://woboq.com/blog/reflection-in-cpp-and-qt-moc.html
https://github.com/woboq/verdigris
https://www.youtube.com/watch?v=DUiUBt-fqEY

https://chibash.github.io/public/opencxx/

http://www.vollmann.com/en/pubs/meta/index.html

https://herbsutter.com/2017/07/26/metaclasses-thoughts-on-generative-c/
 -->
<h3 id="lock-free">lock-free</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>原子操作 (atomic operation): <a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/atomic">atomic</a></p>
</li>
<li class="lvl-2">
<p>lock-free data structure</p>
</li>
<li class="lvl-2">
<p>内存顺序 (memory ordering): <a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/atomic/memory_order">memory_order</a></p>
</li>
<li class="lvl-2">
<p>原子标志 (atomic flag): <a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/atomic/atomic_flag">atomic_flag</a></p>
</li>
</ul>
<h3 id="ABI-C">ABI C++</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://maskray.me/blog/2020-11-08-stack-unwinding">https://maskray.me/blog/2020-11-08-stack-unwinding</a></p>
</li>
</ul>
<h4 id="unwind-exception-堆栈异常展开">unwind exception 堆栈异常展开</h4>
<p>这里介绍 C++ exception handling，stack unwinding 的一个应用。Exception handling 有多种 ABI (interoperability of C++ implementations)，其中应用最广泛的是 <a target="_blank" rel="noopener" href="https://itanium-cxx-abi.github.io/cxx-abi/abi-eh.html">Itanium C++ ABI: Exception Handling</a></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>reference</p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://maskray.me/blog/2020-12-12-c++-exception-handling-abi">https://maskray.me/blog/2020-12-12-c++-exception-handling-abi</a></li>
</ul>
</li>
</ul>
<h4 id="stack-unwind-堆栈展开">stack unwind 堆栈展开</h4>
<p>Stack unwinding 主要有以下作用：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>获取 stack trace，用于 debugger、crash reporter、profiler、garbage collector 等</p>
</li>
<li class="lvl-2">
<p>加上 personality routine 和 language specific data area 后实现 C++ exceptions (Itanium C++ ABI)。参见 <a target="_blank" rel="noopener" href="https://maskray.me/blog/2020-12-12-c++-exception-handling-abi">C++ exception handling ABI</a></p>
</li>
</ul>
<p>Stack unwinding 可以分成两类：</p>
<p>synchronous: 程序自身触发的，C++ throw、获取自身 stack trace 等。这类 stack unwinding 只发生在函数调用处 (在 function body 内，不会出现在 prologue/epilogue)<br>
asynchronous: 由 signal 或外部程序触发，这类 stack unwinding 可以发生在函数 prologue/epilogue</p>
<h4 id="MinGW-ABI">MinGW ABI</h4>
<p>How to Link MSVC DLLs with MinGW GCC in Windows</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.dynamsoft.com/codepool/mingw-gcc-link-msvc-dll.html">https://www.dynamsoft.com/codepool/mingw-gcc-link-msvc-dll.html</a></p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34177792/link-a-msvc-compiled-dll-in-a-mingw-built-project">https://stackoverflow.com/questions/34177792/link-a-msvc-compiled-dll-in-a-mingw-built-project</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/67953800/linking-a-mingw-library-to-a-msvc-app-with-a-c-interface">https://stackoverflow.com/questions/67953800/linking-a-mingw-library-to-a-msvc-app-with-a-c-interface</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2529770/how-to-use-libraries-compiled-with-mingw-in-msvc/3031167#3031167">https://stackoverflow.com/questions/2529770/how-to-use-libraries-compiled-with-mingw-in-msvc/3031167#3031167</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/7241047/linking-lib-files-with-mingw">https://stackoverflow.com/questions/7241047/linking-lib-files-with-mingw</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/62896540/18916219">interoperability of libraries created by different compilers brands</a></p>
</li>
</ul>
<h3 id="Native-API">Native API</h3>
<h4 id="jni">jni</h4>
<p>java 提供 <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/invocation.html#wp16334">invocation api</a> 供三方调用 jvm native api</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html">jni TOC</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/functions.html">jni function</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/types.html#type_signatures">jni type signature</a></p>
</li>
</ul>
<p>QA:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>创建 JVM 虚拟机及句柄：</p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35583247/fetch-java-vm-reference-create-java-object-from-c-and-concurrency">fetch-java-vm-reference-create-java-object-from-c-and-concurrency</a></li>
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35870349/can-you-create-a-new-jvm-in-a-c-function-called-from-java-using-jni">can-you-create-a-new-jvm-in-a-c-function-called-from-java-using-jni</a></li>
</ul>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.codeproject.com/articles/993067/calling-java-from-cplusplus-with-jni">call java from cpp with jni</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_27061049/article/details/115700096">cmake jvm 结合供 java 和 cpp 互调</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8850202/use-jar-file-in-c-c">cpp call java using jar</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.baeldung.com/jni">baeldung jni</a></p>
<ul class="lvl-2">
<li class="lvl-4"><a target="_blank" rel="noopener" href="https://github.com/eugenp/tutorials/tree/master/java-native">github java native</a></li>
</ul>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=87uMi7L-3Hc">Java JNI tutorial on youtube</a></p>
</li>
</ul>
<h3 id="Weekly-Practice">Weekly Practice</h3>
<h4 id="Void-Pointer-Arithmetic">Void Pointer Arithmetic</h4>
<p>避免指针运算有利于提高安全及代码通用性</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/6Mrb1hne3">https://godbolt.org/z/6Mrb1hne3</a></p>
</li>
</ul>
<h4 id="std-expected-std-optional">std::expected/std::optional</h4>
<p>c++23 提出的有力的返回值 / 错误处理工具。向后兼容实现 <a target="_blank" rel="noopener" href="https://github.com/TartanLlama/expected">tl-expected</a></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/expected/expected">https://en.cppreference.com/w/cpp/utility/expected/expected</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/c23-a-new-way-of-error-handling-with-stdexpected/">https://www.modernescpp.com/index.php/c23-a-new-way-of-error-handling-with-stdexpected/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devcodef1.com/news/1015062/std-expected-vs-exceptions-in-c">什么时候用 std::expected</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://www.ashermancinelli.com/std-expected">http://www.ashermancinelli.com/std-expected</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/jimmiebergmann">expected 使用示例</a></p>
</li>
</ul>
<h3 id="core-guideline">core guideline</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.modernescpp.com/index.php/category/blog/modern-c/">https://www.modernescpp.com/index.php/category/blog/modern-c/</a></p>
</li>
</ul>
<h3 id="Development-Utilities">Development Utilities</h3>
<p>这里搜集了一些用于增强 cpp 开发效率的工具。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=o1JinIcoz24">gdb quick start</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=OSCWvBpgKpk">rr quick start</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=7khWZ6_WzPU">sanitizer quick start</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=ykXZdYs9cOw">valgrind quick start</a></p>
</li>
</ul>
<h2 id="Optimization">Optimization</h2>
<h3 id="perf">perf</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/25129751/how-can-i-use-perf-to-profile-my-code">https://stackoverflow.com/questions/25129751/how-can-i-use-perf-to-profile-my-code</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://dev.to/etcwilde/perf---perfect-profiling-of-cc-on-linux-of">https://dev.to/etcwilde/perf---perfect-profiling-of-cc-on-linux-of</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/fenbf/AwesomePerfCpp">https://github.com/fenbf/AwesomePerfCpp</a></p>
</li>
</ul>
<h3 id="Guidelines">Guidelines</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/competitive-programming-a-complete-guide">https://www.geeksforgeeks.org/competitive-programming-a-complete-guide</a></p>
</li>
<li class="lvl-2">
<p>the art of writing efficient programs</p>
</li>
</ul>
<h3 id="测试">测试</h3>
<h4 id="依赖非代码文件">依赖非代码文件</h4>
<p>当测试代码依赖于非代码文件时，需要慎重考虑，是否能拆成更小的测试用例，或者使用 mock 对象。</p>
<p>如果无法避免，可以使用合理的资源管理机制。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.sandordargo.com/blog/2024/02/21/cpp-tests-with-resources">https://www.sandordargo.com/blog/2024/02/21/cpp-tests-with-resources</a></p>
</li>
</ul>
<h4 id="GTest-Main">GTest Main</h4>
<!--
https://google.github.io/googletest/advanced.html
https://google.github.io/googletest/gmock_for_dummies.html
https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md
 -->
<p>当 Gtest 开启在 cmake 中配置时，可以忽略在测试文件中 main 定义</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(GoogleTest)</span><br><span class="line">gtest_discover_tests(targets)</span><br></pre></td></tr></tbody></table></figure>
<p>通常省略以下定义</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>{</span><br><span class="line">    testing::<span class="built_in">InitGoogleTest</span>(&amp;argc, <span class="built_in">const_cast</span>&lt;<span class="type">char</span>**&gt;(argv));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">RUN_ALL_TESTS</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="语义优化（语言相关）">语义优化（语言相关）</h3>
<h4 id="减少-virtual">减少 virtual</h4>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=gTNJXVmuRRA">使用静态多态替代动态多态</a></p>
<h4 id="cin-tie-和-ios-sync-with-stdio">cin.tie 和 ios::sync_with_stdio</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/io/ios_base/sync_with_stdio">sync_with_stdio</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/io/cin">cin.tie</a></p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://godbolt.org/z/EM9PET1oo">加速 IO 测试</a>。</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/fast-io-for-competitive-programming">https://www.geeksforgeeks.org/fast-io-for-competitive-programming</a></p>
</li>
</ul>
<h3 id="算法">算法</h3>
<h4 id="数据结构（容器）">数据结构（容器）</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://julien.jorge.st/posts/en/effortless-performance-improvements-in-cpp-std-vector/">std::vector using reserve</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://julien.jorge.st/posts/en/effortless-performance-improvements-in-cpp-std-unordered_map/">using std::map::iterator preferally</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://julien.jorge.st/posts/en/effortless-performance-improvements-in-cpp-std-unordered_map/#whats-an-stdmap-anyway">using std::unordered_map than std::map</a></p>
</li>
</ul>
<h4 id="hash">hash</h4>
<!--
Robin hashtable
-->
<h4 id="sort">sort</h4>
<p>排序算法是一种将一组数据按照特定顺序进行排列的算法。常见的排序算法包括冒泡排序、选择排序、插入排序、快速排序、归并排序和堆排序等。这些算法的实现方式各不相同，但它们的目的都是将数据按照一定的规则进行排序。</p>
<h5 id="常见的排序算法">常见的排序算法</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p>冒泡排序：冒泡排序是一种简单的排序算法，它的基本思想是通过不断交换相邻的元素来将较大的元素逐渐 “冒泡” 到数组的末尾。冒泡排序的时间复杂度为 O (n^2)，空间复杂度为 O (1)。</p>
</li>
<li class="lvl-2">
<p>选择排序：选择排序是一种简单的排序算法，它的基本思想是每次从未排序的元素中选择最小的元素，然后将其放到已排序的元素末尾。选择排序的时间复杂度为 O (n^2)，空间复杂度为 O (1)。</p>
</li>
<li class="lvl-2">
<p>插入排序：插入排序是一种简单的排序算法，它的基本思想是将未排序的元素插入到已排序的元素中的正确位置。插入排序的时间复杂度为 O (n^2)，空间复杂度为 O (1)。</p>
</li>
<li class="lvl-2">
<p>快速排序：快速排序是一种高效的排序算法，它的基本思想是通过不断地分治和递归来将数组分成两个子数组，然后对子数组进行排序。快速排序的时间复杂度为 O (nlogn)，空间复杂度为 O (logn)。</p>
</li>
<li class="lvl-2">
<p>归并排序：归并排序是一种高效的排序算法，它的基本思想是通过不断地分治和递归来将数组分成两个子数组，然后对子数组进行排序，最后将两个有序的子数组合并成一个有序的数组。归并排序的时间复杂度为 O (nlogn)，空间复杂度为 O (n)。</p>
</li>
<li class="lvl-2">
<p>堆排序：堆排序是一种高效的排序算法，它的基本思想是通过不断地建堆和取堆顶元素来将数组排序。堆排序的时间复杂度为 O (nlogn)，空间复杂度为 O (1)。</p>
</li>
</ul>
<h5 id="STL-实现">STL 实现</h5>
<p>在 C++ STL 中，std::sort 函数是一个非常常用的排序函数。根据官方文档，std::sort 函数的内部实现包含了三种排序算法：快速排序、堆排序和插入排序。在默认情况下，std::sort 使用快速排序算法，但是当元素数量较少时，它会切换到插入排序算法，以提高性能。当元素数量较大时，std::sort 会使用堆排序算法，以避免快速排序的最坏情况。</p>
<p>以下是 std::sort 函数的内部实现：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">_RanIt</span>,</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">_Diff</span>,</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">_Pr</span>&gt; <span class="keyword">inline</span></span><br><span class="line">    <span class="type">void</span> _Sort(_RanIt _First, _RanIt _Last, _Diff _Ideal, _Pr&amp; _Pred)</span><br><span class="line">    {   <span class="comment">// order [_First, _Last), using _Pred</span></span><br><span class="line">    <span class="keyword">if</span> (_Ideal &lt; _SORT_MAX_SIZE) <span class="comment">// _SORT_MAX_SIZE == 16</span></span><br><span class="line">        _Insertion_sort(_First, _Last, _Pred);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (_SORT_MAX_SIZE &lt; _Last - _First)</span><br><span class="line">        {   <span class="comment">// divide and conquer by quicksort</span></span><br><span class="line">        _RanIt _Mid = _Unguarded_partition(_First, _Last, _Pred);</span><br><span class="line">        _Sort(_First, _Mid, _Ideal &gt;&gt; <span class="number">1</span>, _Pred);</span><br><span class="line">        _Sort(_Mid, _Last, _Ideal &gt;&gt; <span class="number">1</span>, _Pred);</span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        _Heap_sort(_First, _Last, _Pred);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>在这个实现中，Ideal 参数表示理想的子序列大小，Pred 参数表示比较函数。如果 Ideal 小于 SORTMAXSIZE（16），则使用插入排序算法。如果 Ideal 大于 SORTMAXSIZE 并且元素数量大于 SORTMAXSIZE，则使用快速排序算法。否则，使用堆排序算法。在快速排序算法中，std::sort 使用了一个叫做 unguardedpartition 的函数来进行分区操作。在堆排序算法中，std::sort 使用了一个叫做 Heapsort 的函数来进行排序操作。</p>
<h3 id="Orbit">Orbit</h3>
<p>Orbit 是 Stadia 上的性能分析解决方案。</p>
<h4 id="todo">todo</h4>
<h3 id="Profiler">Profiler</h3>
<!-- todo -->
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://hackingcpp.com/cpp/tools/profilers.html">https://hackingcpp.com/cpp/tools/profilers.html</a></p>
</li>
</ul>
<h3 id="Hardening">Hardening</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://developers.redhat.com/articles/2023/07/04/developers-guide-secure-coding-fortifysource">https://developers.redhat.com/articles/2023/07/04/developers-guide-secure-coding-fortifysource</a></p>
</li>
</ul>
<h2 id="图形学">图形学</h2>
<!--
https://www.bilibili.com/video/av90798049/?vd_source=363750aa99b1fe385d2d73ddb34a64ec
https://games-cn.org/
https://games-cn.org/gamescoursescollection/
https://www.cnblogs.com/KillerAery/p/14494430.html
https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/
https://www.mathsisfun.com/algebra/matrix-transform.html
https://www.mathsisfun.com/algebra/index.html
https://www.savemyexams.co.uk/a-level/further-maths_core-pure/edexcel/17/revision-notes/2-matrices/2-2-transformations-using-matrices/2-2-1-transformations-using-a-matrix/
-->
<h3 id="矩阵三维变换">矩阵三维变换</h3>
<p>一般三维变换分为缩放、旋转、平移。</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040647867.png" alt="缩放"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040138315.png" alt="平移"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040316421.png" alt="旋转"></p>
<h4 id="矩阵">矩阵</h4>
<p>M x N：M 宽度 = N 的高度<br>
<img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230410/040851364.png" alt="M x N"></p>
<p>前面提到的三维变换非常容易可以替换为矩阵运算。这里 1 是为了配合平移变换计算。</p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230410/041425126.png" alt="二维空间变换"></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/msclock/images/main/images/20230410/041544567.png" alt="三维空间变换"></p>
<h3 id="曲线拟合">曲线拟合</h3>
<h4 id="二次曲线拟合">二次曲线拟合</h4>
<p>以二次拟合曲线为例，方程可以表示为 <code>y = a*x*x + b*x + c</code>，其中 a、b 和 c 是待求的系数，x 和 y 分别是点的横坐标和纵坐标，可以使用三个点的坐标来列出三个方程：</p>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y1 = a * x1^2 + b * x1 + c</span><br><span class="line">y2 = a * x2^2 + b * x2 + c</span><br><span class="line">y3 = a * x3^2 + b * x3 + c</span><br></pre></td></tr></tbody></table></figure>
<p>将这三个方程化简，可以得到以下矩阵方程：</p>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ x1^2  x1  1 ]   [ a ]   [ y1 ]</span><br><span class="line">[ x2^2  x2  1 ] * [ b ] = [ y2 ]</span><br><span class="line">[ x3^2  x3  1 ]   [ c ]   [ y3 ]</span><br></pre></td></tr></tbody></table></figure>
<p>可以使用矩阵的逆来求解系数向量 [a, b, c]，具体来说，系数向量可以表示为：</p>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ a ]   [ x1^2  x1  1 ]^-1    [ y1 ]</span><br><span class="line">[ b ] = [ x2^2  x2  1 ]   *   [ y2 ]</span><br><span class="line">[ c ]   [ x3^2  x3  1 ]       [ y3 ]</span><br></pre></td></tr></tbody></table></figure>
<p>然后，可以使用 for 循环遍历 3 个点之间的所有横坐标，计算对应的纵坐标，得到绘制拟合曲线上的点。需要注意的是，<a target="_blank" rel="noopener" href="https://godbolt.org/z/o658qjnG6">这个 Godbolt 示例程序</a>只是一个简单的演示，实际的拟合曲线算法可能更加复杂和精确。</p>
<h3 id="密码学">密码学</h3>
<!--
https://www.youtube.com/watch?v=AMkIPdEkeMs&list=PLbXF_Fk-xYJ9AI3E5LdSUcwLM76nV4ecE&index=2
 -->
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/sobolevn/awesome-cryptography#c">awesome-encryption in cpp</a></p>
</li>
</ul>
<h2 id="基础工具">基础工具</h2>
<h3 id="编码转换">编码转换</h3>
<h4 id="wstring-and-string">wstring and string</h4>
<p>优先使用 wcsrtombs/mbsrtowcs, 参考<a target="_blank" rel="noopener" href="https://godbolt.org/z/rKMeffzoK">示例</a>.</p>
<h2 id="框架库">框架库</h2>
<h3 id="STL">STL</h3>
<p>C++ 标准库实现.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/tree/master/libstdc%2B%2B-v3/include">Gcc STL</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/tree/main/libcxx/include">Clang STL</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/STL/tree/main/stl/inc">MSVC STL</a></p>
</li>
</ul>
<h3 id="abseil">abseil</h3>
<h4 id="简介">简介</h4>
<p><a target="_blank" rel="noopener" href="https://abseil.io/">Abseil</a> 位于 <a target="_blank" rel="noopener" href="https://github.com/abseil/abseil-cpp">github</a> 包含了对标准库的补充，并提供了一些常用的开发基础能力，<a target="_blank" rel="noopener" href="https://abseil.io/docs/cpp/quickstart">快速开始</a>。</p>
<p>主要包括 algorithm, cleanup, <a target="_blank" rel="noopener" href="https://abseil.io/docs/cpp/guides/container">container</a>, crc, debugging, <a target="_blank" rel="noopener" href="https://abseil.io/docs/cpp/guides/flags">flags(handle command flags)</a>, hash, iterator, <a target="_blank" rel="noopener" href="https://abseil.io/docs/cpp/guides/logging">logging</a>, memory, profiling 等工具</p>
<h3 id="hotels-template-library">hotels-template-library</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/google/hotels-template-library">htl</a> 包含了用于使开发更安全、有效的工具模板。</p>
<h3 id="kicad">kicad</h3>
<p><a target="_blank" rel="noopener" href="https://gitlab.com/kicad/code/kicad">kicad</a> 属计算机辅助设计 CAD (Computer Aided Design)</p>
<h3 id="Boost-Geometry">Boost.Geometry</h3>
<p>如果想学习 Boost.Geometry，可以从以下几个方面入手：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>了解 C++ 模板元编程和泛型编程的基本概念和技术，这是使用 Boost.Geometry 的前提条件。</p>
</li>
<li class="lvl-2">
<p>学习 Boost.Geometry 的基本数据类型和算法，如点、线、多边形、圆等，以及它们之间的关系，如相交、包含等。</p>
</li>
<li class="lvl-2">
<p>学习 Boost.Geometry 的高级功能，如几何图形集合、几何图形索引等，这些功能可以提高几何算法的效率和精度。</p>
</li>
<li class="lvl-2">
<p>了解 Boost.Geometry 与其他 C++ 库的集成方式，如 STL、Boost 等。</p>
</li>
<li class="lvl-2">
<p>参考 Boost.Geometry 的官方文档和示例代码，这些资源可以帮助更好地理解和使用 Boost.Geometry。</p>
</li>
</ul>
<p>如果想深入学习 Boost.Geometry，可以参考以下资源：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Boost.Geometry 的官方文档：<a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/1_76_0/libs/geometry/doc/html/index.html">https://www.boost.org/doc/libs/1_76_0/libs/geometry/doc/html/index.html</a></p>
</li>
<li class="lvl-2">
<p>Boost.Geometry 的 GitHub 仓库：<a target="_blank" rel="noopener" href="https://github.com/boostorg/geometry">https://github.com/boostorg/geometry</a></p>
</li>
<li class="lvl-2">
<p>Boost.Geometry 的示例代码：<a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/1_76_0/libs/geometry/doc/html/geometry/examples.html">https://www.boost.org/doc/libs/1_76_0/libs/geometry/doc/html/geometry/examples.html</a></p>
</li>
<li class="lvl-2">
<p>《Boost.Geometry 入门与实践》一书，该书详细介绍了 Boost.Geometry 的基本概念、数据类型和算法，以及如何使用 Boost.Geometry 解决实际问题。</p>
</li>
</ul>
<h3 id="single-file-libs">single file libs</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/nothings/single_file_libs">非常容易移植单文件的库</a></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/ariya/fastlz">FastLZ L7ZZ 算法</a></p>
</li>
</ul>
<h3 id="Boost">Boost</h3>
<p><a target="_blank" rel="noopener" href="https://www.boost.org/">Boost</a> 是 C++ 必学的三方库。</p>
<h3 id="dynamix">dynamix</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/iboB/dynamix">dynamix</a> 是 C++ 在多态编程支持健壮的 Mixin 库。</p>
<h3 id="proxy">proxy</h3>
<p>c++20 支持的运行时多态代理</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/cppblog/proxy-runtime-polymorphism-made-easier-than-ever/">https://devblogs.microsoft.com/cppblog/proxy-runtime-polymorphism-made-easier-than-ever/</a></p>
</li>
</ul>
<h3 id="Gstreamer">Gstreamer</h3>
<p><a target="_blank" rel="noopener" href="https://gstreamer.freedesktop.org/documentation/">Gstreamer</a> 是一个功能强大的多媒体框架，可以用于音频和视频处理。它是一个基于管道的框架，可以将多个元素（例如音频解码器、视频编码器、过滤器等）连接在一起，以实现所需的处理。以下是一些有关 Gstreamer 的基本信息：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Gstreamer 是一个开源框架，可以在 Linux、Windows 和 macOS 等操作系统上运行。</p>
</li>
<li class="lvl-2">
<p>Gstreamer 使用 C 语言编写，但也提供了许多其他语言的绑定，例如 Python、Java 和 C# 等。</p>
</li>
<li class="lvl-2">
<p>Gstreamer 提供了许多插件，可以用于处理各种音频和视频格式，例如 MP3、H.264 等。</p>
</li>
<li class="lvl-2">
<p>Gstreamer 还提供了许多工具，例如 gst-launch 和 gst-inspect 等，可以帮助构建和调试管道。</p>
</li>
</ul>
<h4 id="开发环境">开发环境</h4>
<p>推荐使用 vcpkg 配置：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcpkg install gstreamer</span><br></pre></td></tr></tbody></table></figure>
<h4 id="demo-示例">demo 示例</h4>
<p>完整的 Gstreamer 示例 demo，可以在 GitHub 上找到许多开源项目。以下是一些示例项目：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/GStreamer/gst-examples">gst-examples</a>：官方 Gstreamer 示例项目，包含许多使用 Gstreamer 的示例管道。</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/GStreamer/gst-plugins-good">gst-plugins-good</a>：官方 Gstreamer 插件项目，包含许多有用的插件，例如音频解码器、视频编码器等。</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/GStreamer/gst-python-tutorials">gst-python-tutorials</a>：使用 Python 编写的 Gstreamer 示例项目，适用于初学者。</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/GStreamer/gst-rtsp-server">gst-rtsp-server</a>：使用 Gstreamer 实现的 RTSP 服务器，可以用于流媒体传输。</p>
</li>
</ul>
<h3 id="Eigen">Eigen</h3>
<p>Eigen3 ，它是一个高性能的线性代数库，提供了各种矩阵和向量的操作。Eigen3 中的矩阵是通过模板类 Matrix 实现的，可以使用静态或动态大小。以下是一些常见的操作：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>创建矩阵：Matrix mat; MatrixXd mat (3, 3);</p>
</li>
<li class="lvl-2">
<p>矩阵乘法：mat1 * mat2</p>
</li>
<li class="lvl-2">
<p>矩阵转置：mat.transpose ()</p>
</li>
<li class="lvl-2">
<p>矩阵求逆：mat.inverse ()</p>
</li>
<li class="lvl-2">
<p>矩阵行列式：mat.determinant ()</p>
</li>
<li class="lvl-2">
<p>矩阵特征值：mat.eigenvalues ()</p>
</li>
<li class="lvl-2">
<p>矩阵特征向量：mat.eigenvectors ()</p>
</li>
</ul>
<p>更多详细信息可以参考 <a target="_blank" rel="noopener" href="https://eigen.tuxfamily.org/dox/groupTutorialMatrixClass.html">Eigen3 官方文档</a>。</p>
<p>如果需要更多关于 Eigen3 的信息，可以参考以下资源：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://eigen.tuxfamily.org/dox/groupTutorialMatrixClass.html">Eigen3 官方文档</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/eigenteam/eigen-git-mirror">Eigen3 GitHub 仓库</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://eigen3.adshao.net/">Eigen3 中文文档</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LeftNotEasy/tag/Eigen/">Eigen3 中文教程</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LeftNotEasy/p/11299214.html">Eigen3 中文 API 文档</a></p>
</li>
</ul>
<h3 id="gRPC">gRPC</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/grpc/grpc">gRPC</a> 是一种高性能、开源和通用的远程过程调用（RPC）框架。它可以在任何地方运行，从而使客户端和服务器应用程序能够透明地相互通信。gRPC 使用 Protocol Buffers 作为其默认的序列化机制，这使得它非常高效。它还支持多种编程语言，包括 C++、Java、Python、Go、Ruby、C# 和 Objective-C 等。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://grpc.io/docs/languages/">Quick Start</a>。</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/grpc/grpc/tree/master/examples/cpp">cpp 参考官方示例</a>。</p>
</li>
</ul>
<h3 id="网络库">网络库</h3>
<!--
https://zhuanlan.zhihu.com/p/147671770?utm_id=0
https://zhuanlan.zhihu.com/p/357075167?utm_id=0
 -->
<h3 id="wxwidget">wxwidget</h3>
<p>cpp 跨平台 ui 框架啊</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/wxwidgets-book/content/">https://wizardforcel.gitbooks.io/wxwidgets-book/content/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Xiao_Ley/article/details/129099607">csdn blog 简介</a></p>
</li>
</ul>
<h3 id="wfrest">wfrest</h3>
<p>Web Framework RESTful API in C++.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/wfrest/wfrest">https://github.com/wfrest/wfrest</a></p>
</li>
</ul>
<h3 id="bpf">bpf</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.linuxjournal.com/content/bpf-observability-getting-started-quickly">https://www.linuxjournal.com/content/bpf-observability-getting-started-quickly</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.ctyun.cn/developer/article/487430210170949">ringbuffer 和 bpf</a></p>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Msclock
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://msclock.github.io/posts/caeaa4a1/" title="cpp 实践">https://msclock.github.io/posts/caeaa4a1/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/cpp/" rel="tag"><i class="fa fa-tag"></i> cpp</a>
              <a href="/tags/cmake/" rel="tag"><i class="fa fa-tag"></i> cmake</a>
              <a href="/tags/msvc/" rel="tag"><i class="fa fa-tag"></i> msvc</a>
              <a href="/tags/gnu/" rel="tag"><i class="fa fa-tag"></i> gnu</a>
              <a href="/tags/vs/" rel="tag"><i class="fa fa-tag"></i> vs</a>
              <a href="/tags/gdb/" rel="tag"><i class="fa fa-tag"></i> gdb</a>
              <a href="/tags/xmake/" rel="tag"><i class="fa fa-tag"></i> xmake</a>
              <a href="/tags/vcpkg/" rel="tag"><i class="fa fa-tag"></i> vcpkg</a>
              <a href="/tags/doxygen/" rel="tag"><i class="fa fa-tag"></i> doxygen</a>
              <a href="/tags/coverage/" rel="tag"><i class="fa fa-tag"></i> coverage</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/51646408/" rel="prev" title="Welcome to Hexo">
                  <i class="fa fa-angle-left"></i> Welcome to Hexo
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/796530809/" rel="next" title="记忆和想象方法">
                  记忆和想象方法 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81Njg4MS8zMzM0NQ=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Msclock</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">426k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:27</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/msclock" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.23.0/source/js/third-party/comments/livere.min.js" defer></script>


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body>
</html>
