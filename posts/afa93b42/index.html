<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-circle.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"msclock.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"github-dark"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"livere","storage":true,"lazyload":false,"nav":null,"activeClass":"livere"},"stickytabs":true,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/config.min.js" defer></script>

    <meta name="description" content="资源    资源 组织 类型     scientific python development python 文档   Python Enhancement Proposals Index python 文档   geeksforgeeks python docs   可乐 python docs 文档   pythonguide pythonguide docs   superfastpyth">
<meta property="og:type" content="article">
<meta property="og:title" content="python">
<meta property="og:url" content="https://msclock.github.io/posts/afa93b42/index.html">
<meta property="og:site_name" content="Live in the present">
<meta property="og:description" content="资源    资源 组织 类型     scientific python development python 文档   Python Enhancement Proposals Index python 文档   geeksforgeeks python docs   可乐 python docs 文档   pythonguide pythonguide docs   superfastpyth">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/08/04/MqPT1U4vnx78Aoa.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/04/UKzp3XCeilOEWdw.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/04/DonjgHkhtr4Wq7N.png">
<meta property="og:image" content="https://s2.loli.net/2022/08/04/dh97nScKyQDXwut.png">
<meta property="og:image" content="https://img.shields.io/badge/code%20style-black-000000.svg">
<meta property="og:image" content="https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&amp;logoColor=white">
<meta property="article:published_time" content="2021-09-06T02:13:26.000Z">
<meta property="article:modified_time" content="2025-11-01T01:21:36.071Z">
<meta property="article:author" content="Msclock">
<meta property="article:tag" content="cpp,hexo,blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/08/04/MqPT1U4vnx78Aoa.png">


<link rel="canonical" href="https://msclock.github.io/posts/afa93b42/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://msclock.github.io/posts/afa93b42/","path":"posts/afa93b42/","title":"python"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>python | Live in the present</title>
  








  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@7.2.0/dist/browser/pangu.umd.js" integrity="sha256-JnmRRnJK7DC6RQJbAJb6AXOM9OmWzS6z8eYultk/48Y=" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/utils.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/motion.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/sidebar.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/next-boot.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/pjax.min.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.5.0/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/third-party/search/local-search.min.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/third-party/tags/pdf.min.js" defer></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@11.10.1/dist/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/third-party/tags/mermaid.min.js" defer></script>



  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/third-party/pace.min.js" defer></script>


  




  <script src="https://cdn.jsdelivr.net/npm/quicklink@3.0.1/dist/quicklink.umd.js" integrity="sha256-44BednzIpUeQJcY8qtLyarFu0UCCTbgmWOvaoehiFQQ=" crossorigin="anonymous" defer></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://msclock.github.io/posts/afa93b42/"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/third-party/quicklink.min.js" defer></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Live in the present</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Msclock's Notes</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">32</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">50</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90"><span class="nav-number">1.</span> <span class="nav-text">资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#beginner"><span class="nav-number">2.</span> <span class="nav-text">beginner</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-in-vscode"><span class="nav-number">2.1.</span> <span class="nav-text">debug in vscode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6"><span class="nav-number">2.1.1.</span> <span class="nav-text">前置条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">2.1.2.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-in-GDB"><span class="nav-number">2.2.</span> <span class="nav-text">debug in GDB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6-2"><span class="nav-number">2.2.1.</span> <span class="nav-text">前置条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.2.2.</span> <span class="nav-text">常用命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-in-vs"><span class="nav-number">2.3.</span> <span class="nav-text">debug in vs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tricks"><span class="nav-number">2.4.</span> <span class="nav-text">Tricks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="nav-number">2.4.1.</span> <span class="nav-text">数据格式化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#prefer-dataclass"><span class="nav-number">2.4.2.</span> <span class="nav-text">prefer dataclass</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WorkingDirContext"><span class="nav-number">2.4.3.</span> <span class="nav-text">WorkingDirContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cmd-%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C"><span class="nav-number">2.4.4.</span> <span class="nav-text">cmd 直接执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7%E6%88%96%E6%96%B9%E6%B3%95"><span class="nav-number">2.4.5.</span> <span class="nav-text">动态添加属性或方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95"><span class="nav-number">2.4.6.</span> <span class="nav-text">获取目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%9C%A8%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.4.7.</span> <span class="nav-text">判断是否在调试模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B6%85%E6%97%B6%E9%80%80%E5%87%BA"><span class="nav-number">2.4.8.</span> <span class="nav-text">超时退出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F"><span class="nav-number">2.4.9.</span> <span class="nav-text">常量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE"><span class="nav-number">2.4.10.</span> <span class="nav-text">从环境变量读取配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%B1%95log%E9%85%8D%E7%BD%AE"><span class="nav-number">2.4.11.</span> <span class="nav-text">扩展 log 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEinput%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"><span class="nav-number">2.4.12.</span> <span class="nav-text">设置 input 默认参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#static-and-class-method"><span class="nav-number">2.4.13.</span> <span class="nav-text">static and class method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#metaclass"><span class="nav-number">2.4.14.</span> <span class="nav-text">metaclass</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#duck-typing"><span class="nav-number">2.5.</span> <span class="nav-text">duck typing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cpython-%E5%BC%80%E5%8F%91"><span class="nav-number">3.</span> <span class="nav-text">cpython 开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">3.1.</span> <span class="nav-text">参考</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95"><span class="nav-number">3.2.</span> <span class="nav-text">调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reference"><span class="nav-number">3.3.</span> <span class="nav-text">reference</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pip"><span class="nav-number">4.</span> <span class="nav-text">pip</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pip-tool"><span class="nav-number">4.1.</span> <span class="nav-text">pip tool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pip-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.</span> <span class="nav-text">pip 常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pip-install-e"><span class="nav-number">4.3.</span> <span class="nav-text">pip install -e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#install-pkg-with-pip"><span class="nav-number">4.4.</span> <span class="nav-text">install pkg with pip</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cmake-skbuild-install"><span class="nav-number">4.4.1.</span> <span class="nav-text">cmake skbuild install</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#install-from-git"><span class="nav-number">4.4.2.</span> <span class="nav-text">install from git</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reference-2"><span class="nav-number">4.4.3.</span> <span class="nav-text">reference</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pip%E6%8D%A2%E6%BA%90"><span class="nav-number">4.5.</span> <span class="nav-text">pip 换源</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#reference-3"><span class="nav-number">4.5.1.</span> <span class="nav-text">reference</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pip-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">4.6.</span> <span class="nav-text">pip 环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#requirements-txt"><span class="nav-number">4.7.</span> <span class="nav-text">requirements.txt</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#reference-4"><span class="nav-number">4.7.1.</span> <span class="nav-text">reference</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pip-offline-package"><span class="nav-number">4.8.</span> <span class="nav-text">pip offline package</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#virtualenv"><span class="nav-number">5.</span> <span class="nav-text">virtualenv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pipx"><span class="nav-number">6.</span> <span class="nav-text">pipx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-project"><span class="nav-number">7.</span> <span class="nav-text">python project</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#project-scaffold"><span class="nav-number">7.1.</span> <span class="nav-text">project scaffold</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pyproject-tmol"><span class="nav-number">7.2.</span> <span class="nav-text">pyproject.tmol</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#build-system"><span class="nav-number">7.3.</span> <span class="nav-text">build-system</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#distutils"><span class="nav-number">7.4.</span> <span class="nav-text">distutils</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setuptools"><span class="nav-number">7.5.</span> <span class="nav-text">setuptools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setuptools-scm"><span class="nav-number">7.6.</span> <span class="nav-text">setuptools-scm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ruff"><span class="nav-number">7.7.</span> <span class="nav-text">ruff</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#black"><span class="nav-number">7.8.</span> <span class="nav-text">black</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#isort"><span class="nav-number">7.9.</span> <span class="nav-text">isort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vulture"><span class="nav-number">7.10.</span> <span class="nav-text">vulture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pylint"><span class="nav-number">7.11.</span> <span class="nav-text">pylint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mypy"><span class="nav-number">7.12.</span> <span class="nav-text">mypy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pytest"><span class="nav-number">7.13.</span> <span class="nav-text">pytest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#codespell"><span class="nav-number">7.14.</span> <span class="nav-text">codespell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#py-typed"><span class="nav-number">7.15.</span> <span class="nav-text">py.typed</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Packing"><span class="nav-number">7.16.</span> <span class="nav-text">Packing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#upload-to-pypi"><span class="nav-number">7.17.</span> <span class="nav-text">upload to pypi</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#twine"><span class="nav-number">7.17.1.</span> <span class="nav-text">twine</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E5%88%B0-GitHub"><span class="nav-number">7.17.2.</span> <span class="nav-text">集成到 GitHub</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E5%88%B0-GitLab"><span class="nav-number">7.17.3.</span> <span class="nav-text">集成到 GitLab</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docs-generator"><span class="nav-number">8.</span> <span class="nav-text">docs generator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sphinx"><span class="nav-number">8.1.</span> <span class="nav-text">sphinx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Quickstart"><span class="nav-number">8.1.1.</span> <span class="nav-text">Quickstart</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#api-generation"><span class="nav-number">8.1.2.</span> <span class="nav-text">api generation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#conf-py"><span class="nav-number">8.1.3.</span> <span class="nav-text">conf.py</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Add-jupter-support"><span class="nav-number">8.1.4.</span> <span class="nav-text">Add jupter support</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#readthedocs"><span class="nav-number">8.2.</span> <span class="nav-text">readthedocs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scikit-build-core"><span class="nav-number">9.</span> <span class="nav-text">scikit-build-core</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#multiprocessing"><span class="nav-number">10.</span> <span class="nav-text">multiprocessing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Queue"><span class="nav-number">10.1.</span> <span class="nav-text">Queue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manager"><span class="nav-number">10.2.</span> <span class="nav-text">Manager</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SyncManager"><span class="nav-number">10.2.1.</span> <span class="nav-text">SyncManager</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QA"><span class="nav-number">10.3.</span> <span class="nav-text">QA</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RuntimeError-Queue-objects-should-only-be-shared-between-processes-through-inheritance"><span class="nav-number">10.3.1.</span> <span class="nav-text">RuntimeError: Queue objects should only be shared between processes through inheritance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#concurrency"><span class="nav-number">10.4.</span> <span class="nav-text">concurrency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#paths"><span class="nav-number">10.5.</span> <span class="nav-text">paths</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E5%92%8C%E8%A7%A3%E5%AF%86"><span class="nav-number">11.</span> <span class="nav-text">加密和解密</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cryptography"><span class="nav-number">11.1.</span> <span class="nav-text">cryptography</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nuitka"><span class="nav-number">11.2.</span> <span class="nav-text">nuitka</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#plugins"><span class="nav-number">11.2.1.</span> <span class="nav-text">plugins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#configuration"><span class="nav-number">11.2.2.</span> <span class="nav-text">configuration</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pyarmor"><span class="nav-number">11.3.</span> <span class="nav-text">pyarmor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin-mechanisms"><span class="nav-number">12.</span> <span class="nav-text">plugin mechanisms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Example-of-entrypoints"><span class="nav-number">12.1.</span> <span class="nav-text">Example of entrypoints</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#marshmallow"><span class="nav-number">13.</span> <span class="nav-text">marshmallow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">13.1.</span> <span class="nav-text">序列化 &amp; 反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#post-load"><span class="nav-number">13.2.</span> <span class="nav-text">post_load</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fields-Method"><span class="nav-number">13.3.</span> <span class="nav-text">fields.Method</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pytest-2"><span class="nav-number">14.</span> <span class="nav-text">pytest</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E7%A0%81"><span class="nav-number">14.1.</span> <span class="nav-text">退出码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flask"><span class="nav-number">15.</span> <span class="nav-text">Flask</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Explore-Flask"><span class="nav-number">15.1.</span> <span class="nav-text">Explore Flask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flasky"><span class="nav-number">15.2.</span> <span class="nav-text">Flasky</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wsgi"><span class="nav-number">15.3.</span> <span class="nav-text">wsgi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gunicorn"><span class="nav-number">15.4.</span> <span class="nav-text">gunicorn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gevent"><span class="nav-number">15.5.</span> <span class="nav-text">gevent</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FastAPI"><span class="nav-number">16.</span> <span class="nav-text">FastAPI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#uvicorn"><span class="nav-number">16.1.</span> <span class="nav-text">uvicorn</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#subprocess"><span class="nav-number">17.</span> <span class="nav-text">subprocess</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#subprocess%E8%BF%90%E8%A1%8C%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-number">17.1.</span> <span class="nav-text">subprocess 运行子进程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#argparse"><span class="nav-number">18.</span> <span class="nav-text">argparse</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gradio"><span class="nav-number">19.</span> <span class="nav-text">gradio</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Quickstart-2"><span class="nav-number">19.1.</span> <span class="nav-text">Quickstart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Share-app"><span class="nav-number">19.2.</span> <span class="nav-text">Share app</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#streamlit"><span class="nav-number">20.</span> <span class="nav-text">streamlit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fire"><span class="nav-number">21.</span> <span class="nav-text">Fire</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-function"><span class="nav-number">21.1.</span> <span class="nav-text">Using function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-class"><span class="nav-number">21.2.</span> <span class="nav-text">Using class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-object"><span class="nav-number">21.3.</span> <span class="nav-text">Using object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Define-subcommand"><span class="nav-number">21.4.</span> <span class="nav-text">Define subcommand</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Embedded-command"><span class="nav-number">21.5.</span> <span class="nav-text">Embedded command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-attr-access"><span class="nav-number">21.6.</span> <span class="nav-text">Using attr access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-command-chain"><span class="nav-number">21.7.</span> <span class="nav-text">Using command chain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-args-and-kwargs"><span class="nav-number">21.8.</span> <span class="nav-text">Using *args and **kwargs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Parameter-type-in-fire"><span class="nav-number">21.9.</span> <span class="nav-text">Parameter type in fire</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#click"><span class="nav-number">22.</span> <span class="nav-text">click</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Define-subcommand-2"><span class="nav-number">22.1.</span> <span class="nav-text">Define subcommand</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pre-commit"><span class="nav-number">23.</span> <span class="nav-text">pre-commit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install"><span class="nav-number">23.1.</span> <span class="nav-text">Install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pre-commit-config-yaml"><span class="nav-number">23.2.</span> <span class="nav-text">.pre-commit-config.yaml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pre-commit-cli"><span class="nav-number">23.3.</span> <span class="nav-text">pre-commit cli</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6"><span class="nav-number">23.4.</span> <span class="nav-text">常用配置插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integrate-with-CI"><span class="nav-number">23.5.</span> <span class="nav-text">Integrate with CI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#gitlab-ci"><span class="nav-number">23.5.1.</span> <span class="nav-text">gitlab ci</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#github-action"><span class="nav-number">23.5.2.</span> <span class="nav-text">github action</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dynaconf"><span class="nav-number">24.</span> <span class="nav-text">dynaconf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="nav-number">24.1.</span> <span class="nav-text">配置实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loguru"><span class="nav-number">25.</span> <span class="nav-text">loguru</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-2"><span class="nav-number">25.1.</span> <span class="nav-text">Install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Usage"><span class="nav-number">25.2.</span> <span class="nav-text">Usage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pydantic"><span class="nav-number">26.</span> <span class="nav-text">pydantic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pyscript"><span class="nav-number">27.</span> <span class="nav-text">pyscript</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gitpython"><span class="nav-number">28.</span> <span class="nav-text">gitpython</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pyenv"><span class="nav-number">29.</span> <span class="nav-text">pyenv</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Msclock"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Msclock</p>
  <div class="site-description" itemprop="description">That life is reality.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/msclock" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;msclock" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:msclock@qq.com" title="E-Mail → mailto:msclock@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/msclockg" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;msclockg" rel="noopener me" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://msclock.github.io/posts/afa93b42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Msclock">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Live in the present">
      <meta itemprop="description" content="That life is reality.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="python | Live in the present">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          python
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-06 10:13:26" itemprop="dateCreated datePublished" datetime="2021-09-06T10:13:26+08:00">2021-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-01 09:21:36" itemprop="dateModified" datetime="2025-11-01T09:21:36+08:00">2025-11-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>60k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>54 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="资源">资源</h2>
<table>
<thead>
<tr>
<th>资源</th>
<th>组织</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://learn.scientific-python.org/development/">scientific python development</a></td>
<td>python</td>
<td>文档</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://peps.python.org/pep-0000/">Python Enhancement Proposals Index</a></td>
<td>python</td>
<td>文档</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/python-programming-language/">geeksforgeeks</a></td>
<td>python</td>
<td>docs</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://kelepython.readthedocs.io/zh/latest/index.html">可乐 python</a></td>
<td>docs</td>
<td>文档</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://pythonguidecn.readthedocs.io/zh/latest/">pythonguide</a></td>
<td>pythonguide</td>
<td>docs</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://superfastpython.com/">superfastpython</a></td>
<td>superfastpython</td>
<td>blog</td>
</tr>
</tbody>
</table>
<span id="more"></span>
<h2 id="beginner">beginner</h2>
<h3 id="debug-in-vscode">debug in vscode</h3>
<h4 id="前置条件">前置条件</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">vscode</a></p>
</li>
<li class="lvl-2">
<p>vscode plugins</p>
<ul class="lvl-2">
<li class="lvl-4">ms-vscode-remote.vscode-remote-extensionpack</li>
</ul>
</li>
<li class="lvl-2">
<p>运行中的服务开放 attach 条件 <a target="_blank" rel="noopener" href="https://github.com/microsoft/debugpy">debugpy</a></p>
</li>
</ul>
<p>调试采用 python 插件提供的模板, 常用模板基于文件 (file) 或基于模块 (module), 模板中字段说明参考插件及 vscode 预定义变量<a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/editor/variables-reference">引用文档</a>.</p>
<p>基于文件模板样例:</p>
<figure class="highlight jsonc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"0.2.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"configurations"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"Python: Current File"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"python"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"request"</span><span class="punctuation">:</span> <span class="string">"launch"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"program"</span><span class="punctuation">:</span> <span class="string">"${file}"</span><span class="punctuation">,</span> <span class="comment">// the current opened file</span></span><br><span class="line">            <span class="attr">"console"</span><span class="punctuation">:</span> <span class="string">"integratedTerminal"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"env"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"args"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"cwd"</span><span class="punctuation">:</span> <span class="string">"${fileWorkspaceFolder}"</span><span class="punctuation">,</span> <span class="comment">// the current opened file's workspace folder</span></span><br><span class="line">            <span class="attr">"justMyCode"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="方法">方法</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>vscode-&gt;Remote Explorer-&gt;SSH Targets 通过配置连接进入要调试服务所在主机。如下示例：</p>
</li>
</ul>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host myhost</span><br><span class="line">    HostName 192.168.1.156</span><br><span class="line">    User root</span><br><span class="line">    Port 22</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>vscode-&gt;Remote Explorer-&gt;Containers 可以看到主机中运行的容器，右键 Attach to Container，vscode 自动进入容器内部：</p>
</li>
</ul>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://s2.loli.net/2022/08/04/MqPT1U4vnx78Aoa.png" alt="20220804202137."></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>安装调试语言插件，ms-python.python</p>
</li>
<li class="lvl-2">
<p>进入调试配置左侧栏，创建基于 Python 调试配置模板，选择 Attach 模板 Attach using Process Id<br>
生成文件 .vscode/launch.json</p>
</li>
</ul>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://s2.loli.net/2022/08/04/UKzp3XCeilOEWdw.png" alt="20220804202048."></p>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://s2.loli.net/2022/08/04/DonjgHkhtr4Wq7N.png" alt="20220804202016."></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>增加匹配调试服务的端口 port 到 launch.json 文件，port 可从服务路径 configs\default_settings.yaml 找到 attach_port: 12345 # 服务默认 attach 调试端口，或从环境变量 CONF_ATTACH_PORT 中获取最新 port ：</p>
</li>
</ul>
<figure class="highlight jsonc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"0.2.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"configurations"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"Python: Attach using Process Id"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"python"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"request"</span><span class="punctuation">:</span> <span class="string">"attach"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"processId"</span><span class="punctuation">:</span> <span class="string">"${command:pickProcess}"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"justMyCode"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"port"</span><span class="punctuation">:</span> <span class="number">12345</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>选择创建的调试模板，启动 attach 模板，选择要调试的服务进程 pid，注意每个进程调试都需要启动一次会话。</p>
</li>
</ul>
<p><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://s2.loli.net/2022/08/04/dh97nScKyQDXwut.png" alt="20220804201927."></p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/remote/ssh">Remote Development using SSH</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/remote/containers">Developing inside a Container</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/remote/advancedcontainers/overview">Advanced container configuration</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/remote/advancedcontainers/overview">Reference Implementation (containers.dev)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/debugpy/wiki/Command-Line-Reference">Wiki debugpy</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://microsoft.github.io/debug-adapter-protocol/">Debug Adapter Protocol</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/remote/troubleshooting#_resolving-git-line-ending-issues-in-containers-resulting-in-many-modified-files">Remote Development Tips and Tricks</a></p>
</li>
</ul>
<h3 id="debug-in-GDB">debug in GDB</h3>
<h4 id="前置条件-2">前置条件</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>使用附带自动加载对应 python 版本脚本的 gdb <a target="_blank" rel="noopener" href="https://github.com/docker-library/python">环境</a>。</p>
</li>
</ul>
<h4 id="常用命令">常用命令</h4>
<p>Gdb 调试 Python 进程以 C 底层实现调试，看不到直接的 Python 源码，需要辅以一下命令：</p>
<blockquote>
<p>[!TIP]<br>
Debugging commands with Gdb</p>
</blockquote>
<ul class="lvl-0">
<li class="lvl-2">
<p>py-bt: 输出 Python 调用栈</p>
</li>
<li class="lvl-2">
<p>py-bt-full: 输出 Python 调用栈</p>
</li>
<li class="lvl-2">
<p>py-down: 在调用栈向下一级</p>
</li>
<li class="lvl-2">
<p>py-list: 显示代码</p>
</li>
<li class="lvl-2">
<p>py-locals: 输出 locals 变量</p>
</li>
<li class="lvl-2">
<p>py-print: 输出</p>
</li>
<li class="lvl-2">
<p>py-up: 在调用栈向上一级</p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/7412708/debugging-stepping-through-python-script-using-gdb">https://stackoverflow.com/questions/7412708/debugging-stepping-through-python-script-using-gdb</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://getdocs.org/Gdb/docs/latest/gdb/Breakpoints-In-Python">Breakpoints in Python (Debugging with GDB)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wiki.python.org/moin/DebuggingWithGdb">DebugginWithGdb</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://ponder.work/2020/12/29/debug-python-with-gdb/">http://ponder.work/2020/12/29/debug-python-with-gdb/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="http://jasonblog.github.io/note/gdb/li_yong_gdb_jin_xing_shared_library_de_chu_cuo.html">http://jasonblog.github.io/note/gdb/li_yong_gdb_jin_xing_shared_library_de_chu_cuo.html</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://meteorix.github.io/2019/02/13/gdbpython/">https://meteorix.github.io/2019/02/13/gdbpython/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.xiexianbin.cn/linux/basic/linux-gdb/index.html">https://www.xiexianbin.cn/linux/basic/linux-gdb/index.html</a></p>
</li>
</ul>
<h3 id="debug-in-vs">debug in vs</h3>
<p>Windows 上用 VS 进行混合调试 Python / C++。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/visualstudio/python/quickstart-01-python-in-visual-studio-project-from-existing-code?view=vs-2022">https://docs.microsoft.com/zh-cn/visualstudio/python/quickstart-01-python-in-visual-studio-project-from-existing-code?view=vs-2022</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2017/python/debugging-mixed-mode-c-cpp-python-in-visual-studio?view=vs-2017#enable-mixed-mode-debugging-in-a-python-project">https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2017/python/debugging-mixed-mode-c-cpp-python-in-visual-studio?view=vs-2017#enable-mixed-mode-debugging-in-a-python-project</a></p>
</li>
</ul>
<h3 id="Tricks">Tricks</h3>
<h4 id="数据格式化">数据格式化</h4>
<p>保留两位小数</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用字符串格式化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">float_to_str</span>(<span class="params">f: <span class="built_in">float</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"<span class="subst">{f:<span class="number">.2</span>f}</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用round函数</span></span><br><span class="line">num = <span class="number">3.1415926</span></span><br><span class="line">result = <span class="built_in">round</span>(num, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Decimal类</span></span><br><span class="line">num = Decimal(<span class="string">"3.1415926"</span>)</span><br><span class="line">result = <span class="built_in">str</span>(num.quantize(Decimal(<span class="string">"0.00"</span>)))</span><br></pre></td></tr></tbody></table></figure>
<h4 id="prefer-dataclass">prefer dataclass</h4>
<p>创建数据类通常使用 python 内置的 dataclass.</p>
<p>它在 Python 3.7 版本中引入。它旨在简化创建和操作数据类的过程。数据类是一种用于存储数据的类，通常只包含属性而不包含方法。</p>
<p>使用 dataclass 装饰器可以自动为类生成一些常见的方法，例如 <strong>init</strong> 、 <strong>repr</strong> 、 <strong>eq</strong> 等。这样，您无需手动编写这些方法，可以更快速地创建和使用数据类。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=vBH6GRJ1REM">https://www.youtube.com/watch?v=vBH6GRJ1REM</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/lidatong/dataclasses-json">dataclass 通常和 dataclass-json 一起使用</a></p>
</li>
</ul>
<p>下面是一个使用 dataclass 的示例：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line">    profession: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个Person对象</span></span><br><span class="line">person = Person(<span class="string">"John Doe"</span>, <span class="number">30</span>, <span class="string">"Engineer"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印对象的字符串表示</span></span><br><span class="line"><span class="built_in">print</span>(person)  <span class="comment"># 输出: Person(name='John Doe', age=30, profession='Engineer')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较两个对象是否相等</span></span><br><span class="line">person2 = Person(<span class="string">"John Doe"</span>, <span class="number">30</span>, <span class="string">"Engineer"</span>)</span><br><span class="line"><span class="built_in">print</span>(person == person2)  <span class="comment"># 输出: True</span></span><br></pre></td></tr></tbody></table></figure>
<p>在上述示例中，使用 dataclass 装饰器来创建一个名为 Person 的数据类。它有三个属性： name 、 age 和 profession 。 dataclass 装饰器自动为该类生成了 <strong>init</strong> 、 <strong>repr</strong> 和 <strong>eq</strong> 方法，使能够更方便地创建和比较对象。</p>
<p>除了自动生成的方法， dataclass 还提供了其他参数来自定义类的行为。例如，您可以使用 frozen = True 参数使生成的类成为不可变类，即对象创建后不能修改。</p>
<p>总之， dataclass 是 Python 中一个非常有用的工具，它简化了创建和操作数据类的过程。通过使用 dataclass 装饰器，您可以更高效地编写代码，并减少样板代码的数量。</p>
<h4 id="WorkingDirContext">WorkingDirContext</h4>
<p>实现保留工作目录上下文</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> TracebackType</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkingDirContext</span>:</span><br><span class="line">    <span class="string">"""Working directory context definition"""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, path: <span class="built_in">str</span> | os.PathLike[<span class="built_in">str</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>._prev_working_dir = os.getcwd()</span><br><span class="line">        os.chdir(path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>) -&gt; WorkingDirContext:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        exc_type: <span class="built_in">type</span>[BaseException] | <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        exc_value: BaseException | <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        traceback: TracebackType | <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""Switch the previous directory"""</span></span><br><span class="line">        os.chdir(<span class="variable language_">self</span>._prev_working_dir)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="cmd-直接执行">cmd 直接执行</h4>
<p>脚本可以直接通过 python 执行, 只需要指定 <code>-c</code>参数即可. 需要注意地是:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>命令将使用; 隔开</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"import os;print(os.environ)"</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="动态添加属性或方法">动态添加属性或方法</h4>
<p>作为动态语言，<code>python</code> 能动态运行时添加动态属性和方法。在不修改源码的情况下，可以通过在运行期间，动态添加属性。参考:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/phyger/p/13639291.html">phyger 博客参考 1</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv17118182/">python 术语</a></p>
</li>
</ul>
<h4 id="获取目录">获取目录</h4>
<p>获取当前文件的绝对路径</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">root = Path(__file__).resolve().parent</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">root = os.path.dirname(os.path.abspath(__file__))</span><br></pre></td></tr></tbody></table></figure>
<h4 id="判断是否在调试模式">判断是否在调试模式</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_debugging</span>():</span><br><span class="line">    <span class="keyword">return</span> sys.gettrace() <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="超时退出">超时退出</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>基于 signal 实现</p>
</li>
</ul>
<p>python signal 负责处理内存信号处理，超时可以通过 <code>SIGALRM</code> 信号触发超时操作。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TimeoutError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">"""自定义超时异常"""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, msg, frame</span>):</span><br><span class="line">        <span class="built_in">super</span>(TimeoutError, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.msg = msg</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">time_out</span>(<span class="params">interval: <span class="built_in">int</span>, callback=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">"""interval秒后向进程发送SIGALRM信号，函数在规定时间执行完后关闭alarm闹钟</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        interval (int): 超时秒数</span></span><br><span class="line"><span class="string">        callback (function, optional): 超时回调. Defaults to None.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">            <span class="built_in">print</span>(frame)</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError(<span class="string">f"run func <span class="subst">{func.__name__}</span> timeout <span class="subst">{interval}</span>s"</span>, frame)</span><br><span class="line"></span><br><span class="line"><span class="meta">        @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                signal.signal(signal.SIGALRM, handler)</span><br><span class="line">                signal.alarm(interval)</span><br><span class="line">                result = func(*args, **kwargs)</span><br><span class="line">                signal.alarm(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">            <span class="keyword">except</span> TimeoutError <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">if</span> callback:</span><br><span class="line">                    callback(e)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timeout_callback</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="built_in">print</span>(e.msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out(<span class="params"><span class="number">2</span>, timeout_callback</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"task1 start"</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)  <span class="comment">#! 超时</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"task1 end"</span>)  <span class="comment"># tak 1 end 不会输出</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@time_out(<span class="params"><span class="number">2</span>, timeout_callback</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"task2 start"</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"task2 end"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    task1()</span><br><span class="line">    task2()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>基于 threading 或协程实现</p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">threading_time_out</span>(<span class="params">interval, callback=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            t = threading.Thread(target=func, args=args, kwargs=kwargs)</span><br><span class="line">            t.setDaemon(<span class="literal">True</span>)  <span class="comment"># 设置主线程结束后子线程立刻结束</span></span><br><span class="line">            t.start()</span><br><span class="line">            t.join(interval)  <span class="comment"># 主线程阻塞等待interval秒</span></span><br><span class="line">            <span class="keyword">if</span> t.is_alive() <span class="keyword">and</span> callback:</span><br><span class="line">                <span class="keyword">return</span> threading.Timer(<span class="number">0</span>, callback).start()  <span class="comment"># 立即执行回调函数</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gevent_time_out</span>(<span class="params">interval, callback=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="comment"># 该部分必选在requests之前导入</span></span><br><span class="line">            <span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line">            <span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">            monkey.patch_all()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                gevent.with_timeout(interval, func, *args, **kwargs)</span><br><span class="line">            <span class="keyword">except</span> gevent.timeout.Timeout <span class="keyword">as</span> e:</span><br><span class="line">                callback() <span class="keyword">if</span> callback <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></tbody></table></figure>
<h4 id="常量">常量</h4>
<p>python 中常量定义是比较困难的，这里给出几种常用的方法。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>覆盖 cls.<strong>setattr</strong></p>
</li>
</ul>
<p>自定义 <strong>setattr</strong>, 检测加入的属性重复性, 通过类修饰方式实现。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">as_const</span>(<span class="params">cls</span>):</span><br><span class="line">    <span class="string">"""成为常量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        from constant import as_const</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @as_const</span></span><br><span class="line"><span class="string">        class _Platform:</span></span><br><span class="line"><span class="string">            linux = "linux"</span></span><br><span class="line"><span class="string">            windows = "windows"</span></span><br><span class="line"><span class="string">            macosx = "macosx"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @as_const</span></span><br><span class="line"><span class="string">        class _Const:</span></span><br><span class="line"><span class="string">            plat = _Platform()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        ct = _Const()</span></span><br><span class="line"><span class="string">        pt = _Platform()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        print(ct.plat.linux)</span></span><br><span class="line"><span class="string">        print(pt.linux)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ConstError</span>(<span class="title class_ inherited__">TypeError</span>):</span><br><span class="line">        <span class="string">"""常量不可改错误定义"""</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ConstCaseError</span>(<span class="title class_ inherited__">ConstError</span>):</span><br><span class="line">        <span class="string">"""常量大小写错误定义"""</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @wraps(<span class="params">cls</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">const_setter</span>(<span class="params">self, key, value</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> <span class="variable language_">self</span>.__dict__.keys():</span><br><span class="line">            <span class="keyword">raise</span> ConstError(<span class="string">f"Can't change a const variable with name <span class="subst">{key}</span>"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> key.isupper():</span><br><span class="line">            <span class="keyword">raise</span> ConstCaseError(</span><br><span class="line">                <span class="string">f"Const variable must be combined with upper letters:<span class="subst">{key}</span>"</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.__dict__[key] = value</span><br><span class="line"></span><br><span class="line">    cls.__setattr__ = const_setter</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cls</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>通过 dataclass</p>
</li>
</ul>
<p>dataclass 修饰实现，通过 frozen 参数固定。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass(<span class="params">frozen=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorName</span>:</span><br><span class="line">    service = <span class="string">"ServiceError"</span></span><br><span class="line">    drawing = <span class="string">"DrawingError"</span></span><br><span class="line">    subblock = <span class="string">"SubBlockError"</span></span><br><span class="line">    file = <span class="string">"FileError"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ErrorName.service)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="从环境变量读取配置">从环境变量读取配置</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/milvus-io/pymilvus/blob/master/pymilvus/settings.py">https://github.com/milvus-io/pymilvus/blob/master/pymilvus/settings.py</a></p>
</li>
</ul>
<h4 id="扩展log配置">扩展 log 配置</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/milvus-io/pymilvus/blob/master/pymilvus/settings.py">https://github.com/milvus-io/pymilvus/blob/master/pymilvus/settings.py</a></p>
</li>
</ul>
<h4 id="设置input默认参数">设置 input 默认参数</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">input_with_default</span>(<span class="params">prompt, default=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    如果default不为None，会在提示中包含默认值。然后，使用`input()`函数接收用户的输入。如果用户输入为空（即直接按下回车），返回默认值。否则，返回用户的输入。</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> default <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        prompt = <span class="string">f"<span class="subst">{prompt}</span> [<span class="subst">{default}</span>] "</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">input</span>(prompt) <span class="keyword">or</span> default</span><br><span class="line"></span><br><span class="line">name = input_with_default(<span class="string">"Please enter your name"</span>, <span class="string">"John"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Hello, <span class="subst">{name}</span>!"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="static-and-class-method">static and class method</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/class-method-vs-static-method-python">https://www.geeksforgeeks.org/class-method-vs-static-method-python</a></p>
</li>
</ul>
<h4 id="metaclass">metaclass</h4>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/metaprogramming-metaclasses-python">https://www.geeksforgeeks.org/metaprogramming-metaclasses-python</a></p>
</li>
</ul>
<h3 id="duck-typing">duck typing</h3>
<p>是 Python 中的一种编程风格和理念。它强调在判断一个对象的类型时，关注的是对象具有的方法和属性，而不是对象的具体类型。</p>
<p>根据鸭子类型的理念，如果一个对象走起路来像鸭子、叫起来像鸭子，那么它就可以被看作是一只鸭子。换句话说，只要对象具备了特定的方法和属性，就可以在代码中使用它，而不需要关心它的具体类型。</p>
<p>在 Python 中，通常不会显式地检查对象的类型，而是直接调用对象的方法或访问属性。如果对象具备所需的方法和属性，那么代码就能正常运行。这种灵活性使得 Python 成为一种支持动态类型和鸭子类型的语言。</p>
<p>以下是一个简单的示例，展示了 Duck Typing 的概念：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">walk</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Duck is walking"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quack</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Duck is quacking"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Robot</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">walk</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Robot is walking"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quack</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Robot cannot quack"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_object_walk</span>(<span class="params">obj</span>):</span><br><span class="line">    obj.walk()</span><br><span class="line"></span><br><span class="line">duck = Duck()</span><br><span class="line">robot = Robot()</span><br><span class="line"></span><br><span class="line">make_object_walk(duck)  <span class="comment"># 输出：Duck is walking</span></span><br><span class="line">make_object_walk(robot)  <span class="comment"># 输出：Robot is walking</span></span><br></pre></td></tr></tbody></table></figure>
<p>在上述示例中，定义了一个 Duck 类和一个 Robot 类，它们都具备了 walk 方法。然后，定义了一个 make_object_walk 函数，该函数接受一个对象作为参数，并调用对象的 walk 方法。无论传入的是 Duck 对象还是 Robot 对象，只要它们具备 walk 方法，函数就能正常运行。</p>
<p>这就是 Duck Typing 的概念，它允许在编写代码时更加关注对象的行为和能力，而不是对象的具体类型。</p>
<h2 id="cpython-开发">cpython 开发</h2>
<p>cpython 是 Python 发行最流行的版本，以 C / C++ 为基础的开发分布版本。</p>
<h3 id="参考">参考</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devguide.python.org/">Python Developer’s Guide</a></p>
</li>
</ul>
<h3 id="调试">调试</h3>
<p>cpython 调试，需要 GDB 这个工具。而 GDB 需要对应 Python 的脚本的命令加载，通常在 Python3.7 后，在源码目录的 <code>Tools/gdb/*</code> 包含用 GDB 需要的脚本。</p>
<p>按照上面的目录规则 cp 到 gdb 的 auto-load，保证调试 python3.7 进程的时候能找到。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /usr/share/gdb/auto-load/usr/local/bin/</span><br></pre></td></tr></tbody></table></figure>
<h3 id="reference">reference</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://meteorix.github.io/2019/02/13/gdbpython/">https://meteorix.github.io/2019/02/13/gdbpython/</a></p>
</li>
</ul>
<h2 id="pip">pip</h2>
<h3 id="pip-tool">pip tool</h3>
<p>pip 工具单独安装。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">python get-pip.py</span><br><span class="line"><span class="built_in">rm</span> -rf get-pip.py ~/.cache/pip</span><br></pre></td></tr></tbody></table></figure>
<h3 id="pip-常用命令">pip 常用命令</h3>
<p>这节列出了常用的 pip 命令, 参考:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pip.pypa.io/en/stable/user_guide/">https://pip.pypa.io/en/stable/user_guide/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pip.pypa.io/en/stable/cli/">https://pip.pypa.io/en/stable/cli/</a></p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装包</span></span><br><span class="line">pip install yolov5-utils[==version]</span><br><span class="line"><span class="comment"># 卸载包</span></span><br><span class="line">pip uninstall yolov5-utils</span><br><span class="line"><span class="comment"># 查看包</span></span><br><span class="line">pip show yolov5-utils</span><br><span class="line"><span class="comment"># 导出环境包至 requirements.txt</span></span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"><span class="comment"># 更新 pip</span></span><br><span class="line">pip install --upgrade pip</span><br></pre></td></tr></tbody></table></figure>
<h3 id="pip-install-e"><code>pip install -e</code></h3>
<p>使用 <code>pip install -e</code> 命令可以将本地的一个 Python 包安装到系统中，同时在安装后，该包的源代码仍然可以在本地进行修改，修改后的代码会立即生效，无需重新安装。这种安装方式被称为 “开发模式”。</p>
<p>在开发模式下，可以在本地修改源代码，而不需要每次修改后都重新安装包。这对于开发过程中的调试和测试非常有用。同时，也可以在本地使用版本控制工具来管理源代码，方便代码的维护和协作。</p>
<p>使用命令安装包时，需要在包的根目录下包含一个 <a target="_blank" rel="noopener" href="http://setup.py">setup.py</a> 文件，该文件包含了包的元数据和依赖关系等信息。在安装时，pip 会读取该文件并根据其中的信息进行安装。</p>
<h3 id="install-pkg-with-pip">install pkg with pip</h3>
<h4 id="cmake-skbuild-install">cmake skbuild install</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>cmake project integration with <a target="_blank" rel="noopener" href="https://github.com/scikit-build/scikit-build">skbuild</a></p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install git+https://**.git --build-type Debug</span><br></pre></td></tr></tbody></table></figure>
<h4 id="install-from-git">install from git</h4>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hash</span></span><br><span class="line">❯ pip install git+git://github.com/aladagemre/django-notification.git@2927346f4c513a217ac8ad076e494dd1adbf70e1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Branch</span></span><br><span class="line">❯ pip install git+git://github.com/aladagemre/django-notification.git@cool-feature-branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tag</span></span><br><span class="line">❯ pip install git+git://github.com/aladagemre/django-notification.git@v2.1.0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="reference-2">reference</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pip-cn.readthedocs.io/en/latest/reference/pip_install.html#git">pip docs 1</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pip.pypa.io/en/stable/topics/vcs-support/">pip docs 2</a></p>
</li>
</ul>
<h3 id="pip换源">pip 换源</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>cmd pip 全局配置</p>
</li>
</ul>
<p>源生效优先级，<strong>sjtu &gt; ngc.nvidia &gt; tsinghua</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip3 config <span class="built_in">set</span> global.index-url <span class="string">"https://pypi.tuna.tsinghua.edu.cn/simple/ https://pypi.ngc.nvidia.com"</span></span><br><span class="line">pip3 config <span class="built_in">set</span> global.extra-index-url <span class="string">"https://pypi.tuna.tsinghua.edu.cn/simple/ https://pypi.ngc.nvidia.com https://mirror.sjtu.edu.cn/pypi/web/simple"</span></span><br><span class="line">pip3 config <span class="built_in">set</span> global.timeout 20</span><br><span class="line">pip3 config <span class="built_in">set</span> global.trusted-host <span class="string">"pypi.tuna.tsinghua.edu.cn pypi.ngc.nvidia.com mirror.sjtu.edu.cn/pypi/web/simple"</span></span><br></pre></td></tr></tbody></table></figure>
<p>执行后会生成配置文件, windows: <code>C:\Users\user\AppData\Roaming\pip</code>, linux: <code>/home/user/.pip/</code></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>创建文件使用软件包的安装用户，执行如下命令：</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.pip</span><br></pre></td></tr></tbody></table></figure>
<p>如果提示目录不存在，则执行如下命令创建：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.pip</span><br><span class="line"><span class="built_in">cd</span> ~/.pip</span><br></pre></td></tr></tbody></table></figure>
<p>编辑 pip.conf 文件。使用 vi pip.conf 命令打开 pip.conf 文件，写入如下内容：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">#以华为源为例，请根据实际情况进行替换。</span><br><span class="line">index-url = https://mirrors.huaweicloud.com/repository/pypi/simple</span><br><span class="line">trusted-host = mirrors.huaweicloud.com</span><br><span class="line">timeout = 120</span><br></pre></td></tr></tbody></table></figure>
<h4 id="reference-3">reference</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jianjiacangcang/p/15195529.html">个人博客参考 1</a></p>
</li>
</ul>
<h3 id="pip-环境配置">pip 环境配置</h3>
<p>pip 包管理器在安装 python 包时，会在本地目录创建缓存，当下次再下载相同的包时，自动读取缓存，不再从三方源下载以节省时间。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>通过命令行配置</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.cache-dir &lt;your-cache-dir&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>通过环境变量配置</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PIP_CACHE_DIR=&lt;your-cache-dir&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="requirements-txt">requirements.txt</h3>
<p>python 安装包可通过 requirements.txt 配置安装依赖，只需通过 pip 命令 -r 即可指定安装。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r ./requirements.txt -r /requirements.gpu.txt</span><br></pre></td></tr></tbody></table></figure>
<p>可通过直接在文件种配置源，灵活拆分配置依赖包。如下，配置了 gpu 的依赖包及相应的搜索源。</p>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--find-links https://download.pytorch.org/whl/torch_stable.html</span><br><span class="line">--extra-index-url https://pypi.ngc.nvidia.com</span><br><span class="line">nvidia-pyindex==1.0.9</span><br><span class="line">nvidia-tensorflow==1.15.5+nv22.7</span><br><span class="line">nvidia-tensorboard==1.15.0+nv21.4</span><br><span class="line">torch==1.8.0+cu111</span><br><span class="line">torchvision==0.9.0+cu111</span><br><span class="line">torchaudio==0.8.0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="reference-4">reference</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/64180511/pip-change-directory-of-pip-cache-on-linux">https://stackoverflow.com/questions/64180511/pip-change-directory-of-pip-cache-on-linux</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pip.pypa.io/en/stable/topics/configuration/#environment-variables">https://pip.pypa.io/en/stable/topics/configuration/#environment-variables</a></p>
</li>
</ul>
<h3 id="pip-offline-package">pip offline package</h3>
<p>pip 实现容器启动时加载离线包安装</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># requirements.gpu.txt</span></span><br><span class="line">--extra-index-url https://pypi.ngc.nvidia.com</span><br><span class="line">--find-links https://download.pytorch.org/whl/torch_stable.html</span><br><span class="line">nvidia-pyindex==1.0.9</span><br><span class="line">nvidia-tensorboard==1.15</span><br><span class="line">nvidia-tensorflow[horovod]==1.15.5+nv22.11</span><br><span class="line">torch==1.8.0+cu111</span><br><span class="line">torchaudio==0.8.0</span><br><span class="line">torchvision==0.9.0+cu111</span><br><span class="line"><span class="comment"># requirements.txt</span></span><br><span class="line">numpy==1.23.5</span><br><span class="line">requests==2.28.1</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1.2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.8</span>-bullseye as python_base</span><br><span class="line"></span><br><span class="line"><span class="comment"># config env remote source</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">set</span> -ex \</span></span><br><span class="line"><span class="language-bash">    <span class="comment"># add multiple pip sources</span></span></span><br><span class="line">    &amp;&amp; pip3 config set global.index-url <span class="string">"https://pypi.tuna.tsinghua.edu.cn/simple/"</span> \</span><br><span class="line">    &amp;&amp; pip3 config set global.extra-index-url <span class="string">"https://pypi.tuna.tsinghua.edu.cn/simple/ https://mirrors.cloud.tencent.com/pypi/simple"</span> \</span><br><span class="line">    &amp;&amp; pip3 config set global.timeout <span class="number">10</span> \</span><br><span class="line">    &amp;&amp; pip3 config set global.trusted-host <span class="string">"pypi.tuna.tsinghua.edu.cn mirrors.cloud.tencent.com"</span> \</span><br><span class="line">    <span class="comment"># add new apt source</span></span><br><span class="line">    &amp;&amp; cp /etc/apt/sources.list /etc/apt/sources.list.bak \</span><br><span class="line">    &amp;&amp; sed -i <span class="string">'/^# deb / d;s|http://deb.debian.org/debian|http://mirrors.tencent.com/debian|g;/^deb http/s/$/ contrib non-free/;/-updates/h;s/-updates/-backports/;$G'</span> /etc/apt/sources.list \</span><br><span class="line">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y apt-transport-https ca-certificates  \</span><br><span class="line">    &amp;&amp; ln -s /lib/x86_64-linux-gnu/libtinfo.so.<span class="number">6</span> /lib/x86_64-linux-gnu/libtinfo.so.<span class="number">5</span> \</span><br><span class="line">    <span class="comment"># dumb-init is used to optimize start the service, see https://github.com/Yelp/dumb-init</span></span><br><span class="line">    &amp;&amp; pip3 install dumb-init \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/* /var/cache/* /var/log/* /tmp/* ~/.cache -rf</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LC_ALL C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> python_base as python_pack_pkg</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> PIP_CACHE_DIR /opt/deploy/.pip_cache</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./requirements.* /opt/deploy/requirements/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker buildx cache</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> --mount=<span class="built_in">type</span>=cache,target=/opt/deploy/.pip_cache,<span class="built_in">id</span>=pip_cache,sharing=locked \</span></span><br><span class="line"><span class="language-bash">    pip3 wheel --wheel-dir /opt/deploy/packages -r /opt/deploy/requirements/requirements.txt -r /opt/deploy/requirements/requirements.gpu.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">set</span> -ex \</span></span><br><span class="line"><span class="language-bash">    <span class="comment"># prevent download pkgs online again</span></span></span><br><span class="line">    &amp;&amp; sed -i <span class="string">'/extra-index-url/,+d'</span> /opt/deploy/requirements/requirements.txt \</span><br><span class="line">    &amp;&amp; sed -i <span class="string">'/extra-index-url/,+1d'</span> /opt/deploy/requirements/requirements.gpu.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> python_base as python_env</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=python_pack_pkg /opt/deploy/requirements/* /opt/deploy/requirements/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=python_pack_pkg /opt/deploy/packages/* /opt/deploy/packages/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">"pip3"</span>, <span class="string">"install"</span>, <span class="string">"--no-index"</span>, <span class="string">"--find-links=/opt/deploy/packages"</span> ,<span class="string">"-r"</span> ,<span class="string">"/opt/deploy/requirements/requirements.txt"</span> ,<span class="string">"-r"</span>, <span class="string">"/opt/deploy/requirements/requirements.gpu.txt"</span>]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> python_env as production</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /opt/deploy</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> scripts/docker/pre_start /usr/local/bin/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=python_pack_pkg /opt/deploy/requirements/* /opt/deploy/requirements/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=python_pack_pkg /opt/deploy/packages/* /opt/deploy/packages/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> . /opt/deploy/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">"/usr/local/bin/dumb-init"</span>, <span class="string">"--"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">"bash"</span>, <span class="string">"-c"</span>,<span class="string">"pre_start &amp;&amp; exec python3 app.py"</span>]</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># pre_start</span></span><br><span class="line"><span class="built_in">set</span> -ex</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---------------- Env echo ----------------"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"current path: "</span><span class="string">"<span class="variable">$PWD</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"who is this: "</span><span class="string">"<span class="subst">$(whoami)</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"pip3 version: "</span><span class="string">"<span class="subst">$(pip3 --version)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"----------- packages info ----------------"</span></span><br><span class="line"><span class="built_in">ls</span> -la /opt/deploy/packages</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---------- requirements info -------------"</span></span><br><span class="line"><span class="built_in">cat</span> /opt/deploy/requirements/requirements.txt</span><br><span class="line"><span class="built_in">cat</span> /opt/deploy/requirements/requirements.gpu.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"-------- install pre-cached pkgs ---------"</span></span><br><span class="line"><span class="comment"># install pkgs from cached path</span></span><br><span class="line">pip3 install --no-index --find-links=/opt/deploy/packages -r /opt/deploy/requirements/requirements.txt -r /opt/deploy/requirements/requirements.gpu.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---------- output active envs ------------"</span></span><br><span class="line">dynaconf -i config.settings list</span><br></pre></td></tr></tbody></table></figure>
<h2 id="virtualenv">virtualenv</h2>
<p>虚拟环境用于环境隔离，进行多环境开发或配置。</p>
<p>安装虚拟环境配置工具 virtualenv, 参考使用教程:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://techinscribed.com/python-virtual-environment-in-vscode/">https://techinscribed.com/python-virtual-environment-in-vscode/</a></p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">virtualenv --version</span><br></pre></td></tr></tbody></table></figure>
<h2 id="pipx">pipx</h2>
<p>常用的管理的 python 命令行 工具</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mamba install pipx</span><br><span class="line"></span><br><span class="line">pipx list</span><br><span class="line">pipx install poetry</span><br><span class="line">pipx install copier</span><br><span class="line">pipx install nox</span><br></pre></td></tr></tbody></table></figure>
<h2 id="python-project">python project</h2>
<p>python 工程表述提供了完整的标准文档, 参考官方打包标准 <a target="_blank" rel="noopener" href="https://peps.python.org/pep-0621/">PEP 621</a></p>
<p>符合官方标准 pyproject.tmol 示例如下:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/carlosperate/awesome-pyproject">https://github.com/carlosperate/awesome-pyproject</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/model_navigator/blob/main/pyproject.toml">https://github.com/triton-inference-server/model_navigator/blob/main/pyproject.toml</a></p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLR-r0edywujdxFSPtTILD8HPbEzt6MJy-">developing complete python project</a></p>
</li>
</ul>
<h3 id="project-scaffold">project scaffold</h3>
<p>使用项目模板可以快速生成一个符合 python 规范的项目.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/serious-scaffold/serious-scaffold-python">serious scaffold python project</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/scientific-python/cookie">scientific python cookie</a></p>
</li>
</ul>
<h3 id="pyproject-tmol">pyproject.tmol</h3>
<p>项目 project 配置参考 <a target="_blank" rel="noopener" href="https://packaging.python.org/en/latest/specifications/declaring-project-metadata/">declaring-project-meta</a>.</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[project]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"xxx"</span></span><br><span class="line"><span class="comment"># version, 配置版本信息,可通过setuptools-scm等工具动态管理版本</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">"0.0.1"</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">"The description of the project xxx"</span></span><br><span class="line"><span class="attr">readme</span> = <span class="string">"README.md"</span></span><br><span class="line"><span class="attr">classifiers</span> = [</span><br><span class="line">    <span class="comment"># https://pypi.org/classifiers/</span></span><br><span class="line">    <span class="comment"># Development Status</span></span><br><span class="line">    <span class="string">"Development Status :: 3 - Alpha"</span>,</span><br><span class="line">    <span class="string">"Development Status :: 4 - Beta"</span>,</span><br><span class="line">    <span class="string">"Development Status :: 5 - Production/Stable"</span>,</span><br><span class="line">    <span class="comment"># Framework</span></span><br><span class="line">    <span class="string">"Framework :: Django"</span>,</span><br><span class="line">    <span class="string">"Framework :: Flask"</span>,</span><br><span class="line">    <span class="comment"># License</span></span><br><span class="line">    <span class="string">"License :: OSI Approved :: GNU General Public License (GPL)"</span>,</span><br><span class="line">    <span class="string">"License :: OSI Approved :: MIT License"</span>,</span><br><span class="line">    <span class="string">"License :: OSI Approved :: Apache Software License"</span>,</span><br><span class="line">    <span class="string">"License :: OSI Approved :: BSD License"</span>,</span><br><span class="line">    <span class="comment"># Operating System</span></span><br><span class="line">    <span class="string">"Operating System :: OS Independent"</span>,</span><br><span class="line">    <span class="string">"Operating System :: Microsoft :: Windows"</span>,</span><br><span class="line">    <span class="string">"Operating System :: POSIX"</span>,</span><br><span class="line">    <span class="string">"Operating System :: Unix"</span>,</span><br><span class="line">    <span class="string">"Operating System :: MacOS"</span>,</span><br><span class="line">    <span class="comment"># Intended Audience</span></span><br><span class="line">    <span class="string">"Intended Audience :: Developers"</span>,</span><br><span class="line">    <span class="string">"Intended Audience :: Education"</span>,</span><br><span class="line">    <span class="string">"Intended Audience :: Science/Research"</span>,</span><br><span class="line">    <span class="comment"># Programming Language</span></span><br><span class="line">    <span class="string">"Programming Language :: Python :: 3 :: Only"</span>,</span><br><span class="line">    <span class="string">"Programming Language :: Python :: 3.7"</span>,</span><br><span class="line">    <span class="string">"Programming Language :: Python :: 3.8"</span>,</span><br><span class="line">    <span class="string">"Programming Language :: Python :: 3.9"</span>,</span><br><span class="line">    <span class="string">"Programming Language :: Python :: 3.10"</span>,</span><br><span class="line">    <span class="string">"Programming Language :: Python :: 3.11"</span>,</span><br><span class="line">    <span class="comment"># Topic</span></span><br><span class="line">    <span class="string">"Topic :: Software Development"</span>,</span><br><span class="line">    <span class="string">"Topic :: Software Development :: Libraries"</span>,</span><br><span class="line">    <span class="string">"Topic :: Software Development :: Libraries :: Python Modules"</span>,</span><br><span class="line">    <span class="string">"Topic :: Education"</span>,</span><br><span class="line">    <span class="string">"Topic :: Scientific/Engineering"</span>,</span><br><span class="line">    <span class="string">"Topic :: Scientific/Engineering :: Artificial Intelligence"</span>,</span><br><span class="line">    <span class="string">"Topic :: Scientific/Engineering :: Image Recognition"</span>,</span><br><span class="line">]</span><br><span class="line"><span class="attr">authors</span> = []</span><br><span class="line"><span class="attr">maintainers</span> = []</span><br><span class="line"><span class="attr">keywords</span> = [</span><br><span class="line">    <span class="string">"machine-learning"</span>,</span><br><span class="line">    <span class="string">"deep-learning"</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># license: A SPDX license identifier</span></span><br><span class="line"><span class="attr">license</span> = { text = <span class="string">"GPL"</span> }</span><br><span class="line"><span class="attr">license</span> = { text = <span class="string">"Apache 2.0"</span> }</span><br><span class="line"><span class="attr">license</span> = { text = <span class="string">"BSD"</span> }</span><br><span class="line"><span class="attr">requires-python</span> = <span class="string">"&gt;=3.7"</span></span><br><span class="line"><span class="comment"># 项目必要的依赖</span></span><br><span class="line"><span class="attr">dependencies</span> = [</span><br><span class="line">    <span class="string">"fire"</span>,</span><br><span class="line">    <span class="string">"gitpython&gt;=3.1.30"</span>,</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目可生成的脚本 https://setuptools.pypa.io/en/latest/userguide/entry_point.html</span></span><br><span class="line"><span class="section">[project.scripts]</span></span><br><span class="line"><span class="comment"># xxx.python-file:entry-function 指定了脚本在xxx包python-file文件中entry-function入口函数</span></span><br><span class="line"><span class="attr">cli_name</span> = <span class="string">"xxx.python-file:entry-function"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目相关的链接</span></span><br><span class="line"><span class="section">[project.urls]</span></span><br><span class="line"><span class="attr">"Documentation"</span> = <span class="string">"https://github.com/msclock/xxx"</span></span><br><span class="line"><span class="attr">"Source"</span> = <span class="string">"https://github.com/msclock/xxx"</span></span><br><span class="line"><span class="attr">"Tracker"</span> = <span class="string">"https://github.com/msclock/xxx/issues"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目可选依赖, 可通过 pip install .[test]安装对应集合依赖</span></span><br><span class="line"><span class="section">[project.optional-dependencies]</span></span><br><span class="line"><span class="comment"># 常用的测试依赖如下</span></span><br><span class="line"><span class="attr">test</span> = [</span><br><span class="line">    <span class="string">"GitPython &gt;= 3.1.30"</span>,</span><br><span class="line">    <span class="string">"pytest &gt;= 5.2"</span>,</span><br><span class="line">    <span class="string">"pytest-mock &gt;= 3.8.2"</span>,</span><br><span class="line">    <span class="string">"pytype!=2021.11.18,!=2022.2.17"</span>,</span><br><span class="line">    <span class="string">"pre-commit &gt;= 2.20.0"</span>,</span><br><span class="line">    <span class="string">"pytest-unordered ~= 0.5"</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 常用到的开发依赖如下</span></span><br><span class="line"><span class="attr">dev</span> = [</span><br><span class="line">    <span class="comment"># 可以使用分类链接的方式传递依赖组</span></span><br><span class="line">    <span class="string">"xxx[test]"</span>, <span class="comment"># 加入上面的 test 依赖</span></span><br><span class="line">    <span class="string">"black &gt;= 22.8"</span>,</span><br><span class="line">    <span class="string">"build &gt;= 0.8"</span>,</span><br><span class="line">    <span class="string">"ipython &gt;= 7.16"</span>,</span><br><span class="line">    <span class="string">"isort &gt;= 5.10"</span>,</span><br><span class="line">    <span class="string">"pdbpp &gt;= 0.10"</span>,</span><br><span class="line">    <span class="string">"pip &gt;= 21.1"</span>,</span><br><span class="line">    <span class="string">"pre-commit &gt;= 2.20.0"</span>,</span><br><span class="line">    <span class="string">"psutil ~= 5.1"</span>,</span><br><span class="line">    <span class="string">"twine &gt;= 4.0"</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="build-system">build-system</h3>
<p>使用 setuptools 后端构建系统</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[build-system]</span></span><br><span class="line"><span class="attr">requires</span> = [<span class="string">"setuptools"</span>, <span class="string">"setuptools-scm"</span>, <span class="string">"wheel"</span>]</span><br><span class="line"><span class="attr">build-backend</span> = <span class="string">"setuptools.build_meta"</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>[!NOTE]<br>
一般使用 setuptools 构建工具, 不需要指定版本</p>
</blockquote>
<h3 id="distutils">distutils</h3>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置生成 wheel 打包文件命名遵循 `pkgname-version-python_tag-xxx-xxx.whl`</span></span><br><span class="line"><span class="section">[tool.distutils.bdist_wheel]</span></span><br><span class="line"><span class="attr">python_tag</span> = <span class="string">"py37.py38.py39.py310"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="setuptools">setuptools</h3>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要包含的数据文件</span></span><br><span class="line"><span class="section">[tool.setuptools]</span></span><br><span class="line"><span class="attr">include-package-data</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">license-files</span> = [<span class="string">"LICENSE"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包使用 find 接口 https://setuptools.pypa.io/en/latest/userguide/package_discovery.html#</span></span><br><span class="line"><span class="section">[tool.setuptools.packages.find]</span></span><br><span class="line"><span class="attr">namespaces</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">include</span> = []</span><br><span class="line"><span class="comment"># 排除pkg包及自包和模块</span></span><br><span class="line"><span class="attr">exclude</span> = [<span class="string">"pkg*"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据文件</span></span><br><span class="line"><span class="section">[tool.setuptools.package-data]</span></span><br><span class="line"><span class="comment"># xxx 为指定的包名</span></span><br><span class="line"><span class="attr">xxx</span> = [<span class="string">"**/*"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用文件中变量动态生成版本信息</span></span><br><span class="line"><span class="section">[project]</span></span><br><span class="line"><span class="attr">dynamic</span> = [<span class="string">"version"</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[tool.setuptools.dynamic]</span></span><br><span class="line"><span class="comment"># attr 指向xxx包中__version__文件中 __version__变量</span></span><br><span class="line"><span class="attr">version</span> = { attr = <span class="string">"xxx.__version__.__version__"</span> }</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/serious-scaffold/serious-scaffold-python/blob/main/pyproject.toml">https://github.com/serious-scaffold/serious-scaffold-python/blob/main/pyproject.toml</a></p>
</li>
</ul>
<h3 id="setuptools-scm">setuptools-scm</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/pypa/setuptools_scm">setuptools-scm</a> 从 git 或 hg 元数据中提取 Python 包版本，而不是将它们声明为版本参数或在 SCM 托管文件中。</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in pyproject.toml</span></span><br><span class="line"><span class="section">[project]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"xxx"</span></span><br><span class="line"><span class="comment"># version = "0.0.1"  # Remove any existing version parameter.</span></span><br><span class="line"><span class="attr">dynamic</span> = [<span class="string">"version"</span>]</span><br><span class="line"><span class="section">[tool.setuptools_scm]</span></span><br><span class="line"><span class="attr">write_to</span> = <span class="string">"xxx/_version.py"</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.check-sdist]</span></span><br><span class="line"><span class="attr">sdist-only</span> = [<span class="string">"xxx/_version.py"</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/msclock/pylicense">https://github.com/msclock/pylicense</a></p>
</li>
</ul>
<h3 id="ruff">ruff</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://beta.ruff.rs/docs/">https://beta.ruff.rs/docs/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://beta.ruff.rs/docs/settings/">https://beta.ruff.rs/docs/settings/</a></p>
</li>
</ul>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in pyproject.toml</span></span><br><span class="line"><span class="section">[tool.ruff]</span></span><br><span class="line"><span class="attr">select</span> = [</span><br><span class="line">  <span class="string">"E"</span>, <span class="string">"F"</span>, <span class="string">"W"</span>, <span class="comment"># flake8</span></span><br><span class="line">  <span class="string">"B"</span>,           <span class="comment"># flake8-bugbear</span></span><br><span class="line">  <span class="string">"I"</span>,           <span class="comment"># isort</span></span><br><span class="line">  <span class="string">"N"</span>,           <span class="comment"># pep8-naming</span></span><br><span class="line">  <span class="string">"ARG"</span>,         <span class="comment"># flake8-unused-arguments</span></span><br><span class="line">  <span class="string">"C4"</span>,          <span class="comment"># flake8-comprehensions</span></span><br><span class="line">  <span class="string">"EM"</span>,          <span class="comment"># flake8-errmsg</span></span><br><span class="line">  <span class="string">"ICN"</span>,         <span class="comment"># flake8-import-conventions</span></span><br><span class="line">  <span class="string">"ISC"</span>,         <span class="comment"># flake8-implicit-str-concat</span></span><br><span class="line">  <span class="string">"PGH"</span>,         <span class="comment"># pygrep-hooks</span></span><br><span class="line">  <span class="string">"PIE"</span>,         <span class="comment"># flake8-pie</span></span><br><span class="line">  <span class="string">"PL"</span>,          <span class="comment"># pylint</span></span><br><span class="line">  <span class="string">"PT"</span>,          <span class="comment"># flake8-pytest-style</span></span><br><span class="line">  <span class="string">"RET"</span>,         <span class="comment"># flake8-return</span></span><br><span class="line">  <span class="string">"RUF100"</span>,      <span class="comment"># Ruff-specific</span></span><br><span class="line">  <span class="string">"SIM"</span>,         <span class="comment"># flake8-simplify</span></span><br><span class="line">  <span class="string">"UP"</span>,          <span class="comment"># pyupgrade</span></span><br><span class="line">  <span class="string">"YTT"</span>,         <span class="comment"># flake8-2020</span></span><br><span class="line">]</span><br><span class="line"><span class="attr">ignore</span> = [</span><br><span class="line">  <span class="string">"PLR"</span>,     <span class="comment"># Design related pylint</span></span><br><span class="line">  <span class="string">"E501"</span>,    <span class="comment"># Line too long (Black is enough)</span></span><br><span class="line">  <span class="string">"PT011"</span>,   <span class="comment"># Too broad with raises in pytest</span></span><br><span class="line">  <span class="string">"PT004"</span>,   <span class="comment"># Fixture that doesn't return needs underscore (no, it is fine)</span></span><br><span class="line">  <span class="string">"SIM118"</span>,  <span class="comment"># iter(x) is not always the same as iter(x.keys())</span></span><br><span class="line">  <span class="string">"ARG001"</span>,  <span class="comment"># Ignore unused arguments</span></span><br><span class="line">  <span class="string">"PLW0603"</span>, <span class="comment"># We're fine with global vars</span></span><br><span class="line">]</span><br><span class="line"><span class="attr">target-version</span> = <span class="string">"py37"</span></span><br><span class="line"><span class="attr">src</span> = [<span class="string">"src"</span>]</span><br><span class="line"><span class="attr">unfixable</span> = [<span class="string">"T20"</span>]</span><br><span class="line"><span class="attr">exclude</span> = []</span><br><span class="line"><span class="comment"># Allow lines to be as long as 120 characters.</span></span><br><span class="line"><span class="attr">line-length</span> = <span class="number">120</span></span><br><span class="line"><span class="attr">isort.known-first-party</span> = [<span class="string">"env"</span>, <span class="string">"pybind11_cross_module_tests"</span>, <span class="string">"pybind11_tests"</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[tool.ruff.per-file-ignores]</span> <span class="comment"># rules on the per file basis include common ignore rules</span></span><br><span class="line"><span class="attr">"tests/**"</span> = [<span class="string">"EM"</span>, <span class="string">"N"</span>]</span><br><span class="line"><span class="attr">"tests/test_call_policies.py"</span> = [<span class="string">"PLC1901"</span>]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="black">black</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>black: 标准化项目格式化</p>
</li>
</ul>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每行不超过 120</span></span><br><span class="line"><span class="section">[tool.black]</span></span><br><span class="line"><span class="attr">line-length</span> = <span class="number">120</span></span><br><span class="line"><span class="attr">target-version</span> = [<span class="string">'py38'</span>]</span><br><span class="line"><span class="attr">include</span> = <span class="string">'\.pyi?$'</span></span><br><span class="line"><span class="attr">exclude</span> = <span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">  /(</span></span><br><span class="line"><span class="string">      \.eggs         # exclude a few common directories in the</span></span><br><span class="line"><span class="string">    | \.git          # root of the project</span></span><br><span class="line"><span class="string">    | \.mypy_cache</span></span><br><span class="line"><span class="string">    | \.venv</span></span><br><span class="line"><span class="string">    | _build</span></span><br><span class="line"><span class="string">    | build</span></span><br><span class="line"><span class="string">    | dist</span></span><br><span class="line"><span class="string">  )/</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></tbody></table></figure>
<p>使用说明</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只检查错误</span></span><br><span class="line">docker run --<span class="built_in">rm</span>  -v <span class="variable">$PWD</span>:/src -w /src \</span><br><span class="line">    pyfound/black:latest_release \</span><br><span class="line">    bash -c <span class="string">"black --check ."</span></span><br><span class="line"><span class="comment"># 自动更正</span></span><br><span class="line">docker run --<span class="built_in">rm</span>  -v <span class="variable">$PWD</span>:/src -w /src \</span><br><span class="line">    pyfound/black:latest_release \</span><br><span class="line">    bash -c <span class="string">"block --quiet ."</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="isort">isort</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>isort: 标注化项目 import 语句</p>
</li>
</ul>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import导入遵循 black 工具</span></span><br><span class="line"><span class="section">[tool.isort]</span></span><br><span class="line"><span class="attr">profile</span> = <span class="string">"black"</span></span><br><span class="line"><span class="attr">line_length</span> = <span class="number">120</span></span><br></pre></td></tr></tbody></table></figure>
<p>使用说明</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只检查错误</span></span><br><span class="line">docker run --<span class="built_in">rm</span>  -v <span class="variable">$PWD</span>:/src -w /src \</span><br><span class="line">    xcgd/isort \</span><br><span class="line">    sh -c <span class="string">"isort --check ."</span></span><br><span class="line"><span class="comment"># 自动更正</span></span><br><span class="line">docker run --<span class="built_in">rm</span>  -v <span class="variable">$PWD</span>:/src -w /src \</span><br><span class="line">    xcgd/isort \</span><br><span class="line">    sh -c <span class="string">"isort ."</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="vulture">vulture</h3>
<p>Vulture 是一个 Python 代码分析工具，用于查找未使用的代码。</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.vulture]</span></span><br><span class="line"><span class="comment"># 排除不需要分析的文件或目录。</span></span><br><span class="line"><span class="attr">exclude</span> = []</span><br><span class="line"><span class="attr">ignore_decorators</span> = []</span><br><span class="line"><span class="attr">ignore_names</span> = []</span><br><span class="line"><span class="comment"># 生成一个白名单，其中包含已经被使用的标识符。</span></span><br><span class="line"><span class="attr">make_whitelist</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 设置最小置信度，即 Vulture 认为代码未使用的最低置信度。</span></span><br><span class="line"><span class="attr">min_confidence</span> = <span class="number">80</span></span><br><span class="line"><span class="comment"># 指定要分析的路径。</span></span><br><span class="line"><span class="attr">paths</span> = [<span class="string">"xxx"</span>]</span><br><span class="line"><span class="comment"># 按文件大小排序。</span></span><br><span class="line"><span class="attr">sort_by_size</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 是否显示详细的输出信息。</span></span><br><span class="line"><span class="attr">verbose</span> = <span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="pylint">pylint</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>pylint: 代码 lint</p>
</li>
</ul>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.pylint]</span></span><br><span class="line"><span class="attr">py-version</span> = <span class="string">"3.7"</span> <span class="comment"># 基于 python3.7 lint</span></span><br><span class="line"><span class="attr">reports</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">persistent</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">output-format</span> = [ <span class="comment"># lint 输出格式</span></span><br><span class="line">    <span class="comment"># "json:.report.pylint.json",</span></span><br><span class="line">    <span class="string">"colorized"</span>,</span><br><span class="line">]</span><br><span class="line"><span class="attr">messages_control.disable</span> = [ <span class="comment"># lint时静默错误选项</span></span><br><span class="line">    <span class="string">"design"</span>,</span><br><span class="line">    <span class="string">"fixme"</span>,</span><br><span class="line">    <span class="string">"imports"</span>,</span><br><span class="line">    <span class="string">"line-too-long"</span>,</span><br><span class="line">    <span class="string">"imports"</span>,</span><br><span class="line">    <span class="string">"invalid-name"</span>,</span><br><span class="line">    <span class="string">"protected-access"</span>,</span><br><span class="line">    <span class="string">"missing-module-docstring"</span>,</span><br><span class="line">    <span class="string">"consider-using-f-string"</span>,</span><br><span class="line">    <span class="string">"unspecified-encoding"</span>,</span><br><span class="line">]</span><br><span class="line"><span class="attr">ignored-modules</span> = [<span class="string">"xxx"</span>] <span class="comment"># 忽视某些模块错误</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="mypy">mypy</h3>
<p>集成 mypy 代码检查, 配置示例如下:</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.mypy]</span></span><br><span class="line"><span class="attr">explicit_package_bases</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">mypy_path</span> = <span class="string">"."</span></span><br><span class="line"><span class="attr">namespace_packages</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">ignore_missing_imports</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">ignore_missing_imports_per_module</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment"># disallow_untyped_defs = true</span></span><br><span class="line"><span class="comment"># no_implicit_optional = true</span></span><br><span class="line"><span class="comment"># strict_optional = true</span></span><br><span class="line"><span class="comment"># warn_redundant_casts = true</span></span><br><span class="line"><span class="attr">check_untyped_defs</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">exclude</span> = <span class="string">'''(?x)(</span></span><br><span class="line"><span class="string">    directory-to-exclude</span></span><br><span class="line"><span class="string">)'''</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[tool.mypy.overrides]]</span></span><br><span class="line"><span class="attr">module</span> = [<span class="string">"skbuild.*"</span>, <span class="string">"setuptools.*"</span>, <span class="string">"another-module-name.*"</span>]</span><br><span class="line"><span class="attr">ignore_missing_imports</span> = <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="pytest">pytest</h3>
<p>使用集成 pytest 单元测试, 配置示例如下:</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.pytest.ini_options]</span></span><br><span class="line"><span class="attr">testpaths</span> = [<span class="string">"test"</span>]</span><br><span class="line"><span class="attr">python_files</span> = [<span class="string">"test_*.py"</span>, <span class="string">"*_test.py"</span>, <span class="string">"testing/python/*.py"</span>]</span><br><span class="line"><span class="attr">python_classes</span> = [<span class="string">"Test"</span>, <span class="string">"Acceptance"</span>]</span><br><span class="line"><span class="attr">python_functions</span> = [<span class="string">"test"</span>]</span><br><span class="line"><span class="attr">filterwarnings</span> = [<span class="string">"error"</span>]</span><br><span class="line"><span class="attr">xfail_strict</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">addopts</span> = [</span><br><span class="line">    <span class="string">"-ra"</span>,</span><br><span class="line">    <span class="string">"--showlocals"</span>,</span><br><span class="line">    <span class="string">"--strict-markers"</span>,</span><br><span class="line">    <span class="string">"--strict-config"</span>,</span><br><span class="line">    <span class="comment"># 导入模块时使用importlib模块</span></span><br><span class="line">    <span class="string">"--import-mode=importlib"</span></span><br><span class="line">]</span><br><span class="line"><span class="attr">minversion</span> = <span class="string">"6.0"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="codespell">codespell</h3>
<p>使用 codespell 检测拼写错误, 配置示例如下:</p>
<figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pyproject.toml</span></span><br><span class="line"><span class="section">[tool.codespell]</span></span><br><span class="line"><span class="comment"># <span class="doctag">note:</span> pre-commit passes explicit lists of files here, which this skip file list doesn't override -</span></span><br><span class="line"><span class="comment"># this is only to allow you to run codespell interactively</span></span><br><span class="line"><span class="attr">skip</span> = <span class="string">"./.git,./.github"</span></span><br><span class="line"><span class="comment"># ignore short words, and typename parameters like offset</span></span><br><span class="line"><span class="attr">ignore-regex</span> = <span class="string">"\\b(.{1,4}|[A-Z]\\w*T)\\b"</span></span><br><span class="line"><span class="comment"># ignore allowed words</span></span><br><span class="line"><span class="attr">ignore-words-list</span> = <span class="string">"passing"</span></span><br><span class="line"><span class="comment"># use the 'clear' dictionary for unambiguous spelling mistakes</span></span><br><span class="line"><span class="attr">builtin</span> = <span class="string">"clear"</span></span><br><span class="line"><span class="comment"># disable warnings about binary files and wrong encoding</span></span><br><span class="line"><span class="attr">quiet-level</span> = <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
<p>以上需要在配合 .pre-commit-config.yaml 使用</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/codespell-project/codespell</span></span><br><span class="line">  <span class="attr">rev:</span> <span class="string">v2.2.4</span></span><br><span class="line">  <span class="attr">hooks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">codespell</span></span><br><span class="line">    <span class="attr">additional_dependencies:</span> [<span class="string">tomli</span>]</span><br><span class="line">    <span class="attr">args:</span> [<span class="string">"--toml"</span>, <span class="string">"pyproject.toml"</span>]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="py-typed">py.typed</h3>
<p><code>py.typed</code> 文件是用来标识 Python 包是类型注解的支持者。当一个包中存在<code>py.typed</code>文件时，它表示该包是类型注解的友好包，即使用了类型注解来增强代码可读性和可维护性。</p>
<p><code>py.typed</code>文件的存在告诉类型检查工具（如 mypy）和 IDE（如 PyCharm）等，该包中包含了类型注解，并且可以进行静态类型检查和自动补全等操作。</p>
<blockquote>
<p>[!NOTE]<br>
需要注意的是，<code>py.typed</code>文件本身不包含任何代码或内容，它只是一个标识文件。</p>
</blockquote>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://typing.readthedocs.io/en/latest/source/libraries.html#marking-a-package-as-providing-type-information">https://typing.readthedocs.io/en/latest/source/libraries.html#marking-a-package-as-providing-type-information</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/python/pylance-introduces-five-new-features-that-enable-type-magic-for-python-developers/">https://devblogs.microsoft.com/python/pylance-introduces-five-new-features-that-enable-type-magic-for-python-developers/</a></p>
</li>
</ul>
<h3 id="Packing">Packing</h3>
<p>配置完 pyproject.toml 后, 打包可以使用以下命令:</p>
<p>使用 build</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install build</span><br><span class="line">python -m build</span><br></pre></td></tr></tbody></table></figure>
<p>使用 pip</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip wheel .</span><br></pre></td></tr></tbody></table></figure>
<h3 id="upload-to-pypi">upload to pypi</h3>
<p>打包完后, 如果需要上传到 pypi 上, 参考 <a target="_blank" rel="noopener" href="https://pypi.org/project/GitHub-Action-Python-Example/">Github-Action-Python-Example</a>.</p>
<h4 id="twine">twine</h4>
<p>上传工具一般选择 twine, 使用方式如下:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pip install twine</span><br><span class="line"><span class="comment"># Packing locally</span></span><br><span class="line">python -m build</span><br><span class="line"><span class="comment"># Upload package in the generated folder dist</span></span><br><span class="line"><span class="built_in">export</span> TWINE_USERNAME=__token__</span><br><span class="line"><span class="comment"># api key generated by pypi</span></span><br><span class="line"><span class="built_in">export</span> TWINE_PASSWORD=[key]</span><br><span class="line">twine upload --verbose --skip-existing dist/*</span><br></pre></td></tr></tbody></table></figure>
<!--
pypi-key is on the edge
-->
<h4 id="集成到-GitHub">集成到 GitHub</h4>
<p>使用 GitHub <a target="_blank" rel="noopener" href="https://github.com/pypa/gh-action-pypi-publish">Python pypi upload</a> 模板, 使用示例参考:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/msclock/yolov5-utils/blob/main/.github/workflows/python-publish.yml">https://github.com/msclock/yolov5-utils/blob/main/.github/workflows/python-publish.yml</a></p>
</li>
</ul>
<h4 id="集成到-GitLab">集成到 GitLab</h4>
<p>参考<a href="#twine">twine</a> 配置 GitLab CI 脚本即可.</p>
<h2 id="docs-generator">docs generator</h2>
<p>python 流行的文档生成器, 包括 sphinx.</p>
<h3 id="sphinx">sphinx</h3>
<p><a target="_blank" rel="noopener" href="https://docs.readthedocs.io/en/stable/index.html">sphinx</a> 是一个非常流行的 python 文档生成工具.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install sphinx</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://sphinx-themes.org/">sphinx-themes</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/264647009">zhihu 简单入门</a></p>
</li>
</ul>
<h4 id="Quickstart">Quickstart</h4>
<p>使用 sphinx-quickstart 工具快速配置</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sphinx-quickstart</span><br><span class="line"><span class="comment"># 后续根据提示设置项目信息</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="api-generation">api generation</h4>
<blockquote>
<p>[!NOTE]<br>
生成完整的 api 依赖于包包含<code>__init__.py</code></p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aphinx-apidoc -o docs path-to-packages</span><br></pre></td></tr></tbody></table></figure>
<p>接下来将生成的 package 文档指定显示在 index 中.</p>
<h4 id="conf-py"><a target="_blank" rel="noopener" href="http://conf.py">conf.py</a></h4>
<h4 id="Add-jupter-support">Add jupter support</h4>
<p><a target="_blank" rel="noopener" href="https://docs.readthedocs.io/en/stable/guides/jupyter.html">在 sphinx 文档中集成 jupyter</a></p>
<p>配置集成 jupyter 插件 <a target="_blank" rel="noopener" href="https://myst-nb.readthedocs.io/">myst-bn</a>.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># conf.py</span></span><br><span class="line">extensions = [</span><br><span class="line">    <span class="string">"myst_nb"</span>,</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>
<p>在 index 中添加 jupyter 链接</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">maxdepth: 2</span><br><span class="line">caption: Contents:</span><br><span class="line">---</span><br><span class="line">notebooks/Example 1</span><br></pre></td></tr></tbody></table></figure>
<h3 id="readthedocs">readthedocs</h3>
<p>在 Read the Docs 网站 <a target="_blank" rel="noopener" href="https://readthedocs.org/">https://readthedocs.org/</a> 注册，并绑定 GitHub 账户。点击 “Import a Project” 导入项目，输入项目名称和仓库地址, 可免费在线托管项目文档。</p>
<h2 id="scikit-build-core">scikit-build-core</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/scikit-build/scikit-build-core">scikit-build-core</a> 用于适配基于 cmake 的 python 构建工具.</p>
<p>参考文档:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://scikit-build-core.readthedocs.io/en/latest/index.html">官方文档</a></p>
</li>
</ul>
<p>参考 demo 示例:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/pybind/scikit_build_example">官方示例 scikit_build_example (with pybind11)</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/scikit-build/scikit-build-sample-projects">官方示例 scikit-build-sample-projects</a></p>
</li>
</ul>
<h2 id="multiprocessing">multiprocessing</h2>
<p>主要总结<code>multiprocessing</code>的常用方法及问题解决方法。</p>
<!-- more -->
<h3 id="Queue">Queue</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://runebook.dev/zh-CN/docs/python/library/multiprocessing?page=4#multiprocessing.Queue">参考文档 runebook</a></p>
</li>
</ul>
<h3 id="Manager">Manager</h3>
<p>管理器提供了一种创建可以在不同进程之间共享的数据的方法，包括通过网络在不同机器上运行的进程之间共享。管理器对象控制管理共享对象的服务器进程。其他进程可以使用代理访问共享对象。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>multiprocessing.Manager()</p>
</li>
</ul>
<p>返回一个已启动的 SyncManager 对象，该对象可用于在进程之间共享对象。返回的管理器对象对应于一个衍生的子进程，并具有创建共享对象和返回相应代理的方法。</p>
<h4 id="SyncManager">SyncManager</h4>
<p>BaseManager 的子类，可用于进程同步。这种类型的对象由 multiprocessing.Manager() 返回。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://runebook.dev/zh-CN/docs/python/library/multiprocessing?page=7#multiprocessing.managers.SyncManager">参考文档 runebook</a></p>
</li>
</ul>
<h3 id="QA">QA</h3>
<h4 id="RuntimeError-Queue-objects-should-only-be-shared-between-processes-through-inheritance">RuntimeError: Queue objects should only be shared between processes through inheritance</h4>
<p>使用 multiprocessing.Queue 通常会报以上错误。因为 multiprocessing.Queue 只能在父子进程间进行队列同步通信。对于使用进程池，需要使用 multiprocessing.Manager.Queue 创建共享的通信队列。示例:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue, Pool</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写数据进程执行的代码:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">q, lock</span>):</span><br><span class="line">    lock.acquire()  <span class="comment"># 加上锁</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> [<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Put <span class="subst">{value}</span> to queue..."</span>)</span><br><span class="line">        q.put(value)</span><br><span class="line">    lock.release()  <span class="comment"># 释放锁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读数据进程执行的代码:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">q</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">            value = q.get(<span class="literal">False</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Get <span class="subst">{value}</span> from queue."</span>)</span><br><span class="line">            time.sleep(random.random())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    manager = multiprocessing.Manager()</span><br><span class="line">    <span class="comment"># 父进程创建Queue，并传给各个子进程：</span></span><br><span class="line">    q = manager.Queue()</span><br><span class="line">    lock = manager.Lock()  <span class="comment"># 初始化一把锁</span></span><br><span class="line">    p = Pool()</span><br><span class="line">    pw = p.apply_async(write, args=(q, lock))</span><br><span class="line">    pr = p.apply_async(read, args=(q,))</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="concurrency">concurrency</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://superfastpython.com/learning-paths/">https://superfastpython.com/learning-paths/</a></p>
</li>
</ul>
<h3 id="paths">paths</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>threading in python: <a target="_blank" rel="noopener" href="https://superfastpython.com/threading-in-python/">https://superfastpython.com/threading-in-python/</a></p>
</li>
<li class="lvl-2">
<p>threadpoolexecutor: <a target="_blank" rel="noopener" href="https://superfastpython.com/threadpoolexecutor-in-python/">https://superfastpython.com/threadpoolexecutor-in-python/</a></p>
</li>
</ul>
<h2 id="加密和解密">加密和解密</h2>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yyds/p/7072492.html">python 加密解密相关介绍</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/144316610">知乎 - 常见的加密算法实现</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/387705013">知乎 - pyarmor</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/54296517">保护 python 源码</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/stpeace/article/details/41598665">基本 license 原理</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/sobolevn/awesome-cryptography#python">awesome-encryption in python</a></p>
</li>
</ul>
<h3 id="cryptography">cryptography</h3>
<p>cryptography 是一个设计用于向 Python 开发人员公开加密原语和配方的包。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/pyca/cryptography">https://github.com/pyca/cryptography</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/multifernet-module-in-python/">multifernet 介绍</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.ssh.com/academy/secrets-management/password-key-rotation">ssh key rotation</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/msclock/pyauthorizer">pyauthorizer 基于 cryptography 的 token 授权工具</a></p>
</li>
</ul>
<h3 id="nuitka">nuitka</h3>
<p>出于安全原因，有时需要将源代码转换为可执行文件，以防止它们被篡改或泄露。有几种工具可以做到这一点, 最受欢迎的是 pyinstaller 和 nuitka。这里用的是 nuitka。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/Nuitka/Nuitka">https://github.com/Nuitka/Nuitka</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://nuitka.net/doc/user-manual.html#use-cases">https://nuitka.net/doc/user-manual.html#use-cases</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.com/msclock/pytools">https://gitlab.com/msclock/pytools</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45752541/article/details/127683219">fastapi 及 nuitka 打包</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/463597594">pyinstaller 及 nuitka 打包</a></p>
</li>
</ul>
<h4 id="plugins">plugins</h4>
<p>在打包某些包时做一些 patch 或者 hacking 操作的插件, 方便适配社区发布的包及自定义加密操作.</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/Nuitka/Nuitka/tree/develop/nuitka/plugins">nuitka plugin</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/Nuitka/Nuitka/blob/develop/UserPlugin-Creation.rst">create a user plugin</a></p>
</li>
</ul>
<h4 id="configuration">configuration</h4>
<p>若转换后缺少某些依赖 (dll / data)，可以在配置文件中添加。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://nuitka.net/doc/nuitka-package-config.html">https://nuitka.net/doc/nuitka-package-config.html</a></p>
</li>
</ul>
<p>在确定包的依赖时，可以使用以下命令查看是否是缺少依赖关系:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出numpy依赖</span></span><br><span class="line">python -m nuitka --list-package-dlls=numpy</span><br><span class="line">Nuitka-Tools:INFO: Checking package directory <span class="string">'C:\tools\mambaforge\envs\3.8\lib\site-packages\numpy'</span> ..</span><br><span class="line">C:\tools\mambaforge\envs\3.8\lib\site-packages\numpy\.libs</span><br><span class="line">  libopenblas.EL2C6PLE4ZYW3ECEVIV3OXXGRN2NRFM2.gfortran-win_amd64.dll</span><br><span class="line">Nuitka-Tools:INFO: Found 1 DLLs.</span><br><span class="line"></span><br><span class="line"><span class="comment"># !!! shapely 1.8.0以下打包库链接存在bug,尽量用1.8.0以上的版本</span></span><br><span class="line">python -m nuitka  --list-package-dlls=shapely</span><br><span class="line">Nuitka-Tools:INFO: Checking package directory <span class="string">'C:\tools\mambaforge\envs\3.8\lib\site-packages\shapely'</span> ..</span><br><span class="line">C:\tools\mambaforge\envs\3.8\lib\site-packages\shapely\DLLs</span><br><span class="line">  geos.dll</span><br><span class="line">  geos_c.dll</span><br><span class="line">Nuitka-Tools:INFO: Found 2 DLLs.</span><br></pre></td></tr></tbody></table></figure>
<p>更详细的使用自定义配置文件参考<a target="_blank" rel="noopener" href="https://gitlab.com/msclock/pytools/-/tree/master/nuitka?ref_type=heads">示例</a></p>
<h3 id="pyarmor">pyarmor</h3>
<p>Pyarmor 是一个用于加密和保护 Python 脚本的工具。它能够在运行时刻保护 Python 脚本代码不被泄露，设置加密后脚本的使用期限，绑定加密脚本到硬盘、网卡等硬件设备。</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pyarmor.readthedocs.io/zh/latest/">https://pyarmor.readthedocs.io/zh/latest/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/Svenskithesource/PyArmor-Unpacker">PyArmor-Unpacker (pyarmor 破解器)</a></p>
</li>
</ul>
<h2 id="plugin-mechanisms">plugin mechanisms</h2>
<p>python 中的插件机制主要依赖于包分发或模块加载机制。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pypi.org/project/entrypoints/">entrypoints</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/importlib.metadata.html#entry-points">importlib.metadata#entry-points</a></p>
</li>
</ul>
<h3 id="Example-of-entrypoints">Example of entrypoints</h3>
<p>基于 entrypoints 的插件机制的使用示例</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/msclock/pyauthorizer">https://github.com/msclock/pyauthorizer</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/jimporter/mike">https://github.com/jimporter/mike</a></p>
</li>
</ul>
<h2 id="marshmallow">marshmallow</h2>
<p>适用于各个场景的序列化包 marshmallow</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>验证</strong>: 输入数据。</p>
</li>
<li class="lvl-2">
<p><strong>反序列化</strong>: 输入数据为应用程序级对象。</p>
</li>
<li class="lvl-2">
<p><strong>序列化</strong>: 应用程序级对象为原始 Python 类型。然后，可以将序列化对象呈现为标准格式，例如 JSON ，以便在 HTTP API 中使用。</p>
</li>
</ul>
<h3 id="序列化-反序列化">序列化 &amp; 反序列化</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    price: Decimal</span><br><span class="line">    date: datetime.date</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于其他的所有类型 fields, 可以参考文档</span></span><br><span class="line"><span class="comment"># https://marshmallow.readthedocs.io/en/stable/marshmallow.fields.html#api-fields</span></span><br><span class="line"><span class="keyword">from</span> marshmallow <span class="keyword">import</span> Schema, fields</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ItemSchema</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    name = fields.String()</span><br><span class="line">    price = fields.Decimal()</span><br><span class="line">    date = fields.Date()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">item = Item(<span class="string">"abc"</span>, Decimal(<span class="string">"1.23456"</span>), datetime.date(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">26</span>))</span><br><span class="line">schema = ItemSchema()</span><br><span class="line">result_obj = schema.dump(item)</span><br><span class="line"><span class="built_in">print</span>(result_obj)</span><br><span class="line"><span class="comment"># 会输出 {'price': Decimal('1.23456'), 'name': 'abc', 'date': '2021-06-26'}</span></span><br><span class="line"></span><br><span class="line">input_data = {<span class="string">"name"</span>: <span class="string">"abc"</span>, <span class="string">"price"</span>: Decimal(<span class="string">"1.23456"</span>), <span class="string">"date"</span>: <span class="string">"2021-06-26"</span>}</span><br><span class="line">load_result = schema.load(input_data)</span><br><span class="line"><span class="built_in">print</span>(load_result)  <span class="comment"># dict</span></span><br><span class="line"><span class="comment"># 输出 {'name': 'abc', 'date': datetime.date(2021, 6, 26), 'price': Decimal('1.23456')}</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="post-load">post_load</h3>
<p>控制反序列化，构造对象</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"><span class="keyword">import</span> decimal</span><br><span class="line"><span class="keyword">from</span> marshmallow <span class="keyword">import</span> Schema, fields, post_load</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ItemSchema</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    name = fields.String()</span><br><span class="line">    price = fields.Decimal()</span><br><span class="line">    date = fields.Date()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @post_load</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_item</span>(<span class="params">self, data, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> Item(**data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result_obj = schema.dump(item)</span><br><span class="line"><span class="built_in">print</span>(result_obj)</span><br><span class="line"><span class="comment"># 返回 Item(name='abc', price=Decimal('1.23456'), date=datetime.date(2021, 6, 26))</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="fields-Method">fields.Method</h3>
<p>自定义字段序列化需求</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> marshmallow <span class="keyword">import</span> Schema, fields, post_load</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ItemSchema</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    <span class="string">"""Define serialization protocol for class Item</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        name: str to be registered by the schema</span></span><br><span class="line"><span class="string">        price: custom way to be registered</span></span><br><span class="line"><span class="string">        date: date to be registered</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    name = fields.String()</span><br><span class="line">    price = fields.Method(<span class="string">"price_decimal_2_float"</span>, deserialize=<span class="string">"float_2_decimal"</span>)</span><br><span class="line">    date = fields.Date()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @post_load  </span><span class="comment"># post_load to make the schema deserialized as object-like</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_item</span>(<span class="params">self, data, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> Item(**data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">price_decimal_2_float</span>(<span class="params">self, item: Item</span>):</span><br><span class="line">        <span class="string">"""price attr to save"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">float</span>(item.price)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">float_2_decimal</span>(<span class="params">self, <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="string">"""price attr to load"""</span></span><br><span class="line">        <span class="keyword">return</span> decimal.Decimal(<span class="built_in">str</span>(<span class="built_in">float</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">item = Item(<span class="string">"abc"</span>, Decimal(<span class="string">"1.23456"</span>), datetime.date(<span class="number">2021</span>, <span class="number">6</span>, <span class="number">26</span>))</span><br><span class="line">schema = ItemSchema()</span><br><span class="line">result_str = schema.dumps(item)</span><br><span class="line"><span class="built_in">print</span>(result_str)</span><br><span class="line"><span class="comment"># {"date": "2021-06-26", "name": "abc", "price": 1.23456}</span></span><br><span class="line">input_str = <span class="string">'{"date": "2021-06-26", "name": "abc", "price": 1.23456}'</span></span><br><span class="line">load_result = schema.loads(input_str)</span><br><span class="line"><span class="built_in">print</span>(load_result)</span><br><span class="line"><span class="comment"># Item(name='abc', price=Decimal('1.23456'), date=datetime.date(2021, 6, 26))</span></span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://marshmallow.readthedocs.io/en/stable/">https://marshmallow.readthedocs.io/en/stable/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.7forz.com/3694/">https://www.7forz.com/3694/</a></p>
</li>
</ul>
<h2 id="pytest-2">pytest</h2>
<p><code>pytest</code> 是一个非常成熟的全功能的 <code>Python</code> 测试框架，主要特点有以下几点：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>简单灵活，容易上手，文档丰富；</p>
</li>
<li class="lvl-2">
<p>支持参数化，可以细粒度地控制要测试的测试用例；</p>
</li>
<li class="lvl-2">
<p>能够支持简单的单元测试和复杂的功能测试，还可以用来做<code>selenium/appnium</code>等自动化测试、接口自动化测试（<code>pytest</code>+<code>requests</code>）;</p>
</li>
<li class="lvl-2">
<p><code>pytest</code>具有很多第三方插件，并且可以自定义扩展，比较好用的如<code>pytest-selenium</code>（集成<code>selenium</code>）、<code>pytest-html</code>（完美 <code>html</code> 测试报告生成）、<code>pytest-rerunfailures</code>（失败 case 重复执行）、<code>pytest-xdist</code>（多 CPU 分发）等；</p>
</li>
<li class="lvl-2">
<p>测试用例的<code>skip</code>和<code>xfail</code>处理；</p>
</li>
</ul>
<!-- more -->
<h3 id="退出码">退出码</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>查看退出码</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Python 3.7.8 (tags/v3.7.8:4b47a5b6ba, Jun 28 2020, 08:53:46) [MSC v.1916 64 bit (AMD64)] on win32</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; from pytest import ExitCode</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">help</span>(ExitCode)</span><br><span class="line">Help on class ExitCode <span class="keyword">in</span> module _pytest.config:</span><br><span class="line"></span><br><span class="line">class ExitCode(enum.IntEnum)</span><br><span class="line"> |  ExitCode(value, names=None, *, module=None, qualname=None, <span class="built_in">type</span>=None, start=1)</span><br><span class="line"> |</span><br><span class="line"> |  Encodes the valid <span class="built_in">exit</span> codes by pytest.</span><br><span class="line"> |</span><br><span class="line"> |  Currently <span class="built_in">users</span> and plugins may supply other <span class="built_in">exit</span> codes as well.</span><br><span class="line"> |</span><br><span class="line"> |  .. versionadded:: 5.0</span><br><span class="line"> |</span><br><span class="line"> |  Method resolution order:</span><br><span class="line"> |      ExitCode</span><br><span class="line"> |      enum.IntEnum</span><br><span class="line"> |      builtins.int</span><br><span class="line"> |      enum.Enum</span><br><span class="line"> |      builtins.object</span><br><span class="line"> |</span><br><span class="line"> |  Data and other attributes defined here:</span><br><span class="line"> |</span><br><span class="line"> |  INTERNAL_ERROR = &lt;ExitCode.INTERNAL_ERROR: 3&gt; <span class="comment"># 内部发生错误</span></span><br><span class="line"> |</span><br><span class="line"> |  INTERRUPTED = &lt;ExitCode.INTERRUPTED: 2&gt; <span class="comment"># 测试过程被用户中断</span></span><br><span class="line"> |</span><br><span class="line"> |  NO_TESTS_COLLECTED = &lt;ExitCode.NO_TESTS_COLLECTED: 5&gt; <span class="comment"># 没有实际的运行case</span></span><br><span class="line"> |</span><br><span class="line"> |  OK = &lt;ExitCode.OK: 0&gt;  <span class="comment"># 全部测试case运行成功</span></span><br><span class="line"> |</span><br><span class="line"> |  TESTS_FAILED = &lt;ExitCode.TESTS_FAILED: 1&gt; <span class="comment"># 存在测试case失败</span></span><br><span class="line"> |</span><br><span class="line"> |  USAGE_ERROR = &lt;ExitCode.USAGE_ERROR: 4&gt; <span class="comment"># pytest命令行使用错误</span></span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data descriptors inherited from enum.Enum:</span><br><span class="line"> |</span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-3">
<p>和 shell 第二次封装调用检测退出码使用 <code>echo $?</code></p>
</li>
<li class="lvl-2">
<p>扩展退出码，通过插件<code>pytest-custom_exit_code</code>扩展。</p>
</li>
</ul>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.pytest.org">pytest 官方文档</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://learning-pytest.readthedocs.io/">pytest 中文文档</a></p>
</li>
</ul>
<h2 id="Flask">Flask</h2>
<h3 id="Explore-Flask">Explore Flask</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/rpicard/explore-flask">Flask Practice</a> 是 github 上社区总结的实践参考.</p>
<h3 id="Flasky">Flasky</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/miguelgrinberg/flasky">flasky</a> 是 O’Reilly 的书 Flask Web Development 的第二版的源代码示例</p>
<h3 id="wsgi">wsgi</h3>
<p>Flask 的默认运行模式是单进程单线程，这意味着它在处理请求时是阻塞的。也就是说，当一个请求正在被处理时，其他的请求必须等待。这对于开发和测试来说通常是可以接受的，但在生产环境中，可能需要一个能够同时处理多个请求的服务器。</p>
<p>要使 Flask 非阻塞，可以使用一个能够处理并发请求的 WSGI 服务器，如 Gunicorn 或 uWSGI。这些服务器可以配置为多进程或多线程模式，从而能够同时处理多个请求。</p>
<p>例如，可以使用 Gunicorn 来运行 Flask 应用，并设置工作进程的数量：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn -w 4 -b 0.0.0.0:5000 <span class="string">'module:app'</span></span><br></pre></td></tr></tbody></table></figure>
<p>在这个命令中，-w 4 设置了 4 个工作进程，这意味着 Gunicorn 可以同时处理 4 个请求。</p>
<p>请注意，虽然这可以提高并发处理能力，但并不能真正实现非阻塞。如果需要非阻塞或异步处理，可能需要考虑使用像 gevent 这样的库，或者使用基于 ASGI 的框架，如 FastAPI 或 Starlette1。</p>
<h3 id="gunicorn">gunicorn</h3>
<p>匹配 flask 的 wsgi 为 gunicorn</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn -w 4 -b 0.0.0.0:5000 <span class="string">'module:app'</span></span><br></pre></td></tr></tbody></table></figure>
<p>在这个命令中：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>-w 4 表示启动 4 个工作进程</p>
</li>
<li class="lvl-2">
<p>-b 0.0.0.0:5000 表示绑定到所有 IP 地址的 5000 端口</p>
</li>
<li class="lvl-2">
<p>‘module:app’ 是 flask 应用的导入路径和应用变量。例如，如果应用在 app.py 文件中，应该使用’app:app’</p>
</li>
</ul>
<h3 id="gevent">gevent</h3>
<p>gevent 作为 flask 的 wsgi.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gevent</span><br></pre></td></tr></tbody></table></figure>
<p>参考:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Xin_101/article/details/86663627">gevent 及 flask 阻塞评测</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lcylln/article/details/33731183">flask 及 tornado, gevent 性能评测</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/131364462">gevent 知乎参考</a></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent.pywsgi <span class="keyword">import</span> WSGIServer</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"></span><br><span class="line">http_server = WSGIServer((<span class="string">"0.0.0.0"</span>, <span class="number">8000</span>), flask.Flask(__file__))</span><br><span class="line">http_server.serve_forever()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="FastAPI">FastAPI</h2>
<p>参考链接:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/157999491">https://zhuanlan.zhihu.com/p/157999491</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/tiangolo/full-stack-fastapi-postgresql">https://github.com/tiangolo/full-stack-fastapi-postgresql</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=iWS9ogMPOI0">https://www.youtube.com/watch?v=iWS9ogMPOI0</a></p>
</li>
</ul>
<h3 id="uvicorn">uvicorn</h3>
<p>fastapi 通常配合 uvicorn 在生成环境中使用.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uvicorn main:app --reload</span><br></pre></td></tr></tbody></table></figure>
<h2 id="subprocess">subprocess</h2>
<h3 id="subprocess运行子进程">subprocess 运行子进程</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">args = [<span class="string">"python"</span>, <span class="string">"-c"</span>, <span class="string">'"print(hello)"'</span>]</span><br><span class="line">subprocess.run(args=args, capture_output=<span class="literal">True</span>).stdout.decode().strip(<span class="string">"\n"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="argparse">argparse</h2>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tt.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_args</span>():</span><br><span class="line">    <span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">    root_parser = argparse.ArgumentParser()</span><br><span class="line">    subs = root_parser.add_subparsers(dest=<span class="string">"action"</span>)</span><br><span class="line">    subs.required = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    sub1_parser = subs.add_parser(<span class="string">"sub1"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># positional argument</span></span><br><span class="line">    sub1_parser.add_argument(<span class="string">"p1"</span>)</span><br><span class="line">    <span class="comment"># optional</span></span><br><span class="line">    sub1_parser.add_argument(<span class="string">"--batch_size"</span>, <span class="string">"-b"</span>, default=<span class="number">8</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">return</span> root_parser.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    FLAGS = parse_args()</span><br><span class="line">    <span class="built_in">print</span>(**<span class="built_in">vars</span>(FLAGS))  <span class="comment"># print as dict</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python tt.py</span></span><br><span class="line"><span class="comment"># usage: tt.py [-h] {sub1} ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># positional arguments:</span></span><br><span class="line"><span class="comment">#   {sub1}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># optional arguments:</span></span><br><span class="line"><span class="comment">#   -h, --help  show this help message and exit</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="gradio">gradio</h2>
<p><a target="_blank" rel="noopener" href="https://www.gradio.app/">gradio</a> 是一个快速构建 AI demo app 的 web 应用框架. 安装 <code>pip install gradio</code>.</p>
<p>教程参考:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.gradio.app/docs/">gradio docs</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15485092/6223566">51cto blog Gradio 入门到进阶全网最详细教程</a></p>
</li>
</ul>
<h3 id="Quickstart-2">Quickstart</h3>
<p>官方示例, 完整文档<a target="_blank" rel="noopener" href="https://www.gradio.app/quickstart/">参考</a>.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gradio <span class="keyword">as</span> gr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello "</span> + name + <span class="string">"!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iface = gr.Interface(fn=greet, inputs=<span class="string">"text"</span>, outputs=<span class="string">"text"</span>)</span><br><span class="line">iface.test_launch()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Share-app">Share app</h3>
<p>共享 app <a target="_blank" rel="noopener" href="https://www.gradio.app/sharing-your-app/">参考</a></p>
<p>以下是一个 fast api</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from fastapi import FastAPI</span><br><span class="line">import gradio as gr</span><br><span class="line"></span><br><span class="line">CUSTOM_PATH = <span class="string">"/gradio"</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.get(<span class="string">"/"</span>)</span><br><span class="line">def read_main():</span><br><span class="line">    <span class="built_in">return</span> {<span class="string">"message"</span>: <span class="string">"This is your main app"</span>}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io = gr.Interface(lambda x: <span class="string">"Hello, "</span> + x + <span class="string">"!"</span>, <span class="string">"textbox"</span>, <span class="string">"textbox"</span>)</span><br><span class="line">app = gr.mount_gradio_app(app, io, path=CUSTOM_PATH)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run this from the terminal as you would normally start a FastAPI app: `uvicorn run:app`</span></span><br><span class="line"><span class="comment"># and navigate to http://localhost:8000/gradio in your browser.</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="streamlit">streamlit</h2>
<p><a target="_blank" rel="noopener" href="https://www.gradio.app/">streamlit</a> 是一个相比于 gradio 更基础的 web app  构建框架.</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>docs: <a target="_blank" rel="noopener" href="https://docs.streamlit.io/">https://docs.streamlit.io/</a></p>
</li>
</ul>
<h2 id="Fire">Fire</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/google/python-fire">Fire</a> 将转换任何 Python 模块、类、对象、函数等 (任何 Python 组件都可以工作!) 变成了 CLI。它被称为 Fire 是因为当调用 Fire () 时，它会激活命令。</p>
<h3 id="Using-function">Using function</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hello.py</span></span><br><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">name=<span class="string">"World"</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello {name}!"</span>.<span class="built_in">format</span>(name=name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire(hello)  <span class="comment"># 当不显示指定时,默认全部导出</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python hello.py --<span class="built_in">help</span></span><br><span class="line">INFO: Showing <span class="built_in">help</span> with the <span class="built_in">command</span> <span class="string">'hello.py -- --help'</span>.</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    hello.py</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">    hello.py &lt;flags&gt;</span><br><span class="line"></span><br><span class="line">FLAGS</span><br><span class="line">    --name=NAME</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Using-class">Using class</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">"""A simple calculator class."""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">double</span>(<span class="params">self, number</span>):</span><br><span class="line">        <span class="string">"""subcommand 1"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * number</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">triple</span>(<span class="params">self, number</span>):</span><br><span class="line">        <span class="string">"""subcommand 2"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span> * number</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire(Calculator)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Using-object">Using object</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> x * y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    calculator = Calculator()</span><br><span class="line">    fire.Fire(calculator)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Define-subcommand">Define subcommand</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>使用函数</p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire()</span><br><span class="line"><span class="comment"># 显示指定暴露方法</span></span><br><span class="line"><span class="comment"># fire.Fire({</span></span><br><span class="line"><span class="comment">#   'add': add,</span></span><br><span class="line"><span class="comment">#   'mul': multiply,</span></span><br><span class="line"><span class="comment"># })</span></span><br></pre></td></tr></tbody></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="#using-class">使用类</a></p>
</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BrokenCalculator</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, offset=<span class="number">1</span></span>):</span><br><span class="line">        <span class="string">"""构造函数中定义了参数，那么这些参数(offset)都会作为整个命令行程序的选项参数。"""</span></span><br><span class="line">        <span class="variable language_">self</span>._offset = offset</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> x + y + <span class="variable language_">self</span>._offset</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> x * y + <span class="variable language_">self</span>._offset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire(BrokenCalculator)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python example.py --<span class="built_in">help</span></span><br><span class="line">INFO: Showing <span class="built_in">help</span> with the <span class="built_in">command</span> <span class="string">'example.py -- --help'</span>.</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    example.py</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">    example.py &lt;flags&gt;</span><br><span class="line"></span><br><span class="line">FLAGS</span><br><span class="line">    --offset=OFFSET</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Embedded-command">Embedded command</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IngestionStage</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Ingesting! Nom nom nom..."</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DigestionStage</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, volume=<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">" "</span>.join([<span class="string">"Burp!"</span>] * volume)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">status</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Satiated."</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ingestion = IngestionStage()</span><br><span class="line">        <span class="variable language_">self</span>.digestion = DigestionStage()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ingestion.run()  <span class="comment">#</span></span><br><span class="line">        <span class="variable language_">self</span>.digestion.run()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire(Pipeline)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Using-attr-access">Using attr access</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line">cities = {</span><br><span class="line">    <span class="string">"hz"</span>: (<span class="number">310000</span>, <span class="string">"杭州"</span>),</span><br><span class="line">    <span class="string">"bj"</span>: (<span class="number">100000</span>, <span class="string">"北京"</span>),</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">City</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, code</span>):</span><br><span class="line">        info = cities.get(code)</span><br><span class="line">        <span class="variable language_">self</span>.zipcode = info[<span class="number">0</span>] <span class="keyword">if</span> info <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.city = info[<span class="number">1</span>] <span class="keyword">if</span> info <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire(City)</span><br></pre></td></tr></tbody></table></figure>
<p>这里直接指定属性访问即可</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python example.py --code bj zipcode</span><br><span class="line">100000</span><br><span class="line">$ python example.py --code hz city</span><br><span class="line">杭州</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Using-command-chain">Using command chain</h3>
<p>实现命令链式调用, 需要在实例方法中返回 self.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.result = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.express = <span class="string">"0"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"<span class="subst">{self.express}</span> = <span class="subst">{self.result}</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="variable language_">self</span>.result += x</span><br><span class="line">        <span class="variable language_">self</span>.express = <span class="string">f"<span class="subst">{self.express}</span>+<span class="subst">{x}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="variable language_">self</span>.result -= x</span><br><span class="line">        <span class="variable language_">self</span>.express = <span class="string">f"<span class="subst">{self.express}</span>-<span class="subst">{x}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="variable language_">self</span>.result *= x</span><br><span class="line">        <span class="variable language_">self</span>.express = <span class="string">f"(<span class="subst">{self.express}</span>)*<span class="subst">{x}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">div</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="variable language_">self</span>.result /= x</span><br><span class="line">        <span class="variable language_">self</span>.express = <span class="string">f"(<span class="subst">{self.express}</span>)/<span class="subst">{x}</span>"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire(Calculator)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python calculator.py add 1 sub 2 mul 3 div 4</span><br><span class="line">((+<span class="number">1</span>-<span class="number">2</span>)*<span class="number">3</span>)/<span class="number">4</span> = -<span class="number">0.75</span></span><br><span class="line"></span><br><span class="line">$ python calculator.py add <span class="number">1</span> sub <span class="number">2</span> mul <span class="number">3</span> div <span class="number">4</span> add <span class="number">4</span> sub <span class="number">3</span> mul <span class="number">2</span> div <span class="number">1</span></span><br><span class="line">((((<span class="number">0</span>+<span class="number">1</span>-<span class="number">2</span>)*<span class="number">3</span>)/<span class="number">4</span>+<span class="number">4</span>-<span class="number">3</span>)*<span class="number">2</span>)/<span class="number">1</span> = <span class="number">0.5</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Using-args-and-kwargs">Using *args and **kwargs</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fargs</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="string">"""位置参数调用:python example.py fargs a b c"""</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fkwargs</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="string">"""选项参数调用:python example.py fargs --a a1 --b b1 --c c1"""</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    fire.Fire()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有使用分隔符，upper 被作为位置参数</span></span><br><span class="line">$ python example.py fargs a b c upper</span><br><span class="line">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'upper'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用了分隔符，upper(内置方法) 被作为子命令</span></span><br><span class="line">$ python example.py fargs a b c - upper</span><br><span class="line">(<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Parameter-type-in-fire">Parameter type in fire</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line">fire.Fire(<span class="keyword">lambda</span> obj: <span class="built_in">type</span>(obj).__name__)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ python example.py 10</span><br><span class="line">int</span><br><span class="line">$ python example.py 10.0</span><br><span class="line"><span class="built_in">float</span></span><br><span class="line">$ python example.py hello</span><br><span class="line">str</span><br><span class="line">$ python example.py <span class="string">'(1,2)'</span></span><br><span class="line">tuple</span><br><span class="line">$ python example.py [1,2]</span><br><span class="line">list</span><br><span class="line">$ python example.py True</span><br><span class="line">bool</span><br><span class="line">$ python example.py {name: David}</span><br><span class="line">dict</span><br><span class="line">$ python example.py <span class="string">'{"name": "David Bieber"}'</span></span><br><span class="line">dict</span><br></pre></td></tr></tbody></table></figure>
<h2 id="click">click</h2>
<!-- https://zhuanlan.zhihu.com/p/90307978 -->
<h3 id="Define-subcommand-2">Define subcommand</h3>
<p>click 创建子命令, 需要 click.group 创建一个命令组</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@click.group()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cli</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cli.command(<span class="params"><span class="string">'publish'</span></span>) </span><span class="comment"># 或 @cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">"--model_name"</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="built_in">help</span>=<span class="string">"Model name"</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">"--model_directory"</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="built_in">type</span>=click.Path(<span class="params">exists=<span class="literal">True</span>, readable=<span class="literal">True</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">    required=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="built_in">help</span>=<span class="string">"Model filepath"</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish</span>(<span class="params">model_name, model_directory, flavor</span>):</span><br><span class="line">    <span class="comment"># ... existing code ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    cli()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="pre-commit">pre-commit</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/pre-commit/pre-commit">pre-commit</a> 用于管理和维护多语言预提交挂钩的框架的使用经验。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pre-commit.com/">https://pre-commit.com/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/pre-commit/pre-commit">https://github.com/pre-commit/pre-commit</a></p>
</li>
</ul>
<h3 id="Install">Install</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该工具可通过 pip 直接安装。</span></span><br><span class="line">pip3 install pre-commit</span><br><span class="line"><span class="comment"># 集成到当前的项目当中</span></span><br><span class="line">pre-commit install</span><br></pre></td></tr></tbody></table></figure>
<h3 id="pre-commit-config-yaml">.pre-commit-config.yaml</h3>
<p><code>pre-commit</code> 工具通过配置文件 <code>.pre-commit-config.yaml</code> 控制代码提交等操作。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>创建文件该配置文件，放于根目录，或者使用 <code>pre-commit sample-config</code> 生成模板，相关模板字段含义参考 <a target="_blank" rel="noopener" href="https://pre-commit.com/#pre-commit-configyaml---top-level">官方文档</a>。</p>
</li>
<li class="lvl-2">
<p>根据需要自定义配置<a target="_blank" rel="noopener" href="https://pre-commit.com/hooks.html">插件 plugin</a>，这里以配置格式化工具 <a target="_blank" rel="noopener" href="https://github.com/psf/black">black</a> 工具为例。</p>
</li>
</ul>
<blockquote>
<p>[!TIP]<br>
配置好后，可使用 black 的徽章 <a target="_blank" rel="noopener" href="https://github.com/psf/black"><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://img.shields.io/badge/code%20style-black-000000.svg" alt="Code style: black."></a>，表示该项目通过该工具检查。</p>
<p>同样, 也可附上，pre-commit 的徽章 <a target="_blank" rel="noopener" href="https://github.com/pre-commit/pre-commit"><img data-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&amp;logoColor=white" alt="pre-commit."></a>。</p>
</blockquote>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">repos:</span></span><br><span class="line">  <span class="comment"># Black, the code formatter, natively supports pre-commit</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/psf/black</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">"22.6.0"</span> <span class="comment"># Keep in sync with blacken-docs</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">black</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Also code format the docs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/asottile/blacken-docs</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">"v1.12.1"</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">blacken-docs</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">black==22.6.0</span> <span class="comment"># keep in sync with black hook</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="pre-commit-cli">pre-commit cli</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有仓库代码都运行</span></span><br><span class="line">pre-commit run -a</span><br><span class="line"><span class="comment"># 注册提交阶段执行钩子</span></span><br><span class="line">pre-commit install --hook-type commit-msg</span><br><span class="line"><span class="comment"># 卸载相应钩子</span></span><br><span class="line">pre-commit uninstall --hook-type commit-msg --hook-type pre-commit</span><br><span class="line"><span class="comment"># 卸载 pre-commit 钩子</span></span><br><span class="line">pre-commit uninstall</span><br><span class="line"><span class="comment"># 执行对应配置钩子 black 格式化代码</span></span><br><span class="line">pre-commit run black</span><br></pre></td></tr></tbody></table></figure>
<h3 id="常用配置插件">常用配置插件</h3>
<p>这里给出实际项目中使用示例 <code>.pre-commit-config.yaml</code> ，并对某些字段附上了相应的说明。</p>
<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .pre-commit-config.yaml</span></span><br><span class="line"><span class="comment"># To use:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     pre-commit run -a</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Or:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     pre-commit install  # (runs every time you commit in git)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To update this file:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     pre-commit autoupdate</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See https://github.com/pre-commit/pre-commit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (optional: default false) set to true to have pre-commit stop running hooks after the first failure</span></span><br><span class="line"><span class="attr">fail_fast:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (optional: default ^$) global file exclude pattern.The below ignores sub/dir1, sub/dir2, *.drawio.</span></span><br><span class="line"><span class="attr">exclude:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  (?x)(</span></span><br><span class="line"><span class="string">    ^(sub/dir1) |</span></span><br><span class="line"><span class="string">    ^(sub/dir2) |</span></span><br><span class="line"><span class="string">    ^.*\.drawio</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment"># (optional: default '') global file include pattern.</span></span><br><span class="line"><span class="attr">files:</span> <span class="string">''</span> <span class="comment"># set '' as default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A list of repository mappings.</span></span><br><span class="line"><span class="attr">repos:</span></span><br><span class="line">  <span class="comment"># Standard hooks</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/pre-commit/pre-commit-hooks</span> <span class="comment"># the repository url to git clone from</span></span><br><span class="line">    <span class="comment"># the revision or tag to clone at</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v4.3.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="comment"># which hook from the repository to use.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-added-large-files</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-case-conflict</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-docstring-first</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-merge-conflict</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-toml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">debug-statements</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">end-of-file-fixer</span></span><br><span class="line">        <span class="attr">types_or:</span> [<span class="string">c</span>, <span class="string">c++</span>, <span class="string">cuda</span>, <span class="string">proto</span>, <span class="string">textproto</span>, <span class="string">java</span>, <span class="string">python</span>]</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">mixed-line-ending</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">requirements-txt-fixer</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">trailing-whitespace</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-yaml</span></span><br><span class="line">        <span class="attr">exclude:</span> <span class="string">^deploy(\/[^\/]+)*\/templates\/.*$</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-shebang-scripts-are-executable</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check yaml</span></span><br><span class="line">  <span class="comment"># - support gitlab reference syntax</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/macisamuele/language-formatters-pre-commit-hooks</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v2.10.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pretty-format-yaml</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--autofix</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--offset=2</span></span><br><span class="line">        <span class="comment"># - --preserve-quotes</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check yaml</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/lyz-code/yamlfix</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">1.13</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">yamlfix</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">-c</span> <span class="string">.yamlfix.toml</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Upgrade old Python syntax</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/asottile/pyupgrade</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v2.37.3</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pyupgrade</span></span><br><span class="line">        <span class="comment"># (optional) list of additional parameters to pass to the hook.</span></span><br><span class="line">        <span class="attr">args:</span> [<span class="string">--py37-plus</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Ruff, the Python auto-correcting linter written in Rust, Ruff can be used to</span></span><br><span class="line">  <span class="comment"># replace Flake8 (plus dozens of plugins), isort, pydocstyle, yesqa, eradicate,</span></span><br><span class="line">  <span class="comment"># pyupgrade, and autoflake</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/astral-sh/ruff-pre-commit</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v0.0.281</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">ruff</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="comment"># this should be placed after black, isort, and similar</span></span><br><span class="line">          <span class="comment"># tools when opoen fixing</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--fix</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--show-fixes</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Nicely sort includes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/pycqa/isort</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">5.12</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">isort</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">isort</span> <span class="string">(python)</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--profile=black</span></span><br><span class="line">          <span class="comment"># - --line-length=88</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Another nicely sort includes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/timothycrosley/isort</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">5.12</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">isort</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span> [<span class="string">toml</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Black, the code formatter, natively supports pre-commit</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/psf/black</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">22.6</span><span class="number">.0</span> <span class="comment"># Keep in sync with blacken-docs</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">black</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--line-length=88</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Also code format the docs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/asottile/blacken-docs</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v1.12.1</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">blacken-docs</span></span><br><span class="line">        <span class="comment"># (optional) a list of dependencies that will be installed in the environment where this</span></span><br><span class="line">        <span class="comment"># hook gets run. One useful application is to install plugins for hooks such as eslint.</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">black==22.6.0</span> <span class="comment"># keep in sync with black hook</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Black mirror, 2x faster black mirror</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/psf/black-pre-commit-mirror</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">23.7</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">black</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--line-length=88</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Changes tabs to spaces</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/Lucas-C/pre-commit-hooks</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v1.3.1</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">remove-tabs</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Autoremoves unused imports</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/hadialqattan/pycln</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v2.1.1</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pycln</span></span><br><span class="line">        <span class="comment"># (optional) confines the hook to the commit, merge-commit, push, prepare-commit-msg,</span></span><br><span class="line">        <span class="comment"># commit-msg, post-checkout, post-commit, post-merge, post-rewrite, or manual stage.</span></span><br><span class="line">        <span class="comment"># See https://pre-commit.com/#confining-hooks-to-run-at-certain-stages</span></span><br><span class="line">        <span class="attr">stages:</span> [<span class="string">manual</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Checking for common mistakes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/pre-commit/pygrep-hooks</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v1.9.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">python-check-blanket-noqa</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">python-check-blanket-type-ignore</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">python-no-log-warn</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">python-use-type-annotations</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Automatically remove noqa that are not used</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/asottile/yesqa</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v1.4.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">yesqa</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span> <span class="meta">&amp;flake8_dependencies</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">flake8-bugbear</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">pep8-naming</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Flake8 also supports pre-commit natively (same author)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/PyCQA/flake8</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">5.0</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">flake8</span></span><br><span class="line">        <span class="comment"># (optional) file exclude pattern.</span></span><br><span class="line">        <span class="attr">exclude:</span> <span class="string">^(docs/.*|tools/.*)$</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span> <span class="meta">*flake8_dependencies</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--max-line-length=120</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--show-source</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--exclude=.git,</span> <span class="string">__pycache__,</span> <span class="string">build,</span> <span class="string">dist,</span> <span class="string">docs,</span> <span class="string">tools,</span> <span class="string">venv,</span> <span class="string">.venv</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--extend-ignore=E203,</span> <span class="string">E722,</span> <span class="string">B950</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--extend-select=B9</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># PyLint has native support - very slow</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/PyCQA/pylint</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v2.14.5</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pylint</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># CMake formatting</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/cheshirekow/cmake-format-precommit</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v0.6.13</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cmake-format</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span> [<span class="string">pyyaml</span>]</span><br><span class="line">        <span class="comment"># (optional) override the default file types to run on (AND).</span></span><br><span class="line">        <span class="comment"># See https://pre-commit.com/#filtering-files-with-types</span></span><br><span class="line">        <span class="attr">types:</span> [<span class="string">file</span>]</span><br><span class="line">        <span class="attr">files:</span> <span class="string">(\.cmake|CMakeLists.txt)(.in)?$</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check static types with mypy</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/pre-commit/mirrors-mypy</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v0.971</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">mypy</span></span><br><span class="line">        <span class="attr">args:</span> []</span><br><span class="line">        <span class="attr">exclude:</span> <span class="string">^(tests|docs|setup.py)/</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span> [<span class="string">nox</span>, <span class="string">rich</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Checks the manifest for missing files (native support)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/mgedmin/check-manifest</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="number">0.48</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-manifest</span></span><br><span class="line">        <span class="comment"># This is a slow hook, so only run this if --hook-stage manual is passed</span></span><br><span class="line">        <span class="attr">stages:</span> [<span class="string">manual</span>]</span><br><span class="line">        <span class="attr">additional_dependencies:</span> [<span class="string">cmake</span>, <span class="string">ninja</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check json with comments</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://gitlab.com/bmares/check-json5</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v1.0.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">check-json5</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check for spelling</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/codespell-project/codespell</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v2.2.1</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">codespell</span></span><br><span class="line">        <span class="attr">exclude:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          (?x)(</span></span><br><span class="line"><span class="string">            ^(package-lock.json)</span></span><br><span class="line"><span class="string">          )</span></span><br><span class="line"><span class="string"></span>        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--skip=".vscode/"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--ignore-words-list="Transer,transer"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--check-filenames</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--write-changes</span> <span class="comment"># auto fix in place</span></span><br><span class="line">        <span class="comment"># using the pyproject.toml as the config file</span></span><br><span class="line">        <span class="attr">additional_dependencies:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">tomli</span></span><br><span class="line">    <span class="comment"># stages: [manual]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check for spelling</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/crate-ci/typos</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v1.16.2</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">typos</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check for common shell mistakes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/shellcheck-py/shellcheck-py</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v0.8.0.4</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">shellcheck</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Clang format the codebase automatically</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/pre-commit/mirrors-clang-format</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v14.0.6</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">clang-format</span></span><br><span class="line">        <span class="comment"># (optional: default []) list of file types to run on (OR). See Filtering files with types.</span></span><br><span class="line">        <span class="attr">types_or:</span> [<span class="string">c++</span>, <span class="string">c</span>, <span class="string">cuda</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Commitizen is a tool designed that obeys a standard way of committing rules.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/commitizen-tools/commitizen</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v2.32.1</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">commitizen</span></span><br><span class="line">        <span class="comment"># (optional: default (all stages)) confines the hook to the commit, merge-commit,</span></span><br><span class="line">        <span class="comment"># push, prepare-commit-msg, commit-msg, post-checkout, post-commit, post-merge,</span></span><br><span class="line">        <span class="comment"># post-rewrite, or manual stage. See Confining hooks to run at certain stages.</span></span><br><span class="line">        <span class="attr">stages:</span> [<span class="string">commit-msg</span>]</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">commitizen-branch</span></span><br><span class="line">        <span class="attr">stages:</span> [<span class="string">push</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check for markdown</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">repo:</span> <span class="string">https://github.com/igorshubovych/markdownlint-cli</span></span><br><span class="line">    <span class="attr">rev:</span> <span class="string">v0.35.0</span></span><br><span class="line">    <span class="attr">hooks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">markdownlint-fix</span></span><br><span class="line">  <span class="comment"># need rc config, such as https://github.com/msclock/blog_hexo/blob/master</span></span><br><span class="line">  <span class="comment"># related options for rc config, see https://github.com/DavidAnson/markdownlint#optionsconfig</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Integrate-with-CI">Integrate with CI</h3>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://lyz-code.github.io/blue-book/devops/ci/#configuring-pre-commit">https://lyz-code.github.io/blue-book/devops/ci/#configuring-pre-commit</a></p>
</li>
</ul>
<h4 id="gitlab-ci">gitlab ci</h4>
<p>赛选出需要使用的插件, 并结合 <a target="_blank" rel="noopener" href="https://gitlab.com/msclock/gitlab-ci-templates">gitlab ci templates</a> 进行配置.</p>
<h4 id="github-action">github action</h4>
<p>在 github 上配置 pre-commit 直接使用对应的 action 即可.</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Make commits from pre-commit</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">pre-commit</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">pre-commit:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">${{</span> <span class="string">secrets.PERSONAL_TOKEN</span> <span class="string">}}</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">python</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-python@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># Avoid checking out the repository in a detached state.</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">${{</span> <span class="string">github.head_ref</span> <span class="string">}}</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">pre-commit</span> <span class="string">on</span> <span class="string">codebase</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">pre-commit/action@v3.0.0</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Auto</span> <span class="string">fixes</span> <span class="string">from</span> <span class="string">pre-commit</span> <span class="string">on</span> <span class="string">failure</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">stefanzweifel/git-auto-commit-action@v4</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">failure()</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">commit_message:</span> <span class="string">"ci: auto fixes from pre-commit"</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Make pr from pre-commit</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">pre-commit</span> <span class="string">update</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="comment"># every day at midnight</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">"0 0 * * *"</span></span><br><span class="line">  <span class="comment"># on demand</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">pre-commit-auto-update:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Python</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-python@v3</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Update</span> <span class="string">pre-commit</span> <span class="string">hooks</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">browniebroke/pre-commit-autoupdate-action@main</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">pull</span> <span class="string">request</span> <span class="string">on</span> <span class="string">pre-commit</span> <span class="string">updates</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peter-evans/create-pull-request@v3</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">${{</span> <span class="string">always()</span> <span class="string">}}</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">branch:</span> <span class="string">update/pre-commit-hooks</span></span><br><span class="line">          <span class="attr">title:</span> <span class="string">Update</span> <span class="string">pre-commit</span> <span class="string">hooks</span></span><br><span class="line">          <span class="attr">commit-message:</span> <span class="string">"ci: update pre-commit hooks"</span></span><br><span class="line">          <span class="attr">body:</span> <span class="string">Update</span> <span class="string">available</span> <span class="string">versions</span> <span class="string">of</span> <span class="string">pre-commit</span> <span class="string">hooks</span> <span class="string">to</span> <span class="string">latest</span> <span class="string">version.</span></span><br><span class="line">          <span class="attr">delete-branch:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="dynaconf">dynaconf</h2>
<p><a target="_blank" rel="noopener" href="https://pypi.org/project/dynaconf/">dynaconf</a> 专用于工程配置管理包, 符合 <a target="_blank" rel="noopener" href="https://12factor.net/config">12factor config</a></p>
<h3 id="配置实例">配置实例</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置布局</span></span><br><span class="line">tree server/configs/</span><br><span class="line">server/configs/</span><br><span class="line">├── __init__.py</span><br><span class="line">├── config.py</span><br><span class="line">├── default_settings.yaml</span><br><span class="line">└── settings.yaml</span><br><span class="line"></span><br><span class="line">0 directories, 4 files</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default_settings.yaml</span></span><br><span class="line"><span class="comment"># 以下配置第一次加载的默认配置</span></span><br><span class="line"><span class="comment"># 然后读取 "configs/settings.yaml" 配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认配置的环境配置</span></span><br><span class="line"><span class="attr">default:</span></span><br><span class="line">  <span class="attr">base:</span> <span class="string">"@jinja <span class="template-variable">{{this.current_env | lower}}</span>"</span></span><br><span class="line">  <span class="attr">logging:</span> <span class="string">"debug"</span> <span class="comment"># 默认debug级，python日志等级 debug &lt; info &lt; warning &lt; error &lt; critical;若设置的level&gt;调用的函数，则不会输出</span></span><br><span class="line">  <span class="attr">open_gpu_mode:</span> <span class="literal">true</span> <span class="comment"># 是否以 gpu 模式调度AI模型。</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">true</span> <span class="comment"># 是否以 hot reload 模式启动服务</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5000</span> <span class="comment"># http 暴露服务端口</span></span><br><span class="line">  <span class="attr">protocol:</span> <span class="string">"application/x-protobuf-json"</span> <span class="comment"># http 协议</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 默认全局数据缓存目录环境配置</span></span><br><span class="line">  <span class="attr">global_dir:</span></span><br><span class="line">    <span class="comment"># 全局数据的文件夹名称</span></span><br><span class="line">    <span class="attr">cache_data:</span> <span class="string">"cache_data"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下的 dwg 文件缓存文件夹名称，默认为 cache_data/dwg_file_cache</span></span><br><span class="line">    <span class="attr">dwg_file_cache:</span> <span class="string">"dwg_file_cache"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下中间结果数据缓存文件夹名称，默认为 cache_data/mid_data_cache</span></span><br><span class="line">    <span class="attr">mid_data_cache:</span> <span class="string">"mid_data_cache"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下结果数据缓存文件夹名称，默认为 cache_data/result_data_cache</span></span><br><span class="line">    <span class="attr">result_data_cache:</span> <span class="string">"result_data_cache"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下目标检测数据缓存文件夹名称，默认为 cache_data/detection_data_cache</span></span><br><span class="line">    <span class="attr">detection_data_cache:</span> <span class="string">"detection_data_cache"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下消息数据缓存文件夹名称，默认为 cache_data/message_data_cache</span></span><br><span class="line">    <span class="attr">message_data_cache:</span> <span class="string">"message_data_cache"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下消息数据缓存文件夹名称，默认为 cache_data/origin_data_cache</span></span><br><span class="line">    <span class="attr">origin_data_cache:</span> <span class="string">"origin_data_cache"</span></span><br><span class="line">    <span class="comment"># 全局数据路径下日志所在路径，默认为 .log</span></span><br><span class="line">    <span class="attr">log_dir:</span> <span class="string">".log"</span></span><br><span class="line">    <span class="comment"># 全局日志名称，默认为 .log/service.log</span></span><br><span class="line">    <span class="attr">log_name:</span> <span class="string">"service"</span></span><br><span class="line">    <span class="comment"># 工程日志路径，默认：cache_data/log_data_cache</span></span><br><span class="line">    <span class="attr">log_data_cache:</span> <span class="string">"log_data_cache"</span></span><br><span class="line">    <span class="comment"># 工程日志路径，默认：cache_data/cpp_parameters_cache</span></span><br><span class="line">    <span class="attr">cpp_parameters_cache:</span> <span class="string">"cpp_parameters_cache"</span></span><br><span class="line">    <span class="comment"># 工程日志路径，默认：cache_data/backup_dara_cache</span></span><br><span class="line">    <span class="attr">backup_dara_cache:</span> <span class="string">"backup_dara_cache"</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.yaml</span></span><br><span class="line"><span class="comment"># 以下配置会默认覆盖从 "configs/default_settings.yaml" 中加载的值</span></span><br><span class="line"></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">dynaconf_merge:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">base:</span> <span class="string">"production"</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.py</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> dynaconf <span class="keyword">import</span> Dynaconf, Validator</span><br><span class="line"></span><br><span class="line">CONFIG_PATH = pathlib.Path(__file__).resolve().parent</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a Dynaconf instance to manage settings</span></span><br><span class="line">settings = Dynaconf(</span><br><span class="line">    <span class="comment"># Switch between environments using the "LAUNCH_ENV" environment variable</span></span><br><span class="line">    env_switcher=<span class="string">"LAUNCH_ENV"</span>,</span><br><span class="line">    <span class="comment"># List of configuration files to load</span></span><br><span class="line">    settings_files=[</span><br><span class="line">        CONFIG_PATH / <span class="string">"default_settings.yaml"</span>,  <span class="comment"># Default configuration</span></span><br><span class="line">        CONFIG_PATH / <span class="string">"settings.yaml"</span>,  <span class="comment"># Main configuration</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Enable layered environments (development, production, default)</span></span><br><span class="line">    environments=<span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># Prefix for environment variables (e.g., "CONF_FOO=bar" becomes "settings.foo == "bar"")</span></span><br><span class="line">    envvar_prefix=<span class="string">"CONF"</span>,</span><br><span class="line">    lowercase_read=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the environment to "config"</span></span><br><span class="line">settings.setenv(<span class="string">"config"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register validators to ensure required settings exist</span></span><br><span class="line">settings.validators.register(</span><br><span class="line">    Validator(<span class="string">"base"</span>, must_exist=<span class="literal">True</span>),</span><br><span class="line">    Validator(<span class="string">"logging"</span>, must_exist=<span class="literal">True</span>),</span><br><span class="line">    Validator(<span class="string">"open_gpu_mode"</span>, must_exist=<span class="literal">True</span>),</span><br><span class="line">    Validator(<span class="string">"port"</span>, must_exist=<span class="literal">True</span>),</span><br><span class="line">    Validator(<span class="string">"protocol"</span>, must_exist=<span class="literal">True</span>),</span><br><span class="line">    Validator(<span class="string">"global_dir"</span>, must_exist=<span class="literal">True</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert settings to a JSON string with custom formatting options</span></span><br><span class="line">final_settings = json.dumps(</span><br><span class="line">    settings.to_dict(),</span><br><span class="line">    indent=<span class="number">4</span>,</span><br><span class="line">    ensure_ascii=<span class="literal">False</span>,</span><br><span class="line">    sort_keys=<span class="literal">False</span>,</span><br><span class="line">    separators=(<span class="string">","</span>, <span class="string">":"</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the final settings to a JSON file named ".settings.json"</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">".settings.json"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(final_settings)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable debug mode when running in a debugger</span></span><br><span class="line"><span class="keyword">if</span> sys.gettrace() <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    settings.debug = <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure>
<p>配置好后, 可使用命令查看配置环境生效的环境结果</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看生效 settings 环境</span></span><br><span class="line">dynaconf -i server.configs.config.settings list</span><br><span class="line">Working <span class="keyword">in</span> config environment</span><br><span class="line">BASE&lt;str&gt; <span class="string">'production'</span></span><br><span class="line">LOGGING&lt;str&gt; <span class="string">'debug'</span></span><br><span class="line">OPEN_GPU_MODE&lt;bool&gt; True</span><br><span class="line">DEBUG&lt;bool&gt; True</span><br><span class="line">PORT&lt;int&gt; 5000</span><br><span class="line">PROTOCOL&lt;str&gt; <span class="string">'application/x-protobuf-json'</span></span><br><span class="line">GLOBAL_DIR&lt;dict&gt; {<span class="string">'backup_dara_cache'</span>: <span class="string">'backup_dara_cache'</span>,</span><br><span class="line"> <span class="string">'cache_data'</span>: <span class="string">'cache_data'</span>,</span><br><span class="line"> <span class="string">'cpp_parameters_cache'</span>: <span class="string">'cpp_parameters_cache'</span>,</span><br><span class="line"> <span class="string">'detection_data_cache'</span>: <span class="string">'detection_data_cache'</span>,</span><br><span class="line"> <span class="string">'dwg_file_cache'</span>: <span class="string">'dwg_file_cache'</span>,</span><br><span class="line"> <span class="string">'log_data_cache'</span>: <span class="string">'log_data_cache'</span>,</span><br><span class="line"> <span class="string">'log_dir'</span>: <span class="string">'.log'</span>,</span><br><span class="line"> <span class="string">'log_name'</span>: <span class="string">'service'</span>,</span><br><span class="line"> <span class="string">'message_data_cache'</span>: <span class="string">'message_data_cache'</span>,</span><br><span class="line"> <span class="string">'mid_data_cache'</span>: <span class="string">'mid_data_cache'</span>,</span><br><span class="line"> <span class="string">'origin_data_cache'</span>: <span class="string">'origin_data_cache'</span>,</span><br><span class="line"> <span class="string">'result_data_cache'</span>: <span class="string">'result_data_cache'</span>}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="loguru">loguru</h2>
<p><a target="_blank" rel="noopener" href="https://pypi.org/project/loguru/">loguru</a> 是一个使 python 日志使用更加方便的包</p>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://loguru.readthedocs.io/en/stable/">loguru</a></p>
</li>
</ul>
<h3 id="Install-2">Install</h3>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install loguru</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Usage">Usage</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loguru</span><br><span class="line"></span><br><span class="line">loguru.logger.add(<span class="string">"file.log"</span>, <span class="built_in">format</span>=<span class="string">"{time} {level} {message}"</span>, level=<span class="string">"DEBUG"</span>)</span><br><span class="line"></span><br><span class="line">loguru.logger.debug(<span class="string">"This is a debug message"</span>)</span><br><span class="line">loguru.logger.info(<span class="string">"This is an info message"</span>)</span><br><span class="line">loguru.logger.warning(<span class="string">"This is a warning message"</span>)</span><br><span class="line">loguru.logger.error(<span class="string">"This is an error message"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="pydantic">pydantic</h2>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=XIdQ6gO3Anc">https://www.youtube.com/watch?v=XIdQ6gO3Anc</a></p>
</li>
</ul>
<h2 id="pyscript">pyscript</h2>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pyscript.net/">https://pyscript.net/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://pyscript.com/@examples">official examples</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.freecodecamp.org/chinese/news/pyscript-python-front-end-framework/">https://www.freecodecamp.org/chinese/news/pyscript-python-front-end-framework/</a></p>
</li>
</ul>
<h2 id="gitpython">gitpython</h2>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/gitpython-developers/GitPython">https://github.com/gitpython-developers/GitPython</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/msclock/sphinx-deployment">usage example 1 in sphinx_deployment</a></p>
</li>
</ul>
<h2 id="pyenv">pyenv</h2>
<p>轻松管理 python 版本。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip install pyenv</span><br><span class="line">curl https://pyenv.run | bash</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$HOME</span>/.pyenv/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="subst">$(pyenv init - bash)</span>"</span></span><br><span class="line">pyenv install 3.10.6</span><br><span class="line">pyenv shell 3.10.6</span><br><span class="line">python --version</span><br></pre></td></tr></tbody></table></figure>
<p>links:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv">https://github.com/pyenv/pyenv</a></p>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Msclock
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://msclock.github.io/posts/afa93b42/" title="python">https://msclock.github.io/posts/afa93b42/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/2985153235/" rel="prev" title="ssh 实践">
                  <i class="fa fa-angle-left"></i> ssh 实践
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/459958868/" rel="next" title="态度">
                  态度 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81Njg4MS8zMzM0NQ=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Msclock</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">426k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:27</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/msclock" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.25.0/source/js/third-party/comments/livere.min.js" defer></script>


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body>
</html>
